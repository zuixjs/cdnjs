define(function(b,a,c){var e=b("../../lib/oop");var h=b("./fold_mode").FoldMode;var g=b("../../range").Range;var d=b("../../token_iterator").TokenIterator;var f=a.FoldMode=function(){};e.inherits(f,h);(function(){this.foldingStartMarker=/^\s*\\(begin)|(section|subsection)\b|{\s*$/;this.foldingStopMarker=/^\s*\\(end)\b|^\s*}/;this.getFoldWidgetRange=function(l,k,m){var i=l.doc.getLine(m);var j=this.foldingStartMarker.exec(i);if(j){if(j[1]){return this.latexBlock(l,m,j[0].length-1)}if(j[2]){return this.latexSection(l,m,j[0].length-1)}return this.openingBracketBlock(l,"{",m,j.index)}var j=this.foldingStopMarker.exec(i);if(j){if(j[1]){return this.latexBlock(l,m,j[0].length-1)}return this.closingBracketBlock(l,"}",m,j.index+j[0].length)}};this.latexBlock=function(r,v,m){var o={"\\begin":1,"\\end":-1};var u=new d(r,v,m);var n=u.getCurrentToken();if(!n||n.type!=="keyword"){return}var j=n.value;var k=o[j];var q=function(){var w=u.stepForward();var x=w.type=="lparen"?u.stepForward().value:"";if(k===-1){u.stepBackward();if(x){u.stepBackward()}}return x};var s=[q()];var l=k===-1?u.getCurrentTokenColumn():r.getLine(v).length;var t=v;u.step=k===-1?u.stepBackward:u.stepForward;while(n=u.step()){if(n.type!=="keyword"){continue}var i=o[n.value];if(!i){continue}var p=q();if(i===k){s.unshift(p)}else{if(s.shift()!==p||!s.length){break}}}if(s.length){return}var v=u.getCurrentTokenRow();if(k===-1){return new g(v,r.getLine(v).length,t,l)}u.stepBackward();return new g(t,l,v,u.getCurrentTokenColumn())};this.latexSection=function(p,r,j){var n=["\\subsection","\\section","\\begin","\\end"];var q=new d(p,r,j);var k=q.getCurrentToken();if(!k||k.type!="keyword"){return}var m=n.indexOf(k.value);var o=0;var l=r;while(k=q.stepForward()){if(k.type!=="keyword"){continue}var i=n.indexOf(k.value);if(i>=2){if(!o){l=q.getCurrentTokenRow()-1}o+=i==2?1:-1;if(o<0){break}}else{if(i>=m){break}}}if(!o){l=q.getCurrentTokenRow()-1}while(l>r&&!/\S/.test(p.getLine(l))){l--}return new g(r,p.getLine(r).length,l,p.getLine(l).length)}}).call(f.prototype)});