(function($){var globalDefaults={};$.dynatableSetup=function(options){$.extend(true,globalDefaults,options)};$.dynatable=function(element,options){var defaults={features:{paginate:true,sort:true,pushState:true,search:true,recordCount:true,perPageSelect:true},table:{defaultColumnIdStyle:"camelCase",columns:null,headRowSelector:"thead tr",bodyRowSelector:"tbody tr",headRowClass:null,rowFilter:function(rowIndex,record,columns,cellFilter){var $tr=$("<tr></tr>");$.each(columns,function(colIndex,column){var html=column.dataFilter(record),$td=cellFilter(html);if(column.hidden){$td.hide()}if(column.textAlign){$td.css("text-align",column.textAlign)}$tr.append($td)});return $tr},cellFilter:function(html){return $("<td></td>",{html:html})}},inputs:{queries:null,sorts:null,multisort:["ctrlKey","shiftKey","metaKey"],page:null,queryEvent:"blur change",recordCountTarget:null,recordCountPlacement:"after",paginationLinkTarget:null,paginationLinkPlacement:"after",paginationPrev:"Previous",paginationNext:"Next",paginationGap:[1,2,2,1],searchTarget:null,searchPlacement:"before",perPageTarget:null,perPagePlacement:"before",perPageText:"Show: ",recordCountText:"Showing ",processingText:"Processing..."},dataset:{ajax:false,ajaxUrl:null,ajaxCache:null,ajaxOnLoad:false,ajaxMethod:"GET",ajaxDataType:"json",totalRecordCount:null,queries:null,queryRecordCount:null,page:null,perPageDefault:10,perPageOptions:[10,20,50,100],sorts:null,sortsKeys:null,sortTypes:{},records:null},filters:{},unfilters:{},params:{dynatable:"dynatable",queries:"queries",sorts:"sorts",page:"page",perPage:"perPage",offset:"offset",records:"records",record:null,queryRecordCount:"queryRecordCount",totalRecordCount:"totalRecordCount"}},plugin=this,$element=$(element),settings;plugin.settings={};plugin.init=function(){if(options){if(options.inputs){if(options.inputs.multisort){defaults.inputs.multisort=undefined;if(globalDefaults.inputs&&globalDefaults.inputs.multisort){globalDefaults.inputs.multisort=undefined}}if(options.inputs.paginationGap){defaults.inputs.paginationGap=undefined;if(globalDefaults.inputs&&globalDefaults.inputs.paginationGap){globalDefaults.inputs.paginationGap=undefined}}}if(options.dataset&&options.dataset.perPageOptions){defaults.dataset.perPageOptions=undefined;if(globalDefaults.dataset&&globalDefaults.dataset.perPageOptions){globalDefaults.dataset.perPageOptions=undefined}}}plugin.settings=settings=$.extend(true,{},defaults,globalDefaults,options);plugin.processingIndicator.attach();settings.table.columns=[];if($element.is("table")){plugin.columns.getFromTable()}if(settings.dataset.records===null&&!settings.dataset.ajax){settings.dataset.records=plugin.records.getFromTable()}if(!settings.dataset.queryRecordCount){settings.dataset.queryRecordCount=plugin.records.count()}if(!settings.dataset.totalRecordCount){settings.dataset.totalRecordCount=settings.dataset.queryRecordCount}var sortsUrl=window.location.search.match(new RegExp(settings.params.sorts+"[^&=]*=[^&]*","g")),queriesUrl=window.location.search.match(new RegExp(settings.params.queries+"[^&=]*=[^&]*","g")),pageUrl=window.location.search.match(new RegExp(settings.params.page+"=([^&]*)")),perPageUrl=window.location.search.match(new RegExp(settings.params.perPage+"=([^&]*)"));settings.dataset.queries=queriesUrl?plugin.utility.deserialize(queriesUrl)[settings.params.queries]:{};if(settings.dataset.queries===""){settings.dataset.queries={}}if(settings.features.recordCount){plugin.recordCount.attach()}if(settings.features.search){plugin.search.attach()}if(!settings.dataset.ajax){settings.dataset.originalRecords=$.extend(true,[],settings.dataset.records)}if(settings.features.paginate){if(perPageUrl){plugin.perPage.set(perPageUrl[1])}else{plugin.perPage.set(settings.dataset.perPageDefault)}plugin.page.set(pageUrl?pageUrl[1]:1);plugin.paginationLinks.attach();if(settings.features.perPageSelect){plugin.perPage.attach()}}if(settings.features.sort){settings.dataset.sorts=sortsUrl?plugin.utility.deserialize(sortsUrl)[settings.params.sorts]:{};settings.dataset.sortsKeys=sortsUrl?plugin.utility.keysFromObject(settings.dataset.sorts):[];plugin.sortHeaders.attach()}if(settings.inputs.queries){plugin.queries.setupInputs()}$element.trigger("dynatable:init",plugin);if(!settings.dataset.ajax||settings.dataset.ajax&&settings.dataset.ajaxOnLoad||settings.features.paginate){plugin.process()}if(settings.features.pushState&&history.pushState){window.onpopstate=function(event){if(event.state&&event.state.dynatable){plugin.state.pop(event)}}}};plugin.process=function(skipPushState){var data={};$element.trigger("dynatable:beforeProcess",data);if(!$.isEmptyObject(settings.dataset.queries)){data[settings.params.queries]=settings.dataset.queries}plugin.processingIndicator.show();if(settings.features.sort&&!$.isEmptyObject(settings.dataset.sorts)){data[settings.params.sorts]=settings.dataset.sorts}if(settings.features.paginate&&settings.dataset.page){var page=settings.dataset.page,perPage=settings.dataset.perPage;data[settings.params.page]=page;data[settings.params.perPage]=perPage;data[settings.params.offset]=(page-1)*perPage}if(settings.dataset.ajaxData){$.extend(data,settings.dataset.ajaxData)}if(settings.dataset.ajax){var options={type:settings.dataset.ajaxMethod,dataType:settings.dataset.ajaxDataType,data:data,success:function(response){$element.trigger("dynatable:ajax:success",response);plugin.records.updateFromJson(response);plugin.table.update();if(settings.features.pushState&&!skipPushState&&history.pushState){plugin.state.push(data)}},complete:function(){plugin.processingIndicator.hide()}};if(settings.dataset.ajaxUrl){options.url=settings.dataset.ajaxUrl}else{options.url=plugin.utility.refreshQueryString(window.location.href,{})}if(settings.dataset.ajaxCache!==null){options.cache=settings.dataset.ajaxCache}$.ajax(options)}else{plugin.records.resetOriginal();plugin.queries.run();if(settings.features.sort){plugin.records.sort()}if(settings.features.paginate){plugin.records.paginate()}plugin.table.update();plugin.processingIndicator.hide();if(settings.features.pushState&&!skipPushState&&history.pushState){plugin.state.push(data)}}$element.trigger("dynatable:afterProcess",data)};plugin.state={push:function(data){var urlString=window.location.search,urlOptions,newParams,cacheStr,cache;if(urlString&&/^\?/.test(urlString)){urlString=urlString.substring(1)}$.extend(urlOptions,data);params=plugin.utility.refreshQueryString(urlString,data);$element.trigger("dynatable:push",data);cache={dynatable:{dataset:settings.dataset}};cacheStr=JSON.stringify(cache);cache.dynatable.dataset.perPageOptions=$.makeArray(cache.dynatable.dataset.perPageOptions);try{window.history.pushState(cache,"Dynatable state","?"+params)}catch(error){cache.dynatable.dataset.records=null;window.history.pushState(cache,"Dynatable state","?"+params)}},pop:function(event){var data=event.state.dynatable;settings.dataset=data.dataset;if(data.dataset.records){plugin.table.update()}else{plugin.process(true)}}};plugin.table={update:function(){var $rows=$(),columns=settings.table.columns,rowFilter=settings.table.rowFilter,cellFilter=settings.table.cellFilter;$element.trigger("dynatable:beforeUpdate",$rows);$.each(settings.dataset.records,function(rowIndex,record){var $tr=rowFilter(rowIndex,record,columns,cellFilter);$rows=$rows.add($tr)});if(settings.features.recordCount){$("#dynatable-record-count-"+element.id).replaceWith(plugin.recordCount.create())}if(settings.features.paginate){$("#dynatable-pagination-links-"+element.id).replaceWith(plugin.paginationLinks.create());if(settings.features.perPageSelect){$("#dynatable-per-page-"+element.id).val(parseInt(settings.dataset.perPage))}}if(settings.features.sort){plugin.sortHeaders.removeAllArrows();$.each(columns,function(){var column=this,sortedByColumn=plugin.utility.allMatch(settings.dataset.sorts,column.sorts,function(sorts,sort){return sort in sorts}),value=settings.dataset.sorts[column.sorts[0]];if(sortedByColumn){$element.find('[data-dynatable-column="'+column.id+'"]').find(".dynatable-sort-header").each(function(){if(value==1){plugin.sortHeaders.appendArrowUp($(this))}else{plugin.sortHeaders.appendArrowDown($(this))}})}})}if(settings.inputs.queries){settings.inputs.queries.each(function(){var $this=$(this),q=settings.dataset.queries[$this.data("dynatable-query")];$(this).val(q||"")})}$element.find(settings.table.bodyRowSelector).remove();$element.append($rows);$element.trigger("dynatable:afterUpdate",$rows)}};plugin.sortHeaders={create:function(cell){var $cell=$(cell),$link=$("<a></a>",{"class":"dynatable-sort-header",href:"#",html:$cell.html()}),id=$cell.data("dynatable-column"),column=plugin.utility.findObjectInArray(settings.table.columns,{id:id});$link.bind("click",function(e){plugin.sortHeaders.toggleSort(e,$link,column);plugin.process();e.preventDefault()});if(plugin.sortHeaders.sortedByColumn($link,column)){if(plugin.sortHeaders.sortedByColumnValue(column)==1){plugin.sortHeaders.appendArrowUp($link)}else{plugin.sortHeaders.appendArrowDown($link)}}return $link},attach:function(){$element.find(settings.table.headRowSelector).children("th,td").each(function(){plugin.sortHeaders.attachOne(this)})},attachOne:function(cell){var $cell=$(cell);if(!$cell.data("dynatable-no-sort")){$cell.html(plugin.sortHeaders.create(cell))}},appendArrowUp:function($link){plugin.sortHeaders.removeArrow($link);$link.append("<span class='dynatable-arrow'> &#9650;</span>")},appendArrowDown:function($link){plugin.sortHeaders.removeArrow($link);$link.append("<span class='dynatable-arrow'> &#9660;</span>")},removeArrow:function($link){$link.find(".dynatable-arrow").remove()},removeAllArrows:function(){$element.find(".dynatable-arrow").remove()},toggleSort:function(e,$link,column){var sortedByColumn=plugin.sortHeaders.sortedByColumn($link,column),value=plugin.sortHeaders.sortedByColumnValue(column);if(!settings.inputs.multisort||!plugin.utility.anyMatch(e,settings.inputs.multisort,function(evt,key){return e[key]})){plugin.sortHeaders.removeAllArrows();plugin.sorts.clear()}if(sortedByColumn){if(value==1){$.each(column.sorts,function(index,key){plugin.sorts.add(key,-1)});plugin.sortHeaders.appendArrowDown($link)}else{$.each(column.sorts,function(index,key){plugin.sorts.remove(key)});plugin.sortHeaders.removeArrow($link)}}else{$.each(column.sorts,function(index,key){plugin.sorts.add(key,1)});plugin.sortHeaders.appendArrowUp($link)}},sortedByColumn:function($link,column){return plugin.utility.allMatch(settings.dataset.sorts,column.sorts,function(sorts,sort){return sort in sorts})},sortedByColumnValue:function(column){return settings.dataset.sorts[column.sorts[0]]}};plugin.sorts={add:function(attr,direction){var sortsKeys=settings.dataset.sortsKeys,index=$.inArray(attr,sortsKeys);settings.dataset.sorts[attr]=direction;if(index===-1){sortsKeys.push(attr)}return plugin},remove:function(attr){var sortsKeys=settings.dataset.sortsKeys,index=$.inArray(attr,sortsKeys);delete settings.dataset.sorts[attr];if(index!==-1){sortsKeys.splice(index,1)}return plugin},clear:function(){settings.dataset.sorts={};settings.dataset.sortsKeys.length=0},guessType:function(a,b,attr){var types={string:"string",number:"number","boolean":"number",object:"number"},attrType=a[attr]?typeof a[attr]:typeof b[attr],type=types[attrType]||"number";return type},functions:{number:function(a,b,attr,direction){return a[attr]===b[attr]?0:direction>0?a[attr]-b[attr]:b[attr]-a[attr]},string:function(a,b,attr,direction){var aAttr=a["dynatable-sortable-text"]&&a["dynatable-sortable-text"][attr]?a["dynatable-sortable-text"][attr]:a[attr],bAttr=b["dynatable-sortable-text"]&&b["dynatable-sortable-text"][attr]?b["dynatable-sortable-text"][attr]:b[attr],comparison;aAttr=aAttr.toLowerCase();bAttr=bAttr.toLowerCase();comparison=aAttr===bAttr?0:direction>0?aAttr>bAttr:bAttr>aAttr;return comparison===false?-1:comparison-0},originalPlacement:function(a,b){return a["dynatable-original-index"]-b["dynatable-original-index"]}}};plugin.page={set:function(page){settings.dataset.page=parseInt(page,10)}};plugin.queries={add:function(name,value){if(settings.features.paginate){settings.dataset.page=1}settings.dataset.queries[name]=value;return plugin},remove:function(name){delete settings.dataset.queries[name];return plugin},run:function(){$.each(settings.dataset.queries,function(query,value){if(plugin.queries.functions[query]===undefined){var queryColumn=plugin.utility.findObjectInArray(settings.table.columns,{id:query});if(queryColumn){plugin.queries.functions[query]=function(record,queryValue){return record[query]==queryValue}}else{$.error("Query named '"+query+"' called, but not defined in queries.functions");return true}}settings.dataset.records=$.map(settings.dataset.records,function(record){return plugin.queries.functions[query](record,value)?record:null})});settings.dataset.queryRecordCount=plugin.records.count()},runSearch:function(q){var origQueries=$.extend({},settings.dataset.queries);if(q){plugin.queries.add("search",q)}else{plugin.queries.remove("search")}if(!plugin.utility.objectsEqual(settings.dataset.queries,origQueries)){plugin.process()}},setupInputs:function(){settings.inputs.queries.each(function(){var $this=$(this),event=$this.data("dynatable-query-event")||settings.inputs.queryEvent,query=$this.data("dynatable-query")||$this.attr("name")||this.id,queryFunction=function(e){var q=$(this).val();if(q===""){q=undefined}if(q===settings.dataset.queries[query]){return false}if(q){plugin.queries.add(query,q)}else{plugin.queries.remove(query)}plugin.process();e.preventDefault()};$this.attr("data-dynatable-query",query).bind(event,queryFunction).bind("keypress",function(e){if(e.which==13){queryFunction.call(this,e)}});if(settings.dataset.queries[query]){$this.val(decodeURIComponent(settings.dataset.queries[query]))}})},functions:{search:function(record,queryValue){var contains=false;$.each(record,function(attr,attrValue){if(typeof attrValue==="string"&&attrValue.toLowerCase().indexOf(queryValue.toLowerCase())!==-1){contains=true;return false}else{return true}});return contains}}};plugin.paginationLinks={create:function(){var $pageLinks=$("<ul></ul>",{id:"dynatable-pagination-links-"+element.id,"class":"dynatable-pagination-links",html:"<span>Pages: </span>"}),pageLinkClass="dynatable-page-link",activePageClass="dynatable-active-page",pages=Math.ceil(settings.dataset.queryRecordCount/settings.dataset.perPage),page=settings.dataset.page,breaks=[settings.inputs.paginationGap[0],settings.dataset.page-settings.inputs.paginationGap[1],settings.dataset.page+settings.inputs.paginationGap[2],pages+1-settings.inputs.paginationGap[3]],$link;for(var i=1;i<=pages;i++){if(i>breaks[0]&&i<breaks[1]||i>breaks[2]&&i<breaks[3]){continue}else{$link=$("<a></a>",{html:i,"class":pageLinkClass,"data-dynatable-page":i}).appendTo($pageLinks);if(page==i){$link.addClass(activePageClass)}var breakIndex=$.inArray(i,breaks),nextBreak=breaks[breakIndex+1];if(breakIndex>0&&i!==1&&nextBreak&&nextBreak>i+1){var $ellip=$('<span class="dynatable-page-break">&hellip;</span>');$link=breakIndex<2?$link.before($ellip):$link.after($ellip)}}if(settings.inputs.paginationPrev&&i===1){var $prevLink=$("<a></a>",{html:settings.inputs.paginationPrev,"class":pageLinkClass+" dynatable-page-prev","data-dynatable-page":page-1});if(page===1){$prevLink.addClass(activePageClass)}$link=$link.before($prevLink)}if(settings.inputs.paginationNext&&i===pages){var $nextLink=$("<a></a>",{html:settings.inputs.paginationNext,"class":pageLinkClass+" dynatable-page-next","data-dynatable-page":page+1});if(page===pages){$nextLink.addClass(activePageClass)}$link=$link.after($nextLink)}}$pageLinks.children().wrap("<li></li>");var selector="#dynatable-pagination-links-"+element.id+" ."+pageLinkClass+":not(."+activePageClass+")";$(document).undelegate(selector,"click.dynatable");$(document).delegate(selector,"click.dynatable",function(e){$this=$(this);$this.closest(".dynatable-pagination-links").find("."+activePageClass).removeClass(activePageClass);$this.addClass(activePageClass);plugin.page.set($this.data("dynatable-page"));plugin.process();e.preventDefault()});return $pageLinks},attach:function(){var $target=settings.inputs.paginationLinkTarget?$(settings.inputs.paginationLinkTarget):$element;$target[settings.inputs.paginationLinkPlacement](plugin.paginationLinks.create())}};plugin.search={create:function(){var $search=$("<input />",{type:"search",id:"dynatable-query-search-"+element.id,value:settings.dataset.queries.search}),$searchSpan=$("<span></span>",{id:"dynatable-search-"+element.id,"class":"dynatable-search",text:"Search: "}).append($search);$search.bind(settings.inputs.queryEvent,function(){plugin.queries.runSearch($(this).val())}).bind("keypress",function(e){if(e.which==13){plugin.queries.runSearch($(this).val());e.preventDefault()}});return $searchSpan},attach:function(){var $target=settings.inputs.searchTarget?$(settings.inputs.searchTarget):$element;$target[settings.inputs.searchPlacement](plugin.search.create())}};plugin.perPage={create:function(){var $select=$("<select>",{id:"dynatable-per-page-"+element.id,"class":"dynatable-per-page-select"});$.each(settings.dataset.perPageOptions,function(index,number){var selected=settings.dataset.perPage==number?'selected="selected"':"";$select.append('<option value="'+number+'" '+selected+">"+number+"</option>")});$select.bind("change",function(e){plugin.perPage.set($(this).val());plugin.process()});return $("<span />",{"class":"dynatable-per-page"}).append("<span class='dynatable-per-page-label'>"+settings.inputs.perPageText+"</span>").append($select)},attach:function(){var $target=settings.inputs.perPageTarget?$(settings.inputs.perPageTarget):$element;$target[settings.inputs.perPagePlacement](plugin.perPage.create())},set:function(number){plugin.page.set(1);settings.dataset.perPage=parseInt(number)}};plugin.recordCount={create:function(){var recordsShown=plugin.records.count(),recordsQueryCount=settings.dataset.queryRecordCount,recordsTotal=settings.dataset.totalRecordCount,text=settings.inputs.recordCountText,collection_name=settings.params.records;if(recordsShown<recordsQueryCount&&settings.features.paginate){var bounds=plugin.records.pageBounds();text+="<span class='dynatable-record-bounds'>"+(bounds[0]+1)+" to "+bounds[1]+"</span> of "}else if(recordsShown===recordsQueryCount&&settings.features.paginate){text+=recordsShown+" of "}text+=recordsQueryCount+" "+collection_name;if(recordsQueryCount<recordsTotal){text+=" (filtered from "+recordsTotal+" total records)"}return $("<span></span>",{id:"dynatable-record-count-"+element.id,"class":"dynatable-record-count",html:text})},attach:function(){var $target=settings.inputs.recordCountTarget?$(settings.inputs.recordCountTarget):$element;$target[settings.inputs.recordCountPlacement](plugin.recordCount.create())}};plugin.processingIndicator={create:function(){var $processing=$("<div></div>",{html:"<span>"+settings.inputs.processingText+"</span>",id:"dynatable-processing-"+element.id,"class":"dynatable-processing",style:"position: absolute; display: none;"});return $processing},position:function(){var $processing=$("#dynatable-processing-"+element.id),$span=$processing.children("span"),spanHeight=$span.outerHeight(),spanWidth=$span.outerWidth(),$covered=$element,offset=$covered.offset(),height=$covered.outerHeight(),width=$covered.outerWidth();$processing.offset({left:offset.left,top:offset.top}).width(width).height(height);$span.offset({left:offset.left+(width-spanWidth)/2,top:offset.top+(height-spanHeight)/2});return $processing},attach:function(){$element.before(plugin.processingIndicator.create())},show:function(){$("#dynatable-processing-"+element.id).show();plugin.processingIndicator.position()},hide:function(){$("#dynatable-processing-"+element.id).hide()}};plugin.records={updateFromJson:function(data){var records;if(settings.params.records==="_root"){records=data}else if(settings.params.records in data){records=data[settings.params.records]}if(settings.params.record){var len=records.length-1;for(var i=0;i<len;i++){records[i]=records[i][settings.params.record]}}if(settings.params.queryRecordCount in data){settings.dataset.queryRecordCount=data[settings.params.queryRecordCount]}if(settings.params.totalRecordCount in data){settings.dataset.totalRecordCount=data[settings.params.totalRecordCount]}settings.dataset.records=records},sort:function(){var sort=[].sort,sorts=settings.dataset.sorts,sortsKeys=settings.dataset.sortsKeys,sortTypes=settings.dataset.sortTypes;var sortFunction=function(a,b){var comparison;if($.isEmptyObject(sorts)){comparison=plugin.sorts.functions["originalPlacement"](a,b)}else{$.each(sortsKeys,function(index,attr){var direction=sorts[attr],sortType=sortTypes[attr]||plugin.sorts.guessType(a,b,attr);comparison=plugin.sorts.functions[sortType](a,b,attr,direction);return comparison==0})}return comparison};return sort.call(settings.dataset.records,sortFunction)},paginate:function(){var bounds=plugin.records.pageBounds(),first=bounds[0],last=bounds[1];settings.dataset.records=settings.dataset.records.slice(first,last)},resetOriginal:function(){settings.dataset.records=$.extend(true,[],settings.dataset.originalRecords)},pageBounds:function(){var page=settings.dataset.page||1,first=(page-1)*settings.dataset.perPage,last=Math.min(first+settings.dataset.perPage,settings.dataset.queryRecordCount);return[first,last]},getFromTable:function(){var records=[],columns=settings.table.columns,tableRecords=$element.find(settings.table.bodyRowSelector);tableRecords.each(function(index){var record={};record["dynatable-original-index"]=index;$(this).find("th,td").each(function(index){if(columns[index]===undefined){plugin.columns.add(plugin.columns.generate(),columns.length,false,true)}var value=columns[index].dataUnfilter(this,record),attr=columns[index].id;if(typeof value==="string"&&value.match(/\s*\<.+\>/)){if(!record["dynatable-sortable-text"]){record["dynatable-sortable-text"]={}}record["dynatable-sortable-text"][attr]=$.trim($("<div></div>").html(value).text())}record[attr]=value});if(typeof settings.table.rowUnfilter==="function"){settings.table.rowUnfilter(index,this,record)}records.push(record)});return records},count:function(){return settings.dataset.records.length}};plugin.columns={getFromTable:function(){var $columns=$element.find(settings.table.headRowSelector).children("th,td");if($columns.length){$columns.each(function(index){plugin.columns.add($(this),index,true)})}else{return $.error("Couldn't find any columns headers in '"+settings.table.headRowSelector+" th,td'. If your header row is different, specify the selector in the table: headRowSelector option.")}},add:function($column,position,skipAppend,skipUpdate){var columns=settings.table.columns,label=$column.text(),id=$column.data("dynatable-column")||plugin.utility.normalizeText(label),dataSorts=$column.data("dynatable-sorts"),sorts=dataSorts?$.map(dataSorts.split(","),function(text){return $.trim(text)}):[id];if(!id){plugin.columns.generate($column);id=$column.data("dynatable-column")}columns.splice(position,0,{index:position,label:label,id:id,dataFilter:settings.filters[id]||plugin.columns.defaultFilter,dataUnfilter:settings.unfilters[id]||plugin.columns.defaultUnfilter,sorts:sorts,hidden:$column.css("display")==="none",textAlign:$column.css("text-align")});$column.attr("data-dynatable-column",id).addClass("dynatable-head");if(settings.table.headRowClass){$column.addClass(settings.table.headRowClass)}if(!skipAppend){var domPosition=position+1,$sibling=$element.find(settings.table.headRowSelector).children("th:nth-child("+domPosition+"),td:nth-child("+domPosition+")").first(),columnsAfter=columns.slice(position+1,columns.length);if($sibling.length){$sibling.before($column)}else{$element.find(settings.table.headRowSelector).append($column)}plugin.sortHeaders.attachOne($column.get());if(columnsAfter.length){$.each(columnsAfter,function(){this.index+=1})}if(!skipUpdate){plugin.table.update()}}return plugin},remove:function(columnIndexOrId){var columns=settings.table.columns,length=columns.length;if(typeof columnIndexOrId==="number"){var column=columns[columnIndexOrId];plugin.columns.removeFromTable(column.id);plugin.columns.removeFromArray(columnIndexOrId)}else{for(var i=columns.length-1;i>=0;i--){var column=columns[i];if(column.id===columnIndexOrId){plugin.columns.removeFromTable(columnIndexOrId);plugin.columns.removeFromArray(i)}}}plugin.table.update()},removeFromTable:function(columnId){$element.find(settings.table.headRowSelector).children('[data-dynatable-column="'+columnId+'"]').first().remove()},removeFromArray:function(index){var columns=settings.table.columns;columns.splice(index,1);$.each(columns.slice(index,columns.length),function(){this.index-=1})},defaultFilter:function(record){return record[this.id]},defaultUnfilter:function(cell,record){return $(cell).html()},generate:function($cell){var cell=$cell===undefined?$("<th></th>"):$cell;return plugin.columns.attachGeneratedAttributes(cell)},attachGeneratedAttributes:function($cell){var increment=$element.find(settings.table.headRowSelector).children("th[data-dynatable-generated]").length;return $cell.attr("data-dynatable-column","dynatable-generated-"+increment).attr("data-dynatable-no-sort","true").attr("data-dynatable-generated",increment)}};plugin.utility={normalizeText:function(text){var style=settings.table.defaultColumnIdStyle;text=plugin.utility.textTransform[style](text);return text},textTransform:{trimDash:function(text){return text.replace(/^\s+|\s+$/g,"").replace(/\s+/g,"-")},camelCase:function(text){text=plugin.utility.textTransform.trimDash(text);return text.replace(/(\-[a-zA-Z])/g,function($1){return $1.toUpperCase().replace("-","")}).replace(/([A-Z])([A-Z]+)/g,function($1,$2,$3){return $2+$3.toLowerCase()}).replace(/^[A-Z]/,function($1){return $1.toLowerCase()})},dashed:function(text){text=plugin.utility.textTransform.trimDash(text);return plugin.utility.textTransform.lowercase(text)},underscore:function(text){text=plugin.utility.textTransform.trimDash(text);return plugin.utility.textTransform.lowercase(text.replace(/(-)/g,"_"))},lowercase:function(text){return text.replace(/([A-Z])/g,function($1){return $1.toLowerCase()})}},deserialize:function(query){if(!query)return{};if(typeof query==="object"){query=query.join("&")}var hash={},vars=query.split("&");for(var i=0;i<vars.length;i++){var pair=vars[i].split("="),k=decodeURIComponent(pair[0]),v,m;if(!pair[1]){continue}v=decodeURIComponent(pair[1].replace(/\+/g," "));while(m=k.match(/([^&=]+)\[([^&=]+)\]$/)){var origV=v;k=m[1];v={};if(m[2].substr(m[2].length-2)=="]["){v[m[2].substr(0,m[2].length-2)]=[origV]}else{v[m[2]]=origV}}if(typeof hash[k]==="undefined"){if(k.substr(k.length-2)!="[]"){hash[k]=v}else{hash[k]=[v]}}else if(typeof hash[k]==="string"){hash[k]=v}else if(typeof hash[k]==="object"){hash[k]=$.extend({},hash[k],v)}else{hash[k].push(v)}}return hash},refreshQueryString:function(urlString,data){var queryString=urlString.split("?"),path=queryString.shift(),urlOptions;urlOptions=plugin.utility.deserialize(urlString);$.each(settings.params,function(attr,label){if(!settings.features.sort&&attr=="sorts"||!settings.features.paginate&&plugin.utility.anyMatch(attr,["page","perPage","offset"],function(attr,param){return attr==param})){return true}if((attr==="page"||attr==="offset")&&data["page"]===1){if(urlOptions[label]){delete urlOptions[label]}return true}if(attr==="perPage"&&data[label]==settings.dataset.perPageDefault){if(urlOptions[label]){delete urlOptions[label]}return true}if(attr=="queries"&&data[label]){var queries=settings.inputs.queries||[],inputQueries=$.makeArray(queries.map(function(){return $(this).attr("name")}));$.each(inputQueries,function(i,attr){if(data[label][attr]){if(typeof urlOptions[label]==="undefined"){urlOptions[label]={}}urlOptions[label][attr]=data[label][attr]}else{delete urlOptions[label][attr]}});return true}if(data[label]){urlOptions[label]=data[label]}else{delete urlOptions[label]}});return decodeURI($.param(urlOptions))},keysFromObject:function(obj){var keys=[];for(var key in obj){keys.push(key)}return keys},findObjectInArray:function(array,objectAttr){var foundObject;$.each(array,function(index,item){if(plugin.utility.allMatch(item,objectAttr,function(item,key,value){return item[key]==value})){foundObject=item;return false}});return foundObject},allMatch:function(item,arrayOrObject,test){var match=true,isArray=$.isArray(arrayOrObject);$.each(arrayOrObject,function(key,value){var result=isArray?test(item,value):test(item,key,value);if(!result){return match=false}});return match},anyMatch:function(item,arrayOrObject,test){var match=false,isArray=$.isArray(arrayOrObject);$.each(arrayOrObject,function(key,value){var result=isArray?test(item,value):test(item,key,value);if(result){match=true;return false}});return match},objectsEqual:function(a,b){for(attr in a){if(a.hasOwnProperty(attr)){if(!b.hasOwnProperty(attr)||a[attr]!==b[attr]){return false}}}for(attr in b){if(b.hasOwnProperty(attr)&&!a.hasOwnProperty(attr)){return false}}return true},randomHash:function(){return((1+Math.random())*65536|0).toString(16).substring(1)}};plugin.init()};$.fn.dynatable=function(options){return this.each(function(){if(undefined==$(this).data("dynatable")){var plugin=new $.dynatable(this,options);$(this).data("dynatable",plugin)}})}})(jQuery);
