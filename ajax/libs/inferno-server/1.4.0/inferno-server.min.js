!(function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("inferno"),require("stream")):"function"==typeof define&&define.amd?define(["exports","inferno","stream"],t):t(e["inferno-server"]=e["inferno-server"]||{},e.Inferno,e.stream)})(this,(function(e,t,r){"use strict";function n(e){var t=typeof e;return"string"===t||"number"===t}function o(e){return c(e)||a(e)}function i(e){return a(e)||e===!1||p(e)||c(e)}function u(e){return"function"==typeof e}function s(e){return"number"==typeof e}function a(e){return null===e}function p(e){return e===!0}function c(e){return void 0===e}function l(e){throw e||(e=b),new Error("Inferno Error: "+e)}function d(e,t){var r,n={};if(e)for(r in e)n[r]=e[r];if(t)for(r in t)n[r]=t[r];return n}function f(e){return String(e).replace(/[<>"'&]/g,P)}function h(e){return e.replace(A,"-$&").toLowerCase().replace(E,"-ms-")}function v(e){return!!I[e]}function m(e){if(n(e))return e;var r="";for(var i in e){var u=e[i],a=s(u)&&!t.internal_isUnitlessNumber[i]?"px":"";o(u)||(r+=h(i)+":"+f(u)+a+";")}return r}function y(e,r,s,h){var g=e.flags,T=e.type,S=e.props||t.EMPTY_OBJ,_=e.children;if(28&g){if(4&g){var Q,M=new T(S,s);c(M.getChildContext)||(Q=M.getChildContext()),o(Q)||(s=d(s,Q)),M.props===t.EMPTY_OBJ&&(M.props=S),M.context=s,M._pendingSetState=!0,M._unmounted=!1,u(M.componentWillMount)&&M.componentWillMount();var x=M.render(S,e.context);return M._pendingSetState=!1,i(x)?"<!--!-->":y(x,e,s,!0)}var N=T(S,s);return i(N)?"<!--!-->":y(N,e,s,!0)}if(3970&g){var C,b="<"+T,w=v(T);if(!a(S))for(var P in S){var A=S[P];"dangerouslySetInnerHTML"===P?C=A.__html:"style"===P?b+=' style="'+m(S.style)+'"':"className"!==P||o(A)?"children"===P||("defaultValue"===P?S.value||(b+=' value="'+f(A)+'"'):"defaultChecked"===P?S.checked||(b+=' checked="'+A+'"'):"value"===P&&r.props&&r.props.value?A===r.props.value&&(b+=" selected"):n(A)?b+=" "+P+'="'+f(A)+'"':p(A)&&(b+=" "+P)):b+=' class="'+f(A)+'"'}if(w)b+=">";else{if(b+=">",i(_))C&&(b+=C);else if(k(_))for(var E=0,I=_.length;E<I;E++){var j=_[E];n(j)?b+=""===j?" ":f(j):i(j)||(b+=y(j,e,s,0===E))}else b+=n(_)?""===_?" ":f(_):y(_,e,s,!0);w||(b+="</"+T+">")}return b}if(1&g)return(h?"":"<!---->")+(""===_?" ":f(_));l()}function g(e){return y(e,{},{},!0)}function T(e){return y(e,{},{},!0)}function S(e){if(n(e))return e;var r=[];for(var i in e){var u=e[i],a=s(u)&&!t.internal_isUnitlessNumber[i]?"px":"";o(u)||r.push(h(i)+":"+f(u)+a+";")}return r.join()}function _(e){var t=[];return(e&&Object.keys(e)||[]).forEach((function(r,o){var i=e[r];switch(r){case"children":case"dangerouslySetInnerHTML":case"className":case"style":return;default:n(i)?t.push(f(r)+'="'+f(i)+'"'):p(i)&&t.push(f(r))}})),t}function Q(e){return new V(e,!1)}function M(e){return new V(e,!0)}function x(e){if(n(e))return e;var r="";for(var i in e){var u=e[i],a=s(u)&&!t.internal_isUnitlessNumber[i]?"px":"";o(u)||(r+=h(i)+":"+f(u)+a+";")}return r}function N(e){return new O(e,!1)}function C(e){return new O(e,!0)}var b="a runtime error occured! Use Inferno in development environment to find the error.",k=Array.isArray,w={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;","&":"&amp;"},P=function(e){return w[e]||e},A=/[A-Z]/g,E=/^ms-/,I={area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},j=Promise.resolve(),V=(function(e){function t(t,r){e.call(this),this.started=!1,this.initNode=t,this.staticMarkup=r}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype._read=function(){var e=this;this.started||(this.started=!0,j.then((function(){return e.renderNode(e.initNode,null,e.staticMarkup)})).then((function(){e.push(null)})).catch((function(t){e.emit("error",t)})))},t.prototype.renderNode=function(e,t,r){if(!i(e)){var n=e.flags;return 28&n?this.renderComponent(e,r,t,4&n):3970&n?this.renderElement(e,r,t):this.renderText(e,r,t)}},t.prototype.renderComponent=function(e,t,r,n){var i=this,u=e.type,s=e.props;if(!n)return this.renderNode(u(s),r,t);var a,p=new u(s);return c(p.getChildContext)||(a=p.getChildContext()),o(a)||(r=d(r,a)),p.context=r,p._pendingSetState=!0,Promise.resolve(p.componentWillMount&&p.componentWillMount()).then((function(){var e=p.render();return p._pendingSetState=!1,i.renderNode(e,r,t)}))},t.prototype.renderChildren=function(e,t){var r=this;if(n(e))return this.push(f(e));if(e){var o=k(e);if(!o&&!i(e))return this.renderNode(e,t,!1);if(!o)throw new Error("invalid component");return e.reduce((function(e,o){return e.then((function(e){var u=n(o);return u?(e===!0&&r.push("<!---->"),u&&r.push(f(o)),!0):k(o)?(r.push("<!---->"),Promise.resolve(r.renderChildren(o)).then((function(){return r.push("<!--!-->"),!0}))):i(o)?void 0:(1&o.flags&&(e&&r.push("<!---->"),e=!0),Promise.resolve(r.renderNode(o,t,!1)).then((function(e){return!!(1&o.flags)})))}))}),Promise.resolve(!1))}},t.prototype.renderText=function(e,t,r){var n=this;return j.then((function(t){return n.push(e.children),t}))},t.prototype.renderElement=function(e,t,r){var n=this,i=e.type,u=e.props,s=_(u),a="";if(u){var p=u.className;o(p)||s.push('class="'+f(p)+'"');var c=u.style;c&&s.push('style="'+S(c)+'"'),u.dangerouslySetInnerHTML&&(a=u.dangerouslySetInnerHTML.__html)}if(t&&s.push("data-infernoroot"),this.push("<"+i+(s.length>0?" "+s.join(" "):"")+">"),!v(i))return a?(this.push(a),void this.push("</"+i+">")):Promise.resolve(this.renderChildren(e.children,r)).then((function(){n.push("</"+i+">")}))},t})(r.Readable),O=(function(e){function r(t,r){e.call(this),this.started=!1,this.collector=[1/0],this.promises=[],this.pushQueue=this.pushQueue.bind(this),t&&this.renderVNodeToQueue(t,null,r,null)}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype._read=function(){setTimeout(this.pushQueue,0)},r.prototype.addToQueue=function(e,t){if(o(t))"string"==typeof e&&this.collector.length-1==0?this.push(e):"string"==typeof e&&"string"==typeof this.collector[this.collector.length-2]?this.collector[this.collector.length-2]+=e:this.collector.splice(-1,0,e);else{var r=this.promises[t].length-1;"string"==typeof this.promises[t][r]&&"string"==typeof e?this.promises[t][r]+=e:this.promises[t].push(e)}},r.prototype.pushQueue=function(){var e=this.collector[0];if("string"==typeof e)this.push(e),this.collector.shift();else if(e&&("object"==typeof e||u(e))&&u(e.then)){var t=this;e.then((function(e){(r=t.collector).splice.apply(r,[0,1].concat(t.promises[e])),t.promises[e]=null,setTimeout(t.pushQueue,0);var r})),this.collector[0]=null}else e===1/0&&this.emit("end")},r.prototype.renderVNodeToQueue=function(e,r,s,h){var m=this;if(i(e))return void this.addToQueue("<!--!-->",h);var y=e.flags,g=e.type,T=e.props||t.EMPTY_OBJ,S=e.children;if(28&y){if(4&y){var _,Q=new g(T,r);if(c(Q.getChildContext)||(_=Q.getChildContext()),o(_)||(r=d(r,_)),Q.props===t.EMPTY_OBJ&&(Q.props=T),Q.context=r,Q._pendingSetState=!0,Q._unmounted=!1,u(Q.componentWillMount)&&Q.componentWillMount(),u(Q.getInitialProps)){var M=Q.getInitialProps(Q.props,Q.context);if(M){if(Promise.resolve(M)===M){var N=this.promises.push([])-1;return void this.addToQueue(M.then((function(e){return Q._pendingSetState=!1,"object"==typeof e&&(Q.props=d(Q.props,e)),m.renderVNodeToQueue(Q.render(Q.props,Q.context),Q.context,!0,N),setTimeout(m.pushQueue,0),N})),h)}Q.props=d(Q.props,M)}}var C=Q.render(T,e.context);Q._pendingSetState=!1,this.renderVNodeToQueue(C,r,!0,h)}else{var b=g(T,r);this.renderVNodeToQueue(b,r,!0,h)}}else if(3970&y){var w,P="<"+g,A=v(g);if(!a(T))for(var E in T){var I=T[E];"dangerouslySetInnerHTML"===E?w=I.__html:"style"===E?P+=' style="'+x(T.style)+'"':"className"!==E||o(I)?"children"===E||("defaultValue"===E?T.value||(P+=' value="'+f(I)+'"'):"defaultChecked"===E?T.checked||(P+=' checked="'+I+'"'):n(I)?P+=" "+E+'="'+f(I)+'"':p(I)&&(P+=" "+E)):P+=' class="'+f(I)+'"'}if(A)this.addToQueue(P+">",h);else{if(P+=">",i(S)){if(w)return void this.addToQueue(P+w+"</"+g+">",h)}else{if(!k(S))return n(S)?void this.addToQueue(P+f(S)+"</"+g+">",h):(this.addToQueue(P,h),this.renderVNodeToQueue(S,r,!0,h),void this.addToQueue("</"+g+">",h));this.addToQueue(P,h),P="";for(var j=0,V=S.length;j<V;j++){var O=S[j];n(O)?m.addToQueue(f(S),h):i(O)||m.renderVNodeToQueue(O,r,0===j,h)}}A||this.addToQueue(P+"</"+g+">",h)}}else 1&y?this.addToQueue((s?"":"<!---->")+f(S),h):l()},r})(r.Readable),L={renderToString:g,renderToStaticMarkup:T,streamAsString:Q,streamAsStaticMarkup:M,RenderStream:V,RenderQueueStream:O,streamQueueAsString:N,streamQueueAsStaticMarkup:C};e.default=L,e.renderToString=g,e.renderToStaticMarkup=T,e.streamAsString=Q,e.streamAsStaticMarkup=M,e.RenderStream=V,e.RenderQueueStream=O,e.streamQueueAsString=N,e.streamQueueAsStaticMarkup=C,Object.defineProperty(e,"__esModule",{value:!0})}));
