/*! OOjs UI v0.25.0 | http://oojs.mit-license.org */
!function(t){"use strict";t.ui.mixin.DraggableElement=function(t){t=t||{},this.index=null,this.$handle=t.$handle||this.$element,this.wasHandleUsed=null,this.$element.addClass("oo-ui-draggableElement").on({mousedown:this.onDragMouseDown.bind(this),dragstart:this.onDragStart.bind(this),dragover:this.onDragOver.bind(this),dragend:this.onDragEnd.bind(this),drop:this.onDrop.bind(this)}),this.$handle.addClass("oo-ui-draggableElement-handle"),this.toggleDraggable(void 0===t.draggable||!!t.draggable)},t.initClass(t.ui.mixin.DraggableElement),t.ui.mixin.DraggableElement.static.cancelButtonMouseDownEvents=!1,t.ui.mixin.DraggableElement.prototype.toggleDraggable=function(t){t=void 0!==t?!!t:!this.draggable,this.draggable!==t&&(this.draggable=t,this.$handle.toggleClass("oo-ui-draggableElement-undraggable",!this.draggable),this.$element.prop("draggable",this.draggable))},t.ui.mixin.DraggableElement.prototype.isDraggable=function(){return this.draggable},t.ui.mixin.DraggableElement.prototype.onDragMouseDown=function(e){this.isDraggable()&&(this.wasHandleUsed=this.$handle[0]===this.$element[0]||t.ui.contains(this.$handle[0],e.target,!0))},t.ui.mixin.DraggableElement.prototype.onDragStart=function(t){var e=this,i=t.originalEvent.dataTransfer;if(!this.wasHandleUsed||!this.isDraggable())return!1;i.dropEffect="none",i.effectAllowed="move";try{i.setData("application-x/OOjs-UI-draggable",this.getIndex())}catch(t){}return this.$element.addClass("oo-ui-draggableElement-clone"),setTimeout(function(){e.$element.removeClass("oo-ui-draggableElement-clone").addClass("oo-ui-draggableElement-placeholder")}),this.emit("dragstart",this),!0},t.ui.mixin.DraggableElement.prototype.onDragEnd=function(){this.$element.removeClass("oo-ui-draggableElement-placeholder"),this.emit("dragend")},t.ui.mixin.DraggableElement.prototype.onDrop=function(t){t.preventDefault(),this.emit("drop",t)},t.ui.mixin.DraggableElement.prototype.onDragOver=function(t){t.preventDefault()},t.ui.mixin.DraggableElement.prototype.setIndex=function(t){this.index!==t&&(this.index=t,this.$element.data("index",t))},t.ui.mixin.DraggableElement.prototype.getIndex=function(){return this.index},t.ui.mixin.DraggableGroupElement=function(e){e=e||{},t.ui.mixin.GroupElement.call(this,e),this.orientation=e.orientation||"vertical",this.dragItem=null,this.itemKeys={},this.dir=null,this.itemsOrder=null,this.draggable=void 0===e.draggable||!!e.draggable,this.aggregate({dragstart:"itemDragStart",dragend:"itemDragEnd",drop:"itemDrop"}),this.connect(this,{itemDragStart:"onItemDragStart",itemDrop:"onItemDropOrDragEnd",itemDragEnd:"onItemDropOrDragEnd"}),Array.isArray(e.items)&&this.addItems(e.items),this.$element.addClass("oo-ui-draggableGroupElement").toggleClass("oo-ui-draggableGroupElement-horizontal","horizontal"===this.orientation)},t.mixinClass(t.ui.mixin.DraggableGroupElement,t.ui.mixin.GroupElement),t.ui.mixin.DraggableGroupElement.prototype.toggleDraggable=function(t){t=void 0!==t?!!t:!this.draggable,this.draggable!==t&&(this.draggable=t,this.getItems().forEach(function(t){t.toggleDraggable(this.draggable)}.bind(this)),this.emit("draggable",this.draggable))},t.ui.mixin.DraggableGroupElement.prototype.isDraggable=function(){return this.draggable},t.ui.mixin.DraggableGroupElement.prototype.onItemDragStart=function(t){this.isDraggable()&&(this.itemsOrder=this.items.slice(),this.updateIndexes(),"horizontal"===this.orientation&&(this.dir=this.$element.css("direction")),this.setDragItem(t))},t.ui.mixin.DraggableGroupElement.prototype.updateIndexes=function(){var t,e;for(t=0,e=this.itemsOrder.length;t<e;t++)this.itemsOrder[t].setIndex(t)},t.ui.mixin.DraggableGroupElement.prototype.onItemDropOrDragEnd=function(){var t,e,i=this.getDragItem();return i&&(e=this.items.indexOf(i),(t=i.getIndex()+(i.getIndex()>e?1:0))!==e&&(this.reorder(this.getDragItem(),t),this.emit("reorder",this.getDragItem(),t)),this.updateIndexes()),this.unsetDragItem(),!1},t.ui.mixin.DraggableGroupElement.prototype.onDragOver=function(t){var e,i,n=this.getDragItem(),s=n.getIndex();void 0!==(e=$(t.target).closest(".oo-ui-draggableElement").data("index"))&&e!==s&&((i=e+(e>s?1:0))>0?this.$group.children().eq(i-1).after(n.$element):this.$group.prepend(n.$element),this.itemsOrder.splice(e,0,this.itemsOrder.splice(s,1)[0]),this.updateIndexes(),this.emit("drag",n,i)),t.preventDefault()},t.ui.mixin.DraggableGroupElement.prototype.reorder=function(t,e){this.addItems([t],e)},t.ui.mixin.DraggableGroupElement.prototype.setDragItem=function(t){this.dragItem!==t&&(this.dragItem=t,this.$element.on("dragover",this.onDragOver.bind(this)),this.$element.addClass("oo-ui-draggableGroupElement-dragging"))},t.ui.mixin.DraggableGroupElement.prototype.unsetDragItem=function(){this.dragItem&&(this.dragItem=null,this.$element.off("dragover"),this.$element.removeClass("oo-ui-draggableGroupElement-dragging"))},t.ui.mixin.DraggableGroupElement.prototype.getDragItem=function(){return this.dragItem},t.ui.mixin.RequestManager=function(){this.requestCache={},this.requestQuery=null,this.requestRequest=null},t.initClass(t.ui.mixin.RequestManager),t.ui.mixin.RequestManager.prototype.getRequestData=function(){var t,e=this,i=this.getRequestQuery(),n=$.Deferred();return this.abortRequest(),Object.prototype.hasOwnProperty.call(this.requestCache,i)?n.resolve(this.requestCache[i]):(this.pushPending&&this.pushPending(),this.requestQuery=i,(t=this.requestRequest=this.getRequest()).always(function(){e.popPending&&e.popPending()}).done(function(s){t===e.requestRequest&&(e.requestQuery=null,e.requestRequest=null,e.requestCache[i]=e.getRequestCacheDataFromResponse(s),n.resolve(e.requestCache[i]))}).fail(function(){t===e.requestRequest&&(e.requestQuery=null,e.requestRequest=null,n.reject())})),n.promise()},t.ui.mixin.RequestManager.prototype.abortRequest=function(){var t=this.requestRequest;t&&(this.requestRequest=null,this.requestQuery=null,t.abort())},t.ui.mixin.RequestManager.prototype.getRequestQuery=null,t.ui.mixin.RequestManager.prototype.getRequest=null,t.ui.mixin.RequestManager.prototype.getRequestCacheDataFromResponse=null,t.ui.mixin.LookupElement=function(e){e=$.extend({highlightFirst:!0},e),t.ui.mixin.RequestManager.call(this,e),this.$overlay=(!0===e.$overlay?t.ui.getDefaultOverlay():e.$overlay)||this.$element,this.lookupMenu=new t.ui.MenuSelectWidget({widget:this,input:this,$floatableContainer:e.$container||this.$element}),this.allowSuggestionsWhenEmpty=e.allowSuggestionsWhenEmpty||!1,this.lookupsDisabled=!1,this.lookupInputFocused=!1,this.lookupHighlightFirstItem=e.highlightFirst,this.$input.on({focus:this.onLookupInputFocus.bind(this),blur:this.onLookupInputBlur.bind(this),mousedown:this.onLookupInputMouseDown.bind(this)}),this.connect(this,{change:"onLookupInputChange"}),this.lookupMenu.connect(this,{toggle:"onLookupMenuToggle",choose:"onLookupMenuItemChoose"}),this.$input.attr({role:"combobox","aria-owns":this.lookupMenu.getElementId(),"aria-autocomplete":"list"}),this.$element.addClass("oo-ui-lookupElement"),this.lookupMenu.$element.addClass("oo-ui-lookupElement-menu"),this.$overlay.append(this.lookupMenu.$element)},t.mixinClass(t.ui.mixin.LookupElement,t.ui.mixin.RequestManager),t.ui.mixin.LookupElement.prototype.onLookupInputFocus=function(){this.lookupInputFocused=!0,this.populateLookupMenu()},t.ui.mixin.LookupElement.prototype.onLookupInputBlur=function(){this.closeLookupMenu(),this.lookupInputFocused=!1},t.ui.mixin.LookupElement.prototype.onLookupInputMouseDown=function(){this.lookupInputFocused&&!this.lookupMenu.isVisible()&&this.populateLookupMenu()},t.ui.mixin.LookupElement.prototype.onLookupInputChange=function(){this.lookupInputFocused&&this.populateLookupMenu()},t.ui.mixin.LookupElement.prototype.onLookupMenuToggle=function(t){t||(this.abortLookupRequest(),this.lookupMenu.clearItems())},t.ui.mixin.LookupElement.prototype.onLookupMenuItemChoose=function(t){this.setValue(t.getData())},t.ui.mixin.LookupElement.prototype.getLookupMenu=function(){return this.lookupMenu},t.ui.mixin.LookupElement.prototype.setLookupsDisabled=function(t){this.lookupsDisabled=!!t},t.ui.mixin.LookupElement.prototype.openLookupMenu=function(){return this.lookupMenu.isEmpty()||this.lookupMenu.toggle(!0),this},t.ui.mixin.LookupElement.prototype.closeLookupMenu=function(){return this.lookupMenu.toggle(!1),this.abortLookupRequest(),this.lookupMenu.clearItems(),this},t.ui.mixin.LookupElement.prototype.populateLookupMenu=function(){var t=this,e=this.getValue();if(!this.lookupsDisabled&&!this.isReadOnly())return this.allowSuggestionsWhenEmpty||""!==e?e!==this.lookupQuery&&this.getLookupMenuItems().done(function(e){t.lookupMenu.clearItems(),e.length?(t.lookupMenu.addItems(e).toggle(!0),t.initializeLookupMenuSelection()):t.lookupMenu.toggle(!1)}).fail(function(){t.lookupMenu.clearItems()}):this.closeLookupMenu(),this},t.ui.mixin.LookupElement.prototype.initializeLookupMenuSelection=function(){this.lookupHighlightFirstItem&&!this.lookupMenu.getSelectedItem()&&this.lookupMenu.highlightItem(this.lookupMenu.findFirstSelectableItem())},t.ui.mixin.LookupElement.prototype.getLookupMenuItems=function(){return this.getRequestData().then(function(t){return this.getLookupMenuOptionsFromData(t)}.bind(this))},t.ui.mixin.LookupElement.prototype.abortLookupRequest=function(){this.abortRequest()},t.ui.mixin.LookupElement.prototype.getLookupRequest=null,t.ui.mixin.LookupElement.prototype.getLookupCacheDataFromResponse=null,t.ui.mixin.LookupElement.prototype.getLookupMenuOptionsFromData=null,t.ui.mixin.LookupElement.prototype.setReadOnly=function(e){return t.ui.TextInputWidget.prototype.setReadOnly.call(this,e),this.isReadOnly()&&this.lookupMenu&&this.closeLookupMenu(),this},t.ui.mixin.LookupElement.prototype.getRequestQuery=function(){return this.getValue()},t.ui.mixin.LookupElement.prototype.getRequest=function(){return this.getLookupRequest()},t.ui.mixin.LookupElement.prototype.getRequestCacheDataFromResponse=function(t){return this.getLookupCacheDataFromResponse(t)},t.ui.TabPanelLayout=function(e,i){t.isPlainObject(e)&&void 0===i&&(e=(i=e).name),i=$.extend({scrollable:!0},i),t.ui.TabPanelLayout.parent.call(this,i),this.name=e,this.label=i.label,this.tabItem=null,this.active=!1,this.$element.addClass("oo-ui-tabPanelLayout")},t.inheritClass(t.ui.TabPanelLayout,t.ui.PanelLayout),t.ui.TabPanelLayout.prototype.getName=function(){return this.name},t.ui.TabPanelLayout.prototype.isActive=function(){return this.active},t.ui.TabPanelLayout.prototype.getTabItem=function(){return this.tabItem},t.ui.TabPanelLayout.prototype.setTabItem=function(t){return this.tabItem=t||null,t&&this.setupTabItem(),this},t.ui.TabPanelLayout.prototype.setupTabItem=function(){return this.label&&this.tabItem.setLabel(this.label),this},t.ui.TabPanelLayout.prototype.setActive=function(t){(t=!!t)!==this.active&&(this.active=t,this.$element.toggleClass("oo-ui-tabPanelLayout-active",this.active),this.emit("active",this.active))},t.ui.PageLayout=function(e,i){t.isPlainObject(e)&&void 0===i&&(e=(i=e).name),i=$.extend({scrollable:!0},i),t.ui.PageLayout.parent.call(this,i),this.name=e,this.outlineItem=null,this.active=!1,this.$element.addClass("oo-ui-pageLayout")},t.inheritClass(t.ui.PageLayout,t.ui.PanelLayout),t.ui.PageLayout.prototype.getName=function(){return this.name},t.ui.PageLayout.prototype.isActive=function(){return this.active},t.ui.PageLayout.prototype.getOutlineItem=function(){return this.outlineItem},t.ui.PageLayout.prototype.setOutlineItem=function(t){return this.outlineItem=t||null,t&&this.setupOutlineItem(),this},t.ui.PageLayout.prototype.setupOutlineItem=function(){return this},t.ui.PageLayout.prototype.setActive=function(t){(t=!!t)!==this.active&&(this.active=t,this.$element.toggleClass("oo-ui-pageLayout-active",t),this.emit("active",this.active))},t.ui.StackLayout=function(e){e=$.extend({scrollable:!0},e),t.ui.StackLayout.parent.call(this,e),t.ui.mixin.GroupElement.call(this,$.extend({},e,{$group:this.$element})),this.currentItem=null,this.continuous=!!e.continuous,this.$element.addClass("oo-ui-stackLayout"),this.continuous&&(this.$element.addClass("oo-ui-stackLayout-continuous"),this.$element.on("scroll",t.ui.debounce(this.onScroll.bind(this),250))),Array.isArray(e.items)&&this.addItems(e.items)},t.inheritClass(t.ui.StackLayout,t.ui.PanelLayout),t.mixinClass(t.ui.StackLayout,t.ui.mixin.GroupElement),t.ui.StackLayout.prototype.onScroll=function(){function t(t){return t.$element[0].getBoundingClientRect()}function e(e){var i=t(e);return i.bottom>u.top&&i.top<u.bottom}var i,n=this.items.length,s=this.items.indexOf(this.currentItem),o=s,u=this.$element[0].getBoundingClientRect();if(u&&(u.top||u.bottom)){if((i=t(this.currentItem)).bottom<u.top)for(;++o<n&&!e(this.items[o]););else if(i.top>u.bottom)for(;--o>=0&&!e(this.items[o]););o!==s&&this.emit("visibleItemChange",this.items[o])}},t.ui.StackLayout.prototype.getCurrentItem=function(){return this.currentItem},t.ui.StackLayout.prototype.unsetCurrentItem=function(){null!==this.currentItem&&(this.currentItem=null,this.emit("set",null))},t.ui.StackLayout.prototype.addItems=function(e,i){return this.updateHiddenState(e,this.currentItem),t.ui.mixin.GroupElement.prototype.addItems.call(this,e,i),!this.currentItem&&e.length&&this.setItem(e[0]),this},t.ui.StackLayout.prototype.removeItems=function(e){return t.ui.mixin.GroupElement.prototype.removeItems.call(this,e),-1!==e.indexOf(this.currentItem)&&(this.items.length?this.setItem(this.items[0]):this.unsetCurrentItem()),this},t.ui.StackLayout.prototype.clearItems=function(){return this.unsetCurrentItem(),t.ui.mixin.GroupElement.prototype.clearItems.call(this),this},t.ui.StackLayout.prototype.setItem=function(t){return t!==this.currentItem&&(this.updateHiddenState(this.items,t),-1!==this.items.indexOf(t)?(this.currentItem=t,this.emit("set",t)):this.unsetCurrentItem()),this},t.ui.StackLayout.prototype.updateHiddenState=function(t,e){var i,n;if(!this.continuous){for(i=0,n=t.length;i<n;i++)e&&e===t[i]||(t[i].$element.addClass("oo-ui-element-hidden"),t[i].$element.attr("aria-hidden","true"));e&&(e.$element.removeClass("oo-ui-element-hidden"),e.$element.removeAttr("aria-hidden"))}},t.ui.MenuLayout=function(e){e=$.extend({expanded:!0,showMenu:!0,menuPosition:"before"},e),t.ui.MenuLayout.parent.call(this,e),this.expanded=!!e.expanded,this.$menu=$("<div>"),this.$content=$("<div>"),this.$menu.addClass("oo-ui-menuLayout-menu"),this.$content.addClass("oo-ui-menuLayout-content"),this.$element.addClass("oo-ui-menuLayout"),e.expanded?this.$element.addClass("oo-ui-menuLayout-expanded"):this.$element.addClass("oo-ui-menuLayout-static"),this.setMenuPosition(e.menuPosition),this.toggleMenu(e.showMenu)},t.inheritClass(t.ui.MenuLayout,t.ui.Layout),t.ui.MenuLayout.prototype.toggleMenu=function(t){return t=void 0===t?!this.showMenu:!!t,this.showMenu!==t&&(this.showMenu=t,this.$element.toggleClass("oo-ui-menuLayout-showMenu",this.showMenu).toggleClass("oo-ui-menuLayout-hideMenu",!this.showMenu),this.$menu.attr("aria-hidden",this.showMenu?"false":"true")),this},t.ui.MenuLayout.prototype.isMenuVisible=function(){return this.showMenu},t.ui.MenuLayout.prototype.setMenuPosition=function(t){return this.$element.removeClass("oo-ui-menuLayout-"+this.menuPosition),this.menuPosition=t,"top"===this.menuPosition||"before"===this.menuPosition?this.$element.append(this.$menu,this.$content):this.$element.append(this.$content,this.$menu),this.$element.addClass("oo-ui-menuLayout-"+t),this},t.ui.MenuLayout.prototype.getMenuPosition=function(){return this.menuPosition},t.ui.BookletLayout=function(e){e=e||{},t.ui.BookletLayout.parent.call(this,e),this.currentPageName=null,this.pages={},this.ignoreFocus=!1,this.stackLayout=new t.ui.StackLayout({continuous:!!e.continuous,expanded:this.expanded}),this.$content.append(this.stackLayout.$element),this.autoFocus=void 0===e.autoFocus||!!e.autoFocus,this.outlineVisible=!1,this.outlined=!!e.outlined,this.outlined&&(this.editable=!!e.editable,this.outlineControlsWidget=null,this.outlineSelectWidget=new t.ui.OutlineSelectWidget,this.outlinePanel=new t.ui.PanelLayout({expanded:this.expanded,scrollable:!0}),this.$menu.append(this.outlinePanel.$element),this.outlineVisible=!0,this.editable&&(this.outlineControlsWidget=new t.ui.OutlineControlsWidget(this.outlineSelectWidget))),this.toggleMenu(this.outlined),this.stackLayout.connect(this,{set:"onStackLayoutSet"}),this.outlined&&(this.outlineSelectWidget.connect(this,{select:"onOutlineSelectWidgetSelect"}),this.scrolling=!1,this.stackLayout.connect(this,{visibleItemChange:"onStackLayoutVisibleItemChange"})),this.autoFocus&&this.stackLayout.$element.on("focusin",this.onStackLayoutFocus.bind(this)),this.$element.addClass("oo-ui-bookletLayout"),this.stackLayout.$element.addClass("oo-ui-bookletLayout-stackLayout"),this.outlined&&(this.outlinePanel.$element.addClass("oo-ui-bookletLayout-outlinePanel").append(this.outlineSelectWidget.$element),this.editable&&this.outlinePanel.$element.addClass("oo-ui-bookletLayout-outlinePanel-editable").append(this.outlineControlsWidget.$element))},t.inheritClass(t.ui.BookletLayout,t.ui.MenuLayout),t.ui.BookletLayout.prototype.onStackLayoutFocus=function(t){var e,i;i=$(t.target).closest(".oo-ui-pageLayout");for(e in this.pages)if(this.pages[e].$element[0]===i[0]&&e!==this.currentPageName){this.setPage(e);break}},t.ui.BookletLayout.prototype.onStackLayoutVisibleItemChange=function(t){this.scrolling=!0,this.outlineSelectWidget.selectItemByData(t.getName()),this.scrolling=!1},t.ui.BookletLayout.prototype.onStackLayoutSet=function(e){var i,n=this;e&&(i=this.stackLayout.continuous&&!this.scrolling?e.scrollElementIntoView():$.Deferred().resolve(),this.autoFocus&&!t.ui.isMobile()&&i.done(function(){n.focus()}))},t.ui.BookletLayout.prototype.focus=function(e){var i,n=this.stackLayout.getItems();!(i=void 0!==e&&n[e]?n[e]:this.stackLayout.getCurrentItem())&&this.outlined&&(this.selectFirstSelectablePage(),i=this.stackLayout.getCurrentItem()),i&&(t.ui.contains(i.$element[0],this.getElementDocument().activeElement,!0)||i.focus())},t.ui.BookletLayout.prototype.focusFirstFocusable=function(){t.ui.findFocusable(this.stackLayout.$element).focus()},t.ui.BookletLayout.prototype.onOutlineSelectWidgetSelect=function(t){t&&this.setPage(t.getData())},t.ui.BookletLayout.prototype.isOutlined=function(){return this.outlined},t.ui.BookletLayout.prototype.isEditable=function(){return this.editable},t.ui.BookletLayout.prototype.isOutlineVisible=function(){return this.outlined&&this.outlineVisible},t.ui.BookletLayout.prototype.toggleOutline=function(e){var i=this;return this.outlined&&(e=void 0===e?!this.outlineVisible:!!e,this.outlineVisible=e,this.toggleMenu(e),e&&this.editable&&setTimeout(function(){t.ui.Element.static.reconsiderScrollbars(i.outlinePanel.$element[0])},200)),this},t.ui.BookletLayout.prototype.findClosestPage=function(t){var e,i,n,s=this.stackLayout.getItems(),o=s.indexOf(t);if(-1!==o&&(e=s[o+1],i=s[o-1],this.outlined)){if(n=this.outlineSelectWidget.findItemFromData(t.getName()).getLevel(),i&&n===this.outlineSelectWidget.findItemFromData(i.getName()).getLevel())return i;if(e&&n===this.outlineSelectWidget.findItemFromData(e.getName()).getLevel())return e}return i||e||null},t.ui.BookletLayout.prototype.getOutline=function(){return this.outlineSelectWidget},t.ui.BookletLayout.prototype.getOutlineControls=function(){return this.outlineControlsWidget},t.ui.BookletLayout.prototype.getPage=function(t){return this.pages[t]},t.ui.BookletLayout.prototype.getCurrentPage=function(){var t=this.getCurrentPageName();return t?this.getPage(t):void 0},t.ui.BookletLayout.prototype.getCurrentPageName=function(){return this.currentPageName},t.ui.BookletLayout.prototype.addPages=function(e,i){var n,s,o,u,l,a,h=this.stackLayout.getItems(),r=[],p=[];for(n=0,s=e.length;n<s;n++)o=(u=e[n]).getName(),Object.prototype.hasOwnProperty.call(this.pages,o)&&(-1!==(a=h.indexOf(this.pages[o]))&&a+1<i&&i--,r.push(this.pages[o]));for(r.length&&this.removePages(r),n=0,s=e.length;n<s;n++)o=(u=e[n]).getName(),this.pages[u.getName()]=u,this.outlined&&(l=new t.ui.OutlineOptionWidget({data:o}),u.setOutlineItem(l),p.push(l));return this.outlined&&p.length&&(this.outlineSelectWidget.addItems(p,i),this.selectFirstSelectablePage()),this.stackLayout.addItems(e,i),this.emit("add",e,i),this},t.ui.BookletLayout.prototype.removePages=function(t){var e,i,n,s,o=[];for(e=0,i=t.length;e<i;e++)n=(s=t[e]).getName(),delete this.pages[n],this.outlined&&(o.push(this.outlineSelectWidget.findItemFromData(n)),s.setOutlineItem(null));return this.outlined&&o.length&&(this.outlineSelectWidget.removeItems(o),this.selectFirstSelectablePage()),this.stackLayout.removeItems(t),this.emit("remove",t),this},t.ui.BookletLayout.prototype.clearPages=function(){var t,e,i=this.stackLayout.getItems();if(this.pages={},this.currentPageName=null,this.outlined)for(this.outlineSelectWidget.clearItems(),t=0,e=i.length;t<e;t++)i[t].setOutlineItem(null);return this.stackLayout.clearItems(),this.emit("remove",i),this},t.ui.BookletLayout.prototype.setPage=function(e){var i,n,s=this.pages[e],o=this.currentPageName&&this.pages[this.currentPageName];e!==this.currentPageName&&(this.outlined&&(i=this.outlineSelectWidget.getSelectedItem())&&i.getData()!==e&&this.outlineSelectWidget.selectItemByData(e),s&&(o&&(o.setActive(!1),this.autoFocus&&!t.ui.isMobile()&&this.stackLayout.continuous&&0!==t.ui.findFocusable(s.$element).length&&(n=o.$element.find(":focus")).length&&n[0].blur()),this.currentPageName=e,s.setActive(!0),this.stackLayout.setItem(s),!this.stackLayout.continuous&&o&&(n=o.$element.find(":focus")).length&&n[0].blur(),this.emit("set",s)))},t.ui.BookletLayout.prototype.selectFirstSelectablePage=function(){return this.outlineSelectWidget.getSelectedItem()||this.outlineSelectWidget.selectItem(this.outlineSelectWidget.findFirstSelectableItem()),this},t.ui.IndexLayout=function(e){e=$.extend({},e,{menuPosition:"top"}),t.ui.IndexLayout.parent.call(this,e),this.currentTabPanelName=null,this.tabPanels={},this.ignoreFocus=!1,this.stackLayout=new t.ui.StackLayout({continuous:!!e.continuous,expanded:this.expanded}),this.$content.append(this.stackLayout.$element),this.autoFocus=void 0===e.autoFocus||!!e.autoFocus,this.tabSelectWidget=new t.ui.TabSelectWidget,this.tabPanel=new t.ui.PanelLayout({expanded:this.expanded}),this.$menu.append(this.tabPanel.$element),this.toggleMenu(!0),this.stackLayout.connect(this,{set:"onStackLayoutSet"}),this.tabSelectWidget.connect(this,{select:"onTabSelectWidgetSelect"}),this.autoFocus&&this.stackLayout.$element.on("focusin",this.onStackLayoutFocus.bind(this)),this.$element.addClass("oo-ui-indexLayout"),this.stackLayout.$element.addClass("oo-ui-indexLayout-stackLayout"),this.tabPanel.$element.addClass("oo-ui-indexLayout-tabPanel").append(this.tabSelectWidget.$element)},t.inheritClass(t.ui.IndexLayout,t.ui.MenuLayout),t.ui.IndexLayout.prototype.onStackLayoutFocus=function(t){var e,i;i=$(t.target).closest(".oo-ui-tabPanelLayout");for(e in this.tabPanels)if(this.tabPanels[e].$element[0]===i[0]&&e!==this.currentTabPanelName){this.setTabPanel(e);break}},t.ui.IndexLayout.prototype.onStackLayoutSet=function(e){e&&this.autoFocus&&!t.ui.isMobile()&&this.focus()},t.ui.IndexLayout.prototype.focus=function(e){var i,n=this.stackLayout.getItems();(i=void 0!==e&&n[e]?n[e]:this.stackLayout.getCurrentItem())||(this.selectFirstSelectableTabPanel(),i=this.stackLayout.getCurrentItem()),i&&(t.ui.contains(i.$element[0],this.getElementDocument().activeElement,!0)||i.focus())},t.ui.IndexLayout.prototype.focusFirstFocusable=function(){t.ui.findFocusable(this.stackLayout.$element).focus()},t.ui.IndexLayout.prototype.onTabSelectWidgetSelect=function(t){t&&this.setTabPanel(t.getData())},t.ui.IndexLayout.prototype.getClosestTabPanel=function(t){var e,i,n,s=this.stackLayout.getItems(),o=s.indexOf(t);if(-1!==o){if(e=s[o+1],i=s[o-1],n=this.tabSelectWidget.findItemFromData(t.getName()).getLevel(),i&&n===this.tabSelectWidget.findItemFromData(i.getName()).getLevel())return i;if(e&&n===this.tabSelectWidget.findItemFromData(e.getName()).getLevel())return e}return i||e||null},t.ui.IndexLayout.prototype.getTabs=function(){return this.tabSelectWidget},t.ui.IndexLayout.prototype.getTabPanel=function(t){return this.tabPanels[t]},t.ui.IndexLayout.prototype.getCurrentTabPanel=function(){var t=this.getCurrentTabPanelName();return t?this.getTabPanel(t):void 0},t.ui.IndexLayout.prototype.getCurrentTabPanelName=function(){return this.currentTabPanelName},t.ui.IndexLayout.prototype.addTabPanels=function(e,i){var n,s,o,u,l,a,h=this.stackLayout.getItems(),r=[],p=[];for(n=0,s=e.length;n<s;n++)o=(u=e[n]).getName(),Object.prototype.hasOwnProperty.call(this.tabPanels,o)&&(-1!==(a=h.indexOf(this.tabPanels[o]))&&a+1<i&&i--,r.push(this.tabPanels[o]));for(r.length&&this.removeTabPanels(r),n=0,s=e.length;n<s;n++)o=(u=e[n]).getName(),this.tabPanels[u.getName()]=u,l=new t.ui.TabOptionWidget({data:o}),u.setTabItem(l),p.push(l);return p.length&&(this.tabSelectWidget.addItems(p,i),this.selectFirstSelectableTabPanel()),this.stackLayout.addItems(e,i),this.emit("add",e,i),this},t.ui.IndexLayout.prototype.removeTabPanels=function(t){var e,i,n,s,o=[];for(e=0,i=t.length;e<i;e++)n=(s=t[e]).getName(),delete this.tabPanels[n],o.push(this.tabSelectWidget.findItemFromData(n)),s.setTabItem(null);return o.length&&(this.tabSelectWidget.removeItems(o),this.selectFirstSelectableTabPanel()),this.stackLayout.removeItems(t),this.emit("remove",t),this},t.ui.IndexLayout.prototype.clearTabPanels=function(){var t,e,i=this.stackLayout.getItems();for(this.tabPanels={},this.currentTabPanelName=null,this.tabSelectWidget.clearItems(),t=0,e=i.length;t<e;t++)i[t].setTabItem(null);return this.stackLayout.clearItems(),this.emit("remove",i),this},t.ui.IndexLayout.prototype.setTabPanel=function(e){var i,n,s=this.tabPanels[e],o=this.currentTabPanelName&&this.tabPanels[this.currentTabPanelName];e!==this.currentTabPanelName&&((i=this.tabSelectWidget.getSelectedItem())&&i.getData()!==e&&this.tabSelectWidget.selectItemByData(e),s&&(o&&(o.setActive(!1),this.autoFocus&&!t.ui.isMobile()&&this.stackLayout.continuous&&0!==t.ui.findFocusable(s.$element).length&&(n=o.$element.find(":focus")).length&&n[0].blur()),this.currentTabPanelName=e,s.setActive(!0),this.stackLayout.setItem(s),!this.stackLayout.continuous&&o&&(n=o.$element.find(":focus")).length&&n[0].blur(),this.emit("set",s)))},t.ui.IndexLayout.prototype.selectFirstSelectableTabPanel=function(){return this.tabSelectWidget.getSelectedItem()||this.tabSelectWidget.selectItem(this.tabSelectWidget.findFirstSelectableItem()),this},t.ui.ToggleWidget=function(e){e=e||{},t.ui.ToggleWidget.parent.call(this,e),this.value=null,this.$element.addClass("oo-ui-toggleWidget"),this.setValue(!!e.value)},t.inheritClass(t.ui.ToggleWidget,t.ui.Widget),t.ui.ToggleWidget.prototype.getValue=function(){return this.value},t.ui.ToggleWidget.prototype.setValue=function(t){return t=!!t,this.value!==t&&(this.value=t,this.emit("change",t),this.$element.toggleClass("oo-ui-toggleWidget-on",t),this.$element.toggleClass("oo-ui-toggleWidget-off",!t)),this},t.ui.ToggleButtonWidget=function(e){e=e||{},t.ui.ToggleButtonWidget.parent.call(this,e),t.ui.mixin.ButtonElement.call(this,$.extend({},e,{active:this.active})),t.ui.mixin.IconElement.call(this,e),t.ui.mixin.IndicatorElement.call(this,e),t.ui.mixin.LabelElement.call(this,e),t.ui.mixin.TitledElement.call(this,$.extend({},e,{$titled:this.$button})),t.ui.mixin.FlaggedElement.call(this,e),t.ui.mixin.TabIndexedElement.call(this,$.extend({},e,{$tabIndexed:this.$button})),this.connect(this,{click:"onAction"}),this.$button.append(this.$icon,this.$label,this.$indicator),this.$element.addClass("oo-ui-toggleButtonWidget").append(this.$button)},t.inheritClass(t.ui.ToggleButtonWidget,t.ui.ToggleWidget),t.mixinClass(t.ui.ToggleButtonWidget,t.ui.mixin.ButtonElement),t.mixinClass(t.ui.ToggleButtonWidget,t.ui.mixin.IconElement),t.mixinClass(t.ui.ToggleButtonWidget,t.ui.mixin.IndicatorElement),t.mixinClass(t.ui.ToggleButtonWidget,t.ui.mixin.LabelElement),t.mixinClass(t.ui.ToggleButtonWidget,t.ui.mixin.TitledElement),t.mixinClass(t.ui.ToggleButtonWidget,t.ui.mixin.FlaggedElement),t.mixinClass(t.ui.ToggleButtonWidget,t.ui.mixin.TabIndexedElement),t.ui.ToggleButtonWidget.static.tagName="span",t.ui.ToggleButtonWidget.prototype.onAction=function(){this.setValue(!this.value)},t.ui.ToggleButtonWidget.prototype.setValue=function(e){return(e=!!e)!==this.value&&(this.$button&&this.$button.attr("aria-pressed",e.toString()),this.setActive(e)),t.ui.ToggleButtonWidget.parent.prototype.setValue.call(this,e),this},t.ui.ToggleButtonWidget.prototype.setButtonElement=function(e){this.$button&&this.$button.removeAttr("aria-pressed"),t.ui.mixin.ButtonElement.prototype.setButtonElement.call(this,e),this.$button.attr("aria-pressed",this.value.toString())},t.ui.ToggleSwitchWidget=function(e){t.ui.ToggleSwitchWidget.parent.call(this,e),t.ui.mixin.TabIndexedElement.call(this,e),this.dragging=!1,this.dragStart=null,this.sliding=!1,this.$glow=$("<span>"),this.$grip=$("<span>"),this.$element.on({click:this.onClick.bind(this),keypress:this.onKeyPress.bind(this)}),this.$glow.addClass("oo-ui-toggleSwitchWidget-glow"),this.$grip.addClass("oo-ui-toggleSwitchWidget-grip"),this.$element.addClass("oo-ui-toggleSwitchWidget").attr("role","checkbox").append(this.$glow,this.$grip)},t.inheritClass(t.ui.ToggleSwitchWidget,t.ui.ToggleWidget),t.mixinClass(t.ui.ToggleSwitchWidget,t.ui.mixin.TabIndexedElement),t.ui.ToggleSwitchWidget.prototype.onClick=function(e){return this.isDisabled()||e.which!==t.ui.MouseButtons.LEFT||this.setValue(!this.value),!1},t.ui.ToggleSwitchWidget.prototype.onKeyPress=function(e){if(!this.isDisabled()&&(e.which===t.ui.Keys.SPACE||e.which===t.ui.Keys.ENTER))return this.setValue(!this.value),!1},t.ui.ToggleSwitchWidget.prototype.setValue=function(e){return t.ui.ToggleSwitchWidget.parent.prototype.setValue.call(this,e),this.$element.attr("aria-checked",this.value.toString()),this},t.ui.ToggleSwitchWidget.prototype.simulateLabelClick=function(){this.isDisabled()||this.setValue(!this.value),this.focus()},t.ui.OutlineControlsWidget=function(e,i){t.isPlainObject(e)&&void 0===i&&(e=(i=e).outline),i=$.extend({icon:"add"},i),t.ui.OutlineControlsWidget.parent.call(this,i),t.ui.mixin.GroupElement.call(this,i),t.ui.mixin.IconElement.call(this,i),this.outline=e,this.$movers=$("<div>"),this.upButton=new t.ui.ButtonWidget({framed:!1,icon:"collapse",title:t.ui.msg("ooui-outline-control-move-up")}),this.downButton=new t.ui.ButtonWidget({framed:!1,icon:"expand",title:t.ui.msg("ooui-outline-control-move-down")}),this.removeButton=new t.ui.ButtonWidget({framed:!1,icon:"trash",title:t.ui.msg("ooui-outline-control-remove")}),this.abilities={move:!0,remove:!0},e.connect(this,{select:"onOutlineChange",add:"onOutlineChange",remove:"onOutlineChange"}),this.upButton.connect(this,{click:["emit","move",-1]}),this.downButton.connect(this,{click:["emit","move",1]}),this.removeButton.connect(this,{click:["emit","remove"]}),this.$element.addClass("oo-ui-outlineControlsWidget"),this.$group.addClass("oo-ui-outlineControlsWidget-items"),this.$movers.addClass("oo-ui-outlineControlsWidget-movers").append(this.removeButton.$element,this.upButton.$element,this.downButton.$element),this.$element.append(this.$icon,this.$group,this.$movers),this.setAbilities(i.abilities||{})},t.inheritClass(t.ui.OutlineControlsWidget,t.ui.Widget),t.mixinClass(t.ui.OutlineControlsWidget,t.ui.mixin.GroupElement),t.mixinClass(t.ui.OutlineControlsWidget,t.ui.mixin.IconElement),t.ui.OutlineControlsWidget.prototype.setAbilities=function(t){var e;for(e in this.abilities)void 0!==t[e]&&(this.abilities[e]=!!t[e]);this.onOutlineChange()},t.ui.OutlineControlsWidget.prototype.onOutlineChange=function(){var t,e,i,n,s=this.outline.getItems(),o=this.outline.getSelectedItem(),u=this.abilities.move&&o&&o.isMovable(),l=this.abilities.remove&&o&&o.isRemovable();if(u){for(t=-1,e=s.length;++t<e;)if(s[t].isMovable()){i=s[t];break}for(t=e;t--;)if(s[t].isMovable()){n=s[t];break}}this.upButton.setDisabled(!u||o===i),this.downButton.setDisabled(!u||o===n),this.removeButton.setDisabled(!l)},t.ui.OutlineOptionWidget=function(e){e=e||{},t.ui.OutlineOptionWidget.parent.call(this,e),this.level=0,this.movable=!!e.movable,this.removable=!!e.removable,this.$element.addClass("oo-ui-outlineOptionWidget"),this.setLevel(e.level)},t.inheritClass(t.ui.OutlineOptionWidget,t.ui.DecoratedOptionWidget),t.ui.OutlineOptionWidget.static.highlightable=!0,t.ui.OutlineOptionWidget.static.scrollIntoViewOnSelect=!0,t.ui.OutlineOptionWidget.static.levelClass="oo-ui-outlineOptionWidget-level-",t.ui.OutlineOptionWidget.static.levels=3,t.ui.OutlineOptionWidget.prototype.isMovable=function(){return this.movable},t.ui.OutlineOptionWidget.prototype.isRemovable=function(){return this.removable},t.ui.OutlineOptionWidget.prototype.getLevel=function(){return this.level},t.ui.OutlineOptionWidget.prototype.setPressed=function(e){return t.ui.OutlineOptionWidget.parent.prototype.setPressed.call(this,e),this.pressed?this.setFlags({progressive:!0}):this.selected||this.setFlags({progressive:!1}),this},t.ui.OutlineOptionWidget.prototype.setMovable=function(t){return this.movable=!!t,this.updateThemeClasses(),this},t.ui.OutlineOptionWidget.prototype.setRemovable=function(t){return this.removable=!!t,this.updateThemeClasses(),this},t.ui.OutlineOptionWidget.prototype.setSelected=function(e){return t.ui.OutlineOptionWidget.parent.prototype.setSelected.call(this,e),this.selected?this.setFlags({progressive:!0}):this.setFlags({progressive:!1}),this},t.ui.OutlineOptionWidget.prototype.setLevel=function(t){var e=this.constructor.static.levels,i=this.constructor.static.levelClass,n=e;for(this.level=t?Math.max(0,Math.min(e-1,t)):0;n--;)this.level===n?this.$element.addClass(i+n):this.$element.removeClass(i+n);return this.updateThemeClasses(),this},t.ui.OutlineSelectWidget=function(e){t.ui.OutlineSelectWidget.parent.call(this,e),t.ui.mixin.TabIndexedElement.call(this,e),this.$element.on({focus:this.bindKeyDownListener.bind(this),blur:this.unbindKeyDownListener.bind(this)}),this.$element.addClass("oo-ui-outlineSelectWidget")},t.inheritClass(t.ui.OutlineSelectWidget,t.ui.SelectWidget),t.mixinClass(t.ui.OutlineSelectWidget,t.ui.mixin.TabIndexedElement),t.ui.ButtonOptionWidget=function(e){e=e||{},t.ui.ButtonOptionWidget.parent.call(this,e),t.ui.mixin.ButtonElement.call(this,e),t.ui.mixin.IconElement.call(this,e),t.ui.mixin.IndicatorElement.call(this,e),t.ui.mixin.TitledElement.call(this,$.extend({},e,{$titled:this.$button})),this.$element.addClass("oo-ui-buttonOptionWidget"),this.$button.append(this.$icon,this.$label,this.$indicator),this.$element.append(this.$button)},t.inheritClass(t.ui.ButtonOptionWidget,t.ui.OptionWidget),t.mixinClass(t.ui.ButtonOptionWidget,t.ui.mixin.ButtonElement),t.mixinClass(t.ui.ButtonOptionWidget,t.ui.mixin.IconElement),t.mixinClass(t.ui.ButtonOptionWidget,t.ui.mixin.IndicatorElement),t.mixinClass(t.ui.ButtonOptionWidget,t.ui.mixin.TitledElement),t.ui.ButtonOptionWidget.static.cancelButtonMouseDownEvents=!1,t.ui.ButtonOptionWidget.static.highlightable=!1,t.ui.ButtonOptionWidget.prototype.setSelected=function(e){return t.ui.ButtonOptionWidget.parent.prototype.setSelected.call(this,e),this.constructor.static.selectable&&this.setActive(e),this},t.ui.ButtonSelectWidget=function(e){t.ui.ButtonSelectWidget.parent.call(this,e),t.ui.mixin.TabIndexedElement.call(this,e),this.$element.on({focus:this.bindKeyDownListener.bind(this),blur:this.unbindKeyDownListener.bind(this)}),this.$element.addClass("oo-ui-buttonSelectWidget")},t.inheritClass(t.ui.ButtonSelectWidget,t.ui.SelectWidget),t.mixinClass(t.ui.ButtonSelectWidget,t.ui.mixin.TabIndexedElement),t.ui.TabOptionWidget=function(e){e=e||{},t.ui.TabOptionWidget.parent.call(this,e),this.$element.addClass("oo-ui-tabOptionWidget")},t.inheritClass(t.ui.TabOptionWidget,t.ui.OptionWidget),t.ui.TabOptionWidget.static.highlightable=!1,t.ui.TabSelectWidget=function(e){t.ui.TabSelectWidget.parent.call(this,e),t.ui.mixin.TabIndexedElement.call(this,e),this.$element.on({focus:this.bindKeyDownListener.bind(this),blur:this.unbindKeyDownListener.bind(this)}),this.$element.addClass("oo-ui-tabSelectWidget")},t.inheritClass(t.ui.TabSelectWidget,t.ui.SelectWidget),t.mixinClass(t.ui.TabSelectWidget,t.ui.mixin.TabIndexedElement),t.ui.CapsuleItemWidget=function(e){e=e||{},t.ui.CapsuleItemWidget.parent.call(this,e),t.ui.mixin.ItemWidget.call(this),t.ui.mixin.LabelElement.call(this,e),t.ui.mixin.FlaggedElement.call(this,e),t.ui.mixin.TabIndexedElement.call(this,e),this.closeButton=new t.ui.ButtonWidget({framed:!1,icon:"close",tabIndex:-1,title:t.ui.msg("ooui-item-remove")}).on("click",this.onCloseClick.bind(this)),this.on("disable",function(t){this.closeButton.setDisabled(t)}.bind(this)),this.$element.on({click:this.onClick.bind(this),keydown:this.onKeyDown.bind(this)}).addClass("oo-ui-capsuleItemWidget").append(this.$label,this.closeButton.$element)},t.inheritClass(t.ui.CapsuleItemWidget,t.ui.Widget),t.mixinClass(t.ui.CapsuleItemWidget,t.ui.mixin.ItemWidget),t.mixinClass(t.ui.CapsuleItemWidget,t.ui.mixin.LabelElement),t.mixinClass(t.ui.CapsuleItemWidget,t.ui.mixin.FlaggedElement),t.mixinClass(t.ui.CapsuleItemWidget,t.ui.mixin.TabIndexedElement),t.ui.CapsuleItemWidget.prototype.onCloseClick=function(){var t=this.getElementGroup();t&&$.isFunction(t.removeItems)&&(t.removeItems([this]),t.focus())},t.ui.CapsuleItemWidget.prototype.onClick=function(){var t=this.getElementGroup();!this.isDisabled()&&t&&$.isFunction(t.editItem)&&t.editItem(this)},t.ui.CapsuleItemWidget.prototype.onKeyDown=function(e){var i=this.getElementGroup();return e.keyCode===t.ui.Keys.BACKSPACE||e.keyCode===t.ui.Keys.DELETE?(i.removeItems([this]),i.focus(),!1):e.keyCode===t.ui.Keys.ENTER?(i.editItem(this),!1):void(e.keyCode===t.ui.Keys.LEFT?i.getPreviousItem(this).focus():e.keyCode===t.ui.Keys.RIGHT&&i.getNextItem(this).focus())},t.ui.CapsuleMultiselectWidget=function(e){var i;t.ui.CapsuleMultiselectWidget.parent.call(this,e),e=$.extend({allowArbitrary:!1,allowDuplicates:!1},e),this.$handle=$("<div>"),this.$input=e.popup?null:$("<input>"),void 0!==e.placeholder&&""!==e.placeholder&&this.$input.attr("placeholder",e.placeholder),t.ui.mixin.GroupElement.call(this,e),e.popup?(e.popup=$.extend({},e.popup,{align:"forwards",anchor:!1}),t.ui.mixin.PopupElement.call(this,e),i=$("<span>"),t.ui.mixin.TabIndexedElement.call(this,$.extend({},e,{$tabIndexed:i}))):(this.popup=null,i=null,t.ui.mixin.TabIndexedElement.call(this,$.extend({},e,{$tabIndexed:this.$input}))),t.ui.mixin.IndicatorElement.call(this,e),t.ui.mixin.IconElement.call(this,e),this.$content=$("<div>"),this.allowArbitrary=e.allowArbitrary,this.allowDuplicates=e.allowDuplicates,this.$overlay=(!0===e.$overlay?t.ui.getDefaultOverlay():e.$overlay)||this.$element,this.menu=new t.ui.MenuSelectWidget($.extend({widget:this,$input:this.$input,$floatableContainer:this.$element,filterFromInput:!0,disabled:this.isDisabled()},e.menu)),this.popup?(i.on({focus:this.focus.bind(this)}),this.popup.$element.on("focusout",this.onPopupFocusOut.bind(this)),this.popup.$autoCloseIgnore&&this.popup.$autoCloseIgnore.on("focusout",this.onPopupFocusOut.bind(this)),this.popup.connect(this,{toggle:function(t){i.toggle(!t)}})):this.$input.on({focus:this.onInputFocus.bind(this),blur:this.onInputBlur.bind(this),"propertychange change click mouseup keydown keyup input cut paste select focus":t.ui.debounce(this.updateInputSize.bind(this)),keydown:this.onKeyDown.bind(this),keypress:this.onKeyPress.bind(this)}),this.menu.connect(this,{choose:"onMenuChoose",toggle:"onMenuToggle",add:"onMenuItemsChange",remove:"onMenuItemsChange"}),this.$handle.on({mousedown:this.onMouseDown.bind(this)}),this.$input&&(this.$input.prop("disabled",this.isDisabled()),this.$input.attr({role:"combobox","aria-owns":this.menu.getElementId(),"aria-autocomplete":"list"})),e.data&&this.setItemsFromData(e.data),this.$content.addClass("oo-ui-capsuleMultiselectWidget-content").append(this.$group),this.$group.addClass("oo-ui-capsuleMultiselectWidget-group"),this.$handle.addClass("oo-ui-capsuleMultiselectWidget-handle").append(this.$indicator,this.$icon,this.$content),this.$element.addClass("oo-ui-capsuleMultiselectWidget").append(this.$handle),this.popup?(this.popup.$element.addClass("oo-ui-capsuleMultiselectWidget-popup"),this.$content.append(i),this.$overlay.append(this.popup.$element)):(this.$content.append(this.$input),this.$overlay.append(this.menu.$element)),i&&i.addClass("oo-ui-capsuleMultiselectWidget-focusTrap"),setTimeout(function(){this.$input&&this.updateInputSize()}.bind(this)),this.onMenuItemsChange()},t.inheritClass(t.ui.CapsuleMultiselectWidget,t.ui.Widget),t.mixinClass(t.ui.CapsuleMultiselectWidget,t.ui.mixin.GroupElement),t.mixinClass(t.ui.CapsuleMultiselectWidget,t.ui.mixin.PopupElement),t.mixinClass(t.ui.CapsuleMultiselectWidget,t.ui.mixin.TabIndexedElement),t.mixinClass(t.ui.CapsuleMultiselectWidget,t.ui.mixin.IndicatorElement),t.mixinClass(t.ui.CapsuleMultiselectWidget,t.ui.mixin.IconElement),t.ui.CapsuleMultiselectWidget.prototype.createItemWidget=function(e,i){return""===i?null:new t.ui.CapsuleItemWidget({data:e,label:i})},t.ui.CapsuleMultiselectWidget.prototype.getInputId=function(){return this.$input?t.ui.mixin.TabIndexedElement.prototype.getInputId.call(this):null},t.ui.CapsuleMultiselectWidget.prototype.getItemsData=function(){return this.getItems().map(function(t){return t.data})},t.ui.CapsuleMultiselectWidget.prototype.setItemsFromData=function(t){var e=this,i=this.menu,n=this.getItems();return $.each(t,function(t,s){var o,u,l=i.findItemFromData(s);if(l)u=l.label;else{if(!e.allowArbitrary)return;u=String(s)}for(l=null,o=0;o<n.length;o++)if(n[o].data===s&&n[o].label===u){l=n[o],n.splice(o,1);break}l||(l=e.createItemWidget(s,u)),l&&e.addItems([l],t)}),n.length&&e.removeItems(n),this},t.ui.CapsuleMultiselectWidget.prototype.addItemsFromData=function(t){var e=this,i=this.menu,n=[];return $.each(t,function(t,s){var o;e.findItemFromData(s)&&!e.allowDuplicates||((o=i.findItemFromData(s))?o=e.createItemWidget(s,o.label):e.allowArbitrary&&(o=e.createItemWidget(s,String(s))),o&&n.push(o))}),n.length&&this.addItems(n),this},t.ui.CapsuleMultiselectWidget.prototype.addItemFromLabel=function(e){var i,n;return(i=this.menu.getItemFromLabel(e,!0))?(this.addItemsFromData([i.data]),!0):!!this.allowArbitrary&&(n=this.getItems(),this.addItemsFromData([e]),!t.compare(this.getItems(),n))},t.ui.CapsuleMultiselectWidget.prototype.removeItemsFromData=function(t){var e=this,i=[];return $.each(t,function(t,n){var s=e.findItemFromData(n);s&&i.push(s)}),i.length&&this.removeItems(i),this},t.ui.CapsuleMultiselectWidget.prototype.addItems=function(e){var i,n,s,o=this.items.slice();if(t.ui.mixin.GroupElement.prototype.addItems.call(this,e),this.items.length!==o.length)i=!1;else for(i=!0,n=0,s=o.length;i&&n<s;n++)i=i&&this.items[n]===o[n];return i||(this.emit("change",this.getItemsData()),this.updateInputSize()),this},t.ui.CapsuleMultiselectWidget.prototype.editItem=function(t){this.addItemFromLabel(this.$input.val()),this.clearInput(),this.$input.val(t.label),this.updateInputSize(),this.focus(),this.menu.updateItemVisibility(),this.removeItems([t])},t.ui.CapsuleMultiselectWidget.prototype.removeItems=function(e){var i,n,s,o=this.items.slice();if(t.ui.mixin.GroupElement.prototype.removeItems.call(this,e),this.items.length!==o.length)i=!1;else for(i=!0,n=0,s=o.length;i&&n<s;n++)i=i&&this.items[n]===o[n];return i||(this.emit("change",this.getItemsData()),this.updateInputSize()),this},t.ui.CapsuleMultiselectWidget.prototype.clearItems=function(){return this.items.length&&(t.ui.mixin.GroupElement.prototype.clearItems.call(this),this.emit("change",this.getItemsData()),this.updateInputSize()),this},t.ui.CapsuleMultiselectWidget.prototype.getNextItem=function(t){var e;return void 0===t?this.items[0]:!((e=this.items.indexOf(t))<0)&&(e===this.items.length-1?this.$input:this.items[e+1])},t.ui.CapsuleMultiselectWidget.prototype.getPreviousItem=function(t){var e;return void 0===t?this.items[this.items.length-1]:!((e=this.items.indexOf(t))<0)&&(0===e?this.$input:this.items[e-1])},t.ui.CapsuleMultiselectWidget.prototype.getMenu=function(){return this.menu},t.ui.CapsuleMultiselectWidget.prototype.onInputFocus=function(){this.isDisabled()||(this.updateInputSize(),this.menu.toggle(!0))},t.ui.CapsuleMultiselectWidget.prototype.onInputBlur=function(){this.addItemFromLabel(this.$input.val()),this.clearInput()},t.ui.CapsuleMultiselectWidget.prototype.onPopupFocusOut=function(){var e=this.popup;setTimeout(function(){e.isVisible()&&!t.ui.contains(e.$element.add(e.$autoCloseIgnore).get(),document.activeElement,!0)&&e.toggle(!1)})},t.ui.CapsuleMultiselectWidget.prototype.onMouseDown=function(e){if(e.which===t.ui.MouseButtons.LEFT)return this.focus(),!1;this.updateInputSize()},t.ui.CapsuleMultiselectWidget.prototype.onKeyPress=function(e){if(!this.isDisabled()){if(e.which===t.ui.Keys.ESCAPE)return this.clearInput(),!1;if(!this.popup){if(this.menu.toggle(!0),e.which===t.ui.Keys.ENTER)return this.addItemFromLabel(this.$input.val())&&this.clearInput(),!1;setTimeout(this.updateInputSize.bind(this),0)}}},t.ui.CapsuleMultiselectWidget.prototype.onKeyDown=function(e){if(!this.isDisabled()&&""===this.$input.val()&&this.items.length){if(e.keyCode===t.ui.Keys.BACKSPACE)return e.metaKey||e.ctrlKey?this.removeItems(this.items.slice(-1)):this.editItem(this.items[this.items.length-1]),!1;e.keyCode===t.ui.Keys.LEFT?this.getPreviousItem().focus():e.keyCode===t.ui.Keys.RIGHT&&this.getNextItem().focus()}},t.ui.CapsuleMultiselectWidget.prototype.updateInputSize=function(){var e,i,n,s,o;if(this.$input&&!this.isDisabled()){if(this.$input.css("width","1em"),e=this.$group.children().last(),i=t.ui.Element.static.getDir(this.$handle),void 0===this.contentWidthWithPlaceholder&&""===this.$input.val()&&void 0!==this.$input.attr("placeholder")&&(this.$input.val(this.$input.attr("placeholder")),this.contentWidthWithPlaceholder=this.$input[0].scrollWidth,this.$input.val("")),n=Math.max(this.$input[0].scrollWidth,void 0===this.contentWidthWithPlaceholder?0:this.contentWidthWithPlaceholder),s=this.$input.width(),n<s)return void this.updateIfHeightChanged();o=0===e.length?this.$content.innerWidth():"ltr"===i?this.$content.innerWidth()-e.position().left-e.outerWidth():e.position().left,n>(o-=10)&&(o=this.$content.innerWidth()-10),this.$input.width(Math.floor(o)),this.updateIfHeightChanged()}else this.updateIfHeightChanged()},t.ui.CapsuleMultiselectWidget.prototype.updateIfHeightChanged=function(){var t=this.$element.height();t!==this.height&&(this.height=t,this.menu.position(),this.popup&&this.popup.updateDimensions(),this.emit("resize"))},t.ui.CapsuleMultiselectWidget.prototype.onMenuChoose=function(t){t&&t.isVisible()&&(this.addItemsFromData([t.getData()]),this.clearInput())},t.ui.CapsuleMultiselectWidget.prototype.onMenuToggle=function(t){this.$element.toggleClass("oo-ui-capsuleMultiselectWidget-open",t)},t.ui.CapsuleMultiselectWidget.prototype.onMenuItemsChange=function(){this.setItemsFromData(this.getItemsData()),this.$element.toggleClass("oo-ui-capsuleMultiselectWidget-empty",this.menu.isEmpty())},t.ui.CapsuleMultiselectWidget.prototype.clearInput=function(){this.$input&&(this.$input.val(""),this.updateInputSize()),this.popup&&this.popup.toggle(!1),this.menu.toggle(!1),this.menu.selectItem(),this.menu.highlightItem()},t.ui.CapsuleMultiselectWidget.prototype.setDisabled=function(e){var i,n;if(t.ui.CapsuleMultiselectWidget.parent.prototype.setDisabled.call(this,e),this.$input&&this.$input.prop("disabled",this.isDisabled()),this.menu&&this.menu.setDisabled(this.isDisabled()),this.popup&&this.popup.setDisabled(this.isDisabled()),this.items)for(i=0,n=this.items.length;i<n;i++)this.items[i].updateDisabled();return this},t.ui.CapsuleMultiselectWidget.prototype.focus=function(){return this.isDisabled()||(this.popup?(this.popup.setSize(this.$handle.outerWidth()),this.popup.toggle(!0),t.ui.findFocusable(this.popup.$element).focus()):t.ui.mixin.TabIndexedElement.prototype.focus.call(this)),this},t.ui.TagItemWidget=function(e){e=e||{},t.ui.TagItemWidget.parent.call(this,e),t.ui.mixin.ItemWidget.call(this),t.ui.mixin.LabelElement.call(this,e),t.ui.mixin.FlaggedElement.call(this,e),t.ui.mixin.TabIndexedElement.call(this,e),t.ui.mixin.DraggableElement.call(this,e),this.valid=void 0===e.valid||!!e.valid,this.closeButton=new t.ui.ButtonWidget({framed:!1,icon:"close",tabIndex:-1,title:t.ui.msg("ooui-item-remove")}),this.closeButton.setDisabled(this.isDisabled()),this.closeButton.connect(this,{click:"remove"}),this.$element.on("click",this.select.bind(this)).on("keydown",this.onKeyDown.bind(this)).on("mousedown",function(t){t.stopPropagation()}),this.$element.addClass("oo-ui-tagItemWidget").append(this.$label,this.closeButton.$element)},t.inheritClass(t.ui.TagItemWidget,t.ui.Widget),t.mixinClass(t.ui.TagItemWidget,t.ui.mixin.ItemWidget),t.mixinClass(t.ui.TagItemWidget,t.ui.mixin.LabelElement),t.mixinClass(t.ui.TagItemWidget,t.ui.mixin.FlaggedElement),t.mixinClass(t.ui.TagItemWidget,t.ui.mixin.TabIndexedElement),t.mixinClass(t.ui.TagItemWidget,t.ui.mixin.DraggableElement),t.ui.TagItemWidget.prototype.setDisabled=function(e){return t.ui.TagItemWidget.parent.prototype.setDisabled.call(this,e),this.closeButton&&this.closeButton.setDisabled(e),this},t.ui.TagItemWidget.prototype.remove=function(){this.isDisabled()||this.emit("remove")},t.ui.TagItemWidget.prototype.onKeyDown=function(e){var i;return e.keyCode===t.ui.Keys.BACKSPACE||e.keyCode===t.ui.Keys.DELETE?(this.remove(),!1):e.keyCode===t.ui.Keys.ENTER?(this.select(),!1):void(e.keyCode!==t.ui.Keys.LEFT&&e.keyCode!==t.ui.Keys.RIGHT||(i="rtl"===t.ui.Element.static.getDir(this.$element)?{left:"forwards",right:"backwards"}:{left:"backwards",right:"forwards"},this.emit("navigate",e.keyCode===t.ui.Keys.LEFT?i.left:i.right)))},t.ui.TagItemWidget.prototype.select=function(){this.isDisabled()||this.emit("select")},t.ui.TagItemWidget.prototype.toggleValid=function(t){t=void 0===t?!this.valid:!!t,this.valid!==t&&(this.valid=t,this.setFlags({invalid:!this.valid}),this.emit("valid",this.valid))},t.ui.TagItemWidget.prototype.isValid=function(){return this.valid},t.ui.TagMultiselectWidget=function(e){var i,n=window.requestAnimationFrame||setTimeout,s=this,o=$("<span>").addClass("oo-ui-tagMultiselectWidget-focusTrap");e=e||{},t.ui.TagMultiselectWidget.parent.call(this,e),t.ui.mixin.GroupWidget.call(this,e),t.ui.mixin.IndicatorElement.call(this,e),t.ui.mixin.IconElement.call(this,e),t.ui.mixin.TabIndexedElement.call(this,e),t.ui.mixin.FlaggedElement.call(this,e),t.ui.mixin.DraggableGroupElement.call(this,e),this.toggleDraggable(void 0===e.allowReordering||!!e.allowReordering),this.inputPosition=this.constructor.static.allowedInputPositions.indexOf(e.inputPosition)>-1?e.inputPosition:"inline",this.allowEditTags=void 0===e.allowEditTags||!!e.allowEditTags,this.allowArbitrary=!!e.allowArbitrary,this.allowDuplicates=!!e.allowDuplicates,this.allowedValues=e.allowedValues||[],this.allowDisplayInvalidTags=e.allowDisplayInvalidTags,this.hasInput="none"!==this.inputPosition,this.height=null,this.valid=!0,this.$content=$("<div>").addClass("oo-ui-tagMultiselectWidget-content"),this.$handle=$("<div>").addClass("oo-ui-tagMultiselectWidget-handle").append(this.$indicator,this.$icon,this.$content.append(this.$group.addClass("oo-ui-tagMultiselectWidget-group"))),this.aggregate({remove:"itemRemove",navigate:"itemNavigate",select:"itemSelect"}),this.connect(this,{itemRemove:"onTagRemove",itemSelect:"onTagSelect",itemNavigate:"onTagNavigate",change:"onChangeTags"}),this.$handle.on({mousedown:this.onMouseDown.bind(this)}),this.$element.addClass("oo-ui-tagMultiselectWidget").append(this.$handle),this.hasInput?(e.inputWidget?this.input=e.inputWidget:this.input=new t.ui.TextInputWidget($.extend({placeholder:e.placeholder,classes:["oo-ui-tagMultiselectWidget-input"]},e.input)),this.input.setDisabled(this.isDisabled()),i={focus:this.onInputFocus.bind(this),blur:this.onInputBlur.bind(this),"propertychange change click mouseup keydown keyup input cut paste select focus":t.ui.debounce(this.updateInputSize.bind(this)),keydown:this.onInputKeyDown.bind(this),keypress:this.onInputKeyPress.bind(this)},this.input.$input.on(i),"outline"===this.inputPosition?(this.input.$element.css("max-width","inherit"),this.$element.addClass("oo-ui-tagMultiselectWidget-outlined").append(this.input.$element)):(this.$element.addClass("oo-ui-tagMultiselectWidget-inlined"),this.$content.append(this.input.$input))):this.$content.append(o),this.setTabIndexedElement(this.hasInput?this.input.$input:o),e.selected&&this.setValue(e.selected),n(function(){s.hasInput&&s.updateInputSize()})},t.inheritClass(t.ui.TagMultiselectWidget,t.ui.Widget),t.mixinClass(t.ui.TagMultiselectWidget,t.ui.mixin.GroupWidget),t.mixinClass(t.ui.TagMultiselectWidget,t.ui.mixin.DraggableGroupElement),t.mixinClass(t.ui.TagMultiselectWidget,t.ui.mixin.IndicatorElement),t.mixinClass(t.ui.TagMultiselectWidget,t.ui.mixin.IconElement),t.mixinClass(t.ui.TagMultiselectWidget,t.ui.mixin.TabIndexedElement),t.mixinClass(t.ui.TagMultiselectWidget,t.ui.mixin.FlaggedElement),t.ui.TagMultiselectWidget.static.allowedInputPositions=["inline","outline","none"],t.ui.TagMultiselectWidget.prototype.onMouseDown=function(e){if(!this.isDisabled()&&e.which===t.ui.MouseButtons.LEFT)return this.focus(),!1},t.ui.TagMultiselectWidget.prototype.onInputKeyPress=function(e){var i,n=e.metaKey||e.ctrlKey;if(!this.isDisabled())return e.which===t.ui.Keys.ENTER&&(i=this.doInputEnter(e,n)),setTimeout(this.updateInputSize.bind(this),0),i},t.ui.TagMultiselectWidget.prototype.onInputKeyDown=function(e){var i,n,s=e.metaKey||e.ctrlKey;if(!this.isDisabled()){if(e.keyCode===t.ui.Keys.BACKSPACE)return this.doInputBackspace(e,s);if(e.keyCode===t.ui.Keys.ESCAPE)return this.doInputEscape(e);if(e.keyCode===t.ui.Keys.LEFT||e.keyCode===t.ui.Keys.RIGHT)return i="rtl"===t.ui.Element.static.getDir(this.$element)?{left:"forwards",right:"backwards"}:{left:"backwards",right:"forwards"},n=e.keyCode===t.ui.Keys.LEFT?i.left:i.right,this.doInputArrow(e,n,s)}},t.ui.TagMultiselectWidget.prototype.onInputFocus=function(){this.$element.addClass("oo-ui-tagMultiselectWidget-focus")},t.ui.TagMultiselectWidget.prototype.onInputBlur=function(){this.$element.removeClass("oo-ui-tagMultiselectWidget-focus")},t.ui.TagMultiselectWidget.prototype.doInputEnter=function(){return this.addTagFromInput(),!1},t.ui.TagMultiselectWidget.prototype.doInputBackspace=function(t,e){var i,n;if("inline"===this.inputPosition&&""===this.input.getValue()&&!this.isEmpty())return i=this.getItems(),n=i[i.length-1],this.removeItems([n]),e||this.input.setValue(n.getData()),!1},t.ui.TagMultiselectWidget.prototype.doInputEscape=function(){this.clearInput()},t.ui.TagMultiselectWidget.prototype.doInputArrow=function(t,e){"inline"!==this.inputPosition||this.isEmpty()||("backwards"===e?this.getPreviousItem().focus():this.getNextItem().focus())},t.ui.TagMultiselectWidget.prototype.onTagSelect=function(t){this.hasInput&&this.allowEditTags&&(this.input.getValue()&&this.addTagFromInput(),this.input.setValue(t.getData()),this.removeItems([t]),this.focus())},t.ui.TagMultiselectWidget.prototype.onChangeTags=function(){this.toggleValid(this.checkValidity()),this.hasInput&&this.updateInputSize(),this.updateIfHeightChanged()},t.ui.TagMultiselectWidget.prototype.setDisabled=function(e){t.ui.TagMultiselectWidget.parent.prototype.setDisabled.call(this,e),this.hasInput&&this.input&&this.input.setDisabled(!!e),this.items&&this.getItems().forEach(function(t){t.setDisabled(!!e)})},t.ui.TagMultiselectWidget.prototype.onTagRemove=function(t){this.removeTagByData(t.getData())},t.ui.TagMultiselectWidget.prototype.onTagNavigate=function(t,e){"forwards"===e?this.getNextItem(t).focus():this.getPreviousItem(t).focus()},t.ui.TagMultiselectWidget.prototype.addTagFromInput=function(){var t=this.input.getValue(),e=this.isAllowedData(t);t&&(e||this.allowDisplayInvalidTags)&&(this.addTag(t),this.clearInput(),this.focus())},t.ui.TagMultiselectWidget.prototype.clearInput=function(){this.input.setValue("")},t.ui.TagMultiselectWidget.prototype.isDuplicateData=function(t){return!!this.findItemFromData(t)},t.ui.TagMultiselectWidget.prototype.isAllowedData=function(t){return!(!this.allowDuplicates&&this.isDuplicateData(t))&&(!!this.allowArbitrary||!!this.getAllowedValues().some(function(e){return t===e}))},t.ui.TagMultiselectWidget.prototype.getAllowedValues=function(){return this.allowedValues},t.ui.TagMultiselectWidget.prototype.addAllowedValue=function(t){-1===this.allowedValues.indexOf(t)&&this.allowedValues.push(t)},t.ui.TagMultiselectWidget.prototype.getValue=function(){return this.getItems().filter(function(t){return t.isValid()}).map(function(t){return t.getData()})},t.ui.TagMultiselectWidget.prototype.setValue=function(t){t=Array.isArray(t)?t:[t],this.clearItems(),t.forEach(function(t){"string"==typeof t?this.addTag(t):this.addTag(t.data,t.label)}.bind(this))},t.ui.TagMultiselectWidget.prototype.addTag=function(t,e){var i,n=this.isAllowedData(t);return!(!n&&!this.allowDisplayInvalidTags)&&((i=this.createTagItemWidget(t,e)).toggleValid(n),this.addItems([i]),!0)},t.ui.TagMultiselectWidget.prototype.removeTagByData=function(t){var e=this.findItemFromData(t);this.removeItems([e])},t.ui.TagMultiselectWidget.prototype.createTagItemWidget=function(e,i){return i=i||e,new t.ui.TagItemWidget({data:e,label:i})},t.ui.TagMultiselectWidget.prototype.getNextItem=function(t){var e=this.items.indexOf(t);return void 0===t||-1===e?this.items[0]:e===this.items.length-1?this.hasInput?this.input:this.items[0]:this.items[e+1]},t.ui.TagMultiselectWidget.prototype.getPreviousItem=function(t){var e=this.items.indexOf(t);return void 0===t||-1===e?this.items[this.items.length-1]:0===e?this.hasInput?this.input:this.items[this.items.length-1]:this.items[e-1]},t.ui.TagMultiselectWidget.prototype.updateInputSize=function(){var e,i,n,s,o;if("inline"!==this.inputPosition||this.isDisabled())this.updateIfHeightChanged();else{if(0===this.input.$input[0].scrollWidth)return;if(this.input.$input.css("width","1em"),e=this.$group.children().last(),i=t.ui.Element.static.getDir(this.$handle),void 0===this.contentWidthWithPlaceholder&&""===this.input.getValue()&&void 0!==this.input.$input.attr("placeholder")&&(this.input.setValue(this.input.$input.attr("placeholder")),this.contentWidthWithPlaceholder=this.input.$input[0].scrollWidth,this.input.setValue("")),n=Math.max(this.input.$input[0].scrollWidth,void 0===this.contentWidthWithPlaceholder?0:this.contentWidthWithPlaceholder),s=this.input.$input.width(),n<s)return void this.updateIfHeightChanged();o=0===e.length?this.$content.innerWidth():"ltr"===i?this.$content.innerWidth()-e.position().left-e.outerWidth():e.position().left,n>(o-=10)&&(o=this.$content.innerWidth()-10),this.input.$input.width(Math.floor(o)),this.updateIfHeightChanged()}},t.ui.TagMultiselectWidget.prototype.updateIfHeightChanged=function(){var t=this.$element.height();t!==this.height&&(this.height=t,this.emit("resize"))},t.ui.TagMultiselectWidget.prototype.checkValidity=function(){return this.getItems().every(function(t){return t.isValid()})},t.ui.TagMultiselectWidget.prototype.toggleValid=function(t){t=void 0===t?!this.valid:!!t,this.valid!==t&&(this.valid=t,this.setFlags({invalid:!this.valid}),this.emit("valid",this.valid))},t.ui.TagMultiselectWidget.prototype.isValid=function(){return this.valid},t.ui.PopupTagMultiselectWidget=function(e){var i,n={popup:{}};e=e||{},t.ui.PopupTagMultiselectWidget.parent.call(this,$.extend({inputPosition:"none"},e)),this.$overlay=(!0===e.$overlay?t.ui.getDefaultOverlay():e.$overlay)||this.$element,e.popup||(i=new t.ui.TextInputWidget,n.popupInput=i,n.popup.$content=i.$element,this.$element.addClass("oo-ui-popupTagMultiselectWidget-defaultPopup")),n.popup.$overlay=this.$overlay,n.popup.$autoCloseIgnore=this.hasInput?this.input.$element.add(this.$overlay):this.$overlay,e=$.extend(n,e),t.ui.mixin.PopupElement.call(this,e),this.hasInput&&this.input.$input.on("focus",this.popup.toggle.bind(this.popup,!0)),this.popupInput=e.popupInput,this.popupInput&&this.popupInput.connect(this,{enter:"onPopupInputEnter"}),this.on("resize",this.popup.updateDimensions.bind(this.popup)),this.popup.connect(this,{toggle:"onPopupToggle"}),this.$tabIndexed.on("focus",this.onFocus.bind(this)),this.$element.append(this.popup.$element).addClass("oo-ui-popupTagMultiselectWidget")},t.inheritClass(t.ui.PopupTagMultiselectWidget,t.ui.TagMultiselectWidget),t.mixinClass(t.ui.PopupTagMultiselectWidget,t.ui.mixin.PopupElement),t.ui.PopupTagMultiselectWidget.prototype.onFocus=function(){this.popup.toggle(!0)},t.ui.PopupTagMultiselectWidget.prototype.onPopupToggle=function(t){t&&this.popupInput&&this.popupInput.focus()},t.ui.PopupTagMultiselectWidget.prototype.onPopupInputEnter=function(){this.popupInput&&(this.addTagByPopupValue(this.popupInput.getValue()),this.popupInput.setValue(""))},t.ui.PopupTagMultiselectWidget.prototype.onTagSelect=function(e){this.popupInput&&this.allowEditTags?(this.popupInput.setValue(e.getData()),this.removeItems([e]),this.popup.toggle(!0),this.popupInput.focus()):t.ui.PopupTagMultiselectWidget.parent.prototype.onTagSelect.call(this,e)},t.ui.PopupTagMultiselectWidget.prototype.addTagByPopupValue=function(t,e){this.addTag(t,e)},t.ui.MenuTagMultiselectWidget=function(e){e=e||{},t.ui.MenuTagMultiselectWidget.parent.call(this,e),this.$overlay=(!0===e.$overlay?t.ui.getDefaultOverlay():e.$overlay)||this.$element,this.menu=this.createMenuWidget($.extend({widget:this,input:this.hasInput?this.input:null,$input:this.hasInput?this.input.$input:null,filterFromInput:!!this.hasInput,$autoCloseIgnore:this.hasInput?this.input.$element:$([]),$floatableContainer:this.hasInput&&"outline"===this.inputPosition?this.input.$element:this.$element,$overlay:this.$overlay,disabled:this.isDisabled()},e.menu)),this.addOptions(e.options||[]),this.menu.connect(this,{choose:"onMenuChoose",toggle:"onMenuToggle"}),this.hasInput&&this.input.connect(this,{change:"onInputChange"}),this.connect(this,{resize:"onResize"}),this.$overlay.append(this.menu.$element),this.$element.addClass("oo-ui-menuTagMultiselectWidget"),e.selected&&this.setValue(e.selected)},t.inheritClass(t.ui.MenuTagMultiselectWidget,t.ui.TagMultiselectWidget),t.ui.MenuTagMultiselectWidget.prototype.onResize=function(){this.menu.position()},t.ui.MenuTagMultiselectWidget.prototype.onInputFocus=function(){t.ui.MenuTagMultiselectWidget.parent.prototype.onInputFocus.call(this),this.menu.toggle(!0)},t.ui.MenuTagMultiselectWidget.prototype.onInputChange=function(){this.menu.toggle(!0)},t.ui.MenuTagMultiselectWidget.prototype.onMenuChoose=function(t){this.addTag(t.getData(),t.getLabel())},t.ui.MenuTagMultiselectWidget.prototype.onMenuToggle=function(t){t||(this.menu.selectItem(null),this.menu.highlightItem(null))},t.ui.MenuTagMultiselectWidget.prototype.onTagSelect=function(t){var e=this.menu.findItemFromData(t.getData());this.hasInput&&this.menu.filterFromInput&&this.input.setValue(""),this.menu.selectItem(e),this.focus()},t.ui.MenuTagMultiselectWidget.prototype.addTagFromInput=function(){var t=this.input.getValue(),e=this.menu.findHighlightedItem(),i=this.menu.findItemFromData(t);(e?this.addTag(e.getData(),e.getLabel()):i?this.addTag(i.getData(),i.getLabel()):this.addTag(t))&&(this.clearInput(),this.focus())},t.ui.MenuTagMultiselectWidget.prototype.getMenuVisibleItems=function(){return this.menu.getItems().filter(function(t){return t.isVisible()})},t.ui.MenuTagMultiselectWidget.prototype.createMenuWidget=function(e){return new t.ui.MenuSelectWidget(e)},t.ui.MenuTagMultiselectWidget.prototype.addOptions=function(t){var e=this,i=t.map(function(t){return e.createMenuOptionWidget(t.data,t.label)});this.menu.addItems(i)},t.ui.MenuTagMultiselectWidget.prototype.createMenuOptionWidget=function(e,i){return new t.ui.MenuOptionWidget({data:e,label:i||e})},t.ui.MenuTagMultiselectWidget.prototype.getMenu=function(){return this.menu},t.ui.MenuTagMultiselectWidget.prototype.getAllowedValues=function(){var t=[];return this.menu&&(t=this.menu.getItems().map(function(t){return t.getData()})),this.allowedValues.concat(t)},t.ui.SelectFileWidget=function(e){var i;e=$.extend({accept:null,placeholder:t.ui.msg("ooui-selectfile-placeholder"),notsupported:t.ui.msg("ooui-selectfile-not-supported"),droppable:!0,showDropTarget:!1,thumbnailSizeLimit:20},e),t.ui.SelectFileWidget.parent.call(this,e),t.ui.mixin.IconElement.call(this,e),t.ui.mixin.IndicatorElement.call(this,e),t.ui.mixin.PendingElement.call(this,$.extend({},e,{$pending:this.$info})),t.ui.mixin.LabelElement.call(this,e),this.$info=$("<span>"),this.showDropTarget=e.showDropTarget,this.thumbnailSizeLimit=e.thumbnailSizeLimit,this.isSupported=this.constructor.static.isSupported(),this.currentFile=null,Array.isArray(e.accept)?this.accept=e.accept:this.accept=null,this.placeholder=e.placeholder,this.notsupported=e.notsupported,this.onFileSelectedHandler=this.onFileSelected.bind(this),this.selectButton=new t.ui.ButtonWidget({classes:["oo-ui-selectFileWidget-selectButton"],label:t.ui.msg("ooui-selectfile-button-select"),disabled:this.disabled||!this.isSupported}),this.clearButton=new t.ui.ButtonWidget({classes:["oo-ui-selectFileWidget-clearButton"],framed:!1,icon:"close",disabled:this.disabled}),this.selectButton.$button.on({keypress:this.onKeyPress.bind(this)}),this.clearButton.connect(this,{click:"onClearClick"}),e.droppable&&(i=this.onDragEnterOrOver.bind(this),this.$element.on({dragenter:i,dragover:i,dragleave:this.onDragLeave.bind(this),drop:this.onDrop.bind(this)})),this.addInput(),this.$label.addClass("oo-ui-selectFileWidget-label"),this.$info.addClass("oo-ui-selectFileWidget-info").append(this.$icon,this.$label,this.clearButton.$element,this.$indicator),e.droppable&&e.showDropTarget?(this.selectButton.setIcon("upload"),this.$thumbnail=$("<div>").addClass("oo-ui-selectFileWidget-thumbnail"),this.setPendingElement(this.$thumbnail),this.$element.addClass("oo-ui-selectFileWidget-dropTarget oo-ui-selectFileWidget").on({click:this.onDropTargetClick.bind(this)}).append(this.$thumbnail,this.$info,this.selectButton.$element,$("<span>").addClass("oo-ui-selectFileWidget-dropLabel").text(t.ui.msg("ooui-selectfile-dragdrop-placeholder")))):this.$element.addClass("oo-ui-selectFileWidget").append(this.$info,this.selectButton.$element),this.updateUI()},t.inheritClass(t.ui.SelectFileWidget,t.ui.Widget),t.mixinClass(t.ui.SelectFileWidget,t.ui.mixin.IconElement),t.mixinClass(t.ui.SelectFileWidget,t.ui.mixin.IndicatorElement),t.mixinClass(t.ui.SelectFileWidget,t.ui.mixin.PendingElement),t.mixinClass(t.ui.SelectFileWidget,t.ui.mixin.LabelElement),t.ui.SelectFileWidget.static.isSupported=function(){var e;return null===t.ui.SelectFileWidget.static.isSupportedCache&&(e=$("<input>").attr("type","file"),t.ui.SelectFileWidget.static.isSupportedCache=void 0!==e[0].files),t.ui.SelectFileWidget.static.isSupportedCache},t.ui.SelectFileWidget.static.isSupportedCache=null,t.ui.SelectFileWidget.prototype.getValue=function(){return this.currentFile},t.ui.SelectFileWidget.prototype.setValue=function(t){this.currentFile!==t&&(this.currentFile=t,this.updateUI(),this.emit("change",this.currentFile))},t.ui.SelectFileWidget.prototype.focus=function(){return this.selectButton.focus(),this},t.ui.SelectFileWidget.prototype.blur=function(){return this.selectButton.blur(),this},t.ui.SelectFileWidget.prototype.simulateLabelClick=function(){this.focus()},t.ui.SelectFileWidget.prototype.updateUI=function(){var e;this.isSupported?(this.$element.addClass("oo-ui-selectFileWidget-supported"),this.currentFile?(this.$element.removeClass("oo-ui-selectFileWidget-empty"),e=(e=$([])).add($("<span>").addClass("oo-ui-selectFileWidget-fileName").text(this.currentFile.name)),this.setLabel(e),this.showDropTarget&&(this.pushPending(),this.loadAndGetImageUrl().done(function(t){this.$thumbnail.css("background-image","url( "+t+" )")}.bind(this)).fail(function(){this.$thumbnail.append(new t.ui.IconWidget({icon:"attachment",classes:["oo-ui-selectFileWidget-noThumbnail-icon"]}).$element)}.bind(this)).always(function(){this.popPending()}.bind(this)),this.$element.off("click"))):(this.showDropTarget&&(this.$element.off("click"),this.$element.on({click:this.onDropTargetClick.bind(this)}),this.$thumbnail.empty().css("background-image","")),this.$element.addClass("oo-ui-selectFileWidget-empty"),this.setLabel(this.placeholder))):(this.$element.addClass("oo-ui-selectFileWidget-notsupported"),this.$element.removeClass("oo-ui-selectFileWidget-empty"),this.setLabel(this.notsupported))},t.ui.SelectFileWidget.prototype.loadAndGetImageUrl=function(){var e=$.Deferred(),i=this.currentFile,n=new FileReader;return i&&0===(t.getProp(i,"type")||"").indexOf("image/")&&i.size<1024*this.thumbnailSizeLimit*1024?(n.onload=function(t){var i=document.createElement("img");i.addEventListener("load",function(){0===i.naturalWidth||0===i.naturalHeight||!1===i.complete?e.reject():e.resolve(t.target.result)}),i.src=t.target.result},n.readAsDataURL(i)):e.reject(),e.promise()},t.ui.SelectFileWidget.prototype.addInput=function(){this.$input&&this.$input.remove(),this.isSupported?(this.$input=$("<input>").attr("type","file"),this.$input.on("change",this.onFileSelectedHandler),this.$input.on("click",function(t){t.stopPropagation()}),this.$input.attr({tabindex:-1}),this.accept&&this.$input.attr("accept",this.accept.join(", ")),this.selectButton.$button.append(this.$input)):this.$input=null},t.ui.SelectFileWidget.prototype.isAllowedType=function(t){var e,i;if(!this.accept||!t)return!0;for(e=0;e<this.accept.length;e++){if((i=this.accept[e])===t)return!0;if("/*"===i.substr(-2)&&(i=i.substr(0,i.length-1),t.substr(0,i.length)===i))return!0}return!1},t.ui.SelectFileWidget.prototype.onFileSelected=function(e){var i=t.getProp(e.target,"files",0)||null;i&&!this.isAllowedType(i.type)&&(i=null),this.setValue(i),this.addInput()},t.ui.SelectFileWidget.prototype.onClearClick=function(){return this.setValue(null),!1},t.ui.SelectFileWidget.prototype.onKeyPress=function(e){if(this.isSupported&&!this.isDisabled()&&this.$input&&(e.which===t.ui.Keys.SPACE||e.which===t.ui.Keys.ENTER))return this.$input.click(),!1},t.ui.SelectFileWidget.prototype.onDropTargetClick=function(){if(this.isSupported&&!this.isDisabled()&&this.$input)return this.$input.click(),!1},t.ui.SelectFileWidget.prototype.onDragEnterOrOver=function(e){var i,n=!1,s=e.originalEvent.dataTransfer;return e.preventDefault(),e.stopPropagation(),this.isDisabled()||!this.isSupported?(this.$element.removeClass("oo-ui-selectFileWidget-canDrop"),s.dropEffect="none",!1):((i=t.getProp(s,"items",0)||t.getProp(s,"files",0))?this.isAllowedType(i.type)&&(n=!0):-1!==Array.prototype.indexOf.call(t.getProp(s,"types")||[],"Files")&&(n=!0),this.$element.toggleClass("oo-ui-selectFileWidget-canDrop",n),n||(s.dropEffect="none"),!1)},t.ui.SelectFileWidget.prototype.onDragLeave=function(){this.$element.removeClass("oo-ui-selectFileWidget-canDrop")},t.ui.SelectFileWidget.prototype.onDrop=function(e){var i=null,n=e.originalEvent.dataTransfer;return e.preventDefault(),e.stopPropagation(),this.$element.removeClass("oo-ui-selectFileWidget-canDrop"),!(this.isDisabled()||!this.isSupported)&&((i=t.getProp(n,"files",0))&&!this.isAllowedType(i.type)&&(i=null),i&&this.setValue(i),!1)},t.ui.SelectFileWidget.prototype.setDisabled=function(e){return t.ui.SelectFileWidget.parent.prototype.setDisabled.call(this,e),this.selectButton&&this.selectButton.setDisabled(e),this.clearButton&&this.clearButton.setDisabled(e),this},t.ui.SearchWidget=function(e){e=e||{},t.ui.SearchWidget.parent.call(this,e),this.query=new t.ui.TextInputWidget({icon:"search",placeholder:e.placeholder,value:e.value}),this.results=new t.ui.SelectWidget,this.$query=$("<div>"),this.$results=$("<div>"),this.query.connect(this,{change:"onQueryChange",enter:"onQueryEnter"}),this.query.$input.on("keydown",this.onQueryKeydown.bind(this)),this.$query.addClass("oo-ui-searchWidget-query").append(this.query.$element),this.$results.addClass("oo-ui-searchWidget-results").append(this.results.$element),this.$element.addClass("oo-ui-searchWidget").append(this.$results,this.$query)},t.inheritClass(t.ui.SearchWidget,t.ui.Widget),t.ui.SearchWidget.prototype.onQueryKeydown=function(e){var i,n,s=e.which===t.ui.Keys.DOWN?1:e.which===t.ui.Keys.UP?-1:0;s&&((i=this.results.findHighlightedItem())||(i=this.results.getSelectedItem()),n=this.results.findRelativeSelectableItem(i,s),this.results.highlightItem(n),n.scrollElementIntoView())},t.ui.SearchWidget.prototype.onQueryChange=function(){this.results.clearItems()},t.ui.SearchWidget.prototype.onQueryEnter=function(){var t=this.results.findHighlightedItem();t&&this.results.chooseItem(t)},t.ui.SearchWidget.prototype.getQuery=function(){return this.query},t.ui.SearchWidget.prototype.getResults=function(){return this.results},t.ui.NumberInputWidget=function(e){var i=$("<div>").addClass("oo-ui-numberInputWidget-field");e=$.extend({allowInteger:!1,min:-1/0,max:1/0,step:1,pageStep:null,showButtons:!0},e),$.extend(e,e.input),this.input=this,t.ui.NumberInputWidget.parent.call(this,$.extend(e,{type:"number"})),e.showButtons&&(this.minusButton=new t.ui.ButtonWidget($.extend({disabled:this.isDisabled(),tabIndex:-1,classes:["oo-ui-numberInputWidget-minusButton"],icon:"subtract"},e.minusButton)),this.plusButton=new t.ui.ButtonWidget($.extend({disabled:this.isDisabled(),tabIndex:-1,classes:["oo-ui-numberInputWidget-plusButton"],icon:"add"},e.plusButton))),this.$input.on({keydown:this.onKeyDown.bind(this),"wheel mousewheel DOMMouseScroll":this.onWheel.bind(this)}),e.showButtons&&(this.plusButton.connect(this,{click:["onButtonClick",1]}),this.minusButton.connect(this,{click:["onButtonClick",-1]})),i.append(this.$input),e.showButtons&&i.prepend(this.minusButton.$element).append(this.plusButton.$element),this.setAllowInteger(e.allowInteger||e.isInteger),this.setRange(e.min,e.max),this.setStep(e.step,e.pageStep),this.setValidation(this.validateNumber.bind(this)),this.$element.addClass("oo-ui-numberInputWidget").toggleClass("oo-ui-numberInputWidget-buttoned",e.showButtons).append(i)},t.inheritClass(t.ui.NumberInputWidget,t.ui.TextInputWidget),t.ui.NumberInputWidget.prototype.setAllowInteger=function(t){this.allowInteger=!!t,this.setValidityFlag()},t.ui.NumberInputWidget.prototype.setIsInteger=t.ui.NumberInputWidget.prototype.setAllowInteger,t.ui.NumberInputWidget.prototype.getAllowInteger=function(){return this.allowInteger},t.ui.NumberInputWidget.prototype.getIsInteger=t.ui.NumberInputWidget.prototype.getAllowInteger,t.ui.NumberInputWidget.prototype.setRange=function(t,e){if(t>e)throw new Error("Minimum ("+t+") must not be greater than maximum ("+e+")");this.min=t,this.max=e,this.setValidityFlag()},t.ui.NumberInputWidget.prototype.getRange=function(){return[this.min,this.max]},t.ui.NumberInputWidget.prototype.setStep=function(t,e){if(t<=0)throw new Error("Step value must be positive");if(null===e)e=10*t;else if(e<=0)throw new Error("Page step value must be positive");this.step=t,this.pageStep=e},t.ui.NumberInputWidget.prototype.getStep=function(){return[this.step,this.pageStep]},t.ui.NumberInputWidget.prototype.getNumericValue=function(){return+this.getValue()},t.ui.NumberInputWidget.prototype.adjustValue=function(t){var e,i=this.getNumericValue();if(t=+t,isNaN(t)||!isFinite(t))throw new Error("Delta must be a finite number");isNaN(i)?e=0:(e=i+t,e=Math.max(Math.min(e,this.max),this.min),this.allowInteger&&(e=Math.round(e))),e!==i&&this.setValue(e)},t.ui.NumberInputWidget.prototype.validateNumber=function(t){var e=+t;return""===t?!this.isRequired():!(isNaN(e)||!isFinite(e))&&((!this.allowInteger||Math.floor(e)===e)&&!(e<this.min||e>this.max))},t.ui.NumberInputWidget.prototype.onButtonClick=function(t){this.adjustValue(t*this.step)},t.ui.NumberInputWidget.prototype.onWheel=function(t){var e=0;if(!this.isDisabled()&&this.$input.is(":focus"))return void 0!==t.originalEvent.deltaMode&&(this.sawWheelEvent=!0),t.originalEvent.deltaY?e=-t.originalEvent.deltaY:t.originalEvent.deltaX&&(e=t.originalEvent.deltaX),this.sawWheelEvent||(t.originalEvent.wheelDeltaX?e=-t.originalEvent.wheelDeltaX:t.originalEvent.wheelDeltaY?e=t.originalEvent.wheelDeltaY:t.originalEvent.wheelDelta?e=t.originalEvent.wheelDelta:t.originalEvent.detail&&(e=-t.originalEvent.detail)),e&&(e=e<0?-1:1,this.adjustValue(e*this.step)),!1},t.ui.NumberInputWidget.prototype.onKeyDown=function(e){if(!this.isDisabled())switch(e.which){case t.ui.Keys.UP:return this.adjustValue(this.step),!1;case t.ui.Keys.DOWN:return this.adjustValue(-this.step),!1;case t.ui.Keys.PAGEUP:return this.adjustValue(this.pageStep),!1;case t.ui.Keys.PAGEDOWN:return this.adjustValue(-this.pageStep),!1}},t.ui.NumberInputWidget.prototype.setDisabled=function(e){return t.ui.NumberInputWidget.parent.prototype.setDisabled.call(this,e),this.minusButton&&this.minusButton.setDisabled(this.isDisabled()),this.plusButton&&this.plusButton.setDisabled(this.isDisabled()),this}}(OO);
//# sourceMappingURL=oojs-ui-widgets.min.js.map