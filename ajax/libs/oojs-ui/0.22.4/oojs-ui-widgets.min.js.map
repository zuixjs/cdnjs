{"version":3,"sources":["oojs-ui-widgets.js"],"names":["OO","ui","mixin","DraggableElement","config","this","index","$handle","$element","wasHandleUsed","draggable","undefined","addClass","attr","on","mousedown","onDragMouseDown","bind","dragstart","onDragStart","dragover","onDragOver","dragend","onDragEnd","drop","onDrop","initClass","static","cancelButtonMouseDownEvents","prototype","toggleDraggable","isDraggable","toggleClass","e","contains","target","element","dataTransfer","originalEvent","dropEffect","effectAllowed","setData","getIndex","err","setTimeout","removeClass","emit","preventDefault","setIndex","data","DraggableGroupElement","GroupElement","call","orientation","dragItem","itemKeys","dir","itemsOrder","aggregate","connect","itemDragStart","itemDrop","itemDragEnd","Array","isArray","items","addItems","append","$status","mixinClass","getItems","forEach","item","onItemDragStart","slice","updateIndexes","css","setDragItem","i","len","length","onItemDropOrDragEnd","targetIndex","originalIndex","getDragItem","indexOf","reorder","unsetDragItem","overIndex","dragItemIndex","$","closest","$group","children","eq","after","prepend","splice","newIndex","off","RequestManager","requestCache","requestQuery","requestRequest","getRequestData","ourRequest","widget","value","getRequestQuery","deferred","Deferred","abortRequest","Object","hasOwnProperty","resolve","pushPending","getRequest","always","popPending","done","response","getRequestCacheDataFromResponse","fail","reject","promise","oldRequest","abort","LookupElement","extend","highlightFirst","$overlay","lookupMenu","MenuSelectWidget","input","$floatableContainer","$container","allowSuggestionsWhenEmpty","lookupsDisabled","lookupInputFocused","lookupHighlightFirstItem","$input","focus","onLookupInputFocus","blur","onLookupInputBlur","onLookupInputMouseDown","change","toggle","choose","role","aria-owns","getElementId","aria-autocomplete","populateLookupMenu","closeLookupMenu","isVisible","onLookupInputChange","onLookupMenuToggle","visible","abortLookupRequest","clearItems","onLookupMenuItemChoose","setValue","getData","getLookupMenu","setLookupsDisabled","disabled","openLookupMenu","isEmpty","getValue","isReadOnly","lookupQuery","getLookupMenuItems","initializeLookupMenuSelection","getSelectedItem","highlightItem","getFirstSelectableItem","then","getLookupMenuOptionsFromData","getLookupRequest","getLookupCacheDataFromResponse","setReadOnly","readOnly","TextInputWidget","TabPanelLayout","name","isPlainObject","scrollable","parent","label","tabItem","active","inheritClass","PanelLayout","getName","isActive","getTabItem","setTabItem","setupTabItem","setLabel","setActive","CardLayout","warnDeprecation","apply","arguments","PageLayout","outlineItem","getOutlineItem","setOutlineItem","setupOutlineItem","StackLayout","currentItem","continuous","debounce","onScroll","getRect","getBoundingClientRect","rect","bottom","containerRect","top","currentRect","currentIndex","getCurrentItem","unsetCurrentItem","updateHiddenState","setItem","removeItems","selectedItem","removeAttr","MenuLayout","showMenu","menuPosition","$menu","$content","setMenuPosition","toggleMenu","Layout","isMenuVisible","position","getMenuPosition","BookletLayout","currentPageName","pages","ignoreFocus","stackLayout","autoFocus","outlineVisible","outlined","editable","outlineControlsWidget","outlineSelectWidget","OutlineSelectWidget","outlinePanel","OutlineControlsWidget","set","select","scrolling","visibleItemChange","onStackLayoutFocus","$target","setPage","onStackLayoutVisibleItemChange","page","selectItemByData","onStackLayoutSet","layout","scrollElementIntoView","isMobile","itemIndex","selectFirstSelectablePage","getElementDocument","activeElement","focusFirstFocusable","findFocusable","onOutlineSelectWidgetSelect","isOutlined","isEditable","isOutlineVisible","toggleOutline","show","booklet","Element","reconsiderScrollbars","getClosestPage","next","prev","level","getItemFromData","getLevel","getOutline","getOutlineControls","getPage","getCurrentPage","getCurrentPageName","addPages","stackLayoutPages","remove","push","removePages","OutlineOptionWidget","clearPages","$focused","previousPage","find","selectItem","IndexLayout","currentTabPanelName","tabPanels","defineProperty","configurable","enumerable","get","expanded","tabSelectWidget","TabSelectWidget","tabPanel","setTabPanel","selectFirstSelectableTabPanel","onTabSelectWidgetSelect","getClosestTabPanel","getClosestCard","getTabs","getTabPanel","getCard","getCurrentTabPanel","getCurrentTabPanelName","getCurrentCard","getCurrentCardName","addTabPanels","stackLayoutTabPanels","removeTabPanels","TabOptionWidget","addCards","removeCards","clearTabPanels","clearCards","previousTabPanel","setCard","selectFirstSelectableCard","ToggleWidget","Widget","ToggleButtonWidget","ButtonElement","IconElement","IndicatorElement","LabelElement","TitledElement","$titled","$button","FlaggedElement","TabIndexedElement","$tabIndexed","click","$icon","$label","$indicator","tagName","onAction","toString","setButtonElement","ToggleSwitchWidget","dragging","dragStart","sliding","$glow","$grip","onClick","keypress","onKeyPress","isDisabled","which","MouseButtons","LEFT","Keys","SPACE","ENTER","simulateLabelClick","outline","icon","$movers","upButton","ButtonWidget","framed","title","msg","downButton","removeButton","abilities","move","add","setAbilities","ability","onOutlineChange","firstMovable","lastMovable","movable","isMovable","removable","isRemovable","setDisabled","setLevel","DecoratedOptionWidget","highlightable","scrollIntoViewOnSelect","levelClass","levels","setPressed","state","pressed","setFlags","progressive","selected","setMovable","updateThemeClasses","setRemovable","setSelected","constructor","Math","max","min","bindKeyDownListener","unbindKeyDownListener","SelectWidget","ButtonOptionWidget","OptionWidget","selectable","ButtonSelectWidget","CapsuleItemWidget","ItemWidget","closeButton","tabIndex","onCloseClick","keydown","onKeyDown","getElementGroup","isFunction","editItem","keyCode","BACKSPACE","DELETE","getPreviousItem","RIGHT","getNextItem","CapsuleMultiselectWidget","$tabFocus","allowArbitrary","allowDuplicates","popup","placeholder","align","anchor","PopupElement","menu","filterFromInput","onPopupFocusOut","$autoCloseIgnore","onInputFocus","onInputBlur","propertychange change click mouseup keydown keyup input cut paste select focus","updateInputSize","onMouseDown","prop","setItemsFromData","onMenuItemsChange","createItemWidget","getInputId","getItemsData","map","datas","each","j","String","addItemsFromData","addItemFromLabel","getItemFromLabel","compare","removeItemsFromData","same","l","oldItems","val","clearInput","updateItemVisibility","getMenu","document","ESCAPE","metaKey","ctrlKey","$lastItem","direction","contentWidth","currentWidth","bestWidth","last","getDir","contentWidthWithPlaceholder","scrollWidth","width","updateIfHeightChanged","innerWidth","left","outerWidth","floor","height","updateDimensions","onMenuChoose","onMenuToggle","updateDisabled","setSize","TagItemWidget","valid","stopPropagation","movement","right","toggleValid","invalid","isValid","TagMultiselectWidget","inputEvents","rAF","window","requestAnimationFrame","GroupWidget","allowReordering","inputPosition","allowedInputPositions","allowEditTags","allowedValues","allowDisplayInvalidTags","hasInput","navigate","itemRemove","itemSelect","itemNavigate","inputWidget","classes","onInputKeyDown","onInputKeyPress","setTabIndexedElement","stopOrContinue","withMetaKey","doInputEnter","doInputBackspace","doInputEscape","doInputArrow","addTagFromInput","onTagSelect","onChangeTags","checkValidity","onTagRemove","removeTagByData","onTagNavigate","isAllowedData","addTag","isDuplicateData","getAllowedValues","some","addAllowedValue","filter","valueObject","obj","newItemWidget","createTagItemWidget","every","PopupTagMultiselectWidget","defaultInput","defaultConfig","popupInput","enter","onFocus","onPopupToggle","onPopupInputEnter","addTagByPopupValue","MenuTagMultiselectWidget","createMenuWidget","addOptions","options","resize","onResize","onInputChange","menuItem","getLabel","tagItem","inputValue","validated","highlightedItem","getHighlightedItem","getMenuVisibleItems","menuConfig","menuOptions","createMenuOptionWidget","MenuOptionWidget","menuDatas","concat","SelectFileWidget","dragHandler","accept","notsupported","droppable","showDropTarget","thumbnailSizeLimit","PendingElement","$pending","$info","isSupported","currentFile","onFileSelectedHandler","onFileSelected","selectButton","clearButton","onDragEnterOrOver","dragenter","dragleave","onDragLeave","addInput","setIcon","$thumbnail","setPendingElement","onDropTargetClick","text","updateUI","isSupportedCache","files","file","loadAndGetImageUrl","url","IconWidget","empty","reader","FileReader","getProp","size","onload","event","img","createElement","addEventListener","naturalWidth","naturalHeight","complete","result","src","readAsDataURL","tabindex","join","isAllowedType","mimeType","mimeTest","substr","type","onClearClick","itemOrFile","droppableFile","dt","SearchWidget","query","results","$query","$results","onQueryKeydown","nextItem","DOWN","UP","getRelativeSelectableItem","onQueryChange","onQueryEnter","chooseItem","getQuery","getResults","NumberInputWidget","$field","allowInteger","Infinity","step","pageStep","showButtons","minusButton","plusButton","wheel mousewheel DOMMouseScroll","onWheel","setAllowInteger","isInteger","setRange","setStep","setValidation","validateNumber","flag","setValidityFlag","setIsInteger","getAllowInteger","getIsInteger","Error","getRange","getStep","getNumericValue","adjustValue","delta","n","v","isNaN","isFinite","round","isRequired","onButtonClick","is","deltaMode","sawWheelEvent","deltaY","deltaX","wheelDeltaX","wheelDeltaY","wheelDelta","detail","PAGEUP","PAGEDOWN"],"mappings":"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","file":"oojs-ui-widgets.min.js","sourcesContent":["/*!\n * OOjs UI v0.22.4\n * https://www.mediawiki.org/wiki/OOjs_UI\n *\n * Copyright 20112017 OOjs UI Team and other contributors.\n * Released under the MIT license\n * http://oojs.mit-license.org\n *\n * Date: 2017-08-01T20:24:38Z\n */\n( function ( OO ) {\n\n'use strict';\n\n/**\n * DraggableElement is a mixin class used to create elements that can be clicked\n * and dragged by a mouse to a new position within a group. This class must be used\n * in conjunction with OO.ui.mixin.DraggableGroupElement, which provides a container for\n * the draggable elements.\n *\n * @abstract\n * @class\n *\n * @constructor\n * @param {Object} [config] Configuration options\n * @cfg {jQuery} [$handle] The part of the element which can be used for dragging, defaults to the whole element\n * @cfg {boolean} [draggable] The items are draggable. This can change with #toggleDraggable\n *  but the draggable state should be called from the DraggableGroupElement, which updates\n *  the whole group\n */\nOO.ui.mixin.DraggableElement = function OoUiMixinDraggableElement( config ) {\n\tconfig = config || {};\n\n\t// Properties\n\tthis.index = null;\n\tthis.$handle = config.$handle || this.$element;\n\tthis.wasHandleUsed = null;\n\tthis.draggable = config.draggable === undefined ? true : !!config.draggable;\n\n\t// Initialize and events\n\tthis.$element.addClass( 'oo-ui-draggableElement' )\n\t\t// We make the entire element draggable, not just the handle, so that\n\t\t// the whole element appears to move. wasHandleUsed prevents drags from\n\t\t// starting outside the handle\n\t\t.attr( 'draggable', true )\n\t\t.on( {\n\t\t\tmousedown: this.onDragMouseDown.bind( this ),\n\t\t\tdragstart: this.onDragStart.bind( this ),\n\t\t\tdragover: this.onDragOver.bind( this ),\n\t\t\tdragend: this.onDragEnd.bind( this ),\n\t\t\tdrop: this.onDrop.bind( this )\n\t\t} );\n\tthis.$handle.addClass( 'oo-ui-draggableElement-handle' );\n};\n\nOO.initClass( OO.ui.mixin.DraggableElement );\n\n/* Events */\n\n/**\n * @event dragstart\n *\n * A dragstart event is emitted when the user clicks and begins dragging an item.\n * @param {OO.ui.mixin.DraggableElement} item The item the user has clicked and is dragging with the mouse.\n */\n\n/**\n * @event dragend\n * A dragend event is emitted when the user drags an item and releases the mouse,\n * thus terminating the drag operation.\n */\n\n/**\n * @event drop\n * A drop event is emitted when the user drags an item and then releases the mouse button\n * over a valid target.\n */\n\n/* Static Properties */\n\n/**\n * @inheritdoc OO.ui.mixin.ButtonElement\n */\nOO.ui.mixin.DraggableElement.static.cancelButtonMouseDownEvents = false;\n\n/* Methods */\n\n/**\n * Change the draggable state of this widget.\n * This allows users to temporarily halt the dragging operations.\n *\n * @param {boolean} isDraggable Widget supports draggable operations\n * @fires draggable\n */\nOO.ui.mixin.DraggableElement.prototype.toggleDraggable = function ( isDraggable ) {\n\tisDraggable = isDraggable !== undefined ? !!isDraggable : !this.draggable;\n\n\tif ( this.draggable !== isDraggable ) {\n\t\tthis.draggable = isDraggable;\n\n\t\tthis.$handle.toggleClass( 'oo-ui-draggableElement-undraggable', !this.draggable );\n\t}\n};\n\n/**\n * Check the draggable state of this widget\n *\n * @return {boolean} Widget supports draggable operations\n */\nOO.ui.mixin.DraggableElement.prototype.isDraggable = function () {\n\treturn this.draggable;\n};\n\n/**\n * Respond to mousedown event.\n *\n * @private\n * @param {jQuery.Event} e Drag event\n */\nOO.ui.mixin.DraggableElement.prototype.onDragMouseDown = function ( e ) {\n\tif ( !this.isDraggable() ) {\n\t\treturn;\n\t}\n\n\tthis.wasHandleUsed =\n\t\t// Optimization: if the handle is the whole element this is always true\n\t\tthis.$handle[ 0 ] === this.$element[ 0 ] ||\n\t\t// Check the mousedown occurred inside the handle\n\t\tOO.ui.contains( this.$handle[ 0 ], e.target, true );\n};\n\n/**\n * Respond to dragstart event.\n *\n * @private\n * @param {jQuery.Event} e Drag event\n * @return {boolean} False if the event is cancelled\n * @fires dragstart\n */\nOO.ui.mixin.DraggableElement.prototype.onDragStart = function ( e ) {\n\tvar element = this,\n\t\tdataTransfer = e.originalEvent.dataTransfer;\n\n\tif ( !this.wasHandleUsed || !this.isDraggable() ) {\n\t\treturn false;\n\t}\n\n\t// Define drop effect\n\tdataTransfer.dropEffect = 'none';\n\tdataTransfer.effectAllowed = 'move';\n\t// Support: Firefox\n\t// We must set up a dataTransfer data property or Firefox seems to\n\t// ignore the fact the element is draggable.\n\ttry {\n\t\tdataTransfer.setData( 'application-x/OOjs-UI-draggable', this.getIndex() );\n\t} catch ( err ) {\n\t\t// The above is only for Firefox. Move on if it fails.\n\t}\n\t// Briefly add a 'clone' class to style the browser's native drag image\n\tthis.$element.addClass( 'oo-ui-draggableElement-clone' );\n\t// Add placeholder class after the browser has rendered the clone\n\tsetTimeout( function () {\n\t\telement.$element\n\t\t\t.removeClass( 'oo-ui-draggableElement-clone' )\n\t\t\t.addClass( 'oo-ui-draggableElement-placeholder' );\n\t} );\n\t// Emit event\n\tthis.emit( 'dragstart', this );\n\treturn true;\n};\n\n/**\n * Respond to dragend event.\n *\n * @private\n * @fires dragend\n */\nOO.ui.mixin.DraggableElement.prototype.onDragEnd = function () {\n\tthis.$element.removeClass( 'oo-ui-draggableElement-placeholder' );\n\tthis.emit( 'dragend' );\n};\n\n/**\n * Handle drop event.\n *\n * @private\n * @param {jQuery.Event} e Drop event\n * @fires drop\n */\nOO.ui.mixin.DraggableElement.prototype.onDrop = function ( e ) {\n\te.preventDefault();\n\tthis.emit( 'drop', e );\n};\n\n/**\n * In order for drag/drop to work, the dragover event must\n * return false and stop propogation.\n *\n * @param {jQuery.Event} e Drag event\n * @private\n */\nOO.ui.mixin.DraggableElement.prototype.onDragOver = function ( e ) {\n\te.preventDefault();\n};\n\n/**\n * Set item index.\n * Store it in the DOM so we can access from the widget drag event\n *\n * @private\n * @param {number} index Item index\n */\nOO.ui.mixin.DraggableElement.prototype.setIndex = function ( index ) {\n\tif ( this.index !== index ) {\n\t\tthis.index = index;\n\t\tthis.$element.data( 'index', index );\n\t}\n};\n\n/**\n * Get item index\n *\n * @private\n * @return {number} Item index\n */\nOO.ui.mixin.DraggableElement.prototype.getIndex = function () {\n\treturn this.index;\n};\n\n/**\n * DraggableGroupElement is a mixin class used to create a group element to\n * contain draggable elements, which are items that can be clicked and dragged by a mouse.\n * The class is used with OO.ui.mixin.DraggableElement.\n *\n * @abstract\n * @class\n * @mixins OO.ui.mixin.GroupElement\n *\n * @constructor\n * @param {Object} [config] Configuration options\n * @cfg {string} [orientation] Item orientation: 'horizontal' or 'vertical'. The orientation\n *  should match the layout of the items. Items displayed in a single row\n *  or in several rows should use horizontal orientation. The vertical orientation should only be\n *  used when the items are displayed in a single column. Defaults to 'vertical'\n * @cfg {boolean} [draggable] The items are draggable. This can change with #toggleDraggable\n */\nOO.ui.mixin.DraggableGroupElement = function OoUiMixinDraggableGroupElement( config ) {\n\t// Configuration initialization\n\tconfig = config || {};\n\n\t// Parent constructor\n\tOO.ui.mixin.GroupElement.call( this, config );\n\n\t// Properties\n\tthis.orientation = config.orientation || 'vertical';\n\tthis.dragItem = null;\n\tthis.itemKeys = {};\n\tthis.dir = null;\n\tthis.itemsOrder = null;\n\tthis.draggable = config.draggable === undefined ? true : !!config.draggable;\n\n\t// Events\n\tthis.aggregate( {\n\t\tdragstart: 'itemDragStart',\n\t\tdragend: 'itemDragEnd',\n\t\tdrop: 'itemDrop'\n\t} );\n\tthis.connect( this, {\n\t\titemDragStart: 'onItemDragStart',\n\t\titemDrop: 'onItemDropOrDragEnd',\n\t\titemDragEnd: 'onItemDropOrDragEnd'\n\t} );\n\n\t// Initialize\n\tif ( Array.isArray( config.items ) ) {\n\t\tthis.addItems( config.items );\n\t}\n\tthis.$element\n\t\t.addClass( 'oo-ui-draggableGroupElement' )\n\t\t.append( this.$status )\n\t\t.toggleClass( 'oo-ui-draggableGroupElement-horizontal', this.orientation === 'horizontal' );\n};\n\n/* Setup */\nOO.mixinClass( OO.ui.mixin.DraggableGroupElement, OO.ui.mixin.GroupElement );\n\n/* Events */\n\n/**\n * An item has been dragged to a new position, but not yet dropped.\n *\n * @event drag\n * @param {OO.ui.mixin.DraggableElement} item Dragged item\n * @param {number} [newIndex] New index for the item\n */\n\n/**\n * An item has been dropped at a new position.\n *\n * @event reorder\n * @param {OO.ui.mixin.DraggableElement} item Reordered item\n * @param {number} [newIndex] New index for the item\n */\n\n/**\n * Draggable state of this widget has changed.\n *\n * @event draggable\n * @param {boolean} [draggable] Widget is draggable\n */\n\n/* Methods */\n\n/**\n * Change the draggable state of this widget.\n * This allows users to temporarily halt the dragging operations.\n *\n * @param {boolean} isDraggable Widget supports draggable operations\n * @fires draggable\n */\nOO.ui.mixin.DraggableGroupElement.prototype.toggleDraggable = function ( isDraggable ) {\n\tisDraggable = isDraggable !== undefined ? !!isDraggable : !this.draggable;\n\n\tif ( this.draggable !== isDraggable ) {\n\t\tthis.draggable = isDraggable;\n\n\t\t// Tell the items their draggable state changed\n\t\tthis.getItems().forEach( function ( item ) {\n\t\t\titem.toggleDraggable( this.draggable );\n\t\t}.bind( this ) );\n\n\t\t// Emit event\n\t\tthis.emit( 'draggable', this.draggable );\n\t}\n};\n\n/**\n * Check the draggable state of this widget\n *\n * @return {boolean} Widget supports draggable operations\n */\nOO.ui.mixin.DraggableGroupElement.prototype.isDraggable = function () {\n\treturn this.draggable;\n};\n\n/**\n * Respond to item drag start event\n *\n * @private\n * @param {OO.ui.mixin.DraggableElement} item Dragged item\n */\nOO.ui.mixin.DraggableGroupElement.prototype.onItemDragStart = function ( item ) {\n\tif ( !this.isDraggable() ) {\n\t\treturn;\n\t}\n\t// Make a shallow copy of this.items so we can re-order it during previews\n\t// without affecting the original array.\n\tthis.itemsOrder = this.items.slice();\n\tthis.updateIndexes();\n\tif ( this.orientation === 'horizontal' ) {\n\t\t// Calculate and cache directionality on drag start - it's a little\n\t\t// expensive and it shouldn't change while dragging.\n\t\tthis.dir = this.$element.css( 'direction' );\n\t}\n\tthis.setDragItem( item );\n};\n\n/**\n * Update the index properties of the items\n */\nOO.ui.mixin.DraggableGroupElement.prototype.updateIndexes = function () {\n\tvar i, len;\n\n\t// Map the index of each object\n\tfor ( i = 0, len = this.itemsOrder.length; i < len; i++ ) {\n\t\tthis.itemsOrder[ i ].setIndex( i );\n\t}\n};\n\n/**\n * Handle drop or dragend event and switch the order of the items accordingly\n *\n * @private\n * @param {OO.ui.mixin.DraggableElement} item Dropped item\n */\nOO.ui.mixin.DraggableGroupElement.prototype.onItemDropOrDragEnd = function () {\n\tvar targetIndex, originalIndex,\n\t\titem = this.getDragItem();\n\n\t// TODO: Figure out a way to configure a list of legally droppable\n\t// elements even if they are not yet in the list\n\tif ( item ) {\n\t\toriginalIndex = this.items.indexOf( item );\n\t\t// If the item has moved forward, add one to the index to account for the left shift\n\t\ttargetIndex = item.getIndex() + ( item.getIndex() > originalIndex ? 1 : 0 );\n\t\tif ( targetIndex !== originalIndex ) {\n\t\t\tthis.reorder( this.getDragItem(), targetIndex );\n\t\t\tthis.emit( 'reorder', this.getDragItem(), targetIndex );\n\t\t}\n\t\tthis.updateIndexes();\n\t}\n\tthis.unsetDragItem();\n\t// Return false to prevent propogation\n\treturn false;\n};\n\n/**\n * Respond to dragover event\n *\n * @private\n * @param {jQuery.Event} e Dragover event\n * @fires reorder\n */\nOO.ui.mixin.DraggableGroupElement.prototype.onDragOver = function ( e ) {\n\tvar overIndex, targetIndex,\n\t\titem = this.getDragItem(),\n\t\tdragItemIndex = item.getIndex();\n\n\t// Get the OptionWidget item we are dragging over\n\toverIndex = $( e.target ).closest( '.oo-ui-draggableElement' ).data( 'index' );\n\n\tif ( overIndex !== undefined && overIndex !== dragItemIndex ) {\n\t\ttargetIndex = overIndex + ( overIndex > dragItemIndex ? 1 : 0 );\n\n\t\tif ( targetIndex > 0 ) {\n\t\t\tthis.$group.children().eq( targetIndex - 1 ).after( item.$element );\n\t\t} else {\n\t\t\tthis.$group.prepend( item.$element );\n\t\t}\n\t\t// Move item in itemsOrder array\n\t\tthis.itemsOrder.splice( overIndex, 0,\n\t\t\tthis.itemsOrder.splice( dragItemIndex, 1 )[ 0 ]\n\t\t);\n\t\tthis.updateIndexes();\n\t\tthis.emit( 'drag', item, targetIndex );\n\t}\n\t// Prevent default\n\te.preventDefault();\n};\n\n/**\n * Reorder the items in the group\n *\n * @param {OO.ui.mixin.DraggableElement} item Reordered item\n * @param {number} newIndex New index\n */\nOO.ui.mixin.DraggableGroupElement.prototype.reorder = function ( item, newIndex ) {\n\tthis.addItems( [ item ], newIndex );\n};\n\n/**\n * Set a dragged item\n *\n * @param {OO.ui.mixin.DraggableElement} item Dragged item\n */\nOO.ui.mixin.DraggableGroupElement.prototype.setDragItem = function ( item ) {\n\tif ( this.dragItem !== item ) {\n\t\tthis.dragItem = item;\n\t\tthis.$element.on( 'dragover', this.onDragOver.bind( this ) );\n\t\tthis.$element.addClass( 'oo-ui-draggableGroupElement-dragging' );\n\t}\n};\n\n/**\n * Unset the current dragged item\n */\nOO.ui.mixin.DraggableGroupElement.prototype.unsetDragItem = function () {\n\tif ( this.dragItem ) {\n\t\tthis.dragItem = null;\n\t\tthis.$element.off( 'dragover' );\n\t\tthis.$element.removeClass( 'oo-ui-draggableGroupElement-dragging' );\n\t}\n};\n\n/**\n * Get the item that is currently being dragged.\n *\n * @return {OO.ui.mixin.DraggableElement|null} The currently dragged item, or `null` if no item is being dragged\n */\nOO.ui.mixin.DraggableGroupElement.prototype.getDragItem = function () {\n\treturn this.dragItem;\n};\n\n/**\n * RequestManager is a mixin that manages the lifecycle of a promise-backed request for a widget, such as\n * the {@link OO.ui.mixin.LookupElement}.\n *\n * @class\n * @abstract\n *\n * @constructor\n */\nOO.ui.mixin.RequestManager = function OoUiMixinRequestManager() {\n\tthis.requestCache = {};\n\tthis.requestQuery = null;\n\tthis.requestRequest = null;\n};\n\n/* Setup */\n\nOO.initClass( OO.ui.mixin.RequestManager );\n\n/**\n * Get request results for the current query.\n *\n * @return {jQuery.Promise} Promise object which will be passed response data as the first argument of\n *   the done event. If the request was aborted to make way for a subsequent request, this promise\n *   may not be rejected, depending on what jQuery feels like doing.\n */\nOO.ui.mixin.RequestManager.prototype.getRequestData = function () {\n\tvar widget = this,\n\t\tvalue = this.getRequestQuery(),\n\t\tdeferred = $.Deferred(),\n\t\tourRequest;\n\n\tthis.abortRequest();\n\tif ( Object.prototype.hasOwnProperty.call( this.requestCache, value ) ) {\n\t\tdeferred.resolve( this.requestCache[ value ] );\n\t} else {\n\t\tif ( this.pushPending ) {\n\t\t\tthis.pushPending();\n\t\t}\n\t\tthis.requestQuery = value;\n\t\tourRequest = this.requestRequest = this.getRequest();\n\t\tourRequest\n\t\t\t.always( function () {\n\t\t\t\t// We need to pop pending even if this is an old request, otherwise\n\t\t\t\t// the widget will remain pending forever.\n\t\t\t\t// TODO: this assumes that an aborted request will fail or succeed soon after\n\t\t\t\t// being aborted, or at least eventually. It would be nice if we could popPending()\n\t\t\t\t// at abort time, but only if we knew that we hadn't already called popPending()\n\t\t\t\t// for that request.\n\t\t\t\tif ( widget.popPending ) {\n\t\t\t\t\twidget.popPending();\n\t\t\t\t}\n\t\t\t} )\n\t\t\t.done( function ( response ) {\n\t\t\t\t// If this is an old request (and aborting it somehow caused it to still succeed),\n\t\t\t\t// ignore its success completely\n\t\t\t\tif ( ourRequest === widget.requestRequest ) {\n\t\t\t\t\twidget.requestQuery = null;\n\t\t\t\t\twidget.requestRequest = null;\n\t\t\t\t\twidget.requestCache[ value ] = widget.getRequestCacheDataFromResponse( response );\n\t\t\t\t\tdeferred.resolve( widget.requestCache[ value ] );\n\t\t\t\t}\n\t\t\t} )\n\t\t\t.fail( function () {\n\t\t\t\t// If this is an old request (or a request failing because it's being aborted),\n\t\t\t\t// ignore its failure completely\n\t\t\t\tif ( ourRequest === widget.requestRequest ) {\n\t\t\t\t\twidget.requestQuery = null;\n\t\t\t\t\twidget.requestRequest = null;\n\t\t\t\t\tdeferred.reject();\n\t\t\t\t}\n\t\t\t} );\n\t}\n\treturn deferred.promise();\n};\n\n/**\n * Abort the currently pending request, if any.\n *\n * @private\n */\nOO.ui.mixin.RequestManager.prototype.abortRequest = function () {\n\tvar oldRequest = this.requestRequest;\n\tif ( oldRequest ) {\n\t\t// First unset this.requestRequest to the fail handler will notice\n\t\t// that the request is no longer current\n\t\tthis.requestRequest = null;\n\t\tthis.requestQuery = null;\n\t\toldRequest.abort();\n\t}\n};\n\n/**\n * Get the query to be made.\n *\n * @protected\n * @method\n * @abstract\n * @return {string} query to be used\n */\nOO.ui.mixin.RequestManager.prototype.getRequestQuery = null;\n\n/**\n * Get a new request object of the current query value.\n *\n * @protected\n * @method\n * @abstract\n * @return {jQuery.Promise} jQuery AJAX object, or promise object with an .abort() method\n */\nOO.ui.mixin.RequestManager.prototype.getRequest = null;\n\n/**\n * Pre-process data returned by the request from #getRequest.\n *\n * The return value of this function will be cached, and any further queries for the given value\n * will use the cache rather than doing API requests.\n *\n * @protected\n * @method\n * @abstract\n * @param {Mixed} response Response from server\n * @return {Mixed} Cached result data\n */\nOO.ui.mixin.RequestManager.prototype.getRequestCacheDataFromResponse = null;\n\n/**\n * LookupElement is a mixin that creates a {@link OO.ui.MenuSelectWidget menu} of suggested values for\n * a {@link OO.ui.TextInputWidget text input widget}. Suggested values are based on the characters the user types\n * into the text input field and, in general, the menu is only displayed when the user types. If a suggested value is chosen\n * from the lookup menu, that value becomes the value of the input field.\n *\n * Note that a new menu of suggested items is displayed when a value is chosen from the lookup menu. If this is\n * not the desired behavior, disable lookup menus with the #setLookupsDisabled method, then set the value, then\n * re-enable lookups.\n *\n * See the [OOjs UI demos][1] for an example.\n *\n * [1]: https://tools.wmflabs.org/oojs-ui/oojs-ui/demos/index.html#widgets-apex-vector-ltr\n *\n * @class\n * @abstract\n * @mixins OO.ui.mixin.RequestManager\n *\n * @constructor\n * @param {Object} [config] Configuration options\n * @cfg {jQuery} [$overlay] Overlay for the lookup menu; defaults to relative positioning.\n *  See <https://www.mediawiki.org/wiki/OOjs_UI/Concepts#Overlays>.\n * @cfg {jQuery} [$container=this.$element] The container element. The lookup menu is rendered beneath the specified element.\n * @cfg {boolean} [allowSuggestionsWhenEmpty=false] Request and display a lookup menu when the text input is empty.\n *  By default, the lookup menu is not generated and displayed until the user begins to type.\n * @cfg {boolean} [highlightFirst=true] Whether the first lookup result should be highlighted (so, that the user can\n *  take it over into the input with simply pressing return) automatically or not.\n */\nOO.ui.mixin.LookupElement = function OoUiMixinLookupElement( config ) {\n\t// Configuration initialization\n\tconfig = $.extend( { highlightFirst: true }, config );\n\n\t// Mixin constructors\n\tOO.ui.mixin.RequestManager.call( this, config );\n\n\t// Properties\n\tthis.$overlay = config.$overlay || this.$element;\n\tthis.lookupMenu = new OO.ui.MenuSelectWidget( {\n\t\twidget: this,\n\t\tinput: this,\n\t\t$floatableContainer: config.$container || this.$element\n\t} );\n\n\tthis.allowSuggestionsWhenEmpty = config.allowSuggestionsWhenEmpty || false;\n\n\tthis.lookupsDisabled = false;\n\tthis.lookupInputFocused = false;\n\tthis.lookupHighlightFirstItem = config.highlightFirst;\n\n\t// Events\n\tthis.$input.on( {\n\t\tfocus: this.onLookupInputFocus.bind( this ),\n\t\tblur: this.onLookupInputBlur.bind( this ),\n\t\tmousedown: this.onLookupInputMouseDown.bind( this )\n\t} );\n\tthis.connect( this, { change: 'onLookupInputChange' } );\n\tthis.lookupMenu.connect( this, {\n\t\ttoggle: 'onLookupMenuToggle',\n\t\tchoose: 'onLookupMenuItemChoose'\n\t} );\n\n\t// Initialization\n\tthis.$input.attr( {\n\t\trole: 'combobox',\n\t\t'aria-owns': this.lookupMenu.getElementId(),\n\t\t'aria-autocomplete': 'list'\n\t} );\n\tthis.$element.addClass( 'oo-ui-lookupElement' );\n\tthis.lookupMenu.$element.addClass( 'oo-ui-lookupElement-menu' );\n\tthis.$overlay.append( this.lookupMenu.$element );\n};\n\n/* Setup */\n\nOO.mixinClass( OO.ui.mixin.LookupElement, OO.ui.mixin.RequestManager );\n\n/* Methods */\n\n/**\n * Handle input focus event.\n *\n * @protected\n * @param {jQuery.Event} e Input focus event\n */\nOO.ui.mixin.LookupElement.prototype.onLookupInputFocus = function () {\n\tthis.lookupInputFocused = true;\n\tthis.populateLookupMenu();\n};\n\n/**\n * Handle input blur event.\n *\n * @protected\n * @param {jQuery.Event} e Input blur event\n */\nOO.ui.mixin.LookupElement.prototype.onLookupInputBlur = function () {\n\tthis.closeLookupMenu();\n\tthis.lookupInputFocused = false;\n};\n\n/**\n * Handle input mouse down event.\n *\n * @protected\n * @param {jQuery.Event} e Input mouse down event\n */\nOO.ui.mixin.LookupElement.prototype.onLookupInputMouseDown = function () {\n\t// Only open the menu if the input was already focused.\n\t// This way we allow the user to open the menu again after closing it with Esc\n\t// by clicking in the input. Opening (and populating) the menu when initially\n\t// clicking into the input is handled by the focus handler.\n\tif ( this.lookupInputFocused && !this.lookupMenu.isVisible() ) {\n\t\tthis.populateLookupMenu();\n\t}\n};\n\n/**\n * Handle input change event.\n *\n * @protected\n * @param {string} value New input value\n */\nOO.ui.mixin.LookupElement.prototype.onLookupInputChange = function () {\n\tif ( this.lookupInputFocused ) {\n\t\tthis.populateLookupMenu();\n\t}\n};\n\n/**\n * Handle the lookup menu being shown/hidden.\n *\n * @protected\n * @param {boolean} visible Whether the lookup menu is now visible.\n */\nOO.ui.mixin.LookupElement.prototype.onLookupMenuToggle = function ( visible ) {\n\tif ( !visible ) {\n\t\t// When the menu is hidden, abort any active request and clear the menu.\n\t\t// This has to be done here in addition to closeLookupMenu(), because\n\t\t// MenuSelectWidget will close itself when the user presses Esc.\n\t\tthis.abortLookupRequest();\n\t\tthis.lookupMenu.clearItems();\n\t}\n};\n\n/**\n * Handle menu item 'choose' event, updating the text input value to the value of the clicked item.\n *\n * @protected\n * @param {OO.ui.MenuOptionWidget} item Selected item\n */\nOO.ui.mixin.LookupElement.prototype.onLookupMenuItemChoose = function ( item ) {\n\tthis.setValue( item.getData() );\n};\n\n/**\n * Get lookup menu.\n *\n * @private\n * @return {OO.ui.MenuSelectWidget}\n */\nOO.ui.mixin.LookupElement.prototype.getLookupMenu = function () {\n\treturn this.lookupMenu;\n};\n\n/**\n * Disable or re-enable lookups.\n *\n * When lookups are disabled, calls to #populateLookupMenu will be ignored.\n *\n * @param {boolean} disabled Disable lookups\n */\nOO.ui.mixin.LookupElement.prototype.setLookupsDisabled = function ( disabled ) {\n\tthis.lookupsDisabled = !!disabled;\n};\n\n/**\n * Open the menu. If there are no entries in the menu, this does nothing.\n *\n * @private\n * @chainable\n */\nOO.ui.mixin.LookupElement.prototype.openLookupMenu = function () {\n\tif ( !this.lookupMenu.isEmpty() ) {\n\t\tthis.lookupMenu.toggle( true );\n\t}\n\treturn this;\n};\n\n/**\n * Close the menu, empty it, and abort any pending request.\n *\n * @private\n * @chainable\n */\nOO.ui.mixin.LookupElement.prototype.closeLookupMenu = function () {\n\tthis.lookupMenu.toggle( false );\n\tthis.abortLookupRequest();\n\tthis.lookupMenu.clearItems();\n\treturn this;\n};\n\n/**\n * Request menu items based on the input's current value, and when they arrive,\n * populate the menu with these items and show the menu.\n *\n * If lookups have been disabled with #setLookupsDisabled, this function does nothing.\n *\n * @private\n * @chainable\n */\nOO.ui.mixin.LookupElement.prototype.populateLookupMenu = function () {\n\tvar widget = this,\n\t\tvalue = this.getValue();\n\n\tif ( this.lookupsDisabled || this.isReadOnly() ) {\n\t\treturn;\n\t}\n\n\t// If the input is empty, clear the menu, unless suggestions when empty are allowed.\n\tif ( !this.allowSuggestionsWhenEmpty && value === '' ) {\n\t\tthis.closeLookupMenu();\n\t// Skip population if there is already a request pending for the current value\n\t} else if ( value !== this.lookupQuery ) {\n\t\tthis.getLookupMenuItems()\n\t\t\t.done( function ( items ) {\n\t\t\t\twidget.lookupMenu.clearItems();\n\t\t\t\tif ( items.length ) {\n\t\t\t\t\twidget.lookupMenu\n\t\t\t\t\t\t.addItems( items )\n\t\t\t\t\t\t.toggle( true );\n\t\t\t\t\twidget.initializeLookupMenuSelection();\n\t\t\t\t} else {\n\t\t\t\t\twidget.lookupMenu.toggle( false );\n\t\t\t\t}\n\t\t\t} )\n\t\t\t.fail( function () {\n\t\t\t\twidget.lookupMenu.clearItems();\n\t\t\t} );\n\t}\n\n\treturn this;\n};\n\n/**\n * Highlight the first selectable item in the menu, if configured.\n *\n * @private\n * @chainable\n */\nOO.ui.mixin.LookupElement.prototype.initializeLookupMenuSelection = function () {\n\tif ( this.lookupHighlightFirstItem && !this.lookupMenu.getSelectedItem() ) {\n\t\tthis.lookupMenu.highlightItem( this.lookupMenu.getFirstSelectableItem() );\n\t}\n};\n\n/**\n * Get lookup menu items for the current query.\n *\n * @private\n * @return {jQuery.Promise} Promise object which will be passed menu items as the first argument of\n *   the done event. If the request was aborted to make way for a subsequent request, this promise\n *   will not be rejected: it will remain pending forever.\n */\nOO.ui.mixin.LookupElement.prototype.getLookupMenuItems = function () {\n\treturn this.getRequestData().then( function ( data ) {\n\t\treturn this.getLookupMenuOptionsFromData( data );\n\t}.bind( this ) );\n};\n\n/**\n * Abort the currently pending lookup request, if any.\n *\n * @private\n */\nOO.ui.mixin.LookupElement.prototype.abortLookupRequest = function () {\n\tthis.abortRequest();\n};\n\n/**\n * Get a new request object of the current lookup query value.\n *\n * @protected\n * @method\n * @abstract\n * @return {jQuery.Promise} jQuery AJAX object, or promise object with an .abort() method\n */\nOO.ui.mixin.LookupElement.prototype.getLookupRequest = null;\n\n/**\n * Pre-process data returned by the request from #getLookupRequest.\n *\n * The return value of this function will be cached, and any further queries for the given value\n * will use the cache rather than doing API requests.\n *\n * @protected\n * @method\n * @abstract\n * @param {Mixed} response Response from server\n * @return {Mixed} Cached result data\n */\nOO.ui.mixin.LookupElement.prototype.getLookupCacheDataFromResponse = null;\n\n/**\n * Get a list of menu option widgets from the (possibly cached) data returned by\n * #getLookupCacheDataFromResponse.\n *\n * @protected\n * @method\n * @abstract\n * @param {Mixed} data Cached result data, usually an array\n * @return {OO.ui.MenuOptionWidget[]} Menu items\n */\nOO.ui.mixin.LookupElement.prototype.getLookupMenuOptionsFromData = null;\n\n/**\n * Set the read-only state of the widget.\n *\n * This will also disable/enable the lookups functionality.\n *\n * @param {boolean} readOnly Make input read-only\n * @chainable\n */\nOO.ui.mixin.LookupElement.prototype.setReadOnly = function ( readOnly ) {\n\t// Parent method\n\t// Note: Calling #setReadOnly this way assumes this is mixed into an OO.ui.TextInputWidget\n\tOO.ui.TextInputWidget.prototype.setReadOnly.call( this, readOnly );\n\n\t// During construction, #setReadOnly is called before the OO.ui.mixin.LookupElement constructor\n\tif ( this.isReadOnly() && this.lookupMenu ) {\n\t\tthis.closeLookupMenu();\n\t}\n\n\treturn this;\n};\n\n/**\n * @inheritdoc OO.ui.mixin.RequestManager\n */\nOO.ui.mixin.LookupElement.prototype.getRequestQuery = function () {\n\treturn this.getValue();\n};\n\n/**\n * @inheritdoc OO.ui.mixin.RequestManager\n */\nOO.ui.mixin.LookupElement.prototype.getRequest = function () {\n\treturn this.getLookupRequest();\n};\n\n/**\n * @inheritdoc OO.ui.mixin.RequestManager\n */\nOO.ui.mixin.LookupElement.prototype.getRequestCacheDataFromResponse = function ( response ) {\n\treturn this.getLookupCacheDataFromResponse( response );\n};\n\n/**\n * TabPanelLayouts are used within {@link OO.ui.IndexLayout index layouts} to create tab panels that\n * users can select and display from the index's optional {@link OO.ui.TabSelectWidget tab}\n * navigation. TabPanels are usually not instantiated directly, rather extended to include the\n * required content and functionality.\n *\n * Each tab panel must have a unique symbolic name, which is passed to the constructor. In addition,\n * the tab panel's tab item is customized (with a label) using the #setupTabItem method. See\n * {@link OO.ui.IndexLayout IndexLayout} for an example.\n *\n * @class\n * @extends OO.ui.PanelLayout\n *\n * @constructor\n * @param {string} name Unique symbolic name of tab panel\n * @param {Object} [config] Configuration options\n * @cfg {jQuery|string|Function|OO.ui.HtmlSnippet} [label] Label for tab panel's tab\n */\nOO.ui.TabPanelLayout = function OoUiTabPanelLayout( name, config ) {\n\t// Allow passing positional parameters inside the config object\n\tif ( OO.isPlainObject( name ) && config === undefined ) {\n\t\tconfig = name;\n\t\tname = config.name;\n\t}\n\n\t// Configuration initialization\n\tconfig = $.extend( { scrollable: true }, config );\n\n\t// Parent constructor\n\tOO.ui.TabPanelLayout.parent.call( this, config );\n\n\t// Properties\n\tthis.name = name;\n\tthis.label = config.label;\n\tthis.tabItem = null;\n\tthis.active = false;\n\n\t// Initialization\n\tthis.$element.addClass( 'oo-ui-tabPanelLayout' );\n};\n\n/* Setup */\n\nOO.inheritClass( OO.ui.TabPanelLayout, OO.ui.PanelLayout );\n\n/* Events */\n\n/**\n * An 'active' event is emitted when the tab panel becomes active. Tab panels become active when they are\n * shown in a index layout that is configured to display only one tab panel at a time.\n *\n * @event active\n * @param {boolean} active Tab panel is active\n */\n\n/* Methods */\n\n/**\n * Get the symbolic name of the tab panel.\n *\n * @return {string} Symbolic name of tab panel\n */\nOO.ui.TabPanelLayout.prototype.getName = function () {\n\treturn this.name;\n};\n\n/**\n * Check if tab panel is active.\n *\n * Tab panels become active when they are shown in a {@link OO.ui.IndexLayout index layout} that is configured to\n * display only one tab panel at a time. Additional CSS is applied to the tab panel's tab item to reflect the\n * active state.\n *\n * @return {boolean} Tab panel is active\n */\nOO.ui.TabPanelLayout.prototype.isActive = function () {\n\treturn this.active;\n};\n\n/**\n * Get tab item.\n *\n * The tab item allows users to access the tab panel from the index's tab\n * navigation. The tab item itself can be customized (with a label, level, etc.) using the #setupTabItem method.\n *\n * @return {OO.ui.TabOptionWidget|null} Tab option widget\n */\nOO.ui.TabPanelLayout.prototype.getTabItem = function () {\n\treturn this.tabItem;\n};\n\n/**\n * Set or unset the tab item.\n *\n * Specify a {@link OO.ui.TabOptionWidget tab option} to set it,\n * or `null` to clear the tab item. To customize the tab item itself (e.g., to set a label or tab\n * level), use #setupTabItem instead of this method.\n *\n * @param {OO.ui.TabOptionWidget|null} tabItem Tab option widget, null to clear\n * @chainable\n */\nOO.ui.TabPanelLayout.prototype.setTabItem = function ( tabItem ) {\n\tthis.tabItem = tabItem || null;\n\tif ( tabItem ) {\n\t\tthis.setupTabItem();\n\t}\n\treturn this;\n};\n\n/**\n * Set up the tab item.\n *\n * Use this method to customize the tab item (e.g., to add a label or tab level). To set or unset\n * the tab item itself (with a {@link OO.ui.TabOptionWidget tab option} or `null`), use\n * the #setTabItem method instead.\n *\n * @param {OO.ui.TabOptionWidget} tabItem Tab option widget to set up\n * @chainable\n */\nOO.ui.TabPanelLayout.prototype.setupTabItem = function () {\n\tif ( this.label ) {\n\t\tthis.tabItem.setLabel( this.label );\n\t}\n\treturn this;\n};\n\n/**\n * Set the tab panel to its 'active' state.\n *\n * Tab panels become active when they are shown in a index layout that is configured to display only\n * one tab panel at a time. Additional CSS is applied to the tab item to reflect the tab panel's\n * active state. Outside of the index context, setting the active state on a tab panel does nothing.\n *\n * @param {boolean} active Tab panel is active\n * @fires active\n */\nOO.ui.TabPanelLayout.prototype.setActive = function ( active ) {\n\tactive = !!active;\n\n\tif ( active !== this.active ) {\n\t\tthis.active = active;\n\t\tthis.$element.toggleClass( 'oo-ui-tabPanelLayout-active', this.active );\n\t\tthis.emit( 'active', this.active );\n\t}\n};\n\n/**\n * The deprecated name for the TabPanelLayout, provided for backwards-compatibility.\n *\n * @class\n * @extends OO.ui.TabPanelLayout\n *\n * @constructor\n * @deprecated since v0.21.3\n */\nOO.ui.CardLayout = function OoUiCardLayout() {\n\tOO.ui.warnDeprecation( 'CardLayout has been renamed to TabPanel layout. Use that instead. See T155152' );\n\t// Parent constructor\n\tOO.ui.CardLayout.parent.apply( this, arguments );\n};\n\nOO.inheritClass( OO.ui.CardLayout, OO.ui.TabPanelLayout );\n\n/**\n * PageLayouts are used within {@link OO.ui.BookletLayout booklet layouts} to create pages that users can select and display\n * from the booklet's optional {@link OO.ui.OutlineSelectWidget outline} navigation. Pages are usually not instantiated directly,\n * rather extended to include the required content and functionality.\n *\n * Each page must have a unique symbolic name, which is passed to the constructor. In addition, the page's outline\n * item is customized (with a label, outline level, etc.) using the #setupOutlineItem method. See\n * {@link OO.ui.BookletLayout BookletLayout} for an example.\n *\n * @class\n * @extends OO.ui.PanelLayout\n *\n * @constructor\n * @param {string} name Unique symbolic name of page\n * @param {Object} [config] Configuration options\n */\nOO.ui.PageLayout = function OoUiPageLayout( name, config ) {\n\t// Allow passing positional parameters inside the config object\n\tif ( OO.isPlainObject( name ) && config === undefined ) {\n\t\tconfig = name;\n\t\tname = config.name;\n\t}\n\n\t// Configuration initialization\n\tconfig = $.extend( { scrollable: true }, config );\n\n\t// Parent constructor\n\tOO.ui.PageLayout.parent.call( this, config );\n\n\t// Properties\n\tthis.name = name;\n\tthis.outlineItem = null;\n\tthis.active = false;\n\n\t// Initialization\n\tthis.$element.addClass( 'oo-ui-pageLayout' );\n};\n\n/* Setup */\n\nOO.inheritClass( OO.ui.PageLayout, OO.ui.PanelLayout );\n\n/* Events */\n\n/**\n * An 'active' event is emitted when the page becomes active. Pages become active when they are\n * shown in a booklet layout that is configured to display only one page at a time.\n *\n * @event active\n * @param {boolean} active Page is active\n */\n\n/* Methods */\n\n/**\n * Get the symbolic name of the page.\n *\n * @return {string} Symbolic name of page\n */\nOO.ui.PageLayout.prototype.getName = function () {\n\treturn this.name;\n};\n\n/**\n * Check if page is active.\n *\n * Pages become active when they are shown in a {@link OO.ui.BookletLayout booklet layout} that is configured to display\n * only one page at a time. Additional CSS is applied to the page's outline item to reflect the active state.\n *\n * @return {boolean} Page is active\n */\nOO.ui.PageLayout.prototype.isActive = function () {\n\treturn this.active;\n};\n\n/**\n * Get outline item.\n *\n * The outline item allows users to access the page from the booklet's outline\n * navigation. The outline item itself can be customized (with a label, level, etc.) using the #setupOutlineItem method.\n *\n * @return {OO.ui.OutlineOptionWidget|null} Outline option widget\n */\nOO.ui.PageLayout.prototype.getOutlineItem = function () {\n\treturn this.outlineItem;\n};\n\n/**\n * Set or unset the outline item.\n *\n * Specify an {@link OO.ui.OutlineOptionWidget outline option} to set it,\n * or `null` to clear the outline item. To customize the outline item itself (e.g., to set a label or outline\n * level), use #setupOutlineItem instead of this method.\n *\n * @param {OO.ui.OutlineOptionWidget|null} outlineItem Outline option widget, null to clear\n * @chainable\n */\nOO.ui.PageLayout.prototype.setOutlineItem = function ( outlineItem ) {\n\tthis.outlineItem = outlineItem || null;\n\tif ( outlineItem ) {\n\t\tthis.setupOutlineItem();\n\t}\n\treturn this;\n};\n\n/**\n * Set up the outline item.\n *\n * Use this method to customize the outline item (e.g., to add a label or outline level). To set or unset\n * the outline item itself (with an {@link OO.ui.OutlineOptionWidget outline option} or `null`), use\n * the #setOutlineItem method instead.\n *\n * @param {OO.ui.OutlineOptionWidget} outlineItem Outline option widget to set up\n * @chainable\n */\nOO.ui.PageLayout.prototype.setupOutlineItem = function () {\n\treturn this;\n};\n\n/**\n * Set the page to its 'active' state.\n *\n * Pages become active when they are shown in a booklet layout that is configured to display only one page at a time. Additional\n * CSS is applied to the outline item to reflect the page's active state. Outside of the booklet\n * context, setting the active state on a page does nothing.\n *\n * @param {boolean} active Page is active\n * @fires active\n */\nOO.ui.PageLayout.prototype.setActive = function ( active ) {\n\tactive = !!active;\n\n\tif ( active !== this.active ) {\n\t\tthis.active = active;\n\t\tthis.$element.toggleClass( 'oo-ui-pageLayout-active', active );\n\t\tthis.emit( 'active', this.active );\n\t}\n};\n\n/**\n * StackLayouts contain a series of {@link OO.ui.PanelLayout panel layouts}. By default, only one panel is displayed\n * at a time, though the stack layout can also be configured to show all contained panels, one after another,\n * by setting the #continuous option to 'true'.\n *\n *     @example\n *     // A stack layout with two panels, configured to be displayed continously\n *     var myStack = new OO.ui.StackLayout( {\n *         items: [\n *             new OO.ui.PanelLayout( {\n *                 $content: $( '<p>Panel One</p>' ),\n *                 padded: true,\n *                 framed: true\n *             } ),\n *             new OO.ui.PanelLayout( {\n *                 $content: $( '<p>Panel Two</p>' ),\n *                 padded: true,\n *                 framed: true\n *             } )\n *         ],\n *         continuous: true\n *     } );\n *     $( 'body' ).append( myStack.$element );\n *\n * @class\n * @extends OO.ui.PanelLayout\n * @mixins OO.ui.mixin.GroupElement\n *\n * @constructor\n * @param {Object} [config] Configuration options\n * @cfg {boolean} [continuous=false] Show all panels, one after another. By default, only one panel is displayed at a time.\n * @cfg {OO.ui.Layout[]} [items] Panel layouts to add to the stack layout.\n */\nOO.ui.StackLayout = function OoUiStackLayout( config ) {\n\t// Configuration initialization\n\tconfig = $.extend( { scrollable: true }, config );\n\n\t// Parent constructor\n\tOO.ui.StackLayout.parent.call( this, config );\n\n\t// Mixin constructors\n\tOO.ui.mixin.GroupElement.call( this, $.extend( {}, config, { $group: this.$element } ) );\n\n\t// Properties\n\tthis.currentItem = null;\n\tthis.continuous = !!config.continuous;\n\n\t// Initialization\n\tthis.$element.addClass( 'oo-ui-stackLayout' );\n\tif ( this.continuous ) {\n\t\tthis.$element.addClass( 'oo-ui-stackLayout-continuous' );\n\t\tthis.$element.on( 'scroll', OO.ui.debounce( this.onScroll.bind( this ), 250 ) );\n\t}\n\tif ( Array.isArray( config.items ) ) {\n\t\tthis.addItems( config.items );\n\t}\n};\n\n/* Setup */\n\nOO.inheritClass( OO.ui.StackLayout, OO.ui.PanelLayout );\nOO.mixinClass( OO.ui.StackLayout, OO.ui.mixin.GroupElement );\n\n/* Events */\n\n/**\n * A 'set' event is emitted when panels are {@link #addItems added}, {@link #removeItems removed},\n * {@link #clearItems cleared} or {@link #setItem displayed}.\n *\n * @event set\n * @param {OO.ui.Layout|null} item Current panel or `null` if no panel is shown\n */\n\n/**\n * When used in continuous mode, this event is emitted when the user scrolls down\n * far enough such that currentItem is no longer visible.\n *\n * @event visibleItemChange\n * @param {OO.ui.PanelLayout} panel The next visible item in the layout\n */\n\n/* Methods */\n\n/**\n * Handle scroll events from the layout element\n *\n * @param {jQuery.Event} e\n * @fires visibleItemChange\n */\nOO.ui.StackLayout.prototype.onScroll = function () {\n\tvar currentRect,\n\t\tlen = this.items.length,\n\t\tcurrentIndex = this.items.indexOf( this.currentItem ),\n\t\tnewIndex = currentIndex,\n\t\tcontainerRect = this.$element[ 0 ].getBoundingClientRect();\n\n\tif ( !containerRect || ( !containerRect.top && !containerRect.bottom ) ) {\n\t\t// Can't get bounding rect, possibly not attached.\n\t\treturn;\n\t}\n\n\tfunction getRect( item ) {\n\t\treturn item.$element[ 0 ].getBoundingClientRect();\n\t}\n\n\tfunction isVisible( item ) {\n\t\tvar rect = getRect( item );\n\t\treturn rect.bottom > containerRect.top && rect.top < containerRect.bottom;\n\t}\n\n\tcurrentRect = getRect( this.currentItem );\n\n\tif ( currentRect.bottom < containerRect.top ) {\n\t\t// Scrolled down past current item\n\t\twhile ( ++newIndex < len ) {\n\t\t\tif ( isVisible( this.items[ newIndex ] ) ) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t} else if ( currentRect.top > containerRect.bottom ) {\n\t\t// Scrolled up past current item\n\t\twhile ( --newIndex >= 0 ) {\n\t\t\tif ( isVisible( this.items[ newIndex ] ) ) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tif ( newIndex !== currentIndex ) {\n\t\tthis.emit( 'visibleItemChange', this.items[ newIndex ] );\n\t}\n};\n\n/**\n * Get the current panel.\n *\n * @return {OO.ui.Layout|null}\n */\nOO.ui.StackLayout.prototype.getCurrentItem = function () {\n\treturn this.currentItem;\n};\n\n/**\n * Unset the current item.\n *\n * @private\n * @param {OO.ui.StackLayout} layout\n * @fires set\n */\nOO.ui.StackLayout.prototype.unsetCurrentItem = function () {\n\tvar prevItem = this.currentItem;\n\tif ( prevItem === null ) {\n\t\treturn;\n\t}\n\n\tthis.currentItem = null;\n\tthis.emit( 'set', null );\n};\n\n/**\n * Add panel layouts to the stack layout.\n *\n * Panels will be added to the end of the stack layout array unless the optional index parameter specifies a different\n * insertion point. Adding a panel that is already in the stack will move it to the end of the array or the point specified\n * by the index.\n *\n * @param {OO.ui.Layout[]} items Panels to add\n * @param {number} [index] Index of the insertion point\n * @chainable\n */\nOO.ui.StackLayout.prototype.addItems = function ( items, index ) {\n\t// Update the visibility\n\tthis.updateHiddenState( items, this.currentItem );\n\n\t// Mixin method\n\tOO.ui.mixin.GroupElement.prototype.addItems.call( this, items, index );\n\n\tif ( !this.currentItem && items.length ) {\n\t\tthis.setItem( items[ 0 ] );\n\t}\n\n\treturn this;\n};\n\n/**\n * Remove the specified panels from the stack layout.\n *\n * Removed panels are detached from the DOM, not removed, so that they may be reused. To remove all panels,\n * you may wish to use the #clearItems method instead.\n *\n * @param {OO.ui.Layout[]} items Panels to remove\n * @chainable\n * @fires set\n */\nOO.ui.StackLayout.prototype.removeItems = function ( items ) {\n\t// Mixin method\n\tOO.ui.mixin.GroupElement.prototype.removeItems.call( this, items );\n\n\tif ( items.indexOf( this.currentItem ) !== -1 ) {\n\t\tif ( this.items.length ) {\n\t\t\tthis.setItem( this.items[ 0 ] );\n\t\t} else {\n\t\t\tthis.unsetCurrentItem();\n\t\t}\n\t}\n\n\treturn this;\n};\n\n/**\n * Clear all panels from the stack layout.\n *\n * Cleared panels are detached from the DOM, not removed, so that they may be reused. To remove only\n * a subset of panels, use the #removeItems method.\n *\n * @chainable\n * @fires set\n */\nOO.ui.StackLayout.prototype.clearItems = function () {\n\tthis.unsetCurrentItem();\n\tOO.ui.mixin.GroupElement.prototype.clearItems.call( this );\n\n\treturn this;\n};\n\n/**\n * Show the specified panel.\n *\n * If another panel is currently displayed, it will be hidden.\n *\n * @param {OO.ui.Layout} item Panel to show\n * @chainable\n * @fires set\n */\nOO.ui.StackLayout.prototype.setItem = function ( item ) {\n\tif ( item !== this.currentItem ) {\n\t\tthis.updateHiddenState( this.items, item );\n\n\t\tif ( this.items.indexOf( item ) !== -1 ) {\n\t\t\tthis.currentItem = item;\n\t\t\tthis.emit( 'set', item );\n\t\t} else {\n\t\t\tthis.unsetCurrentItem();\n\t\t}\n\t}\n\n\treturn this;\n};\n\n/**\n * Update the visibility of all items in case of non-continuous view.\n *\n * Ensure all items are hidden except for the selected one.\n * This method does nothing when the stack is continuous.\n *\n * @private\n * @param {OO.ui.Layout[]} items Item list iterate over\n * @param {OO.ui.Layout} [selectedItem] Selected item to show\n */\nOO.ui.StackLayout.prototype.updateHiddenState = function ( items, selectedItem ) {\n\tvar i, len;\n\n\tif ( !this.continuous ) {\n\t\tfor ( i = 0, len = items.length; i < len; i++ ) {\n\t\t\tif ( !selectedItem || selectedItem !== items[ i ] ) {\n\t\t\t\titems[ i ].$element.addClass( 'oo-ui-element-hidden' );\n\t\t\t\titems[ i ].$element.attr( 'aria-hidden', 'true' );\n\t\t\t}\n\t\t}\n\t\tif ( selectedItem ) {\n\t\t\tselectedItem.$element.removeClass( 'oo-ui-element-hidden' );\n\t\t\tselectedItem.$element.removeAttr( 'aria-hidden' );\n\t\t}\n\t}\n};\n\n/**\n * MenuLayouts combine a menu and a content {@link OO.ui.PanelLayout panel}. The menu is positioned relative to the content (after, before, top, or bottom)\n * and its size is customized with the #menuSize config. The content area will fill all remaining space.\n *\n *     @example\n *     var menuLayout = new OO.ui.MenuLayout( {\n *         position: 'top'\n *     } ),\n *         menuPanel = new OO.ui.PanelLayout( { padded: true, expanded: true, scrollable: true } ),\n *         contentPanel = new OO.ui.PanelLayout( { padded: true, expanded: true, scrollable: true } ),\n *         select = new OO.ui.SelectWidget( {\n *             items: [\n *                 new OO.ui.OptionWidget( {\n *                     data: 'before',\n *                     label: 'Before',\n *                 } ),\n *                 new OO.ui.OptionWidget( {\n *                     data: 'after',\n *                     label: 'After',\n *                 } ),\n *                 new OO.ui.OptionWidget( {\n *                     data: 'top',\n *                     label: 'Top',\n *                 } ),\n *                 new OO.ui.OptionWidget( {\n *                     data: 'bottom',\n *                     label: 'Bottom',\n *                 } )\n *              ]\n *         } ).on( 'select', function ( item ) {\n *            menuLayout.setMenuPosition( item.getData() );\n *         } );\n *\n *     menuLayout.$menu.append(\n *         menuPanel.$element.append( '<b>Menu panel</b>', select.$element )\n *     );\n *     menuLayout.$content.append(\n *         contentPanel.$element.append( '<b>Content panel</b>', '<p>Note that the menu is positioned relative to the content panel: top, bottom, after, before.</p>')\n *     );\n *     $( 'body' ).append( menuLayout.$element );\n *\n * If menu size needs to be overridden, it can be accomplished using CSS similar to the snippet\n * below. MenuLayout's CSS will override the appropriate values with 'auto' or '0' to display the\n * menu correctly. If `menuPosition` is known beforehand, CSS rules corresponding to other positions\n * may be omitted.\n *\n *     .oo-ui-menuLayout-menu {\n *         height: 200px;\n *         width: 200px;\n *     }\n *     .oo-ui-menuLayout-content {\n *         top: 200px;\n *         left: 200px;\n *         right: 200px;\n *         bottom: 200px;\n *     }\n *\n * @class\n * @extends OO.ui.Layout\n *\n * @constructor\n * @param {Object} [config] Configuration options\n * @cfg {boolean} [showMenu=true] Show menu\n * @cfg {string} [menuPosition='before'] Position of menu: `top`, `after`, `bottom` or `before`\n */\nOO.ui.MenuLayout = function OoUiMenuLayout( config ) {\n\t// Configuration initialization\n\tconfig = $.extend( {\n\t\tshowMenu: true,\n\t\tmenuPosition: 'before'\n\t}, config );\n\n\t// Parent constructor\n\tOO.ui.MenuLayout.parent.call( this, config );\n\n\t/**\n\t * Menu DOM node\n\t *\n\t * @property {jQuery}\n\t */\n\tthis.$menu = $( '<div>' );\n\t/**\n\t * Content DOM node\n\t *\n\t * @property {jQuery}\n\t */\n\tthis.$content = $( '<div>' );\n\n\t// Initialization\n\tthis.$menu\n\t\t.addClass( 'oo-ui-menuLayout-menu' );\n\tthis.$content.addClass( 'oo-ui-menuLayout-content' );\n\tthis.$element\n\t\t.addClass( 'oo-ui-menuLayout' )\n\t\t.append( this.$content, this.$menu );\n\tthis.setMenuPosition( config.menuPosition );\n\tthis.toggleMenu( config.showMenu );\n};\n\n/* Setup */\n\nOO.inheritClass( OO.ui.MenuLayout, OO.ui.Layout );\n\n/* Methods */\n\n/**\n * Toggle menu.\n *\n * @param {boolean} showMenu Show menu, omit to toggle\n * @chainable\n */\nOO.ui.MenuLayout.prototype.toggleMenu = function ( showMenu ) {\n\tshowMenu = showMenu === undefined ? !this.showMenu : !!showMenu;\n\n\tif ( this.showMenu !== showMenu ) {\n\t\tthis.showMenu = showMenu;\n\t\tthis.$element\n\t\t\t.toggleClass( 'oo-ui-menuLayout-showMenu', this.showMenu )\n\t\t\t.toggleClass( 'oo-ui-menuLayout-hideMenu', !this.showMenu );\n\t\tthis.$menu.attr( 'aria-hidden', this.showMenu ? 'false' : 'true' );\n\t}\n\n\treturn this;\n};\n\n/**\n * Check if menu is visible\n *\n * @return {boolean} Menu is visible\n */\nOO.ui.MenuLayout.prototype.isMenuVisible = function () {\n\treturn this.showMenu;\n};\n\n/**\n * Set menu position.\n *\n * @param {string} position Position of menu, either `top`, `after`, `bottom` or `before`\n * @throws {Error} If position value is not supported\n * @chainable\n */\nOO.ui.MenuLayout.prototype.setMenuPosition = function ( position ) {\n\tthis.$element.removeClass( 'oo-ui-menuLayout-' + this.menuPosition );\n\tthis.menuPosition = position;\n\tthis.$element.addClass( 'oo-ui-menuLayout-' + position );\n\n\treturn this;\n};\n\n/**\n * Get menu position.\n *\n * @return {string} Menu position\n */\nOO.ui.MenuLayout.prototype.getMenuPosition = function () {\n\treturn this.menuPosition;\n};\n\n/**\n * BookletLayouts contain {@link OO.ui.PageLayout page layouts} as well as\n * an {@link OO.ui.OutlineSelectWidget outline} that allows users to easily navigate\n * through the pages and select which one to display. By default, only one page is\n * displayed at a time and the outline is hidden. When a user navigates to a new page,\n * the booklet layout automatically focuses on the first focusable element, unless the\n * default setting is changed. Optionally, booklets can be configured to show\n * {@link OO.ui.OutlineControlsWidget controls} for adding, moving, and removing items.\n *\n *     @example\n *     // Example of a BookletLayout that contains two PageLayouts.\n *\n *     function PageOneLayout( name, config ) {\n *         PageOneLayout.parent.call( this, name, config );\n *         this.$element.append( '<p>First page</p><p>(This booklet has an outline, displayed on the left)</p>' );\n *     }\n *     OO.inheritClass( PageOneLayout, OO.ui.PageLayout );\n *     PageOneLayout.prototype.setupOutlineItem = function () {\n *         this.outlineItem.setLabel( 'Page One' );\n *     };\n *\n *     function PageTwoLayout( name, config ) {\n *         PageTwoLayout.parent.call( this, name, config );\n *         this.$element.append( '<p>Second page</p>' );\n *     }\n *     OO.inheritClass( PageTwoLayout, OO.ui.PageLayout );\n *     PageTwoLayout.prototype.setupOutlineItem = function () {\n *         this.outlineItem.setLabel( 'Page Two' );\n *     };\n *\n *     var page1 = new PageOneLayout( 'one' ),\n *         page2 = new PageTwoLayout( 'two' );\n *\n *     var booklet = new OO.ui.BookletLayout( {\n *         outlined: true\n *     } );\n *\n *     booklet.addPages ( [ page1, page2 ] );\n *     $( 'body' ).append( booklet.$element );\n *\n * @class\n * @extends OO.ui.MenuLayout\n *\n * @constructor\n * @param {Object} [config] Configuration options\n * @cfg {boolean} [continuous=false] Show all pages, one after another\n * @cfg {boolean} [autoFocus=true] Focus on the first focusable element when a new page is displayed. Disabled on mobile.\n * @cfg {boolean} [outlined=false] Show the outline. The outline is used to navigate through the pages of the booklet.\n * @cfg {boolean} [editable=false] Show controls for adding, removing and reordering pages\n */\nOO.ui.BookletLayout = function OoUiBookletLayout( config ) {\n\t// Configuration initialization\n\tconfig = config || {};\n\n\t// Parent constructor\n\tOO.ui.BookletLayout.parent.call( this, config );\n\n\t// Properties\n\tthis.currentPageName = null;\n\tthis.pages = {};\n\tthis.ignoreFocus = false;\n\tthis.stackLayout = new OO.ui.StackLayout( { continuous: !!config.continuous } );\n\tthis.$content.append( this.stackLayout.$element );\n\tthis.autoFocus = config.autoFocus === undefined || !!config.autoFocus;\n\tthis.outlineVisible = false;\n\tthis.outlined = !!config.outlined;\n\tif ( this.outlined ) {\n\t\tthis.editable = !!config.editable;\n\t\tthis.outlineControlsWidget = null;\n\t\tthis.outlineSelectWidget = new OO.ui.OutlineSelectWidget();\n\t\tthis.outlinePanel = new OO.ui.PanelLayout( { scrollable: true } );\n\t\tthis.$menu.append( this.outlinePanel.$element );\n\t\tthis.outlineVisible = true;\n\t\tif ( this.editable ) {\n\t\t\tthis.outlineControlsWidget = new OO.ui.OutlineControlsWidget(\n\t\t\t\tthis.outlineSelectWidget\n\t\t\t);\n\t\t}\n\t}\n\tthis.toggleMenu( this.outlined );\n\n\t// Events\n\tthis.stackLayout.connect( this, { set: 'onStackLayoutSet' } );\n\tif ( this.outlined ) {\n\t\tthis.outlineSelectWidget.connect( this, { select: 'onOutlineSelectWidgetSelect' } );\n\t\tthis.scrolling = false;\n\t\tthis.stackLayout.connect( this, { visibleItemChange: 'onStackLayoutVisibleItemChange' } );\n\t}\n\tif ( this.autoFocus ) {\n\t\t// Event 'focus' does not bubble, but 'focusin' does\n\t\tthis.stackLayout.$element.on( 'focusin', this.onStackLayoutFocus.bind( this ) );\n\t}\n\n\t// Initialization\n\tthis.$element.addClass( 'oo-ui-bookletLayout' );\n\tthis.stackLayout.$element.addClass( 'oo-ui-bookletLayout-stackLayout' );\n\tif ( this.outlined ) {\n\t\tthis.outlinePanel.$element\n\t\t\t.addClass( 'oo-ui-bookletLayout-outlinePanel' )\n\t\t\t.append( this.outlineSelectWidget.$element );\n\t\tif ( this.editable ) {\n\t\t\tthis.outlinePanel.$element\n\t\t\t\t.addClass( 'oo-ui-bookletLayout-outlinePanel-editable' )\n\t\t\t\t.append( this.outlineControlsWidget.$element );\n\t\t}\n\t}\n};\n\n/* Setup */\n\nOO.inheritClass( OO.ui.BookletLayout, OO.ui.MenuLayout );\n\n/* Events */\n\n/**\n * A 'set' event is emitted when a page is {@link #setPage set} to be displayed by the booklet layout.\n * @event set\n * @param {OO.ui.PageLayout} page Current page\n */\n\n/**\n * An 'add' event is emitted when pages are {@link #addPages added} to the booklet layout.\n *\n * @event add\n * @param {OO.ui.PageLayout[]} page Added pages\n * @param {number} index Index pages were added at\n */\n\n/**\n * A 'remove' event is emitted when pages are {@link #clearPages cleared} or\n * {@link #removePages removed} from the booklet.\n *\n * @event remove\n * @param {OO.ui.PageLayout[]} pages Removed pages\n */\n\n/* Methods */\n\n/**\n * Handle stack layout focus.\n *\n * @private\n * @param {jQuery.Event} e Focusin event\n */\nOO.ui.BookletLayout.prototype.onStackLayoutFocus = function ( e ) {\n\tvar name, $target;\n\n\t// Find the page that an element was focused within\n\t$target = $( e.target ).closest( '.oo-ui-pageLayout' );\n\tfor ( name in this.pages ) {\n\t\t// Check for page match, exclude current page to find only page changes\n\t\tif ( this.pages[ name ].$element[ 0 ] === $target[ 0 ] && name !== this.currentPageName ) {\n\t\t\tthis.setPage( name );\n\t\t\tbreak;\n\t\t}\n\t}\n};\n\n/**\n * Handle visibleItemChange events from the stackLayout\n *\n * The next visible page is set as the current page by selecting it\n * in the outline\n *\n * @param {OO.ui.PageLayout} page The next visible page in the layout\n */\nOO.ui.BookletLayout.prototype.onStackLayoutVisibleItemChange = function ( page ) {\n\t// Set a flag to so that the resulting call to #onStackLayoutSet doesn't\n\t// try and scroll the item into view again.\n\tthis.scrolling = true;\n\tthis.outlineSelectWidget.selectItemByData( page.getName() );\n\tthis.scrolling = false;\n};\n\n/**\n * Handle stack layout set events.\n *\n * @private\n * @param {OO.ui.PanelLayout|null} page The page panel that is now the current panel\n */\nOO.ui.BookletLayout.prototype.onStackLayoutSet = function ( page ) {\n\tvar layout = this;\n\tif ( !this.scrolling && page ) {\n\t\tpage.scrollElementIntoView().done( function () {\n\t\t\tif ( layout.autoFocus && !OO.ui.isMobile() ) {\n\t\t\t\tlayout.focus();\n\t\t\t}\n\t\t} );\n\t}\n};\n\n/**\n * Focus the first input in the current page.\n *\n * If no page is selected, the first selectable page will be selected.\n * If the focus is already in an element on the current page, nothing will happen.\n *\n * @param {number} [itemIndex] A specific item to focus on\n */\nOO.ui.BookletLayout.prototype.focus = function ( itemIndex ) {\n\tvar page,\n\t\titems = this.stackLayout.getItems();\n\n\tif ( itemIndex !== undefined && items[ itemIndex ] ) {\n\t\tpage = items[ itemIndex ];\n\t} else {\n\t\tpage = this.stackLayout.getCurrentItem();\n\t}\n\n\tif ( !page && this.outlined ) {\n\t\tthis.selectFirstSelectablePage();\n\t\tpage = this.stackLayout.getCurrentItem();\n\t}\n\tif ( !page ) {\n\t\treturn;\n\t}\n\t// Only change the focus if is not already in the current page\n\tif ( !OO.ui.contains( page.$element[ 0 ], this.getElementDocument().activeElement, true ) ) {\n\t\tpage.focus();\n\t}\n};\n\n/**\n * Find the first focusable input in the booklet layout and focus\n * on it.\n */\nOO.ui.BookletLayout.prototype.focusFirstFocusable = function () {\n\tOO.ui.findFocusable( this.stackLayout.$element ).focus();\n};\n\n/**\n * Handle outline widget select events.\n *\n * @private\n * @param {OO.ui.OptionWidget|null} item Selected item\n */\nOO.ui.BookletLayout.prototype.onOutlineSelectWidgetSelect = function ( item ) {\n\tif ( item ) {\n\t\tthis.setPage( item.getData() );\n\t}\n};\n\n/**\n * Check if booklet has an outline.\n *\n * @return {boolean} Booklet has an outline\n */\nOO.ui.BookletLayout.prototype.isOutlined = function () {\n\treturn this.outlined;\n};\n\n/**\n * Check if booklet has editing controls.\n *\n * @return {boolean} Booklet is editable\n */\nOO.ui.BookletLayout.prototype.isEditable = function () {\n\treturn this.editable;\n};\n\n/**\n * Check if booklet has a visible outline.\n *\n * @return {boolean} Outline is visible\n */\nOO.ui.BookletLayout.prototype.isOutlineVisible = function () {\n\treturn this.outlined && this.outlineVisible;\n};\n\n/**\n * Hide or show the outline.\n *\n * @param {boolean} [show] Show outline, omit to invert current state\n * @chainable\n */\nOO.ui.BookletLayout.prototype.toggleOutline = function ( show ) {\n\tvar booklet = this;\n\n\tif ( this.outlined ) {\n\t\tshow = show === undefined ? !this.outlineVisible : !!show;\n\t\tthis.outlineVisible = show;\n\t\tthis.toggleMenu( show );\n\t\tif ( show && this.editable ) {\n\t\t\t// HACK: When the sidebar stops animating, kill dumb scrollbars (T161798). Only necessary when\n\t\t\t// outline controls are present, The delay matches transition on `.oo-ui-menuLayout-menu`.\n\t\t\tsetTimeout( function () {\n\t\t\t\tOO.ui.Element.static.reconsiderScrollbars( booklet.outlinePanel.$element[ 0 ] );\n\t\t\t}, 200 );\n\t\t}\n\t}\n\n\treturn this;\n};\n\n/**\n * Get the page closest to the specified page.\n *\n * @param {OO.ui.PageLayout} page Page to use as a reference point\n * @return {OO.ui.PageLayout|null} Page closest to the specified page\n */\nOO.ui.BookletLayout.prototype.getClosestPage = function ( page ) {\n\tvar next, prev, level,\n\t\tpages = this.stackLayout.getItems(),\n\t\tindex = pages.indexOf( page );\n\n\tif ( index !== -1 ) {\n\t\tnext = pages[ index + 1 ];\n\t\tprev = pages[ index - 1 ];\n\t\t// Prefer adjacent pages at the same level\n\t\tif ( this.outlined ) {\n\t\t\tlevel = this.outlineSelectWidget.getItemFromData( page.getName() ).getLevel();\n\t\t\tif (\n\t\t\t\tprev &&\n\t\t\t\tlevel === this.outlineSelectWidget.getItemFromData( prev.getName() ).getLevel()\n\t\t\t) {\n\t\t\t\treturn prev;\n\t\t\t}\n\t\t\tif (\n\t\t\t\tnext &&\n\t\t\t\tlevel === this.outlineSelectWidget.getItemFromData( next.getName() ).getLevel()\n\t\t\t) {\n\t\t\t\treturn next;\n\t\t\t}\n\t\t}\n\t}\n\treturn prev || next || null;\n};\n\n/**\n * Get the outline widget.\n *\n * If the booklet is not outlined, the method will return `null`.\n *\n * @return {OO.ui.OutlineSelectWidget|null} Outline widget, or null if the booklet is not outlined\n */\nOO.ui.BookletLayout.prototype.getOutline = function () {\n\treturn this.outlineSelectWidget;\n};\n\n/**\n * Get the outline controls widget.\n *\n * If the outline is not editable, the method will return `null`.\n *\n * @return {OO.ui.OutlineControlsWidget|null} The outline controls widget.\n */\nOO.ui.BookletLayout.prototype.getOutlineControls = function () {\n\treturn this.outlineControlsWidget;\n};\n\n/**\n * Get a page by its symbolic name.\n *\n * @param {string} name Symbolic name of page\n * @return {OO.ui.PageLayout|undefined} Page, if found\n */\nOO.ui.BookletLayout.prototype.getPage = function ( name ) {\n\treturn this.pages[ name ];\n};\n\n/**\n * Get the current page.\n *\n * @return {OO.ui.PageLayout|undefined} Current page, if found\n */\nOO.ui.BookletLayout.prototype.getCurrentPage = function () {\n\tvar name = this.getCurrentPageName();\n\treturn name ? this.getPage( name ) : undefined;\n};\n\n/**\n * Get the symbolic name of the current page.\n *\n * @return {string|null} Symbolic name of the current page\n */\nOO.ui.BookletLayout.prototype.getCurrentPageName = function () {\n\treturn this.currentPageName;\n};\n\n/**\n * Add pages to the booklet layout\n *\n * When pages are added with the same names as existing pages, the existing pages will be\n * automatically removed before the new pages are added.\n *\n * @param {OO.ui.PageLayout[]} pages Pages to add\n * @param {number} index Index of the insertion point\n * @fires add\n * @chainable\n */\nOO.ui.BookletLayout.prototype.addPages = function ( pages, index ) {\n\tvar i, len, name, page, item, currentIndex,\n\t\tstackLayoutPages = this.stackLayout.getItems(),\n\t\tremove = [],\n\t\titems = [];\n\n\t// Remove pages with same names\n\tfor ( i = 0, len = pages.length; i < len; i++ ) {\n\t\tpage = pages[ i ];\n\t\tname = page.getName();\n\n\t\tif ( Object.prototype.hasOwnProperty.call( this.pages, name ) ) {\n\t\t\t// Correct the insertion index\n\t\t\tcurrentIndex = stackLayoutPages.indexOf( this.pages[ name ] );\n\t\t\tif ( currentIndex !== -1 && currentIndex + 1 < index ) {\n\t\t\t\tindex--;\n\t\t\t}\n\t\t\tremove.push( this.pages[ name ] );\n\t\t}\n\t}\n\tif ( remove.length ) {\n\t\tthis.removePages( remove );\n\t}\n\n\t// Add new pages\n\tfor ( i = 0, len = pages.length; i < len; i++ ) {\n\t\tpage = pages[ i ];\n\t\tname = page.getName();\n\t\tthis.pages[ page.getName() ] = page;\n\t\tif ( this.outlined ) {\n\t\t\titem = new OO.ui.OutlineOptionWidget( { data: name } );\n\t\t\tpage.setOutlineItem( item );\n\t\t\titems.push( item );\n\t\t}\n\t}\n\n\tif ( this.outlined && items.length ) {\n\t\tthis.outlineSelectWidget.addItems( items, index );\n\t\tthis.selectFirstSelectablePage();\n\t}\n\tthis.stackLayout.addItems( pages, index );\n\tthis.emit( 'add', pages, index );\n\n\treturn this;\n};\n\n/**\n * Remove the specified pages from the booklet layout.\n *\n * To remove all pages from the booklet, you may wish to use the #clearPages method instead.\n *\n * @param {OO.ui.PageLayout[]} pages An array of pages to remove\n * @fires remove\n * @chainable\n */\nOO.ui.BookletLayout.prototype.removePages = function ( pages ) {\n\tvar i, len, name, page,\n\t\titems = [];\n\n\tfor ( i = 0, len = pages.length; i < len; i++ ) {\n\t\tpage = pages[ i ];\n\t\tname = page.getName();\n\t\tdelete this.pages[ name ];\n\t\tif ( this.outlined ) {\n\t\t\titems.push( this.outlineSelectWidget.getItemFromData( name ) );\n\t\t\tpage.setOutlineItem( null );\n\t\t}\n\t}\n\tif ( this.outlined && items.length ) {\n\t\tthis.outlineSelectWidget.removeItems( items );\n\t\tthis.selectFirstSelectablePage();\n\t}\n\tthis.stackLayout.removeItems( pages );\n\tthis.emit( 'remove', pages );\n\n\treturn this;\n};\n\n/**\n * Clear all pages from the booklet layout.\n *\n * To remove only a subset of pages from the booklet, use the #removePages method.\n *\n * @fires remove\n * @chainable\n */\nOO.ui.BookletLayout.prototype.clearPages = function () {\n\tvar i, len,\n\t\tpages = this.stackLayout.getItems();\n\n\tthis.pages = {};\n\tthis.currentPageName = null;\n\tif ( this.outlined ) {\n\t\tthis.outlineSelectWidget.clearItems();\n\t\tfor ( i = 0, len = pages.length; i < len; i++ ) {\n\t\t\tpages[ i ].setOutlineItem( null );\n\t\t}\n\t}\n\tthis.stackLayout.clearItems();\n\n\tthis.emit( 'remove', pages );\n\n\treturn this;\n};\n\n/**\n * Set the current page by symbolic name.\n *\n * @fires set\n * @param {string} name Symbolic name of page\n */\nOO.ui.BookletLayout.prototype.setPage = function ( name ) {\n\tvar selectedItem,\n\t\t$focused,\n\t\tpage = this.pages[ name ],\n\t\tpreviousPage = this.currentPageName && this.pages[ this.currentPageName ];\n\n\tif ( name !== this.currentPageName ) {\n\t\tif ( this.outlined ) {\n\t\t\tselectedItem = this.outlineSelectWidget.getSelectedItem();\n\t\t\tif ( selectedItem && selectedItem.getData() !== name ) {\n\t\t\t\tthis.outlineSelectWidget.selectItemByData( name );\n\t\t\t}\n\t\t}\n\t\tif ( page ) {\n\t\t\tif ( previousPage ) {\n\t\t\t\tpreviousPage.setActive( false );\n\t\t\t\t// Blur anything focused if the next page doesn't have anything focusable.\n\t\t\t\t// This is not needed if the next page has something focusable (because once it is focused\n\t\t\t\t// this blur happens automatically). If the layout is non-continuous, this check is\n\t\t\t\t// meaningless because the next page is not visible yet and thus can't hold focus.\n\t\t\t\tif (\n\t\t\t\t\tthis.autoFocus &&\n\t\t\t\t\t!OO.ui.isMobile() &&\n\t\t\t\t\tthis.stackLayout.continuous &&\n\t\t\t\t\tOO.ui.findFocusable( page.$element ).length !== 0\n\t\t\t\t) {\n\t\t\t\t\t$focused = previousPage.$element.find( ':focus' );\n\t\t\t\t\tif ( $focused.length ) {\n\t\t\t\t\t\t$focused[ 0 ].blur();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.currentPageName = name;\n\t\t\tpage.setActive( true );\n\t\t\tthis.stackLayout.setItem( page );\n\t\t\tif ( !this.stackLayout.continuous && previousPage ) {\n\t\t\t\t// This should not be necessary, since any inputs on the previous page should have been\n\t\t\t\t// blurred when it was hidden, but browsers are not very consistent about this.\n\t\t\t\t$focused = previousPage.$element.find( ':focus' );\n\t\t\t\tif ( $focused.length ) {\n\t\t\t\t\t$focused[ 0 ].blur();\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.emit( 'set', page );\n\t\t}\n\t}\n};\n\n/**\n * Select the first selectable page.\n *\n * @chainable\n */\nOO.ui.BookletLayout.prototype.selectFirstSelectablePage = function () {\n\tif ( !this.outlineSelectWidget.getSelectedItem() ) {\n\t\tthis.outlineSelectWidget.selectItem( this.outlineSelectWidget.getFirstSelectableItem() );\n\t}\n\n\treturn this;\n};\n\n/**\n * IndexLayouts contain {@link OO.ui.TabPanelLayout tab panel layouts} as well as\n * {@link OO.ui.TabSelectWidget tabs} that allow users to easily navigate through the tab panels and\n * select which one to display. By default, only one tab panel is displayed at a time. When a user\n * navigates to a new tab panel, the index layout automatically focuses on the first focusable element,\n * unless the default setting is changed.\n *\n * TODO: This class is similar to BookletLayout, we may want to refactor to reduce duplication\n *\n *     @example\n *     // Example of a IndexLayout that contains two TabPanelLayouts.\n *\n *     function TabPanelOneLayout( name, config ) {\n *         TabPanelOneLayout.parent.call( this, name, config );\n *         this.$element.append( '<p>First tab panel</p>' );\n *     }\n *     OO.inheritClass( TabPanelOneLayout, OO.ui.TabPanelLayout );\n *     TabPanelOneLayout.prototype.setupTabItem = function () {\n *         this.tabItem.setLabel( 'Tab panel one' );\n *     };\n *\n *     var tabPanel1 = new TabPanelOneLayout( 'one' ),\n *         tabPanel2 = new OO.ui.TabPanelLayout( 'two', { label: 'Tab panel two' } );\n *\n *     tabPanel2.$element.append( '<p>Second tab panel</p>' );\n *\n *     var index = new OO.ui.IndexLayout();\n *\n *     index.addTabPanels ( [ tabPanel1, tabPanel2 ] );\n *     $( 'body' ).append( index.$element );\n *\n * @class\n * @extends OO.ui.MenuLayout\n *\n * @constructor\n * @param {Object} [config] Configuration options\n * @cfg {boolean} [continuous=false] Show all tab panels, one after another\n * @cfg {boolean} [expanded=true] Expand the content panel to fill the entire parent element.\n * @cfg {boolean} [autoFocus=true] Focus on the first focusable element when a new tab panel is displayed. Disabled on mobile.\n */\nOO.ui.IndexLayout = function OoUiIndexLayout( config ) {\n\t// Configuration initialization\n\tconfig = $.extend( {}, config, { menuPosition: 'top' } );\n\n\t// Parent constructor\n\tOO.ui.IndexLayout.parent.call( this, config );\n\n\t// Properties\n\tthis.currentTabPanelName = null;\n\tthis.tabPanels = {};\n\n\tObject.defineProperty( this, 'currentCardName', {\n\t\t// TODO: read documentation\n\t\tconfigurable: true,\n\t\tenumerable: true,\n\t\tget: function () {\n\t\t\tOO.ui.warnDeprecation( 'IndexLayout\\'s currentCardName property is deprecated. Use currentTabPanelName instead. See T155152' );\n\t\t\treturn this.currentTabPanelName;\n\t\t},\n\t\tset: function ( value ) {\n\t\t\tOO.ui.warnDeprecation( 'IndexLayout\\'s currentCardName property is deprecated. Use currentTabPanelName instead. See T155152' );\n\t\t\tthis.currentTabPanelName = value;\n\t\t}\n\t} );\n\n\tObject.defineProperty( this, 'cards', {\n\t\t// TODO: read documentation\n\t\tconfigurable: true,\n\t\tenumerable: true,\n\t\tget: function () {\n\t\t\tOO.ui.warnDeprecation( 'IndexLayout\\'s cards property is deprecated. Use tabPanels instead. See T155152' );\n\t\t\treturn this.tabPanels;\n\t\t},\n\t\tset: function ( value ) {\n\t\t\tOO.ui.warnDeprecation( 'IndexLayout\\'s cards property is deprecated. Use tabPanels instead. See T155152' );\n\t\t\tthis.tabPanels = value;\n\t\t}\n\t} );\n\n\tthis.ignoreFocus = false;\n\tthis.stackLayout = new OO.ui.StackLayout( {\n\t\tcontinuous: !!config.continuous,\n\t\texpanded: config.expanded\n\t} );\n\tthis.$content.append( this.stackLayout.$element );\n\tthis.autoFocus = config.autoFocus === undefined || !!config.autoFocus;\n\n\tthis.tabSelectWidget = new OO.ui.TabSelectWidget();\n\tthis.tabPanel = new OO.ui.PanelLayout();\n\tthis.$menu.append( this.tabPanel.$element );\n\n\tthis.toggleMenu( true );\n\n\t// Events\n\tthis.stackLayout.connect( this, { set: 'onStackLayoutSet' } );\n\tthis.tabSelectWidget.connect( this, { select: 'onTabSelectWidgetSelect' } );\n\tif ( this.autoFocus ) {\n\t\t// Event 'focus' does not bubble, but 'focusin' does\n\t\tthis.stackLayout.$element.on( 'focusin', this.onStackLayoutFocus.bind( this ) );\n\t}\n\n\t// Initialization\n\tthis.$element.addClass( 'oo-ui-indexLayout' );\n\tthis.stackLayout.$element.addClass( 'oo-ui-indexLayout-stackLayout' );\n\tthis.tabPanel.$element\n\t\t.addClass( 'oo-ui-indexLayout-tabPanel' )\n\t\t.append( this.tabSelectWidget.$element );\n};\n\n/* Setup */\n\nOO.inheritClass( OO.ui.IndexLayout, OO.ui.MenuLayout );\n\n/* Events */\n\n/**\n * A 'set' event is emitted when a tab panel is {@link #setTabPanel set} to be displayed by the index layout.\n * @event set\n * @param {OO.ui.TabPanelLayout} tabPanel Current tab panel\n */\n\n/**\n * An 'add' event is emitted when tab panels are {@link #addTabPanels added} to the index layout.\n *\n * @event add\n * @param {OO.ui.TabPanelLayout[]} tabPanel Added tab panels\n * @param {number} index Index tab panels were added at\n */\n\n/**\n * A 'remove' event is emitted when tab panels are {@link #clearTabPanels cleared} or\n * {@link #removeTabPanels removed} from the index.\n *\n * @event remove\n * @param {OO.ui.TabPanelLayout[]} tabPanel Removed tab panels\n */\n\n/* Methods */\n\n/**\n * Handle stack layout focus.\n *\n * @private\n * @param {jQuery.Event} e Focusing event\n */\nOO.ui.IndexLayout.prototype.onStackLayoutFocus = function ( e ) {\n\tvar name, $target;\n\n\t// Find the tab panel that an element was focused within\n\t$target = $( e.target ).closest( '.oo-ui-tabPanelLayout' );\n\tfor ( name in this.tabPanels ) {\n\t\t// Check for tab panel match, exclude current tab panel to find only tab panel changes\n\t\tif ( this.tabPanels[ name ].$element[ 0 ] === $target[ 0 ] && name !== this.currentTabPanelName ) {\n\t\t\tthis.setTabPanel( name );\n\t\t\tbreak;\n\t\t}\n\t}\n};\n\n/**\n * Handle stack layout set events.\n *\n * @private\n * @param {OO.ui.PanelLayout|null} tabPanel The tab panel that is now the current panel\n */\nOO.ui.IndexLayout.prototype.onStackLayoutSet = function ( tabPanel ) {\n\tvar layout = this;\n\tif ( tabPanel ) {\n\t\ttabPanel.scrollElementIntoView().done( function () {\n\t\t\tif ( layout.autoFocus && !OO.ui.isMobile() ) {\n\t\t\t\tlayout.focus();\n\t\t\t}\n\t\t} );\n\t}\n};\n\n/**\n * Focus the first input in the current tab panel.\n *\n * If no tab panel is selected, the first selectable tab panel will be selected.\n * If the focus is already in an element on the current tab panel, nothing will happen.\n *\n * @param {number} [itemIndex] A specific item to focus on\n */\nOO.ui.IndexLayout.prototype.focus = function ( itemIndex ) {\n\tvar tabPanel,\n\t\titems = this.stackLayout.getItems();\n\n\tif ( itemIndex !== undefined && items[ itemIndex ] ) {\n\t\ttabPanel = items[ itemIndex ];\n\t} else {\n\t\ttabPanel = this.stackLayout.getCurrentItem();\n\t}\n\n\tif ( !tabPanel ) {\n\t\tthis.selectFirstSelectableTabPanel();\n\t\ttabPanel = this.stackLayout.getCurrentItem();\n\t}\n\tif ( !tabPanel ) {\n\t\treturn;\n\t}\n\t// Only change the focus if is not already in the current page\n\tif ( !OO.ui.contains( tabPanel.$element[ 0 ], this.getElementDocument().activeElement, true ) ) {\n\t\ttabPanel.focus();\n\t}\n};\n\n/**\n * Find the first focusable input in the index layout and focus\n * on it.\n */\nOO.ui.IndexLayout.prototype.focusFirstFocusable = function () {\n\tOO.ui.findFocusable( this.stackLayout.$element ).focus();\n};\n\n/**\n * Handle tab widget select events.\n *\n * @private\n * @param {OO.ui.OptionWidget|null} item Selected item\n */\nOO.ui.IndexLayout.prototype.onTabSelectWidgetSelect = function ( item ) {\n\tif ( item ) {\n\t\tthis.setTabPanel( item.getData() );\n\t}\n};\n\n/**\n * Get the tab panel closest to the specified tab panel.\n *\n * @param {OO.ui.TabPanelLayout} tabPanel Tab panel to use as a reference point\n * @return {OO.ui.TabPanelLayout|null} Tab panel closest to the specified\n */\nOO.ui.IndexLayout.prototype.getClosestTabPanel = function ( tabPanel ) {\n\tvar next, prev, level,\n\t\ttabPanels = this.stackLayout.getItems(),\n\t\tindex = tabPanels.indexOf( tabPanel );\n\n\tif ( index !== -1 ) {\n\t\tnext = tabPanels[ index + 1 ];\n\t\tprev = tabPanels[ index - 1 ];\n\t\t// Prefer adjacent tab panels at the same level\n\t\tlevel = this.tabSelectWidget.getItemFromData( tabPanel.getName() ).getLevel();\n\t\tif (\n\t\t\tprev &&\n\t\t\tlevel === this.tabSelectWidget.getItemFromData( prev.getName() ).getLevel()\n\t\t) {\n\t\t\treturn prev;\n\t\t}\n\t\tif (\n\t\t\tnext &&\n\t\t\tlevel === this.tabSelectWidget.getItemFromData( next.getName() ).getLevel()\n\t\t) {\n\t\t\treturn next;\n\t\t}\n\t}\n\treturn prev || next || null;\n};\n\n/**\n * Get the tab panel closest to the specified tab panel.\n *\n * @param {OO.ui.TabPanelLayout} tabPanel Tab panel to use as a reference point\n * @return {OO.ui.TabPanelLayout|null} Tab panel closest to the specified\n * @deprecated since v0.21.3, use `getClosestTabPanel` instead\n */\nOO.ui.IndexLayout.prototype.getClosestCard = function ( tabPanel ) {\n\tOO.ui.warnDeprecation( 'IndexLayout\\'s getClosestCard method is deprecated. Use getClosestTabPanel instead. See T155152' );\n\treturn this.getClosestTabPanel( tabPanel );\n};\n\n/**\n * Get the tabs widget.\n *\n * @return {OO.ui.TabSelectWidget} Tabs widget\n */\nOO.ui.IndexLayout.prototype.getTabs = function () {\n\treturn this.tabSelectWidget;\n};\n\n/**\n * Get a tab panel by its symbolic name.\n *\n * @param {string} name Symbolic name of tab panel\n * @return {OO.ui.TabPanelLayout|undefined} Tab panel, if found\n */\nOO.ui.IndexLayout.prototype.getTabPanel = function ( name ) {\n\treturn this.tabPanels[ name ];\n};\n\n/**\n * Get a tab panel by its symbolic name.\n *\n * @param {string} name Symbolic name of tab panel\n * @return {OO.ui.TabPanelLayout|undefined} Tab panel, if found\n * @deprecated since v0.21.3, use `getTabPanel` instead\n */\nOO.ui.IndexLayout.prototype.getCard = function ( name ) {\n\tOO.ui.warnDeprecation( 'IndexLayout\\'s getCard method is deprecated. Use getTabPanel instead. See T155152' );\n\treturn this.getTabPanel( name );\n};\n\n/**\n * Get the current tab panel.\n *\n * @return {OO.ui.TabPanelLayout|undefined} Current tab panel, if found\n */\nOO.ui.IndexLayout.prototype.getCurrentTabPanel = function () {\n\tvar name = this.getCurrentTabPanelName();\n\treturn name ? this.getTabPanel( name ) : undefined;\n};\n\n/**\n * Get the current tab panel.\n *\n * @return {OO.ui.TabPanelLayout|undefined} Current tab panel, if found\n * @deprecated since v0.21.3, use `getCurrentTabPanel` instead\n */\nOO.ui.IndexLayout.prototype.getCurrentCard = function () {\n\tOO.ui.warnDeprecation( 'IndexLayout\\'s getCurrentCard method is deprecated. Use getCurrentTabPanel instead. See T155152' );\n\treturn this.getCurrentTabPanel();\n};\n\n/**\n * Get the symbolic name of the current tab panel.\n *\n * @return {string|null} Symbolic name of the current tab panel\n */\nOO.ui.IndexLayout.prototype.getCurrentTabPanelName = function () {\n\treturn this.currentTabPanelName;\n};\n\n/**\n * Get the symbolic name of the current tab panel.\n *\n * @return {string|null} Symbolic name of the current tab panel\n * @deprecated since v0.21.3, use `getCurrentTabPanelName` instead\n */\nOO.ui.IndexLayout.prototype.getCurrentCardName = function () {\n\tOO.ui.warnDeprecation( 'IndexLayout\\'s getCurrentCardName method is deprecated. Use getCurrentTabPanelName instead. See T155152' );\n\treturn this.getCurrentTabPanelName();\n};\n\n/**\n * Add tab panels to the index layout\n *\n * When tab panels are added with the same names as existing tab panels, the existing tab panels\n * will be automatically removed before the new tab panels are added.\n *\n * @param {OO.ui.TabPanelLayout[]} tabPanels Tab panels to add\n * @param {number} index Index of the insertion point\n * @fires add\n * @chainable\n */\nOO.ui.IndexLayout.prototype.addTabPanels = function ( tabPanels, index ) {\n\tvar i, len, name, tabPanel, item, currentIndex,\n\t\tstackLayoutTabPanels = this.stackLayout.getItems(),\n\t\tremove = [],\n\t\titems = [];\n\n\t// Remove tab panels with same names\n\tfor ( i = 0, len = tabPanels.length; i < len; i++ ) {\n\t\ttabPanel = tabPanels[ i ];\n\t\tname = tabPanel.getName();\n\n\t\tif ( Object.prototype.hasOwnProperty.call( this.tabPanels, name ) ) {\n\t\t\t// Correct the insertion index\n\t\t\tcurrentIndex = stackLayoutTabPanels.indexOf( this.tabPanels[ name ] );\n\t\t\tif ( currentIndex !== -1 && currentIndex + 1 < index ) {\n\t\t\t\tindex--;\n\t\t\t}\n\t\t\tremove.push( this.tabPanels[ name ] );\n\t\t}\n\t}\n\tif ( remove.length ) {\n\t\tthis.removeTabPanels( remove );\n\t}\n\n\t// Add new tab panels\n\tfor ( i = 0, len = tabPanels.length; i < len; i++ ) {\n\t\ttabPanel = tabPanels[ i ];\n\t\tname = tabPanel.getName();\n\t\tthis.tabPanels[ tabPanel.getName() ] = tabPanel;\n\t\titem = new OO.ui.TabOptionWidget( { data: name } );\n\t\ttabPanel.setTabItem( item );\n\t\titems.push( item );\n\t}\n\n\tif ( items.length ) {\n\t\tthis.tabSelectWidget.addItems( items, index );\n\t\tthis.selectFirstSelectableTabPanel();\n\t}\n\tthis.stackLayout.addItems( tabPanels, index );\n\tthis.emit( 'add', tabPanels, index );\n\n\treturn this;\n};\n\n/**\n * Add tab panels to the index layout\n *\n * When tab panels are added with the same names as existing tab panels, the existing tab panels\n * will be automatically removed before the new tab panels are added.\n *\n * @param {OO.ui.TabPanelLayout[]} tabPanels Tab panels to add\n * @param {number} index Index of the insertion point\n * @fires add\n * @chainable\n * @deprecated since v0.21.3, use `addTabPanels` instead\n */\nOO.ui.IndexLayout.prototype.addCards = function ( tabPanels, index ) {\n\tOO.ui.warnDeprecation( 'IndexLayout\\'s addCards method is deprecated. Use addTabPanels instead. See T155152' );\n\treturn this.addTabPanels( tabPanels, index );\n};\n\n/**\n * Remove the specified tab panels from the index layout.\n *\n * To remove all tab panels from the index, you may wish to use the #clearTabPanels method instead.\n *\n * @param {OO.ui.TabPanelLayout[]} tabPanels An array of tab panels to remove\n * @fires remove\n * @chainable\n */\nOO.ui.IndexLayout.prototype.removeTabPanels = function ( tabPanels ) {\n\tvar i, len, name, tabPanel,\n\t\titems = [];\n\n\tfor ( i = 0, len = tabPanels.length; i < len; i++ ) {\n\t\ttabPanel = tabPanels[ i ];\n\t\tname = tabPanel.getName();\n\t\tdelete this.tabPanels[ name ];\n\t\titems.push( this.tabSelectWidget.getItemFromData( name ) );\n\t\ttabPanel.setTabItem( null );\n\t}\n\tif ( items.length ) {\n\t\tthis.tabSelectWidget.removeItems( items );\n\t\tthis.selectFirstSelectableTabPanel();\n\t}\n\tthis.stackLayout.removeItems( tabPanels );\n\tthis.emit( 'remove', tabPanels );\n\n\treturn this;\n};\n\n/**\n * Remove the specified tab panels from the index layout.\n *\n * To remove all tab panels from the index, you may wish to use the #clearTabPanels method instead.\n *\n * @param {OO.ui.TabPanelLayout[]} tabPanels An array of tab panels to remove\n * @fires remove\n * @chainable\n * @deprecated since v0.21.3, use `removeTabPanels` instead\n */\nOO.ui.IndexLayout.prototype.removeCards = function ( tabPanels ) {\n\tOO.ui.warnDeprecation( 'IndexLayout\\'s removeCards method is deprecated. Use removeTabPanels instead. See T155152.' );\n\treturn this.removeTabPanels( tabPanels );\n};\n\n/**\n * Clear all tab panels from the index layout.\n *\n * To remove only a subset of tab panels from the index, use the #removeTabPanels method.\n *\n * @fires remove\n * @chainable\n */\nOO.ui.IndexLayout.prototype.clearTabPanels = function () {\n\tvar i, len,\n\t\ttabPanels = this.stackLayout.getItems();\n\n\tthis.tabPanels = {};\n\tthis.currentTabPanelName = null;\n\tthis.tabSelectWidget.clearItems();\n\tfor ( i = 0, len = tabPanels.length; i < len; i++ ) {\n\t\ttabPanels[ i ].setTabItem( null );\n\t}\n\tthis.stackLayout.clearItems();\n\n\tthis.emit( 'remove', tabPanels );\n\n\treturn this;\n};\n\n/**\n * Clear all tab panels from the index layout.\n *\n * To remove only a subset of tab panels from the index, use the #removeTabPanels method.\n *\n * @fires remove\n * @chainable\n * @deprecated since v0.21.3, use `clearTabPanels` instead\n */\nOO.ui.IndexLayout.prototype.clearCards = function () {\n\tOO.ui.warnDeprecation( 'IndexLayout\\'s clearCards method is deprecated. Use clearTabPanels instead. See T155152.' );\n\treturn this.clearTabPanels();\n};\n\n/**\n * Set the current tab panel by symbolic name.\n *\n * @fires set\n * @param {string} name Symbolic name of tab panel\n */\nOO.ui.IndexLayout.prototype.setTabPanel = function ( name ) {\n\tvar selectedItem,\n\t\t$focused,\n\t\ttabPanel = this.tabPanels[ name ],\n\t\tpreviousTabPanel = this.currentTabPanelName && this.tabPanels[ this.currentTabPanelName ];\n\n\tif ( name !== this.currentTabPanelName ) {\n\t\tselectedItem = this.tabSelectWidget.getSelectedItem();\n\t\tif ( selectedItem && selectedItem.getData() !== name ) {\n\t\t\tthis.tabSelectWidget.selectItemByData( name );\n\t\t}\n\t\tif ( tabPanel ) {\n\t\t\tif ( previousTabPanel ) {\n\t\t\t\tpreviousTabPanel.setActive( false );\n\t\t\t\t// Blur anything focused if the next tab panel doesn't have anything focusable.\n\t\t\t\t// This is not needed if the next tab panel has something focusable (because once it is focused\n\t\t\t\t// this blur happens automatically). If the layout is non-continuous, this check is\n\t\t\t\t// meaningless because the next tab panel is not visible yet and thus can't hold focus.\n\t\t\t\tif (\n\t\t\t\t\tthis.autoFocus &&\n\t\t\t\t\t!OO.ui.isMobile() &&\n\t\t\t\t\tthis.stackLayout.continuous &&\n\t\t\t\t\tOO.ui.findFocusable( tabPanel.$element ).length !== 0\n\t\t\t\t) {\n\t\t\t\t\t$focused = previousTabPanel.$element.find( ':focus' );\n\t\t\t\t\tif ( $focused.length ) {\n\t\t\t\t\t\t$focused[ 0 ].blur();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.currentTabPanelName = name;\n\t\t\ttabPanel.setActive( true );\n\t\t\tthis.stackLayout.setItem( tabPanel );\n\t\t\tif ( !this.stackLayout.continuous && previousTabPanel ) {\n\t\t\t\t// This should not be necessary, since any inputs on the previous tab panel should have been\n\t\t\t\t// blurred when it was hidden, but browsers are not very consistent about this.\n\t\t\t\t$focused = previousTabPanel.$element.find( ':focus' );\n\t\t\t\tif ( $focused.length ) {\n\t\t\t\t\t$focused[ 0 ].blur();\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.emit( 'set', tabPanel );\n\t\t}\n\t}\n};\n\n/**\n * Set the current tab panel by symbolic name.\n *\n * @fires set\n * @param {string} name Symbolic name of tab panel\n * @deprecated since v0.21.3, use `setTabPanel` instead\n */\nOO.ui.IndexLayout.prototype.setCard = function ( name ) {\n\tOO.ui.warnDeprecation( 'IndexLayout\\'s setCard method is deprecated. Use setTabPanel instead. See T155152.' );\n\treturn this.setTabPanel( name );\n};\n\n/**\n * Select the first selectable tab panel.\n *\n * @chainable\n */\nOO.ui.IndexLayout.prototype.selectFirstSelectableTabPanel = function () {\n\tif ( !this.tabSelectWidget.getSelectedItem() ) {\n\t\tthis.tabSelectWidget.selectItem( this.tabSelectWidget.getFirstSelectableItem() );\n\t}\n\n\treturn this;\n};\n\n/**\n * Select the first selectable tab panel.\n *\n * @chainable\n * @deprecated since v0.21.3, use `selectFirstSelectableTabPanel` instead\n */\nOO.ui.IndexLayout.prototype.selectFirstSelectableCard = function () {\n\tOO.ui.warnDeprecation( 'IndexLayout\\'s selectFirstSelectableCard method is deprecated. Use selectFirestSelectableTabPanel instead. See T155152.' );\n\treturn this.selectFirstSelectableTabPanel();\n};\n\n/**\n * ToggleWidget implements basic behavior of widgets with an on/off state.\n * Please see OO.ui.ToggleButtonWidget and OO.ui.ToggleSwitchWidget for examples.\n *\n * @abstract\n * @class\n * @extends OO.ui.Widget\n *\n * @constructor\n * @param {Object} [config] Configuration options\n * @cfg {boolean} [value=false] The toggles initial on/off state.\n *  By default, the toggle is in the 'off' state.\n */\nOO.ui.ToggleWidget = function OoUiToggleWidget( config ) {\n\t// Configuration initialization\n\tconfig = config || {};\n\n\t// Parent constructor\n\tOO.ui.ToggleWidget.parent.call( this, config );\n\n\t// Properties\n\tthis.value = null;\n\n\t// Initialization\n\tthis.$element.addClass( 'oo-ui-toggleWidget' );\n\tthis.setValue( !!config.value );\n};\n\n/* Setup */\n\nOO.inheritClass( OO.ui.ToggleWidget, OO.ui.Widget );\n\n/* Events */\n\n/**\n * @event change\n *\n * A change event is emitted when the on/off state of the toggle changes.\n *\n * @param {boolean} value Value representing the new state of the toggle\n */\n\n/* Methods */\n\n/**\n * Get the value representing the toggles state.\n *\n * @return {boolean} The on/off state of the toggle\n */\nOO.ui.ToggleWidget.prototype.getValue = function () {\n\treturn this.value;\n};\n\n/**\n * Set the state of the toggle: `true` for 'on', `false` for 'off'.\n *\n * @param {boolean} value The state of the toggle\n * @fires change\n * @chainable\n */\nOO.ui.ToggleWidget.prototype.setValue = function ( value ) {\n\tvalue = !!value;\n\tif ( this.value !== value ) {\n\t\tthis.value = value;\n\t\tthis.emit( 'change', value );\n\t\tthis.$element.toggleClass( 'oo-ui-toggleWidget-on', value );\n\t\tthis.$element.toggleClass( 'oo-ui-toggleWidget-off', !value );\n\t}\n\treturn this;\n};\n\n/**\n * ToggleButtons are buttons that have a state (on or off) that is represented by a\n * Boolean value. Like other {@link OO.ui.ButtonWidget buttons}, toggle buttons can be\n * configured with {@link OO.ui.mixin.IconElement icons}, {@link OO.ui.mixin.IndicatorElement indicators},\n * {@link OO.ui.mixin.TitledElement titles}, {@link OO.ui.mixin.FlaggedElement styling flags},\n * and {@link OO.ui.mixin.LabelElement labels}. Please see\n * the [OOjs UI documentation][1] on MediaWiki for more information.\n *\n *     @example\n *     // Toggle buttons in the 'off' and 'on' state.\n *     var toggleButton1 = new OO.ui.ToggleButtonWidget( {\n *         label: 'Toggle Button off'\n *     } );\n *     var toggleButton2 = new OO.ui.ToggleButtonWidget( {\n *         label: 'Toggle Button on',\n *         value: true\n *     } );\n *     // Append the buttons to the DOM.\n *     $( 'body' ).append( toggleButton1.$element, toggleButton2.$element );\n *\n * [1]: https://www.mediawiki.org/wiki/OOjs_UI/Widgets/Buttons_and_Switches#Toggle_buttons\n *\n * @class\n * @extends OO.ui.ToggleWidget\n * @mixins OO.ui.mixin.ButtonElement\n * @mixins OO.ui.mixin.IconElement\n * @mixins OO.ui.mixin.IndicatorElement\n * @mixins OO.ui.mixin.LabelElement\n * @mixins OO.ui.mixin.TitledElement\n * @mixins OO.ui.mixin.FlaggedElement\n * @mixins OO.ui.mixin.TabIndexedElement\n *\n * @constructor\n * @param {Object} [config] Configuration options\n * @cfg {boolean} [value=false] The toggle buttons initial on/off\n *  state. By default, the button is in the 'off' state.\n */\nOO.ui.ToggleButtonWidget = function OoUiToggleButtonWidget( config ) {\n\t// Configuration initialization\n\tconfig = config || {};\n\n\t// Parent constructor\n\tOO.ui.ToggleButtonWidget.parent.call( this, config );\n\n\t// Mixin constructors\n\tOO.ui.mixin.ButtonElement.call( this, $.extend( {}, config, { active: this.active } ) );\n\tOO.ui.mixin.IconElement.call( this, config );\n\tOO.ui.mixin.IndicatorElement.call( this, config );\n\tOO.ui.mixin.LabelElement.call( this, config );\n\tOO.ui.mixin.TitledElement.call( this, $.extend( {}, config, { $titled: this.$button } ) );\n\tOO.ui.mixin.FlaggedElement.call( this, config );\n\tOO.ui.mixin.TabIndexedElement.call( this, $.extend( {}, config, { $tabIndexed: this.$button } ) );\n\n\t// Events\n\tthis.connect( this, { click: 'onAction' } );\n\n\t// Initialization\n\tthis.$button.append( this.$icon, this.$label, this.$indicator );\n\tthis.$element\n\t\t.addClass( 'oo-ui-toggleButtonWidget' )\n\t\t.append( this.$button );\n};\n\n/* Setup */\n\nOO.inheritClass( OO.ui.ToggleButtonWidget, OO.ui.ToggleWidget );\nOO.mixinClass( OO.ui.ToggleButtonWidget, OO.ui.mixin.ButtonElement );\nOO.mixinClass( OO.ui.ToggleButtonWidget, OO.ui.mixin.IconElement );\nOO.mixinClass( OO.ui.ToggleButtonWidget, OO.ui.mixin.IndicatorElement );\nOO.mixinClass( OO.ui.ToggleButtonWidget, OO.ui.mixin.LabelElement );\nOO.mixinClass( OO.ui.ToggleButtonWidget, OO.ui.mixin.TitledElement );\nOO.mixinClass( OO.ui.ToggleButtonWidget, OO.ui.mixin.FlaggedElement );\nOO.mixinClass( OO.ui.ToggleButtonWidget, OO.ui.mixin.TabIndexedElement );\n\n/* Static Properties */\n\n/**\n * @static\n * @inheritdoc\n */\nOO.ui.ToggleButtonWidget.static.tagName = 'span';\n\n/* Methods */\n\n/**\n * Handle the button action being triggered.\n *\n * @private\n */\nOO.ui.ToggleButtonWidget.prototype.onAction = function () {\n\tthis.setValue( !this.value );\n};\n\n/**\n * @inheritdoc\n */\nOO.ui.ToggleButtonWidget.prototype.setValue = function ( value ) {\n\tvalue = !!value;\n\tif ( value !== this.value ) {\n\t\t// Might be called from parent constructor before ButtonElement constructor\n\t\tif ( this.$button ) {\n\t\t\tthis.$button.attr( 'aria-pressed', value.toString() );\n\t\t}\n\t\tthis.setActive( value );\n\t}\n\n\t// Parent method\n\tOO.ui.ToggleButtonWidget.parent.prototype.setValue.call( this, value );\n\n\treturn this;\n};\n\n/**\n * @inheritdoc\n */\nOO.ui.ToggleButtonWidget.prototype.setButtonElement = function ( $button ) {\n\tif ( this.$button ) {\n\t\tthis.$button.removeAttr( 'aria-pressed' );\n\t}\n\tOO.ui.mixin.ButtonElement.prototype.setButtonElement.call( this, $button );\n\tthis.$button.attr( 'aria-pressed', this.value.toString() );\n};\n\n/**\n * ToggleSwitches are switches that slide on and off. Their state is represented by a Boolean\n * value (`true` for on, and `false` otherwise, the default). The off state is represented\n * visually by a slider in the leftmost position.\n *\n *     @example\n *     // Toggle switches in the 'off' and 'on' position.\n *     var toggleSwitch1 = new OO.ui.ToggleSwitchWidget();\n *     var toggleSwitch2 = new OO.ui.ToggleSwitchWidget( {\n *         value: true\n *     } );\n *\n *     // Create a FieldsetLayout to layout and label switches\n *     var fieldset = new OO.ui.FieldsetLayout( {\n *        label: 'Toggle switches'\n *     } );\n *     fieldset.addItems( [\n *         new OO.ui.FieldLayout( toggleSwitch1, { label: 'Off', align: 'top' } ),\n *         new OO.ui.FieldLayout( toggleSwitch2, { label: 'On', align: 'top' } )\n *     ] );\n *     $( 'body' ).append( fieldset.$element );\n *\n * @class\n * @extends OO.ui.ToggleWidget\n * @mixins OO.ui.mixin.TabIndexedElement\n *\n * @constructor\n * @param {Object} [config] Configuration options\n * @cfg {boolean} [value=false] The toggle switchs initial on/off state.\n *  By default, the toggle switch is in the 'off' position.\n */\nOO.ui.ToggleSwitchWidget = function OoUiToggleSwitchWidget( config ) {\n\t// Parent constructor\n\tOO.ui.ToggleSwitchWidget.parent.call( this, config );\n\n\t// Mixin constructors\n\tOO.ui.mixin.TabIndexedElement.call( this, config );\n\n\t// Properties\n\tthis.dragging = false;\n\tthis.dragStart = null;\n\tthis.sliding = false;\n\tthis.$glow = $( '<span>' );\n\tthis.$grip = $( '<span>' );\n\n\t// Events\n\tthis.$element.on( {\n\t\tclick: this.onClick.bind( this ),\n\t\tkeypress: this.onKeyPress.bind( this )\n\t} );\n\n\t// Initialization\n\tthis.$glow.addClass( 'oo-ui-toggleSwitchWidget-glow' );\n\tthis.$grip.addClass( 'oo-ui-toggleSwitchWidget-grip' );\n\tthis.$element\n\t\t.addClass( 'oo-ui-toggleSwitchWidget' )\n\t\t.attr( 'role', 'checkbox' )\n\t\t.append( this.$glow, this.$grip );\n};\n\n/* Setup */\n\nOO.inheritClass( OO.ui.ToggleSwitchWidget, OO.ui.ToggleWidget );\nOO.mixinClass( OO.ui.ToggleSwitchWidget, OO.ui.mixin.TabIndexedElement );\n\n/* Methods */\n\n/**\n * Handle mouse click events.\n *\n * @private\n * @param {jQuery.Event} e Mouse click event\n */\nOO.ui.ToggleSwitchWidget.prototype.onClick = function ( e ) {\n\tif ( !this.isDisabled() && e.which === OO.ui.MouseButtons.LEFT ) {\n\t\tthis.setValue( !this.value );\n\t}\n\treturn false;\n};\n\n/**\n * Handle key press events.\n *\n * @private\n * @param {jQuery.Event} e Key press event\n */\nOO.ui.ToggleSwitchWidget.prototype.onKeyPress = function ( e ) {\n\tif ( !this.isDisabled() && ( e.which === OO.ui.Keys.SPACE || e.which === OO.ui.Keys.ENTER ) ) {\n\t\tthis.setValue( !this.value );\n\t\treturn false;\n\t}\n};\n\n/**\n * @inheritdoc\n */\nOO.ui.ToggleSwitchWidget.prototype.setValue = function ( value ) {\n\tOO.ui.ToggleSwitchWidget.parent.prototype.setValue.call( this, value );\n\tthis.$element.attr( 'aria-checked', this.value.toString() );\n\treturn this;\n};\n\n/**\n * @inheritdoc\n */\nOO.ui.ToggleSwitchWidget.prototype.simulateLabelClick = function () {\n\tif ( !this.isDisabled() ) {\n\t\tthis.setValue( !this.value );\n\t}\n\tthis.focus();\n};\n\n/**\n * OutlineControlsWidget is a set of controls for an {@link OO.ui.OutlineSelectWidget outline select widget}.\n * Controls include moving items up and down, removing items, and adding different kinds of items.\n *\n * **Currently, this class is only used by {@link OO.ui.BookletLayout booklet layouts}.**\n *\n * @class\n * @extends OO.ui.Widget\n * @mixins OO.ui.mixin.GroupElement\n * @mixins OO.ui.mixin.IconElement\n *\n * @constructor\n * @param {OO.ui.OutlineSelectWidget} outline Outline to control\n * @param {Object} [config] Configuration options\n * @cfg {Object} [abilities] List of abilties\n * @cfg {boolean} [abilities.move=true] Allow moving movable items\n * @cfg {boolean} [abilities.remove=true] Allow removing removable items\n */\nOO.ui.OutlineControlsWidget = function OoUiOutlineControlsWidget( outline, config ) {\n\t// Allow passing positional parameters inside the config object\n\tif ( OO.isPlainObject( outline ) && config === undefined ) {\n\t\tconfig = outline;\n\t\toutline = config.outline;\n\t}\n\n\t// Configuration initialization\n\tconfig = $.extend( { icon: 'add' }, config );\n\n\t// Parent constructor\n\tOO.ui.OutlineControlsWidget.parent.call( this, config );\n\n\t// Mixin constructors\n\tOO.ui.mixin.GroupElement.call( this, config );\n\tOO.ui.mixin.IconElement.call( this, config );\n\n\t// Properties\n\tthis.outline = outline;\n\tthis.$movers = $( '<div>' );\n\tthis.upButton = new OO.ui.ButtonWidget( {\n\t\tframed: false,\n\t\ticon: 'collapse',\n\t\ttitle: OO.ui.msg( 'ooui-outline-control-move-up' )\n\t} );\n\tthis.downButton = new OO.ui.ButtonWidget( {\n\t\tframed: false,\n\t\ticon: 'expand',\n\t\ttitle: OO.ui.msg( 'ooui-outline-control-move-down' )\n\t} );\n\tthis.removeButton = new OO.ui.ButtonWidget( {\n\t\tframed: false,\n\t\ticon: 'trash',\n\t\ttitle: OO.ui.msg( 'ooui-outline-control-remove' )\n\t} );\n\tthis.abilities = { move: true, remove: true };\n\n\t// Events\n\toutline.connect( this, {\n\t\tselect: 'onOutlineChange',\n\t\tadd: 'onOutlineChange',\n\t\tremove: 'onOutlineChange'\n\t} );\n\tthis.upButton.connect( this, { click: [ 'emit', 'move', -1 ] } );\n\tthis.downButton.connect( this, { click: [ 'emit', 'move', 1 ] } );\n\tthis.removeButton.connect( this, { click: [ 'emit', 'remove' ] } );\n\n\t// Initialization\n\tthis.$element.addClass( 'oo-ui-outlineControlsWidget' );\n\tthis.$group.addClass( 'oo-ui-outlineControlsWidget-items' );\n\tthis.$movers\n\t\t.addClass( 'oo-ui-outlineControlsWidget-movers' )\n\t\t.append( this.removeButton.$element, this.upButton.$element, this.downButton.$element );\n\tthis.$element.append( this.$icon, this.$group, this.$movers );\n\tthis.setAbilities( config.abilities || {} );\n};\n\n/* Setup */\n\nOO.inheritClass( OO.ui.OutlineControlsWidget, OO.ui.Widget );\nOO.mixinClass( OO.ui.OutlineControlsWidget, OO.ui.mixin.GroupElement );\nOO.mixinClass( OO.ui.OutlineControlsWidget, OO.ui.mixin.IconElement );\n\n/* Events */\n\n/**\n * @event move\n * @param {number} places Number of places to move\n */\n\n/**\n * @event remove\n */\n\n/* Methods */\n\n/**\n * Set abilities.\n *\n * @param {Object} abilities List of abilties\n * @param {boolean} [abilities.move] Allow moving movable items\n * @param {boolean} [abilities.remove] Allow removing removable items\n */\nOO.ui.OutlineControlsWidget.prototype.setAbilities = function ( abilities ) {\n\tvar ability;\n\n\tfor ( ability in this.abilities ) {\n\t\tif ( abilities[ ability ] !== undefined ) {\n\t\t\tthis.abilities[ ability ] = !!abilities[ ability ];\n\t\t}\n\t}\n\n\tthis.onOutlineChange();\n};\n\n/**\n * Handle outline change events.\n *\n * @private\n */\nOO.ui.OutlineControlsWidget.prototype.onOutlineChange = function () {\n\tvar i, len, firstMovable, lastMovable,\n\t\titems = this.outline.getItems(),\n\t\tselectedItem = this.outline.getSelectedItem(),\n\t\tmovable = this.abilities.move && selectedItem && selectedItem.isMovable(),\n\t\tremovable = this.abilities.remove && selectedItem && selectedItem.isRemovable();\n\n\tif ( movable ) {\n\t\ti = -1;\n\t\tlen = items.length;\n\t\twhile ( ++i < len ) {\n\t\t\tif ( items[ i ].isMovable() ) {\n\t\t\t\tfirstMovable = items[ i ];\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\ti = len;\n\t\twhile ( i-- ) {\n\t\t\tif ( items[ i ].isMovable() ) {\n\t\t\t\tlastMovable = items[ i ];\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\tthis.upButton.setDisabled( !movable || selectedItem === firstMovable );\n\tthis.downButton.setDisabled( !movable || selectedItem === lastMovable );\n\tthis.removeButton.setDisabled( !removable );\n};\n\n/**\n * OutlineOptionWidget is an item in an {@link OO.ui.OutlineSelectWidget OutlineSelectWidget}.\n *\n * Currently, this class is only used by {@link OO.ui.BookletLayout booklet layouts}, which contain\n * {@link OO.ui.PageLayout page layouts}. See {@link OO.ui.BookletLayout BookletLayout}\n * for an example.\n *\n * @class\n * @extends OO.ui.DecoratedOptionWidget\n *\n * @constructor\n * @param {Object} [config] Configuration options\n * @cfg {number} [level] Indentation level\n * @cfg {boolean} [movable] Allow modification from {@link OO.ui.OutlineControlsWidget outline controls}.\n */\nOO.ui.OutlineOptionWidget = function OoUiOutlineOptionWidget( config ) {\n\t// Configuration initialization\n\tconfig = config || {};\n\n\t// Parent constructor\n\tOO.ui.OutlineOptionWidget.parent.call( this, config );\n\n\t// Properties\n\tthis.level = 0;\n\tthis.movable = !!config.movable;\n\tthis.removable = !!config.removable;\n\n\t// Initialization\n\tthis.$element.addClass( 'oo-ui-outlineOptionWidget' );\n\tthis.setLevel( config.level );\n};\n\n/* Setup */\n\nOO.inheritClass( OO.ui.OutlineOptionWidget, OO.ui.DecoratedOptionWidget );\n\n/* Static Properties */\n\n/**\n * @static\n * @inheritdoc\n */\nOO.ui.OutlineOptionWidget.static.highlightable = true;\n\n/**\n * @static\n * @inheritdoc\n */\nOO.ui.OutlineOptionWidget.static.scrollIntoViewOnSelect = true;\n\n/**\n * @static\n * @inheritable\n * @property {string}\n */\nOO.ui.OutlineOptionWidget.static.levelClass = 'oo-ui-outlineOptionWidget-level-';\n\n/**\n * @static\n * @inheritable\n * @property {number}\n */\nOO.ui.OutlineOptionWidget.static.levels = 3;\n\n/* Methods */\n\n/**\n * Check if item is movable.\n *\n * Movability is used by {@link OO.ui.OutlineControlsWidget outline controls}.\n *\n * @return {boolean} Item is movable\n */\nOO.ui.OutlineOptionWidget.prototype.isMovable = function () {\n\treturn this.movable;\n};\n\n/**\n * Check if item is removable.\n *\n * Removability is used by {@link OO.ui.OutlineControlsWidget outline controls}.\n *\n * @return {boolean} Item is removable\n */\nOO.ui.OutlineOptionWidget.prototype.isRemovable = function () {\n\treturn this.removable;\n};\n\n/**\n * Get indentation level.\n *\n * @return {number} Indentation level\n */\nOO.ui.OutlineOptionWidget.prototype.getLevel = function () {\n\treturn this.level;\n};\n\n/**\n * @inheritdoc\n */\nOO.ui.OutlineOptionWidget.prototype.setPressed = function ( state ) {\n\tOO.ui.OutlineOptionWidget.parent.prototype.setPressed.call( this, state );\n\tif ( this.pressed ) {\n\t\tthis.setFlags( { progressive: true } );\n\t} else if ( !this.selected ) {\n\t\tthis.setFlags( { progressive: false } );\n\t}\n\treturn this;\n};\n\n/**\n * Set movability.\n *\n * Movability is used by {@link OO.ui.OutlineControlsWidget outline controls}.\n *\n * @param {boolean} movable Item is movable\n * @chainable\n */\nOO.ui.OutlineOptionWidget.prototype.setMovable = function ( movable ) {\n\tthis.movable = !!movable;\n\tthis.updateThemeClasses();\n\treturn this;\n};\n\n/**\n * Set removability.\n *\n * Removability is used by {@link OO.ui.OutlineControlsWidget outline controls}.\n *\n * @param {boolean} removable Item is removable\n * @chainable\n */\nOO.ui.OutlineOptionWidget.prototype.setRemovable = function ( removable ) {\n\tthis.removable = !!removable;\n\tthis.updateThemeClasses();\n\treturn this;\n};\n\n/**\n * @inheritdoc\n */\nOO.ui.OutlineOptionWidget.prototype.setSelected = function ( state ) {\n\tOO.ui.OutlineOptionWidget.parent.prototype.setSelected.call( this, state );\n\tif ( this.selected ) {\n\t\tthis.setFlags( { progressive: true } );\n\t} else {\n\t\tthis.setFlags( { progressive: false } );\n\t}\n\treturn this;\n};\n\n/**\n * Set indentation level.\n *\n * @param {number} [level=0] Indentation level, in the range of [0,#maxLevel]\n * @chainable\n */\nOO.ui.OutlineOptionWidget.prototype.setLevel = function ( level ) {\n\tvar levels = this.constructor.static.levels,\n\t\tlevelClass = this.constructor.static.levelClass,\n\t\ti = levels;\n\n\tthis.level = level ? Math.max( 0, Math.min( levels - 1, level ) ) : 0;\n\twhile ( i-- ) {\n\t\tif ( this.level === i ) {\n\t\t\tthis.$element.addClass( levelClass + i );\n\t\t} else {\n\t\t\tthis.$element.removeClass( levelClass + i );\n\t\t}\n\t}\n\tthis.updateThemeClasses();\n\n\treturn this;\n};\n\n/**\n * OutlineSelectWidget is a structured list that contains {@link OO.ui.OutlineOptionWidget outline options}\n * A set of controls can be provided with an {@link OO.ui.OutlineControlsWidget outline controls} widget.\n *\n * **Currently, this class is only used by {@link OO.ui.BookletLayout booklet layouts}.**\n *\n * @class\n * @extends OO.ui.SelectWidget\n * @mixins OO.ui.mixin.TabIndexedElement\n *\n * @constructor\n * @param {Object} [config] Configuration options\n */\nOO.ui.OutlineSelectWidget = function OoUiOutlineSelectWidget( config ) {\n\t// Parent constructor\n\tOO.ui.OutlineSelectWidget.parent.call( this, config );\n\n\t// Mixin constructors\n\tOO.ui.mixin.TabIndexedElement.call( this, config );\n\n\t// Events\n\tthis.$element.on( {\n\t\tfocus: this.bindKeyDownListener.bind( this ),\n\t\tblur: this.unbindKeyDownListener.bind( this )\n\t} );\n\n\t// Initialization\n\tthis.$element.addClass( 'oo-ui-outlineSelectWidget' );\n};\n\n/* Setup */\n\nOO.inheritClass( OO.ui.OutlineSelectWidget, OO.ui.SelectWidget );\nOO.mixinClass( OO.ui.OutlineSelectWidget, OO.ui.mixin.TabIndexedElement );\n\n/**\n * ButtonOptionWidget is a special type of {@link OO.ui.mixin.ButtonElement button element} that\n * can be selected and configured with data. The class is\n * used with OO.ui.ButtonSelectWidget to create a selection of button options. Please see the\n * [OOjs UI documentation on MediaWiki] [1] for more information.\n *\n * [1]: https://www.mediawiki.org/wiki/OOjs_UI/Widgets/Selects_and_Options#Button_selects_and_options\n *\n * @class\n * @extends OO.ui.OptionWidget\n * @mixins OO.ui.mixin.ButtonElement\n * @mixins OO.ui.mixin.IconElement\n * @mixins OO.ui.mixin.IndicatorElement\n * @mixins OO.ui.mixin.TitledElement\n *\n * @constructor\n * @param {Object} [config] Configuration options\n */\nOO.ui.ButtonOptionWidget = function OoUiButtonOptionWidget( config ) {\n\t// Configuration initialization\n\tconfig = config || {};\n\n\t// Parent constructor\n\tOO.ui.ButtonOptionWidget.parent.call( this, config );\n\n\t// Mixin constructors\n\tOO.ui.mixin.ButtonElement.call( this, config );\n\tOO.ui.mixin.IconElement.call( this, config );\n\tOO.ui.mixin.IndicatorElement.call( this, config );\n\tOO.ui.mixin.TitledElement.call( this, $.extend( {}, config, { $titled: this.$button } ) );\n\n\t// Initialization\n\tthis.$element.addClass( 'oo-ui-buttonOptionWidget' );\n\tthis.$button.append( this.$icon, this.$label, this.$indicator );\n\tthis.$element.append( this.$button );\n};\n\n/* Setup */\n\nOO.inheritClass( OO.ui.ButtonOptionWidget, OO.ui.OptionWidget );\nOO.mixinClass( OO.ui.ButtonOptionWidget, OO.ui.mixin.ButtonElement );\nOO.mixinClass( OO.ui.ButtonOptionWidget, OO.ui.mixin.IconElement );\nOO.mixinClass( OO.ui.ButtonOptionWidget, OO.ui.mixin.IndicatorElement );\nOO.mixinClass( OO.ui.ButtonOptionWidget, OO.ui.mixin.TitledElement );\n\n/* Static Properties */\n\n/**\n * Allow button mouse down events to pass through so they can be handled by the parent select widget\n *\n * @static\n * @inheritdoc\n */\nOO.ui.ButtonOptionWidget.static.cancelButtonMouseDownEvents = false;\n\n/**\n * @static\n * @inheritdoc\n */\nOO.ui.ButtonOptionWidget.static.highlightable = false;\n\n/* Methods */\n\n/**\n * @inheritdoc\n */\nOO.ui.ButtonOptionWidget.prototype.setSelected = function ( state ) {\n\tOO.ui.ButtonOptionWidget.parent.prototype.setSelected.call( this, state );\n\n\tif ( this.constructor.static.selectable ) {\n\t\tthis.setActive( state );\n\t}\n\n\treturn this;\n};\n\n/**\n * ButtonSelectWidget is a {@link OO.ui.SelectWidget select widget} that contains\n * button options and is used together with\n * OO.ui.ButtonOptionWidget. The ButtonSelectWidget provides an interface for\n * highlighting, choosing, and selecting mutually exclusive options. Please see\n * the [OOjs UI documentation on MediaWiki] [1] for more information.\n *\n *     @example\n *     // Example: A ButtonSelectWidget that contains three ButtonOptionWidgets\n *     var option1 = new OO.ui.ButtonOptionWidget( {\n *         data: 1,\n *         label: 'Option 1',\n *         title: 'Button option 1'\n *     } );\n *\n *     var option2 = new OO.ui.ButtonOptionWidget( {\n *         data: 2,\n *         label: 'Option 2',\n *         title: 'Button option 2'\n *     } );\n *\n *     var option3 = new OO.ui.ButtonOptionWidget( {\n *         data: 3,\n *         label: 'Option 3',\n *         title: 'Button option 3'\n *     } );\n *\n *     var buttonSelect=new OO.ui.ButtonSelectWidget( {\n *         items: [ option1, option2, option3 ]\n *     } );\n *     $( 'body' ).append( buttonSelect.$element );\n *\n * [1]: https://www.mediawiki.org/wiki/OOjs_UI/Widgets/Selects_and_Options\n *\n * @class\n * @extends OO.ui.SelectWidget\n * @mixins OO.ui.mixin.TabIndexedElement\n *\n * @constructor\n * @param {Object} [config] Configuration options\n */\nOO.ui.ButtonSelectWidget = function OoUiButtonSelectWidget( config ) {\n\t// Parent constructor\n\tOO.ui.ButtonSelectWidget.parent.call( this, config );\n\n\t// Mixin constructors\n\tOO.ui.mixin.TabIndexedElement.call( this, config );\n\n\t// Events\n\tthis.$element.on( {\n\t\tfocus: this.bindKeyDownListener.bind( this ),\n\t\tblur: this.unbindKeyDownListener.bind( this )\n\t} );\n\n\t// Initialization\n\tthis.$element.addClass( 'oo-ui-buttonSelectWidget' );\n};\n\n/* Setup */\n\nOO.inheritClass( OO.ui.ButtonSelectWidget, OO.ui.SelectWidget );\nOO.mixinClass( OO.ui.ButtonSelectWidget, OO.ui.mixin.TabIndexedElement );\n\n/**\n * TabOptionWidget is an item in a {@link OO.ui.TabSelectWidget TabSelectWidget}.\n *\n * Currently, this class is only used by {@link OO.ui.IndexLayout index layouts}, which contain\n * {@link OO.ui.TabPanelLayout tab panel layouts}. See {@link OO.ui.IndexLayout IndexLayout}\n * for an example.\n *\n * @class\n * @extends OO.ui.OptionWidget\n *\n * @constructor\n * @param {Object} [config] Configuration options\n */\nOO.ui.TabOptionWidget = function OoUiTabOptionWidget( config ) {\n\t// Configuration initialization\n\tconfig = config || {};\n\n\t// Parent constructor\n\tOO.ui.TabOptionWidget.parent.call( this, config );\n\n\t// Initialization\n\tthis.$element.addClass( 'oo-ui-tabOptionWidget' );\n};\n\n/* Setup */\n\nOO.inheritClass( OO.ui.TabOptionWidget, OO.ui.OptionWidget );\n\n/* Static Properties */\n\n/**\n * @static\n * @inheritdoc\n */\nOO.ui.TabOptionWidget.static.highlightable = false;\n\n/**\n * TabSelectWidget is a list that contains {@link OO.ui.TabOptionWidget tab options}\n *\n * **Currently, this class is only used by {@link OO.ui.IndexLayout index layouts}.**\n *\n * @class\n * @extends OO.ui.SelectWidget\n * @mixins OO.ui.mixin.TabIndexedElement\n *\n * @constructor\n * @param {Object} [config] Configuration options\n */\nOO.ui.TabSelectWidget = function OoUiTabSelectWidget( config ) {\n\t// Parent constructor\n\tOO.ui.TabSelectWidget.parent.call( this, config );\n\n\t// Mixin constructors\n\tOO.ui.mixin.TabIndexedElement.call( this, config );\n\n\t// Events\n\tthis.$element.on( {\n\t\tfocus: this.bindKeyDownListener.bind( this ),\n\t\tblur: this.unbindKeyDownListener.bind( this )\n\t} );\n\n\t// Initialization\n\tthis.$element.addClass( 'oo-ui-tabSelectWidget' );\n};\n\n/* Setup */\n\nOO.inheritClass( OO.ui.TabSelectWidget, OO.ui.SelectWidget );\nOO.mixinClass( OO.ui.TabSelectWidget, OO.ui.mixin.TabIndexedElement );\n\n/**\n * CapsuleItemWidgets are used within a {@link OO.ui.CapsuleMultiselectWidget\n * CapsuleMultiselectWidget} to display the selected items.\n *\n * @class\n * @extends OO.ui.Widget\n * @mixins OO.ui.mixin.ItemWidget\n * @mixins OO.ui.mixin.LabelElement\n * @mixins OO.ui.mixin.FlaggedElement\n * @mixins OO.ui.mixin.TabIndexedElement\n *\n * @constructor\n * @param {Object} [config] Configuration options\n */\nOO.ui.CapsuleItemWidget = function OoUiCapsuleItemWidget( config ) {\n\t// Configuration initialization\n\tconfig = config || {};\n\n\t// Parent constructor\n\tOO.ui.CapsuleItemWidget.parent.call( this, config );\n\n\t// Mixin constructors\n\tOO.ui.mixin.ItemWidget.call( this );\n\tOO.ui.mixin.LabelElement.call( this, config );\n\tOO.ui.mixin.FlaggedElement.call( this, config );\n\tOO.ui.mixin.TabIndexedElement.call( this, config );\n\n\t// Events\n\tthis.closeButton = new OO.ui.ButtonWidget( {\n\t\tframed: false,\n\t\ticon: 'close',\n\t\ttabIndex: -1\n\t} ).on( 'click', this.onCloseClick.bind( this ) );\n\n\tthis.on( 'disable', function ( disabled ) {\n\t\tthis.closeButton.setDisabled( disabled );\n\t}.bind( this ) );\n\n\t// Initialization\n\tthis.$element\n\t\t.on( {\n\t\t\tclick: this.onClick.bind( this ),\n\t\t\tkeydown: this.onKeyDown.bind( this )\n\t\t} )\n\t\t.addClass( 'oo-ui-capsuleItemWidget' )\n\t\t.append( this.$label, this.closeButton.$element );\n};\n\n/* Setup */\n\nOO.inheritClass( OO.ui.CapsuleItemWidget, OO.ui.Widget );\nOO.mixinClass( OO.ui.CapsuleItemWidget, OO.ui.mixin.ItemWidget );\nOO.mixinClass( OO.ui.CapsuleItemWidget, OO.ui.mixin.LabelElement );\nOO.mixinClass( OO.ui.CapsuleItemWidget, OO.ui.mixin.FlaggedElement );\nOO.mixinClass( OO.ui.CapsuleItemWidget, OO.ui.mixin.TabIndexedElement );\n\n/* Methods */\n\n/**\n * Handle close icon clicks\n */\nOO.ui.CapsuleItemWidget.prototype.onCloseClick = function () {\n\tvar element = this.getElementGroup();\n\n\tif ( element && $.isFunction( element.removeItems ) ) {\n\t\telement.removeItems( [ this ] );\n\t\telement.focus();\n\t}\n};\n\n/**\n * Handle click event for the entire capsule\n */\nOO.ui.CapsuleItemWidget.prototype.onClick = function () {\n\tvar element = this.getElementGroup();\n\n\tif ( !this.isDisabled() && element && $.isFunction( element.editItem ) ) {\n\t\telement.editItem( this );\n\t}\n};\n\n/**\n * Handle keyDown event for the entire capsule\n *\n * @param {jQuery.Event} e Key down event\n */\nOO.ui.CapsuleItemWidget.prototype.onKeyDown = function ( e ) {\n\tvar element = this.getElementGroup();\n\n\tif ( e.keyCode === OO.ui.Keys.BACKSPACE || e.keyCode === OO.ui.Keys.DELETE ) {\n\t\telement.removeItems( [ this ] );\n\t\telement.focus();\n\t\treturn false;\n\t} else if ( e.keyCode === OO.ui.Keys.ENTER ) {\n\t\telement.editItem( this );\n\t\treturn false;\n\t} else if ( e.keyCode === OO.ui.Keys.LEFT ) {\n\t\telement.getPreviousItem( this ).focus();\n\t} else if ( e.keyCode === OO.ui.Keys.RIGHT ) {\n\t\telement.getNextItem( this ).focus();\n\t}\n};\n\n/**\n * CapsuleMultiselectWidgets are something like a {@link OO.ui.ComboBoxInputWidget combo box widget}\n * that allows for selecting multiple values.\n *\n * For more information about menus and options, please see the [OOjs UI documentation on MediaWiki][1].\n *\n *     @example\n *     // Example: A CapsuleMultiselectWidget.\n *     var capsule = new OO.ui.CapsuleMultiselectWidget( {\n *         label: 'CapsuleMultiselectWidget',\n *         selected: [ 'Option 1', 'Option 3' ],\n *         menu: {\n *             items: [\n *                 new OO.ui.MenuOptionWidget( {\n *                     data: 'Option 1',\n *                     label: 'Option One'\n *                 } ),\n *                 new OO.ui.MenuOptionWidget( {\n *                     data: 'Option 2',\n *                     label: 'Option Two'\n *                 } ),\n *                 new OO.ui.MenuOptionWidget( {\n *                     data: 'Option 3',\n *                     label: 'Option Three'\n *                 } ),\n *                 new OO.ui.MenuOptionWidget( {\n *                     data: 'Option 4',\n *                     label: 'Option Four'\n *                 } ),\n *                 new OO.ui.MenuOptionWidget( {\n *                     data: 'Option 5',\n *                     label: 'Option Five'\n *                 } )\n *             ]\n *         }\n *     } );\n *     $( 'body' ).append( capsule.$element );\n *\n * [1]: https://www.mediawiki.org/wiki/OOjs_UI/Widgets/Selects_and_Options#Menu_selects_and_options\n *\n * @class\n * @extends OO.ui.Widget\n * @mixins OO.ui.mixin.GroupElement\n * @mixins OO.ui.mixin.PopupElement\n * @mixins OO.ui.mixin.TabIndexedElement\n * @mixins OO.ui.mixin.IndicatorElement\n * @mixins OO.ui.mixin.IconElement\n * @uses OO.ui.CapsuleItemWidget\n * @uses OO.ui.MenuSelectWidget\n *\n * @constructor\n * @param {Object} [config] Configuration options\n * @cfg {string} [placeholder] Placeholder text\n * @cfg {boolean} [allowArbitrary=false] Allow data items to be added even if not present in the menu.\n * @cfg {boolean} [allowDuplicates=false] Allow duplicate items to be added.\n * @cfg {Object} [menu] (required) Configuration options to pass to the\n *  {@link OO.ui.MenuSelectWidget menu select widget}.\n * @cfg {Object} [popup] Configuration options to pass to the {@link OO.ui.PopupWidget popup widget}.\n *  If specified, this popup will be shown instead of the menu (but the menu\n *  will still be used for item labels and allowArbitrary=false). The widgets\n *  in the popup should use {@link #addItemsFromData} or {@link #addItems} as necessary.\n * @cfg {jQuery} [$overlay=this.$element] Render the menu or popup into a separate layer.\n *  This configuration is useful in cases where the expanded menu is larger than\n *  its containing `<div>`. The specified overlay layer is usually on top of\n *  the containing `<div>` and has a larger area. By default, the menu uses\n *  relative positioning.\n *  See <https://www.mediawiki.org/wiki/OOjs_UI/Concepts#Overlays>.\n */\nOO.ui.CapsuleMultiselectWidget = function OoUiCapsuleMultiselectWidget( config ) {\n\tvar $tabFocus;\n\n\t// Parent constructor\n\tOO.ui.CapsuleMultiselectWidget.parent.call( this, config );\n\n\t// Configuration initialization\n\tconfig = $.extend( {\n\t\tallowArbitrary: false,\n\t\tallowDuplicates: false,\n\t\t$overlay: this.$element\n\t}, config );\n\n\t// Properties (must be set before mixin constructor calls)\n\tthis.$handle = $( '<div>' );\n\tthis.$input = config.popup ? null : $( '<input>' );\n\tif ( config.placeholder !== undefined && config.placeholder !== '' ) {\n\t\tthis.$input.attr( 'placeholder', config.placeholder );\n\t}\n\n\t// Mixin constructors\n\tOO.ui.mixin.GroupElement.call( this, config );\n\tif ( config.popup ) {\n\t\tconfig.popup = $.extend( {}, config.popup, {\n\t\t\talign: 'forwards',\n\t\t\tanchor: false\n\t\t} );\n\t\tOO.ui.mixin.PopupElement.call( this, config );\n\t\t$tabFocus = $( '<span>' );\n\t\tOO.ui.mixin.TabIndexedElement.call( this, $.extend( {}, config, { $tabIndexed: $tabFocus } ) );\n\t} else {\n\t\tthis.popup = null;\n\t\t$tabFocus = null;\n\t\tOO.ui.mixin.TabIndexedElement.call( this, $.extend( {}, config, { $tabIndexed: this.$input } ) );\n\t}\n\tOO.ui.mixin.IndicatorElement.call( this, config );\n\tOO.ui.mixin.IconElement.call( this, config );\n\n\t// Properties\n\tthis.$content = $( '<div>' );\n\tthis.allowArbitrary = config.allowArbitrary;\n\tthis.allowDuplicates = config.allowDuplicates;\n\tthis.$overlay = config.$overlay;\n\tthis.menu = new OO.ui.MenuSelectWidget( $.extend(\n\t\t{\n\t\t\twidget: this,\n\t\t\t$input: this.$input,\n\t\t\t$floatableContainer: this.$element,\n\t\t\tfilterFromInput: true,\n\t\t\tdisabled: this.isDisabled()\n\t\t},\n\t\tconfig.menu\n\t) );\n\n\t// Events\n\tif ( this.popup ) {\n\t\t$tabFocus.on( {\n\t\t\tfocus: this.focus.bind( this )\n\t\t} );\n\t\tthis.popup.$element.on( 'focusout', this.onPopupFocusOut.bind( this ) );\n\t\tif ( this.popup.$autoCloseIgnore ) {\n\t\t\tthis.popup.$autoCloseIgnore.on( 'focusout', this.onPopupFocusOut.bind( this ) );\n\t\t}\n\t\tthis.popup.connect( this, {\n\t\t\ttoggle: function ( visible ) {\n\t\t\t\t$tabFocus.toggle( !visible );\n\t\t\t}\n\t\t} );\n\t} else {\n\t\tthis.$input.on( {\n\t\t\tfocus: this.onInputFocus.bind( this ),\n\t\t\tblur: this.onInputBlur.bind( this ),\n\t\t\t'propertychange change click mouseup keydown keyup input cut paste select focus':\n\t\t\t\tOO.ui.debounce( this.updateInputSize.bind( this ) ),\n\t\t\tkeydown: this.onKeyDown.bind( this ),\n\t\t\tkeypress: this.onKeyPress.bind( this )\n\t\t} );\n\t}\n\tthis.menu.connect( this, {\n\t\tchoose: 'onMenuChoose',\n\t\ttoggle: 'onMenuToggle',\n\t\tadd: 'onMenuItemsChange',\n\t\tremove: 'onMenuItemsChange'\n\t} );\n\tthis.$handle.on( {\n\t\tmousedown: this.onMouseDown.bind( this )\n\t} );\n\n\t// Initialization\n\tif ( this.$input ) {\n\t\tthis.$input.prop( 'disabled', this.isDisabled() );\n\t\tthis.$input.attr( {\n\t\t\trole: 'combobox',\n\t\t\t'aria-owns': this.menu.getElementId(),\n\t\t\t'aria-autocomplete': 'list'\n\t\t} );\n\t}\n\tif ( config.data ) {\n\t\tthis.setItemsFromData( config.data );\n\t}\n\tthis.$content.addClass( 'oo-ui-capsuleMultiselectWidget-content' )\n\t\t.append( this.$group );\n\tthis.$group.addClass( 'oo-ui-capsuleMultiselectWidget-group' );\n\tthis.$handle.addClass( 'oo-ui-capsuleMultiselectWidget-handle' )\n\t\t.append( this.$indicator, this.$icon, this.$content );\n\tthis.$element.addClass( 'oo-ui-capsuleMultiselectWidget' )\n\t\t.append( this.$handle );\n\tif ( this.popup ) {\n\t\tthis.popup.$element.addClass( 'oo-ui-capsuleMultiselectWidget-popup' );\n\t\tthis.$content.append( $tabFocus );\n\t\tthis.$overlay.append( this.popup.$element );\n\t} else {\n\t\tthis.$content.append( this.$input );\n\t\tthis.$overlay.append( this.menu.$element );\n\t}\n\tif ( $tabFocus ) {\n\t\t$tabFocus.addClass( 'oo-ui-capsuleMultiselectWidget-focusTrap' );\n\t}\n\n\t// Input size needs to be calculated after everything else is rendered\n\tsetTimeout( function () {\n\t\tif ( this.$input ) {\n\t\t\tthis.updateInputSize();\n\t\t}\n\t}.bind( this ) );\n\n\tthis.onMenuItemsChange();\n};\n\n/* Setup */\n\nOO.inheritClass( OO.ui.CapsuleMultiselectWidget, OO.ui.Widget );\nOO.mixinClass( OO.ui.CapsuleMultiselectWidget, OO.ui.mixin.GroupElement );\nOO.mixinClass( OO.ui.CapsuleMultiselectWidget, OO.ui.mixin.PopupElement );\nOO.mixinClass( OO.ui.CapsuleMultiselectWidget, OO.ui.mixin.TabIndexedElement );\nOO.mixinClass( OO.ui.CapsuleMultiselectWidget, OO.ui.mixin.IndicatorElement );\nOO.mixinClass( OO.ui.CapsuleMultiselectWidget, OO.ui.mixin.IconElement );\n\n/* Events */\n\n/**\n * @event change\n *\n * A change event is emitted when the set of selected items changes.\n *\n * @param {Mixed[]} datas Data of the now-selected items\n */\n\n/**\n * @event resize\n *\n * A resize event is emitted when the widget's dimensions change to accomodate newly added items or\n * current user input.\n */\n\n/* Methods */\n\n/**\n * Construct a OO.ui.CapsuleItemWidget (or a subclass thereof) from given label and data.\n * May return `null` if the given label and data are not valid.\n *\n * @protected\n * @param {Mixed} data Custom data of any type.\n * @param {string} label The label text.\n * @return {OO.ui.CapsuleItemWidget|null}\n */\nOO.ui.CapsuleMultiselectWidget.prototype.createItemWidget = function ( data, label ) {\n\tif ( label === '' ) {\n\t\treturn null;\n\t}\n\treturn new OO.ui.CapsuleItemWidget( { data: data, label: label } );\n};\n\n/**\n * @inheritdoc\n */\nOO.ui.CapsuleMultiselectWidget.prototype.getInputId = function () {\n\tif ( !this.$input ) {\n\t\treturn null;\n\t}\n\treturn OO.ui.mixin.TabIndexedElement.prototype.getInputId.call( this );\n};\n\n/**\n * Get the data of the items in the capsule\n *\n * @return {Mixed[]}\n */\nOO.ui.CapsuleMultiselectWidget.prototype.getItemsData = function () {\n\treturn this.getItems().map( function ( item ) {\n\t\treturn item.data;\n\t} );\n};\n\n/**\n * Set the items in the capsule by providing data\n *\n * @chainable\n * @param {Mixed[]} datas\n * @return {OO.ui.CapsuleMultiselectWidget}\n */\nOO.ui.CapsuleMultiselectWidget.prototype.setItemsFromData = function ( datas ) {\n\tvar widget = this,\n\t\tmenu = this.menu,\n\t\titems = this.getItems();\n\n\t$.each( datas, function ( i, data ) {\n\t\tvar j, label,\n\t\t\titem = menu.getItemFromData( data );\n\n\t\tif ( item ) {\n\t\t\tlabel = item.label;\n\t\t} else if ( widget.allowArbitrary ) {\n\t\t\tlabel = String( data );\n\t\t} else {\n\t\t\treturn;\n\t\t}\n\n\t\titem = null;\n\t\tfor ( j = 0; j < items.length; j++ ) {\n\t\t\tif ( items[ j ].data === data && items[ j ].label === label ) {\n\t\t\t\titem = items[ j ];\n\t\t\t\titems.splice( j, 1 );\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif ( !item ) {\n\t\t\titem = widget.createItemWidget( data, label );\n\t\t}\n\t\tif ( item ) {\n\t\t\twidget.addItems( [ item ], i );\n\t\t}\n\t} );\n\n\tif ( items.length ) {\n\t\twidget.removeItems( items );\n\t}\n\n\treturn this;\n};\n\n/**\n * Add items to the capsule by providing their data\n *\n * @chainable\n * @param {Mixed[]} datas\n * @return {OO.ui.CapsuleMultiselectWidget}\n */\nOO.ui.CapsuleMultiselectWidget.prototype.addItemsFromData = function ( datas ) {\n\tvar widget = this,\n\t\tmenu = this.menu,\n\t\titems = [];\n\n\t$.each( datas, function ( i, data ) {\n\t\tvar item;\n\n\t\tif ( !widget.getItemFromData( data ) || widget.allowDuplicates ) {\n\t\t\titem = menu.getItemFromData( data );\n\t\t\tif ( item ) {\n\t\t\t\titem = widget.createItemWidget( data, item.label );\n\t\t\t} else if ( widget.allowArbitrary ) {\n\t\t\t\titem = widget.createItemWidget( data, String( data ) );\n\t\t\t}\n\t\t\tif ( item ) {\n\t\t\t\titems.push( item );\n\t\t\t}\n\t\t}\n\t} );\n\n\tif ( items.length ) {\n\t\tthis.addItems( items );\n\t}\n\n\treturn this;\n};\n\n/**\n * Add items to the capsule by providing a label\n *\n * @param {string} label\n * @return {boolean} Whether the item was added or not\n */\nOO.ui.CapsuleMultiselectWidget.prototype.addItemFromLabel = function ( label ) {\n\tvar item, items;\n\titem = this.menu.getItemFromLabel( label, true );\n\tif ( item ) {\n\t\tthis.addItemsFromData( [ item.data ] );\n\t\treturn true;\n\t} else if ( this.allowArbitrary ) {\n\t\titems = this.getItems();\n\t\tthis.addItemsFromData( [ label ] );\n\t\treturn !OO.compare( this.getItems(), items );\n\t}\n\treturn false;\n};\n\n/**\n * Remove items by data\n *\n * @chainable\n * @param {Mixed[]} datas\n * @return {OO.ui.CapsuleMultiselectWidget}\n */\nOO.ui.CapsuleMultiselectWidget.prototype.removeItemsFromData = function ( datas ) {\n\tvar widget = this,\n\t\titems = [];\n\n\t$.each( datas, function ( i, data ) {\n\t\tvar item = widget.getItemFromData( data );\n\t\tif ( item ) {\n\t\t\titems.push( item );\n\t\t}\n\t} );\n\n\tif ( items.length ) {\n\t\tthis.removeItems( items );\n\t}\n\n\treturn this;\n};\n\n/**\n * @inheritdoc\n */\nOO.ui.CapsuleMultiselectWidget.prototype.addItems = function ( items ) {\n\tvar same, i, l,\n\t\toldItems = this.items.slice();\n\n\tOO.ui.mixin.GroupElement.prototype.addItems.call( this, items );\n\n\tif ( this.items.length !== oldItems.length ) {\n\t\tsame = false;\n\t} else {\n\t\tsame = true;\n\t\tfor ( i = 0, l = oldItems.length; same && i < l; i++ ) {\n\t\t\tsame = same && this.items[ i ] === oldItems[ i ];\n\t\t}\n\t}\n\tif ( !same ) {\n\t\tthis.emit( 'change', this.getItemsData() );\n\t\tthis.updateInputSize();\n\t}\n\n\treturn this;\n};\n\n/**\n * Removes the item from the list and copies its label to `this.$input`.\n *\n * @param {Object} item\n */\nOO.ui.CapsuleMultiselectWidget.prototype.editItem = function ( item ) {\n\tthis.addItemFromLabel( this.$input.val() );\n\tthis.clearInput();\n\tthis.$input.val( item.label );\n\tthis.updateInputSize();\n\tthis.focus();\n\tthis.menu.updateItemVisibility(); // Hack, we shouldn't be calling this method directly\n\tthis.removeItems( [ item ] );\n};\n\n/**\n * @inheritdoc\n */\nOO.ui.CapsuleMultiselectWidget.prototype.removeItems = function ( items ) {\n\tvar same, i, l,\n\t\toldItems = this.items.slice();\n\n\tOO.ui.mixin.GroupElement.prototype.removeItems.call( this, items );\n\n\tif ( this.items.length !== oldItems.length ) {\n\t\tsame = false;\n\t} else {\n\t\tsame = true;\n\t\tfor ( i = 0, l = oldItems.length; same && i < l; i++ ) {\n\t\t\tsame = same && this.items[ i ] === oldItems[ i ];\n\t\t}\n\t}\n\tif ( !same ) {\n\t\tthis.emit( 'change', this.getItemsData() );\n\t\tthis.updateInputSize();\n\t}\n\n\treturn this;\n};\n\n/**\n * @inheritdoc\n */\nOO.ui.CapsuleMultiselectWidget.prototype.clearItems = function () {\n\tif ( this.items.length ) {\n\t\tOO.ui.mixin.GroupElement.prototype.clearItems.call( this );\n\t\tthis.emit( 'change', this.getItemsData() );\n\t\tthis.updateInputSize();\n\t}\n\treturn this;\n};\n\n/**\n * Given an item, returns the item after it. If its the last item,\n * returns `this.$input`. If no item is passed, returns the very first\n * item.\n *\n * @param {OO.ui.CapsuleItemWidget} [item]\n * @return {OO.ui.CapsuleItemWidget|jQuery|boolean}\n */\nOO.ui.CapsuleMultiselectWidget.prototype.getNextItem = function ( item ) {\n\tvar itemIndex;\n\n\tif ( item === undefined ) {\n\t\treturn this.items[ 0 ];\n\t}\n\n\titemIndex = this.items.indexOf( item );\n\tif ( itemIndex < 0 ) { // Item not in list\n\t\treturn false;\n\t} else if ( itemIndex === this.items.length - 1 ) { // Last item\n\t\treturn this.$input;\n\t} else {\n\t\treturn this.items[ itemIndex + 1 ];\n\t}\n};\n\n/**\n * Given an item, returns the item before it. If its the first item,\n * returns `this.$input`. If no item is passed, returns the very last\n * item.\n *\n * @param {OO.ui.CapsuleItemWidget} [item]\n * @return {OO.ui.CapsuleItemWidget|jQuery|boolean}\n */\nOO.ui.CapsuleMultiselectWidget.prototype.getPreviousItem = function ( item ) {\n\tvar itemIndex;\n\n\tif ( item === undefined ) {\n\t\treturn this.items[ this.items.length - 1 ];\n\t}\n\n\titemIndex = this.items.indexOf( item );\n\tif ( itemIndex < 0 ) { // Item not in list\n\t\treturn false;\n\t} else if ( itemIndex === 0 ) { // First item\n\t\treturn this.$input;\n\t} else {\n\t\treturn this.items[ itemIndex - 1 ];\n\t}\n};\n\n/**\n * Get the capsule widget's menu.\n *\n * @return {OO.ui.MenuSelectWidget} Menu widget\n */\nOO.ui.CapsuleMultiselectWidget.prototype.getMenu = function () {\n\treturn this.menu;\n};\n\n/**\n * Handle focus events\n *\n * @private\n * @param {jQuery.Event} event\n */\nOO.ui.CapsuleMultiselectWidget.prototype.onInputFocus = function () {\n\tif ( !this.isDisabled() ) {\n\t\tthis.updateInputSize();\n\t\tthis.menu.toggle( true );\n\t}\n};\n\n/**\n * Handle blur events\n *\n * @private\n * @param {jQuery.Event} event\n */\nOO.ui.CapsuleMultiselectWidget.prototype.onInputBlur = function () {\n\tthis.addItemFromLabel( this.$input.val() );\n\tthis.clearInput();\n};\n\n/**\n * Handles popup focus out events.\n *\n * @private\n * @param {jQuery.Event} e Focus out event\n */\nOO.ui.CapsuleMultiselectWidget.prototype.onPopupFocusOut = function () {\n\tvar widget = this.popup;\n\n\tsetTimeout( function () {\n\t\tif (\n\t\t\twidget.isVisible() &&\n\t\t\t!OO.ui.contains( widget.$element.add( widget.$autoCloseIgnore ).get(), document.activeElement, true )\n\t\t) {\n\t\t\twidget.toggle( false );\n\t\t}\n\t} );\n};\n\n/**\n * Handle mouse down events.\n *\n * @private\n * @param {jQuery.Event} e Mouse down event\n */\nOO.ui.CapsuleMultiselectWidget.prototype.onMouseDown = function ( e ) {\n\tif ( e.which === OO.ui.MouseButtons.LEFT ) {\n\t\tthis.focus();\n\t\treturn false;\n\t} else {\n\t\tthis.updateInputSize();\n\t}\n};\n\n/**\n * Handle key press events.\n *\n * @private\n * @param {jQuery.Event} e Key press event\n */\nOO.ui.CapsuleMultiselectWidget.prototype.onKeyPress = function ( e ) {\n\tif ( !this.isDisabled() ) {\n\t\tif ( e.which === OO.ui.Keys.ESCAPE ) {\n\t\t\tthis.clearInput();\n\t\t\treturn false;\n\t\t}\n\n\t\tif ( !this.popup ) {\n\t\t\tthis.menu.toggle( true );\n\t\t\tif ( e.which === OO.ui.Keys.ENTER ) {\n\t\t\t\tif ( this.addItemFromLabel( this.$input.val() ) ) {\n\t\t\t\t\tthis.clearInput();\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// Make sure the input gets resized.\n\t\t\tsetTimeout( this.updateInputSize.bind( this ), 0 );\n\t\t}\n\t}\n};\n\n/**\n * Handle key down events.\n *\n * @private\n * @param {jQuery.Event} e Key down event\n */\nOO.ui.CapsuleMultiselectWidget.prototype.onKeyDown = function ( e ) {\n\tif (\n\t\t!this.isDisabled() &&\n\t\tthis.$input.val() === '' &&\n\t\tthis.items.length\n\t) {\n\t\t// 'keypress' event is not triggered for Backspace\n\t\tif ( e.keyCode === OO.ui.Keys.BACKSPACE ) {\n\t\t\tif ( e.metaKey || e.ctrlKey ) {\n\t\t\t\tthis.removeItems( this.items.slice( -1 ) );\n\t\t\t} else {\n\t\t\t\tthis.editItem( this.items[ this.items.length - 1 ] );\n\t\t\t}\n\t\t\treturn false;\n\t\t} else if ( e.keyCode === OO.ui.Keys.LEFT ) {\n\t\t\tthis.getPreviousItem().focus();\n\t\t} else if ( e.keyCode === OO.ui.Keys.RIGHT ) {\n\t\t\tthis.getNextItem().focus();\n\t\t}\n\t}\n};\n\n/**\n * Update the dimensions of the text input field to encompass all available area.\n *\n * @private\n * @param {jQuery.Event} e Event of some sort\n */\nOO.ui.CapsuleMultiselectWidget.prototype.updateInputSize = function () {\n\tvar $lastItem, direction, contentWidth, currentWidth, bestWidth;\n\tif ( this.$input && !this.isDisabled() ) {\n\t\tthis.$input.css( 'width', '1em' );\n\t\t$lastItem = this.$group.children().last();\n\t\tdirection = OO.ui.Element.static.getDir( this.$handle );\n\n\t\t// Get the width of the input with the placeholder text as\n\t\t// the value and save it so that we don't keep recalculating\n\t\tif (\n\t\t\tthis.contentWidthWithPlaceholder === undefined &&\n\t\t\tthis.$input.val() === '' &&\n\t\t\tthis.$input.attr( 'placeholder' ) !== undefined\n\t\t) {\n\t\t\tthis.$input.val( this.$input.attr( 'placeholder' ) );\n\t\t\tthis.contentWidthWithPlaceholder = this.$input[ 0 ].scrollWidth;\n\t\t\tthis.$input.val( '' );\n\n\t\t}\n\n\t\t// Always keep the input wide enough for the placeholder text\n\t\tcontentWidth = Math.max(\n\t\t\tthis.$input[ 0 ].scrollWidth,\n\t\t\t// undefined arguments in Math.max lead to NaN\n\t\t\t( this.contentWidthWithPlaceholder === undefined ) ?\n\t\t\t\t0 : this.contentWidthWithPlaceholder\n\t\t);\n\t\tcurrentWidth = this.$input.width();\n\n\t\tif ( contentWidth < currentWidth ) {\n\t\t\tthis.updateIfHeightChanged();\n\t\t\t// All is fine, don't perform expensive calculations\n\t\t\treturn;\n\t\t}\n\n\t\tif ( $lastItem.length === 0 ) {\n\t\t\tbestWidth = this.$content.innerWidth();\n\t\t} else {\n\t\t\tbestWidth = direction === 'ltr' ?\n\t\t\t\tthis.$content.innerWidth() - $lastItem.position().left - $lastItem.outerWidth() :\n\t\t\t\t$lastItem.position().left;\n\t\t}\n\n\t\t// Some safety margin for sanity, because I *really* don't feel like finding out where the few\n\t\t// pixels this is off by are coming from.\n\t\tbestWidth -= 10;\n\t\tif ( contentWidth > bestWidth ) {\n\t\t\t// This will result in the input getting shifted to the next line\n\t\t\tbestWidth = this.$content.innerWidth() - 10;\n\t\t}\n\t\tthis.$input.width( Math.floor( bestWidth ) );\n\t\tthis.updateIfHeightChanged();\n\t} else {\n\t\tthis.updateIfHeightChanged();\n\t}\n};\n\n/**\n * Determine if widget height changed, and if so, update menu position and emit 'resize' event.\n *\n * @private\n */\nOO.ui.CapsuleMultiselectWidget.prototype.updateIfHeightChanged = function () {\n\tvar height = this.$element.height();\n\tif ( height !== this.height ) {\n\t\tthis.height = height;\n\t\tthis.menu.position();\n\t\tif ( this.popup ) {\n\t\t\tthis.popup.updateDimensions();\n\t\t}\n\t\tthis.emit( 'resize' );\n\t}\n};\n\n/**\n * Handle menu choose events.\n *\n * @private\n * @param {OO.ui.OptionWidget} item Chosen item\n */\nOO.ui.CapsuleMultiselectWidget.prototype.onMenuChoose = function ( item ) {\n\tif ( item && item.isVisible() ) {\n\t\tthis.addItemsFromData( [ item.getData() ] );\n\t\tthis.clearInput();\n\t}\n};\n\n/**\n * Handle menu toggle events.\n *\n * @private\n * @param {boolean} isVisible Menu toggle event\n */\nOO.ui.CapsuleMultiselectWidget.prototype.onMenuToggle = function ( isVisible ) {\n\tthis.$element.toggleClass( 'oo-ui-capsuleMultiselectWidget-open', isVisible );\n};\n\n/**\n * Handle menu item change events.\n *\n * @private\n */\nOO.ui.CapsuleMultiselectWidget.prototype.onMenuItemsChange = function () {\n\tthis.setItemsFromData( this.getItemsData() );\n\tthis.$element.toggleClass( 'oo-ui-capsuleMultiselectWidget-empty', this.menu.isEmpty() );\n};\n\n/**\n * Clear the input field\n *\n * @private\n */\nOO.ui.CapsuleMultiselectWidget.prototype.clearInput = function () {\n\tif ( this.$input ) {\n\t\tthis.$input.val( '' );\n\t\tthis.updateInputSize();\n\t}\n\tif ( this.popup ) {\n\t\tthis.popup.toggle( false );\n\t}\n\tthis.menu.toggle( false );\n\tthis.menu.selectItem();\n\tthis.menu.highlightItem();\n};\n\n/**\n * @inheritdoc\n */\nOO.ui.CapsuleMultiselectWidget.prototype.setDisabled = function ( disabled ) {\n\tvar i, len;\n\n\t// Parent method\n\tOO.ui.CapsuleMultiselectWidget.parent.prototype.setDisabled.call( this, disabled );\n\n\tif ( this.$input ) {\n\t\tthis.$input.prop( 'disabled', this.isDisabled() );\n\t}\n\tif ( this.menu ) {\n\t\tthis.menu.setDisabled( this.isDisabled() );\n\t}\n\tif ( this.popup ) {\n\t\tthis.popup.setDisabled( this.isDisabled() );\n\t}\n\n\tif ( this.items ) {\n\t\tfor ( i = 0, len = this.items.length; i < len; i++ ) {\n\t\t\tthis.items[ i ].updateDisabled();\n\t\t}\n\t}\n\n\treturn this;\n};\n\n/**\n * Focus the widget\n *\n * @chainable\n */\nOO.ui.CapsuleMultiselectWidget.prototype.focus = function () {\n\tif ( !this.isDisabled() ) {\n\t\tif ( this.popup ) {\n\t\t\tthis.popup.setSize( this.$handle.outerWidth() );\n\t\t\tthis.popup.toggle( true );\n\t\t\tOO.ui.findFocusable( this.popup.$element ).focus();\n\t\t} else {\n\t\t\tOO.ui.mixin.TabIndexedElement.prototype.focus.call( this );\n\t\t}\n\t}\n\treturn this;\n};\n\n/**\n * TagItemWidgets are used within a {@link OO.ui.TagMultiselectWidget\n * TagMultiselectWidget} to display the selected items.\n *\n * @class\n * @extends OO.ui.Widget\n * @mixins OO.ui.mixin.ItemWidget\n * @mixins OO.ui.mixin.LabelElement\n * @mixins OO.ui.mixin.FlaggedElement\n * @mixins OO.ui.mixin.TabIndexedElement\n * @mixins OO.ui.mixin.DraggableElement\n *\n * @constructor\n * @param {Object} [config] Configuration object\n * @cfg {boolean} [valid=true] Item is valid\n */\nOO.ui.TagItemWidget = function OoUiTagItemWidget( config ) {\n\tconfig = config || {};\n\n\t// Parent constructor\n\tOO.ui.TagItemWidget.parent.call( this, config );\n\n\t// Mixin constructors\n\tOO.ui.mixin.ItemWidget.call( this );\n\tOO.ui.mixin.LabelElement.call( this, config );\n\tOO.ui.mixin.FlaggedElement.call( this, config );\n\tOO.ui.mixin.TabIndexedElement.call( this, config );\n\tOO.ui.mixin.DraggableElement.call( this, config );\n\n\tthis.valid = config.valid === undefined ? true : !!config.valid;\n\n\tthis.closeButton = new OO.ui.ButtonWidget( {\n\t\tframed: false,\n\t\ticon: 'close',\n\t\ttabIndex: -1\n\t} );\n\tthis.closeButton.setDisabled( this.isDisabled() );\n\n\t// Events\n\tthis.closeButton\n\t\t.connect( this, { click: 'remove' } );\n\tthis.$element\n\t\t.on( 'click', this.select.bind( this ) )\n\t\t.on( 'keydown', this.onKeyDown.bind( this ) )\n\t\t// Prevent propagation of mousedown; the tag item \"lives\" in the\n\t\t// clickable area of the TagMultiselectWidget, which listens to\n\t\t// mousedown to open the menu or popup. We want to prevent that\n\t\t// for clicks specifically on the tag itself, so the actions taken\n\t\t// are more deliberate. When the tag is clicked, it will emit the\n\t\t// selection event (similar to how #OO.ui.MultioptionWidget emits 'change')\n\t\t// and can be handled separately.\n\t\t.on( 'mousedown', function ( e ) { e.stopPropagation(); } );\n\n\t// Initialization\n\tthis.$element\n\t\t.addClass( 'oo-ui-tagItemWidget' )\n\t\t.append( this.$label, this.closeButton.$element );\n};\n\n/* Initialization */\n\nOO.inheritClass( OO.ui.TagItemWidget, OO.ui.Widget );\nOO.mixinClass( OO.ui.TagItemWidget, OO.ui.mixin.ItemWidget );\nOO.mixinClass( OO.ui.TagItemWidget, OO.ui.mixin.LabelElement );\nOO.mixinClass( OO.ui.TagItemWidget, OO.ui.mixin.FlaggedElement );\nOO.mixinClass( OO.ui.TagItemWidget, OO.ui.mixin.TabIndexedElement );\nOO.mixinClass( OO.ui.TagItemWidget, OO.ui.mixin.DraggableElement );\n\n/* Events */\n\n/**\n * @event remove\n *\n * A remove action was performed on the item\n */\n\n/**\n * @event navigate\n * @param {string} direction Direction of the movement, forward or backwards\n *\n * A navigate action was performed on the item\n */\n\n/**\n * @event select\n *\n * The tag widget was selected. This can occur when the widget\n * is either clicked or enter was pressed on it.\n */\n\n/**\n * @event valid\n * @param {boolean} isValid Item is valid\n *\n * Item validity has changed\n */\n\n/* Methods */\n\n/**\n * @inheritdoc\n */\nOO.ui.TagItemWidget.prototype.setDisabled = function ( state ) {\n\t// Parent method\n\tOO.ui.TagItemWidget.parent.prototype.setDisabled.call( this, state );\n\n\tif ( this.closeButton ) {\n\t\tthis.closeButton.setDisabled( state );\n\t}\n\treturn this;\n};\n\n/**\n * Handle removal of the item\n *\n * This is mainly for extensibility concerns, so other children\n * of this class can change the behavior if they need to. This\n * is called by both clicking the 'remove' button but also\n * on keypress, which is harder to override if needed.\n *\n * @fires remove\n */\nOO.ui.TagItemWidget.prototype.remove = function () {\n\tif ( !this.isDisabled() ) {\n\t\tthis.emit( 'remove' );\n\t}\n};\n\n/**\n * Handle a keydown event on the widget\n *\n * @fires navigate\n * @fires remove\n * @param {jQuery.Event} e Key down event\n * @return {boolean|undefined} false to stop the operation\n */\nOO.ui.TagItemWidget.prototype.onKeyDown = function ( e ) {\n\tvar movement;\n\n\tif ( e.keyCode === OO.ui.Keys.BACKSPACE || e.keyCode === OO.ui.Keys.DELETE ) {\n\t\tthis.remove();\n\t\treturn false;\n\t} else if ( e.keyCode === OO.ui.Keys.ENTER ) {\n\t\tthis.select();\n\t\treturn false;\n\t} else if (\n\t\te.keyCode === OO.ui.Keys.LEFT ||\n\t\te.keyCode === OO.ui.Keys.RIGHT\n\t) {\n\t\tif ( OO.ui.Element.static.getDir( this.$element ) === 'rtl' ) {\n\t\t\tmovement = {\n\t\t\t\tleft: 'forwards',\n\t\t\t\tright: 'backwards'\n\t\t\t};\n\t\t} else {\n\t\t\tmovement = {\n\t\t\t\tleft: 'backwards',\n\t\t\t\tright: 'forwards'\n\t\t\t};\n\t\t}\n\n\t\tthis.emit(\n\t\t\t'navigate',\n\t\t\te.keyCode === OO.ui.Keys.LEFT ?\n\t\t\t\tmovement.left : movement.right\n\t\t);\n\t}\n};\n\n/**\n * Select this item\n *\n * @fires select\n */\nOO.ui.TagItemWidget.prototype.select = function () {\n\tif ( !this.isDisabled() ) {\n\t\tthis.emit( 'select' );\n\t}\n};\n\n/**\n * Set the valid state of this item\n *\n * @param {boolean} [valid] Item is valid\n * @fires valid\n */\nOO.ui.TagItemWidget.prototype.toggleValid = function ( valid ) {\n\tvalid = valid === undefined ? !this.valid : !!valid;\n\n\tif ( this.valid !== valid ) {\n\t\tthis.valid = valid;\n\n\t\tthis.setFlags( { invalid: !this.valid } );\n\n\t\tthis.emit( 'valid', this.valid );\n\t}\n};\n\n/**\n * Check whether the item is valid\n *\n * @return {boolean} Item is valid\n */\nOO.ui.TagItemWidget.prototype.isValid = function () {\n\treturn this.valid;\n};\n\n/**\n * A basic tag multiselect widget, similar in concept to {@link OO.ui.ComboBoxInputWidget combo box widget}\n * that allows the user to add multiple values that are displayed in a tag area.\n *\n * For more information about menus and options, please see the [OOjs UI documentation on MediaWiki][1].\n *\n * This widget is a base widget; see {@link OO.ui.MenuTagMultiselectWidget MenuTagMultiselectWidget} and\n * {@link OO.ui.PopupTagMultiselectWidget PopupTagMultiselectWidget} for the implementations that use\n * a menu and a popup respectively.\n *\n *     @example\n *     // Example: A basic TagMultiselectWidget.\n *     var widget = new OO.ui.TagMultiselectWidget( {\n *         inputPosition: 'outline',\n *         allowedValues: [ 'Option 1', 'Option 2', 'Option 3' ],\n *         selected: [ 'Option 1' ]\n *     } );\n *     $( 'body' ).append( widget.$element );\n *\n * [1]: https://www.mediawiki.org/wiki/OOjs_UI/Widgets/Selects_and_Options#Menu_selects_and_options\n *\n * @class\n * @extends OO.ui.Widget\n * @mixins OO.ui.mixin.GroupWidget\n * @mixins OO.ui.mixin.DraggableGroupElement\n * @mixins OO.ui.mixin.IndicatorElement\n * @mixins OO.ui.mixin.IconElement\n * @mixins OO.ui.mixin.TabIndexedElement\n * @mixins OO.ui.mixin.FlaggedElement\n *\n * @constructor\n * @param {Object} config Configuration object\n * @cfg {Object} [input] Configuration options for the input widget\n * @cfg {OO.ui.InputWidget} [inputWidget] An optional input widget. If given, it will\n *  replace the input widget used in the TagMultiselectWidget. If not given,\n *  TagMultiselectWidget creates its own.\n * @cfg {boolean} [inputPosition='inline'] Position of the input. Options are:\n * \t- inline: The input is invisible, but exists inside the tag list, so\n * \t\tthe user types into the tag groups to add tags.\n * \t- outline: The input is underneath the tag area.\n * \t- none: No input supplied\n * @cfg {boolean} [allowEditTags=true] Allow editing of the tags by clicking them\n * @cfg {boolean} [allowArbitrary=false] Allow data items to be added even if\n *  not present in the menu.\n * @cfg {Object[]} [allowedValues] An array representing the allowed items\n *  by their datas.\n * @cfg {boolean} [allowDuplicates=false] Allow duplicate items to be added\n * @cfg {boolean} [allowDisplayInvalidTags=false] Allow the display of\n *  invalid tags. These tags will display with an invalid state, and\n *  the widget as a whole will have an invalid state if any invalid tags\n *  are present.\n * @cfg {boolean} [allowReordering=true] Allow reordering of the items\n * @cfg {Object[]|String[]} [selected] A set of selected tags. If given,\n *  these will appear in the tag list on initialization, as long as they\n *  pass the validity tests.\n */\nOO.ui.TagMultiselectWidget = function OoUiTagMultiselectWidget( config ) {\n\tvar inputEvents,\n\t\trAF = window.requestAnimationFrame || setTimeout,\n\t\twidget = this,\n\t\t$tabFocus = $( '<span>' )\n\t\t\t.addClass( 'oo-ui-tagMultiselectWidget-focusTrap' );\n\n\tconfig = config || {};\n\n\t// Parent constructor\n\tOO.ui.TagMultiselectWidget.parent.call( this, config );\n\n\t// Mixin constructors\n\tOO.ui.mixin.GroupWidget.call( this, config );\n\tOO.ui.mixin.IndicatorElement.call( this, config );\n\tOO.ui.mixin.IconElement.call( this, config );\n\tOO.ui.mixin.TabIndexedElement.call( this, config );\n\tOO.ui.mixin.FlaggedElement.call( this, config );\n\tOO.ui.mixin.DraggableGroupElement.call( this, config );\n\n\tthis.toggleDraggable(\n\t\tconfig.allowReordering === undefined ?\n\t\t\ttrue : !!config.allowReordering\n\t);\n\n\tthis.inputPosition = this.constructor.static.allowedInputPositions.indexOf( config.inputPosition ) > -1 ?\n\t\t\tconfig.inputPosition : 'inline';\n\tthis.allowEditTags = config.allowEditTags === undefined ? true : !!config.allowEditTags;\n\tthis.allowArbitrary = !!config.allowArbitrary;\n\tthis.allowDuplicates = !!config.allowDuplicates;\n\tthis.allowedValues = config.allowedValues || [];\n\tthis.allowDisplayInvalidTags = config.allowDisplayInvalidTags;\n\tthis.hasInput = this.inputPosition !== 'none';\n\tthis.height = null;\n\tthis.valid = true;\n\n\tthis.$content = $( '<div>' )\n\t\t.addClass( 'oo-ui-tagMultiselectWidget-content' );\n\tthis.$handle = $( '<div>' )\n\t\t.addClass( 'oo-ui-tagMultiselectWidget-handle' )\n\t\t.append(\n\t\t\tthis.$indicator,\n\t\t\tthis.$icon,\n\t\t\tthis.$content\n\t\t\t\t.append(\n\t\t\t\t\tthis.$group\n\t\t\t\t\t\t.addClass( 'oo-ui-tagMultiselectWidget-group' )\n\t\t\t\t)\n\t\t);\n\n\t// Events\n\tthis.aggregate( {\n\t\tremove: 'itemRemove',\n\t\tnavigate: 'itemNavigate',\n\t\tselect: 'itemSelect'\n\t} );\n\tthis.connect( this, {\n\t\titemRemove: 'onTagRemove',\n\t\titemSelect: 'onTagSelect',\n\t\titemNavigate: 'onTagNavigate',\n\t\tchange: 'onChangeTags'\n\t} );\n\tthis.$handle.on( {\n\t\tmousedown: this.onMouseDown.bind( this )\n\t} );\n\n\t// Initialize\n\tthis.$element\n\t\t.addClass( 'oo-ui-tagMultiselectWidget' )\n\t\t.append( this.$handle );\n\n\tif ( this.hasInput ) {\n\t\tif ( config.inputWidget ) {\n\t\t\tthis.input = config.inputWidget;\n\t\t} else {\n\t\t\tthis.input = new OO.ui.TextInputWidget( $.extend( {\n\t\t\t\tplaceholder: config.placeholder,\n\t\t\t\tclasses: [ 'oo-ui-tagMultiselectWidget-input' ]\n\t\t\t}, config.input ) );\n\t\t}\n\t\tthis.input.setDisabled( this.isDisabled() );\n\n\t\tinputEvents = {\n\t\t\tfocus: this.onInputFocus.bind( this ),\n\t\t\tblur: this.onInputBlur.bind( this ),\n\t\t\t'propertychange change click mouseup keydown keyup input cut paste select focus':\n\t\t\t\tOO.ui.debounce( this.updateInputSize.bind( this ) ),\n\t\t\tkeydown: this.onInputKeyDown.bind( this ),\n\t\t\tkeypress: this.onInputKeyPress.bind( this )\n\t\t};\n\n\t\tthis.input.$input.on( inputEvents );\n\n\t\tif ( this.inputPosition === 'outline' ) {\n\t\t\t// Override max-height for the input widget\n\t\t\t// in the case the widget is outline so it can\n\t\t\t// stretch all the way if the widet is wide\n\t\t\tthis.input.$element.css( 'max-width', 'inherit' );\n\t\t\tthis.$element\n\t\t\t\t.addClass( 'oo-ui-tagMultiselectWidget-outlined' )\n\t\t\t\t.append( this.input.$element );\n\t\t} else {\n\t\t\tthis.$element.addClass( 'oo-ui-tagMultiselectWidget-inlined' );\n\t\t\t// HACK: When the widget is using 'inline' input, the\n\t\t\t// behavior needs to only use the $input itself\n\t\t\t// so we style and size it accordingly (otherwise\n\t\t\t// the styling and sizing can get very convoluted\n\t\t\t// when the wrapping divs and other elements)\n\t\t\t// We are taking advantage of still being able to\n\t\t\t// call the widget itself for operations like\n\t\t\t// .getValue() and setDisabled() and .focus() but\n\t\t\t// having only the $input attached to the DOM\n\t\t\tthis.$content.append( this.input.$input );\n\t\t}\n\t} else {\n\t\tthis.$content.append( $tabFocus );\n\t}\n\n\tthis.setTabIndexedElement(\n\t\tthis.hasInput ?\n\t\t\tthis.input.$input :\n\t\t\t$tabFocus\n\t);\n\n\tif ( config.selected ) {\n\t\tthis.setValue( config.selected );\n\t}\n\n\t// HACK: Input size needs to be calculated after everything\n\t// else is rendered\n\trAF( function () {\n\t\tif ( widget.hasInput ) {\n\t\t\twidget.updateInputSize();\n\t\t}\n\t} );\n};\n\n/* Initialization */\n\nOO.inheritClass( OO.ui.TagMultiselectWidget, OO.ui.Widget );\nOO.mixinClass( OO.ui.TagMultiselectWidget, OO.ui.mixin.GroupWidget );\nOO.mixinClass( OO.ui.TagMultiselectWidget, OO.ui.mixin.DraggableGroupElement );\nOO.mixinClass( OO.ui.TagMultiselectWidget, OO.ui.mixin.IndicatorElement );\nOO.mixinClass( OO.ui.TagMultiselectWidget, OO.ui.mixin.IconElement );\nOO.mixinClass( OO.ui.TagMultiselectWidget, OO.ui.mixin.TabIndexedElement );\nOO.mixinClass( OO.ui.TagMultiselectWidget, OO.ui.mixin.FlaggedElement );\n\n/* Static properties */\n\n/**\n * Allowed input positions.\n * - inline: The input is inside the tag list\n * - outline: The input is under the tag list\n * - none: There is no input\n *\n * @property {Array}\n */\nOO.ui.TagMultiselectWidget.static.allowedInputPositions = [ 'inline', 'outline', 'none' ];\n\n/* Methods */\n\n/**\n * Handle mouse down events.\n *\n * @private\n * @param {jQuery.Event} e Mouse down event\n * @return {boolean} False to prevent defaults\n */\nOO.ui.TagMultiselectWidget.prototype.onMouseDown = function ( e ) {\n\tif ( !this.isDisabled() && e.which === OO.ui.MouseButtons.LEFT ) {\n\t\tthis.focus();\n\t\treturn false;\n\t}\n};\n\n/**\n * Handle key press events.\n *\n * @private\n * @param {jQuery.Event} e Key press event\n * @return {boolean} Whether to prevent defaults\n */\nOO.ui.TagMultiselectWidget.prototype.onInputKeyPress = function ( e ) {\n\tvar stopOrContinue,\n\t\twithMetaKey = e.metaKey || e.ctrlKey;\n\n\tif ( !this.isDisabled() ) {\n\t\tif ( e.which === OO.ui.Keys.ENTER ) {\n\t\t\tstopOrContinue = this.doInputEnter( e, withMetaKey );\n\t\t}\n\n\t\t// Make sure the input gets resized.\n\t\tsetTimeout( this.updateInputSize.bind( this ), 0 );\n\t\treturn stopOrContinue;\n\t}\n};\n\n/**\n * Handle key down events.\n *\n * @private\n * @param {jQuery.Event} e Key down event\n * @return {boolean}\n */\nOO.ui.TagMultiselectWidget.prototype.onInputKeyDown = function ( e ) {\n\tvar movement, direction,\n\t\twithMetaKey = e.metaKey || e.ctrlKey;\n\n\tif ( !this.isDisabled() ) {\n\t\t// 'keypress' event is not triggered for Backspace\n\t\tif ( e.keyCode === OO.ui.Keys.BACKSPACE ) {\n\t\t\treturn this.doInputBackspace( e, withMetaKey );\n\t\t} else if ( e.keyCode === OO.ui.Keys.ESCAPE ) {\n\t\t\treturn this.doInputEscape( e );\n\t\t} else if (\n\t\t\te.keyCode === OO.ui.Keys.LEFT ||\n\t\t\te.keyCode === OO.ui.Keys.RIGHT\n\t\t) {\n\t\t\tif ( OO.ui.Element.static.getDir( this.$element ) === 'rtl' ) {\n\t\t\t\tmovement = {\n\t\t\t\t\tleft: 'forwards',\n\t\t\t\t\tright: 'backwards'\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tmovement = {\n\t\t\t\t\tleft: 'backwards',\n\t\t\t\t\tright: 'forwards'\n\t\t\t\t};\n\t\t\t}\n\t\t\tdirection = e.keyCode === OO.ui.Keys.LEFT ?\n\t\t\t\tmovement.left : movement.right;\n\n\t\t\treturn this.doInputArrow( e, direction, withMetaKey );\n\t\t}\n\t}\n};\n\n/**\n * Respond to input focus event\n */\nOO.ui.TagMultiselectWidget.prototype.onInputFocus = function () {\n\tthis.$element.addClass( 'oo-ui-tagMultiselectWidget-focus' );\n};\n\n/**\n * Respond to input blur event\n */\nOO.ui.TagMultiselectWidget.prototype.onInputBlur = function () {\n\tthis.$element.removeClass( 'oo-ui-tagMultiselectWidget-focus' );\n};\n\n/**\n * Perform an action after the enter key on the input\n *\n * @param {jQuery.Event} e Event data\n * @param {boolean} [withMetaKey] Whether this key was pressed with\n * a meta key like 'ctrl'\n * @return {boolean} Whether to prevent defaults\n */\nOO.ui.TagMultiselectWidget.prototype.doInputEnter = function () {\n\tthis.addTagFromInput();\n\treturn false;\n};\n\n/**\n * Perform an action responding to the enter key on the input\n *\n * @param {jQuery.Event} e Event data\n * @param {boolean} [withMetaKey] Whether this key was pressed with\n * a meta key like 'ctrl'\n * @return {boolean} Whether to prevent defaults\n */\nOO.ui.TagMultiselectWidget.prototype.doInputBackspace = function ( e, withMetaKey ) {\n\tvar items, item;\n\n\tif (\n\t\tthis.inputPosition === 'inline' &&\n\t\tthis.input.getValue() === '' &&\n\t\t!this.isEmpty()\n\t) {\n\t\t// Delete the last item\n\t\titems = this.getItems();\n\t\titem = items[ items.length - 1 ];\n\t\tthis.removeItems( [ item ] );\n\t\t// If Ctrl/Cmd was pressed, delete item entirely.\n\t\t// Otherwise put it into the text field for editing.\n\t\tif ( !withMetaKey ) {\n\t\t\tthis.input.setValue( item.getData() );\n\t\t}\n\n\t\treturn false;\n\t}\n};\n\n/**\n * Perform an action after the escape key on the input\n *\n * @param {jQuery.Event} e Event data\n */\nOO.ui.TagMultiselectWidget.prototype.doInputEscape = function () {\n\tthis.clearInput();\n};\n\n/**\n * Perform an action after the arrow key on the input, select the previous\n * or next item from the input.\n * See #getPreviousItem and #getNextItem\n *\n * @param {jQuery.Event} e Event data\n * @param {string} direction Direction of the movement; forwards or backwards\n * @param {boolean} [withMetaKey] Whether this key was pressed with\n *  a meta key like 'ctrl'\n */\nOO.ui.TagMultiselectWidget.prototype.doInputArrow = function ( e, direction ) {\n\tif (\n\t\tthis.inputPosition === 'inline' &&\n\t\t!this.isEmpty()\n\t) {\n\t\tif ( direction === 'backwards' ) {\n\t\t\t// Get previous item\n\t\t\tthis.getPreviousItem().focus();\n\t\t} else {\n\t\t\t// Get next item\n\t\t\tthis.getNextItem().focus();\n\t\t}\n\t}\n};\n\n/**\n * Respond to item select event\n *\n * @param {OO.ui.TagItemWidget} item Selected item\n */\nOO.ui.TagMultiselectWidget.prototype.onTagSelect = function ( item ) {\n\tif ( this.hasInput && this.allowEditTags ) {\n\t\tif ( this.input.getValue() ) {\n\t\t\tthis.addTagFromInput();\n\t\t}\n\t\t// 1. Get the label of the tag into the input\n\t\tthis.input.setValue( item.getData() );\n\t\t// 2. Remove the tag\n\t\tthis.removeItems( [ item ] );\n\t\t// 3. Focus the input\n\t\tthis.focus();\n\t}\n};\n\n/**\n * Respond to change event, where items were added, removed, or cleared.\n */\nOO.ui.TagMultiselectWidget.prototype.onChangeTags = function () {\n\tthis.toggleValid( this.checkValidity() );\n\tif ( this.hasInput ) {\n\t\tthis.updateInputSize();\n\t}\n\tthis.updateIfHeightChanged();\n};\n\n/**\n * @inheritdoc\n */\nOO.ui.TagMultiselectWidget.prototype.setDisabled = function ( isDisabled ) {\n\t// Parent method\n\tOO.ui.TagMultiselectWidget.parent.prototype.setDisabled.call( this, isDisabled );\n\n\tif ( this.hasInput && this.input ) {\n\t\tthis.input.setDisabled( !!isDisabled );\n\t}\n\n\tif ( this.items ) {\n\t\tthis.getItems().forEach( function ( item ) {\n\t\t\titem.setDisabled( !!isDisabled );\n\t\t} );\n\t}\n};\n\n/**\n * Respond to tag remove event\n * @param {OO.ui.TagItemWidget} item Removed tag\n */\nOO.ui.TagMultiselectWidget.prototype.onTagRemove = function ( item ) {\n\tthis.removeTagByData( item.getData() );\n};\n\n/**\n * Respond to navigate event on the tag\n *\n * @param {OO.ui.TagItemWidget} item Removed tag\n * @param {string} direction Direction of movement; 'forwards' or 'backwards'\n */\nOO.ui.TagMultiselectWidget.prototype.onTagNavigate = function ( item, direction ) {\n\tif ( direction === 'forwards' ) {\n\t\tthis.getNextItem( item ).focus();\n\t} else {\n\t\tthis.getPreviousItem( item ).focus();\n\t}\n};\n\n/**\n * Add tag from input value\n */\nOO.ui.TagMultiselectWidget.prototype.addTagFromInput = function () {\n\tvar val = this.input.getValue(),\n\t\tisValid = this.isAllowedData( val );\n\n\tif ( !val ) {\n\t\treturn;\n\t}\n\n\tif ( isValid || this.allowDisplayInvalidTags ) {\n\t\tthis.addTag( val );\n\t\tthis.clearInput();\n\t\tthis.focus();\n\t}\n};\n\n/**\n * Clear the input\n */\nOO.ui.TagMultiselectWidget.prototype.clearInput = function () {\n\tthis.input.setValue( '' );\n};\n\n/**\n * Check whether the given value is a duplicate of an existing\n * tag already in the list.\n *\n * @param {string|Object} data Requested value\n * @return {boolean} Value is duplicate\n */\nOO.ui.TagMultiselectWidget.prototype.isDuplicateData = function ( data ) {\n\treturn !!this.getItemFromData( data );\n};\n\n/**\n * Check whether a given value is allowed to be added\n *\n * @param {string|Object} data Requested value\n * @return {boolean} Value is allowed\n */\nOO.ui.TagMultiselectWidget.prototype.isAllowedData = function ( data ) {\n\tif (\n\t\t!this.allowDuplicates &&\n\t\tthis.isDuplicateData( data )\n\t) {\n\t\treturn false;\n\t}\n\n\tif ( this.allowArbitrary ) {\n\t\treturn true;\n\t}\n\n\t// Check with allowed values\n\tif (\n\t\tthis.getAllowedValues().some( function ( value ) {\n\t\t\treturn data === value;\n\t\t} )\n\t) {\n\t\treturn true;\n\t}\n\n\treturn false;\n};\n\n/**\n * Get the allowed values list\n *\n * @return {string[]} Allowed data values\n */\nOO.ui.TagMultiselectWidget.prototype.getAllowedValues = function () {\n\treturn this.allowedValues;\n};\n\n/**\n * Add a value to the allowed values list\n *\n * @param {string} value Allowed data value\n */\nOO.ui.TagMultiselectWidget.prototype.addAllowedValue = function ( value ) {\n\tif ( this.allowedValues.indexOf( value ) === -1 ) {\n\t\tthis.allowedValues.push( value );\n\t}\n};\n\n/**\n * Get the datas of the currently selected items\n *\n * @return {string[]|Object[]} Datas of currently selected items\n */\nOO.ui.TagMultiselectWidget.prototype.getValue = function () {\n\treturn this.getItems()\n\t\t.filter( function ( item ) {\n\t\t\treturn item.isValid();\n\t\t} )\n\t\t.map( function ( item ) {\n\t\t\treturn item.getData();\n\t\t} );\n};\n\n/**\n * Set the value of this widget by datas.\n *\n * @param {string|string[]|Object|Object[]} valueObject An object representing the data\n *  and label of the value. If the widget allows arbitrary values,\n *  the items will be added as-is. Otherwise, the data value will\n *  be checked against allowedValues.\n *  This object must contain at least a data key. Example:\n *  { data: 'foo', label: 'Foo item' }\n *  For multiple items, use an array of objects. For example:\n *   [\n *      { data: 'foo', label: 'Foo item' },\n *      { data: 'bar', label: 'Bar item' }\n * \t ]\n *  Value can also be added with plaintext array, for example:\n *  [ 'foo', 'bar', 'bla' ] or a single string, like 'foo'\n */\nOO.ui.TagMultiselectWidget.prototype.setValue = function ( valueObject ) {\n\tvalueObject = Array.isArray( valueObject ) ? valueObject : [ valueObject ];\n\n\tthis.clearItems();\n\tvalueObject.forEach( function ( obj ) {\n\t\tif ( typeof obj === 'string' ) {\n\t\t\tthis.addTag( obj );\n\t\t} else {\n\t\t\tthis.addTag( obj.data, obj.label );\n\t\t}\n\t}.bind( this ) );\n};\n\n/**\n * Add tag to the display area\n *\n * @param {string|Object} data Tag data\n * @param {string} [label] Tag label. If no label is provided, the\n *  stringified version of the data will be used instead.\n * @return {boolean} Item was added successfully\n */\nOO.ui.TagMultiselectWidget.prototype.addTag = function ( data, label ) {\n\tvar newItemWidget,\n\t\tisValid = this.isAllowedData( data );\n\n\tif ( isValid || this.allowDisplayInvalidTags ) {\n\t\tnewItemWidget = this.createTagItemWidget( data, label );\n\t\tnewItemWidget.toggleValid( isValid );\n\t\tthis.addItems( [ newItemWidget ] );\n\t\treturn true;\n\t}\n\treturn false;\n};\n\n/**\n * Remove tag by its data property.\n *\n * @param {string|Object} data Tag data\n */\nOO.ui.TagMultiselectWidget.prototype.removeTagByData = function ( data ) {\n\tvar item = this.getItemFromData( data );\n\n\tthis.removeItems( [ item ] );\n};\n\n/**\n * Construct a OO.ui.TagItemWidget (or a subclass thereof) from given label and data.\n *\n * @protected\n * @param {string} data Item data\n * @param {string} label The label text.\n * @return {OO.ui.TagItemWidget}\n */\nOO.ui.TagMultiselectWidget.prototype.createTagItemWidget = function ( data, label ) {\n\tlabel = label || data;\n\n\treturn new OO.ui.TagItemWidget( { data: data, label: label } );\n};\n\n/**\n * Given an item, returns the item after it. If the item is already the\n * last item, return `this.input`. If no item is passed, returns the\n * very first item.\n *\n * @protected\n * @param {OO.ui.TagItemWidget} [item] Tag item\n * @return {OO.ui.Widget} The next widget available.\n */\nOO.ui.TagMultiselectWidget.prototype.getNextItem = function ( item ) {\n\tvar itemIndex = this.items.indexOf( item );\n\n\tif ( item === undefined || itemIndex === -1 ) {\n\t\treturn this.items[ 0 ];\n\t}\n\n\tif ( itemIndex === this.items.length - 1 ) { // Last item\n\t\tif ( this.hasInput ) {\n\t\t\treturn this.input;\n\t\t} else {\n\t\t\t// Return first item\n\t\t\treturn this.items[ 0 ];\n\t\t}\n\t} else {\n\t\treturn this.items[ itemIndex + 1 ];\n\t}\n};\n\n/**\n * Given an item, returns the item before it. If the item is already the\n * first item, return `this.input`. If no item is passed, returns the\n * very last item.\n *\n * @protected\n * @param {OO.ui.TagItemWidget} [item] Tag item\n * @return {OO.ui.Widget} The previous widget available.\n */\nOO.ui.TagMultiselectWidget.prototype.getPreviousItem = function ( item ) {\n\tvar itemIndex = this.items.indexOf( item );\n\n\tif ( item === undefined || itemIndex === -1 ) {\n\t\treturn this.items[ this.items.length - 1 ];\n\t}\n\n\tif ( itemIndex === 0 ) {\n\t\tif ( this.hasInput ) {\n\t\t\treturn this.input;\n\t\t} else {\n\t\t\t// Return the last item\n\t\t\treturn this.items[ this.items.length - 1 ];\n\t\t}\n\t} else {\n\t\treturn this.items[ itemIndex - 1 ];\n\t}\n};\n\n/**\n * Update the dimensions of the text input field to encompass all available area.\n * This is especially relevant for when the input is at the edge of a line\n * and should get smaller. The usual operation (as an inline-block with min-width)\n * does not work in that case, pushing the input downwards to the next line.\n *\n * @private\n */\nOO.ui.TagMultiselectWidget.prototype.updateInputSize = function () {\n\tvar $lastItem, direction, contentWidth, currentWidth, bestWidth;\n\tif ( this.inputPosition === 'inline' && !this.isDisabled() ) {\n\t\tif ( this.input.$input[ 0 ].scrollWidth === 0 ) {\n\t\t\t// Input appears to be attached but not visible.\n\t\t\t// Don't attempt to adjust its size, because our measurements\n\t\t\t// are going to fail anyway.\n\t\t\treturn;\n\t\t}\n\t\tthis.input.$input.css( 'width', '1em' );\n\t\t$lastItem = this.$group.children().last();\n\t\tdirection = OO.ui.Element.static.getDir( this.$handle );\n\n\t\t// Get the width of the input with the placeholder text as\n\t\t// the value and save it so that we don't keep recalculating\n\t\tif (\n\t\t\tthis.contentWidthWithPlaceholder === undefined &&\n\t\t\tthis.input.getValue() === '' &&\n\t\t\tthis.input.$input.attr( 'placeholder' ) !== undefined\n\t\t) {\n\t\t\tthis.input.setValue( this.input.$input.attr( 'placeholder' ) );\n\t\t\tthis.contentWidthWithPlaceholder = this.input.$input[ 0 ].scrollWidth;\n\t\t\tthis.input.setValue( '' );\n\n\t\t}\n\n\t\t// Always keep the input wide enough for the placeholder text\n\t\tcontentWidth = Math.max(\n\t\t\tthis.input.$input[ 0 ].scrollWidth,\n\t\t\t// undefined arguments in Math.max lead to NaN\n\t\t\t( this.contentWidthWithPlaceholder === undefined ) ?\n\t\t\t\t0 : this.contentWidthWithPlaceholder\n\t\t);\n\t\tcurrentWidth = this.input.$input.width();\n\n\t\tif ( contentWidth < currentWidth ) {\n\t\t\tthis.updateIfHeightChanged();\n\t\t\t// All is fine, don't perform expensive calculations\n\t\t\treturn;\n\t\t}\n\n\t\tif ( $lastItem.length === 0 ) {\n\t\t\tbestWidth = this.$content.innerWidth();\n\t\t} else {\n\t\t\tbestWidth = direction === 'ltr' ?\n\t\t\t\tthis.$content.innerWidth() - $lastItem.position().left - $lastItem.outerWidth() :\n\t\t\t\t$lastItem.position().left;\n\t\t}\n\n\t\t// Some safety margin for sanity, because I *really* don't feel like finding out where the few\n\t\t// pixels this is off by are coming from.\n\t\tbestWidth -= 10;\n\t\tif ( contentWidth > bestWidth ) {\n\t\t\t// This will result in the input getting shifted to the next line\n\t\t\tbestWidth = this.$content.innerWidth() - 10;\n\t\t}\n\t\tthis.input.$input.width( Math.floor( bestWidth ) );\n\t\tthis.updateIfHeightChanged();\n\t} else {\n\t\tthis.updateIfHeightChanged();\n\t}\n};\n\n/**\n * Determine if widget height changed, and if so,\n * emit the resize event. This is useful for when there are either\n * menus or popups attached to the bottom of the widget, to allow\n * them to change their positioning in case the widget moved down\n * or up.\n *\n * @private\n */\nOO.ui.TagMultiselectWidget.prototype.updateIfHeightChanged = function () {\n\tvar height = this.$element.height();\n\tif ( height !== this.height ) {\n\t\tthis.height = height;\n\t\tthis.emit( 'resize' );\n\t}\n};\n\n/**\n * Check whether all items in the widget are valid\n *\n * @return {boolean} Widget is valid\n */\nOO.ui.TagMultiselectWidget.prototype.checkValidity = function () {\n\treturn this.getItems().every( function ( item ) {\n\t\treturn item.isValid();\n\t} );\n};\n\n/**\n * Set the valid state of this item\n *\n * @param {boolean} [valid] Item is valid\n * @fires valid\n */\nOO.ui.TagMultiselectWidget.prototype.toggleValid = function ( valid ) {\n\tvalid = valid === undefined ? !this.valid : !!valid;\n\n\tif ( this.valid !== valid ) {\n\t\tthis.valid = valid;\n\n\t\tthis.setFlags( { invalid: !this.valid } );\n\n\t\tthis.emit( 'valid', this.valid );\n\t}\n};\n\n/**\n * Get the current valid state of the widget\n *\n * @return {boolean} Widget is valid\n */\nOO.ui.TagMultiselectWidget.prototype.isValid = function () {\n\treturn this.valid;\n};\n\n/**\n * PopupTagMultiselectWidget is a {@link OO.ui.TagMultiselectWidget OO.ui.TagMultiselectWidget} intended\n * to use a popup. The popup can be configured to have a default input to insert values into the widget.\n *\n * For more information about menus and options, please see the [OOjs UI documentation on MediaWiki][1].\n *\n *     @example\n *     // Example: A basic PopupTagMultiselectWidget.\n *     var widget = new OO.ui.PopupTagMultiselectWidget();\n *     $( 'body' ).append( widget.$element );\n *\n *     // Example: A PopupTagMultiselectWidget with an external popup.\n *     var popupInput = new OO.ui.TextInputWidget(),\n *         widget = new OO.ui.PopupTagMultiselectWidget( {\n *            popupInput: popupInput,\n *            popup: {\n *               $content: popupInput.$element\n *            }\n *         } );\n *     $( 'body' ).append( widget.$element );\n *\n * [1]: https://www.mediawiki.org/wiki/OOjs_UI/Widgets/Selects_and_Options#Menu_selects_and_options\n *\n * @class\n * @extends OO.ui.TagMultiselectWidget\n * @mixins OO.ui.mixin.PopupElement\n *\n * @param {Object} config Configuration object\n * @cfg {jQuery} [$overlay] An overlay for the popup.\n *  See <https://www.mediawiki.org/wiki/OOjs_UI/Concepts#Overlays>.\n * @cfg {Object} [popup] Configuration options for the popup\n * @cfg {OO.ui.InputWidget} [popupInput] An input widget inside the popup that will be\n *  focused when the popup is opened and will be used as replacement for the\n *  general input in the widget.\n */\nOO.ui.PopupTagMultiselectWidget = function OoUiPopupTagMultiselectWidget( config ) {\n\tvar defaultInput,\n\t\tdefaultConfig = { popup: {} };\n\n\tconfig = config || {};\n\n\t// Parent constructor\n\tOO.ui.PopupTagMultiselectWidget.parent.call( this, $.extend( { inputPosition: 'none' }, config ) );\n\n\tthis.$overlay = config.$overlay || this.$element;\n\n\tif ( !config.popup ) {\n\t\t// For the default base implementation, we give a popup\n\t\t// with an input widget inside it. For any other use cases\n\t\t// the popup needs to be populated externally and the\n\t\t// event handled to add tags separately and manually\n\t\tdefaultInput = new OO.ui.TextInputWidget();\n\n\t\tdefaultConfig.popupInput = defaultInput;\n\t\tdefaultConfig.popup.$content = defaultInput.$element;\n\n\t\tthis.$element.addClass( 'oo-ui-popupTagMultiselectWidget-defaultPopup' );\n\t}\n\n\t// Add overlay, and add that to the autoCloseIgnore\n\tdefaultConfig.popup.$overlay = this.$overlay;\n\tdefaultConfig.popup.$autoCloseIgnore = this.hasInput ?\n\t\tthis.input.$element.add( this.$overlay ) : this.$overlay;\n\n\t// Allow extending any of the above\n\tconfig = $.extend( defaultConfig, config );\n\n\t// Mixin constructors\n\tOO.ui.mixin.PopupElement.call( this, config );\n\n\tif ( this.hasInput ) {\n\t\tthis.input.$input.on( 'focus', this.popup.toggle.bind( this.popup, true ) );\n\t}\n\n\t// Configuration options\n\tthis.popupInput = config.popupInput;\n\tif ( this.popupInput ) {\n\t\tthis.popupInput.connect( this, {\n\t\t\tenter: 'onPopupInputEnter'\n\t\t} );\n\t}\n\n\t// Events\n\tthis.on( 'resize', this.popup.updateDimensions.bind( this.popup ) );\n\tthis.popup.connect( this, { toggle: 'onPopupToggle' } );\n\tthis.$tabIndexed\n\t\t.on( 'focus', this.onFocus.bind( this ) );\n\n\t// Initialize\n\tthis.$element\n\t\t.append( this.popup.$element )\n\t\t.addClass( 'oo-ui-popupTagMultiselectWidget' );\n};\n\n/* Initialization */\n\nOO.inheritClass( OO.ui.PopupTagMultiselectWidget, OO.ui.TagMultiselectWidget );\nOO.mixinClass( OO.ui.PopupTagMultiselectWidget, OO.ui.mixin.PopupElement );\n\n/* Methods */\n\n/**\n * Focus event handler.\n *\n * @private\n */\nOO.ui.PopupTagMultiselectWidget.prototype.onFocus = function () {\n\tthis.popup.toggle( true );\n};\n\n/**\n * Respond to popup toggle event\n *\n * @param {boolean} isVisible Popup is visible\n */\nOO.ui.PopupTagMultiselectWidget.prototype.onPopupToggle = function ( isVisible ) {\n\tif ( isVisible && this.popupInput ) {\n\t\tthis.popupInput.focus();\n\t}\n};\n\n/**\n * Respond to popup input enter event\n */\nOO.ui.PopupTagMultiselectWidget.prototype.onPopupInputEnter = function () {\n\tif ( this.popupInput ) {\n\t\tthis.addTagByPopupValue( this.popupInput.getValue() );\n\t\tthis.popupInput.setValue( '' );\n\t}\n};\n\n/**\n * @inheritdoc\n */\nOO.ui.PopupTagMultiselectWidget.prototype.onTagSelect = function ( item ) {\n\tif ( this.popupInput && this.allowEditTags ) {\n\t\tthis.popupInput.setValue( item.getData() );\n\t\tthis.removeItems( [ item ] );\n\n\t\tthis.popup.toggle( true );\n\t\tthis.popupInput.focus();\n\t} else {\n\t\t// Parent\n\t\tOO.ui.PopupTagMultiselectWidget.parent.prototype.onTagSelect.call( this, item );\n\t}\n};\n\n/**\n * Add a tag by the popup value.\n * Whatever is responsible for setting the value in the popup should call\n * this method to add a tag, or use the regular methods like #addTag or\n * #setValue directly.\n *\n * @param {string} data The value of item\n * @param {string} [label] The label of the tag. If not given, the data is used.\n */\nOO.ui.PopupTagMultiselectWidget.prototype.addTagByPopupValue = function ( data, label ) {\n\tthis.addTag( data, label );\n};\n\n/**\n * MenuTagMultiselectWidget is a {@link OO.ui.TagMultiselectWidget OO.ui.TagMultiselectWidget} intended\n * to use a menu of selectable options.\n *\n * For more information about menus and options, please see the [OOjs UI documentation on MediaWiki][1].\n *\n *     @example\n *     // Example: A basic MenuTagMultiselectWidget.\n *     var widget = new OO.ui.MenuTagMultiselectWidget( {\n *         inputPosition: 'outline',\n *         options: [\n *            { data: 'option1', label: 'Option 1' },\n *            { data: 'option2', label: 'Option 2' },\n *            { data: 'option3', label: 'Option 3' },\n *         ],\n *         selected: [ 'option1', 'option2' ]\n *     } );\n *     $( 'body' ).append( widget.$element );\n *\n * [1]: https://www.mediawiki.org/wiki/OOjs_UI/Widgets/Selects_and_Options#Menu_selects_and_options\n *\n * @class\n * @extends OO.ui.TagMultiselectWidget\n *\n * @constructor\n * @param {Object} [config] Configuration object\n * @cfg {Object} [menu] Configuration object for the menu widget\n * @cfg {jQuery} [$overlay] An overlay for the menu.\n *  See <https://www.mediawiki.org/wiki/OOjs_UI/Concepts#Overlays>.\n * @cfg {Object[]} [options=[]] Array of menu options in the format `{ data: , label:  }`\n */\nOO.ui.MenuTagMultiselectWidget = function OoUiMenuTagMultiselectWidget( config ) {\n\tconfig = config || {};\n\n\t// Parent constructor\n\tOO.ui.MenuTagMultiselectWidget.parent.call( this, config );\n\n\tthis.$overlay = config.$overlay || this.$element;\n\n\tthis.menu = this.createMenuWidget( $.extend( {\n\t\twidget: this,\n\t\tinput: this.hasInput ? this.input : null,\n\t\t$input: this.hasInput ? this.input.$input : null,\n\t\tfilterFromInput: !!this.hasInput,\n\t\t$autoCloseIgnore: this.hasInput ?\n\t\t\tthis.input.$element.add( this.$overlay ) : this.$overlay,\n\t\t$floatableContainer: this.hasInput && this.inputPosition === 'outline' ?\n\t\t\tthis.input.$element : this.$element,\n\t\t$overlay: this.$overlay,\n\t\tdisabled: this.isDisabled()\n\t}, config.menu ) );\n\tthis.addOptions( config.options || [] );\n\n\t// Events\n\tthis.menu.connect( this, {\n\t\tchoose: 'onMenuChoose',\n\t\ttoggle: 'onMenuToggle'\n\t} );\n\tif ( this.hasInput ) {\n\t\tthis.input.connect( this, { change: 'onInputChange' } );\n\t}\n\tthis.connect( this, { resize: 'onResize' } );\n\n\t// Initialization\n\tthis.$overlay\n\t\t.append( this.menu.$element );\n\tthis.$element\n\t\t.addClass( 'oo-ui-menuTagMultiselectWidget' );\n\t// TagMultiselectWidget already does this, but it doesn't work right because this.menu is not yet\n\t// set up while the parent constructor runs, and #getAllowedValues rejects everything.\n\tif ( config.selected ) {\n\t\tthis.setValue( config.selected );\n\t}\n};\n\n/* Initialization */\n\nOO.inheritClass( OO.ui.MenuTagMultiselectWidget, OO.ui.TagMultiselectWidget );\n\n/* Methods */\n\n/**\n * Respond to resize event\n */\nOO.ui.MenuTagMultiselectWidget.prototype.onResize = function () {\n\t// Reposition the menu\n\tthis.menu.position();\n};\n\n/**\n * @inheritdoc\n */\nOO.ui.MenuTagMultiselectWidget.prototype.onInputFocus = function () {\n\t// Parent method\n\tOO.ui.MenuTagMultiselectWidget.parent.prototype.onInputFocus.call( this );\n\n\tthis.menu.toggle( true );\n};\n\n/**\n * Respond to input change event\n */\nOO.ui.MenuTagMultiselectWidget.prototype.onInputChange = function () {\n\tthis.menu.toggle( true );\n};\n\n/**\n * Respond to menu choose event\n *\n * @param {OO.ui.OptionWidget} menuItem Chosen menu item\n */\nOO.ui.MenuTagMultiselectWidget.prototype.onMenuChoose = function ( menuItem ) {\n\t// Add tag\n\tthis.addTag( menuItem.getData(), menuItem.getLabel() );\n};\n\n/**\n * Respond to menu toggle event. Reset item highlights on hide.\n *\n * @param {boolean} isVisible The menu is visible\n */\nOO.ui.MenuTagMultiselectWidget.prototype.onMenuToggle = function ( isVisible ) {\n\tif ( !isVisible ) {\n\t\tthis.menu.selectItem( null );\n\t\tthis.menu.highlightItem( null );\n\t}\n};\n\n/**\n * @inheritdoc\n */\nOO.ui.MenuTagMultiselectWidget.prototype.onTagSelect = function ( tagItem ) {\n\tvar menuItem = this.menu.getItemFromData( tagItem.getData() );\n\t// Override the base behavior from TagMultiselectWidget; the base behavior\n\t// in TagMultiselectWidget is to remove the tag to edit it in the input,\n\t// but in our case, we want to utilize the menu selection behavior, and\n\t// definitely not remove the item.\n\n\t// Select the menu item\n\tthis.menu.selectItem( menuItem );\n\n\tthis.focus();\n};\n\n/**\n * @inheritdoc\n */\nOO.ui.MenuTagMultiselectWidget.prototype.addTagFromInput = function () {\n\tvar inputValue = this.input.getValue(),\n\t\tvalidated = false,\n\t\thighlightedItem = this.menu.getHighlightedItem(),\n\t\titem = this.menu.getItemFromData( inputValue );\n\n\t// Override the parent method so we add from the menu\n\t// rather than directly from the input\n\n\t// Look for a highlighted item first\n\tif ( highlightedItem ) {\n\t\tvalidated = this.addTag( highlightedItem.getData(), highlightedItem.getLabel() );\n\t} else if ( item ) {\n\t\t// Look for the element that fits the data\n\t\tvalidated = this.addTag( item.getData(), item.getLabel() );\n\t} else {\n\t\t// Otherwise, add the tag - the method will only add if the\n\t\t// tag is valid or if invalid tags are allowed\n\t\tvalidated = this.addTag( inputValue );\n\t}\n\n\tif ( validated ) {\n\t\tthis.clearInput();\n\t\tthis.focus();\n\t}\n};\n\n/**\n * Return the visible items in the menu. This is mainly used for when\n * the menu is filtering results.\n *\n * @return {OO.ui.MenuOptionWidget[]} Visible results\n */\nOO.ui.MenuTagMultiselectWidget.prototype.getMenuVisibleItems = function () {\n\treturn this.menu.getItems().filter( function ( menuItem ) {\n\t\treturn menuItem.isVisible();\n\t} );\n};\n\n/**\n * Create the menu for this widget. This is in a separate method so that\n * child classes can override this without polluting the constructor with\n * unnecessary extra objects that will be overidden.\n *\n * @param {Object} menuConfig Configuration options\n * @return {OO.ui.MenuSelectWidget} Menu widget\n */\nOO.ui.MenuTagMultiselectWidget.prototype.createMenuWidget = function ( menuConfig ) {\n\treturn new OO.ui.MenuSelectWidget( menuConfig );\n};\n\n/**\n * Add options to the menu\n *\n * @param {Object[]} menuOptions Object defining options\n */\nOO.ui.MenuTagMultiselectWidget.prototype.addOptions = function ( menuOptions ) {\n\tvar widget = this,\n\t\titems = menuOptions.map( function ( obj ) {\n\t\t\treturn widget.createMenuOptionWidget( obj.data, obj.label );\n\t\t} );\n\n\tthis.menu.addItems( items );\n};\n\n/**\n * Create a menu option widget.\n *\n * @param {string} data Item data\n * @param {string} [label] Item label\n * @return {OO.ui.OptionWidget} Option widget\n */\nOO.ui.MenuTagMultiselectWidget.prototype.createMenuOptionWidget = function ( data, label ) {\n\treturn new OO.ui.MenuOptionWidget( {\n\t\tdata: data,\n\t\tlabel: label || data\n\t} );\n};\n\n/**\n * Get the menu\n *\n * @return {OO.ui.MenuSelectWidget} Menu\n */\nOO.ui.MenuTagMultiselectWidget.prototype.getMenu = function () {\n\treturn this.menu;\n};\n\n/**\n * Get the allowed values list\n *\n * @return {string[]} Allowed data values\n */\nOO.ui.MenuTagMultiselectWidget.prototype.getAllowedValues = function () {\n\tvar menuDatas = [];\n\tif ( this.menu ) {\n\t\t// If the parent constructor is calling us, we're not ready yet, this.menu is not set up.\n\t\tmenuDatas = this.menu.getItems().map( function ( menuItem ) {\n\t\t\treturn menuItem.getData();\n\t\t} );\n\t}\n\treturn this.allowedValues.concat( menuDatas );\n};\n\n/**\n * SelectFileWidgets allow for selecting files, using the HTML5 File API. These\n * widgets can be configured with {@link OO.ui.mixin.IconElement icons} and {@link\n * OO.ui.mixin.IndicatorElement indicators}.\n * Please see the [OOjs UI documentation on MediaWiki] [1] for more information and examples.\n *\n *     @example\n *     // Example of a file select widget\n *     var selectFile = new OO.ui.SelectFileWidget();\n *     $( 'body' ).append( selectFile.$element );\n *\n * [1]: https://www.mediawiki.org/wiki/OOjs_UI/Widgets\n *\n * @class\n * @extends OO.ui.Widget\n * @mixins OO.ui.mixin.IconElement\n * @mixins OO.ui.mixin.IndicatorElement\n * @mixins OO.ui.mixin.PendingElement\n * @mixins OO.ui.mixin.LabelElement\n *\n * @constructor\n * @param {Object} [config] Configuration options\n * @cfg {string[]|null} [accept=null] MIME types to accept. null accepts all types.\n * @cfg {string} [placeholder] Text to display when no file is selected.\n * @cfg {string} [notsupported] Text to display when file support is missing in the browser.\n * @cfg {boolean} [droppable=true] Whether to accept files by drag and drop.\n * @cfg {boolean} [showDropTarget=false] Whether to show a drop target. Requires droppable to be true.\n * @cfg {number} [thumbnailSizeLimit=20] File size limit in MiB above which to not try and show a\n *  preview (for performance)\n */\nOO.ui.SelectFileWidget = function OoUiSelectFileWidget( config ) {\n\tvar dragHandler;\n\n\t// Configuration initialization\n\tconfig = $.extend( {\n\t\taccept: null,\n\t\tplaceholder: OO.ui.msg( 'ooui-selectfile-placeholder' ),\n\t\tnotsupported: OO.ui.msg( 'ooui-selectfile-not-supported' ),\n\t\tdroppable: true,\n\t\tshowDropTarget: false,\n\t\tthumbnailSizeLimit: 20\n\t}, config );\n\n\t// Parent constructor\n\tOO.ui.SelectFileWidget.parent.call( this, config );\n\n\t// Mixin constructors\n\tOO.ui.mixin.IconElement.call( this, config );\n\tOO.ui.mixin.IndicatorElement.call( this, config );\n\tOO.ui.mixin.PendingElement.call( this, $.extend( {}, config, { $pending: this.$info } ) );\n\tOO.ui.mixin.LabelElement.call( this, config );\n\n\t// Properties\n\tthis.$info = $( '<span>' );\n\tthis.showDropTarget = config.showDropTarget;\n\tthis.thumbnailSizeLimit = config.thumbnailSizeLimit;\n\tthis.isSupported = this.constructor.static.isSupported();\n\tthis.currentFile = null;\n\tif ( Array.isArray( config.accept ) ) {\n\t\tthis.accept = config.accept;\n\t} else {\n\t\tthis.accept = null;\n\t}\n\tthis.placeholder = config.placeholder;\n\tthis.notsupported = config.notsupported;\n\tthis.onFileSelectedHandler = this.onFileSelected.bind( this );\n\n\tthis.selectButton = new OO.ui.ButtonWidget( {\n\t\tclasses: [ 'oo-ui-selectFileWidget-selectButton' ],\n\t\tlabel: OO.ui.msg( 'ooui-selectfile-button-select' ),\n\t\tdisabled: this.disabled || !this.isSupported\n\t} );\n\n\tthis.clearButton = new OO.ui.ButtonWidget( {\n\t\tclasses: [ 'oo-ui-selectFileWidget-clearButton' ],\n\t\tframed: false,\n\t\ticon: 'close',\n\t\tdisabled: this.disabled\n\t} );\n\n\t// Events\n\tthis.selectButton.$button.on( {\n\t\tkeypress: this.onKeyPress.bind( this )\n\t} );\n\tthis.clearButton.connect( this, {\n\t\tclick: 'onClearClick'\n\t} );\n\tif ( config.droppable ) {\n\t\tdragHandler = this.onDragEnterOrOver.bind( this );\n\t\tthis.$element.on( {\n\t\t\tdragenter: dragHandler,\n\t\t\tdragover: dragHandler,\n\t\t\tdragleave: this.onDragLeave.bind( this ),\n\t\t\tdrop: this.onDrop.bind( this )\n\t\t} );\n\t}\n\n\t// Initialization\n\tthis.addInput();\n\tthis.$label.addClass( 'oo-ui-selectFileWidget-label' );\n\tthis.$info\n\t\t.addClass( 'oo-ui-selectFileWidget-info' )\n\t\t.append( this.$icon, this.$label, this.clearButton.$element, this.$indicator );\n\n\tif ( config.droppable && config.showDropTarget ) {\n\t\tthis.selectButton.setIcon( 'upload' );\n\t\tthis.$thumbnail = $( '<div>' ).addClass( 'oo-ui-selectFileWidget-thumbnail' );\n\t\tthis.setPendingElement( this.$thumbnail );\n\t\tthis.$element\n\t\t\t.addClass( 'oo-ui-selectFileWidget-dropTarget oo-ui-selectFileWidget' )\n\t\t\t.on( {\n\t\t\t\tclick: this.onDropTargetClick.bind( this )\n\t\t\t} )\n\t\t\t.append(\n\t\t\t\tthis.$thumbnail,\n\t\t\t\tthis.$info,\n\t\t\t\tthis.selectButton.$element,\n\t\t\t\t$( '<span>' )\n\t\t\t\t\t.addClass( 'oo-ui-selectFileWidget-dropLabel' )\n\t\t\t\t\t.text( OO.ui.msg( 'ooui-selectfile-dragdrop-placeholder' ) )\n\t\t\t);\n\t} else {\n\t\tthis.$element\n\t\t\t.addClass( 'oo-ui-selectFileWidget' )\n\t\t\t.append( this.$info, this.selectButton.$element );\n\t}\n\tthis.updateUI();\n};\n\n/* Setup */\n\nOO.inheritClass( OO.ui.SelectFileWidget, OO.ui.Widget );\nOO.mixinClass( OO.ui.SelectFileWidget, OO.ui.mixin.IconElement );\nOO.mixinClass( OO.ui.SelectFileWidget, OO.ui.mixin.IndicatorElement );\nOO.mixinClass( OO.ui.SelectFileWidget, OO.ui.mixin.PendingElement );\nOO.mixinClass( OO.ui.SelectFileWidget, OO.ui.mixin.LabelElement );\n\n/* Static Properties */\n\n/**\n * Check if this widget is supported\n *\n * @static\n * @return {boolean}\n */\nOO.ui.SelectFileWidget.static.isSupported = function () {\n\tvar $input;\n\tif ( OO.ui.SelectFileWidget.static.isSupportedCache === null ) {\n\t\t$input = $( '<input>' ).attr( 'type', 'file' );\n\t\tOO.ui.SelectFileWidget.static.isSupportedCache = $input[ 0 ].files !== undefined;\n\t}\n\treturn OO.ui.SelectFileWidget.static.isSupportedCache;\n};\n\nOO.ui.SelectFileWidget.static.isSupportedCache = null;\n\n/* Events */\n\n/**\n * @event change\n *\n * A change event is emitted when the on/off state of the toggle changes.\n *\n * @param {File|null} value New value\n */\n\n/* Methods */\n\n/**\n * Get the current value of the field\n *\n * @return {File|null}\n */\nOO.ui.SelectFileWidget.prototype.getValue = function () {\n\treturn this.currentFile;\n};\n\n/**\n * Set the current value of the field\n *\n * @param {File|null} file File to select\n */\nOO.ui.SelectFileWidget.prototype.setValue = function ( file ) {\n\tif ( this.currentFile !== file ) {\n\t\tthis.currentFile = file;\n\t\tthis.updateUI();\n\t\tthis.emit( 'change', this.currentFile );\n\t}\n};\n\n/**\n * Focus the widget.\n *\n * Focusses the select file button.\n *\n * @chainable\n */\nOO.ui.SelectFileWidget.prototype.focus = function () {\n\tthis.selectButton.focus();\n\treturn this;\n};\n\n/**\n * Blur the widget.\n *\n * @chainable\n */\nOO.ui.SelectFileWidget.prototype.blur = function () {\n\tthis.selectButton.blur();\n\treturn this;\n};\n\n/**\n * @inheritdoc\n */\nOO.ui.SelectFileWidget.prototype.simulateLabelClick = function () {\n\tthis.focus();\n};\n\n/**\n * Update the user interface when a file is selected or unselected\n *\n * @protected\n */\nOO.ui.SelectFileWidget.prototype.updateUI = function () {\n\tvar $label;\n\tif ( !this.isSupported ) {\n\t\tthis.$element.addClass( 'oo-ui-selectFileWidget-notsupported' );\n\t\tthis.$element.removeClass( 'oo-ui-selectFileWidget-empty' );\n\t\tthis.setLabel( this.notsupported );\n\t} else {\n\t\tthis.$element.addClass( 'oo-ui-selectFileWidget-supported' );\n\t\tif ( this.currentFile ) {\n\t\t\tthis.$element.removeClass( 'oo-ui-selectFileWidget-empty' );\n\t\t\t$label = $( [] );\n\t\t\t$label = $label.add(\n\t\t\t\t$( '<span>' )\n\t\t\t\t\t.addClass( 'oo-ui-selectFileWidget-fileName' )\n\t\t\t\t\t.text( this.currentFile.name )\n\t\t\t);\n\t\t\tthis.setLabel( $label );\n\n\t\t\tif ( this.showDropTarget ) {\n\t\t\t\tthis.pushPending();\n\t\t\t\tthis.loadAndGetImageUrl().done( function ( url ) {\n\t\t\t\t\tthis.$thumbnail.css( 'background-image', 'url( ' + url + ' )' );\n\t\t\t\t}.bind( this ) ).fail( function () {\n\t\t\t\t\tthis.$thumbnail.append(\n\t\t\t\t\t\tnew OO.ui.IconWidget( {\n\t\t\t\t\t\t\ticon: 'attachment',\n\t\t\t\t\t\t\tclasses: [ 'oo-ui-selectFileWidget-noThumbnail-icon' ]\n\t\t\t\t\t\t} ).$element\n\t\t\t\t\t);\n\t\t\t\t}.bind( this ) ).always( function () {\n\t\t\t\t\tthis.popPending();\n\t\t\t\t}.bind( this ) );\n\t\t\t\tthis.$element.off( 'click' );\n\t\t\t}\n\t\t} else {\n\t\t\tif ( this.showDropTarget ) {\n\t\t\t\tthis.$element.off( 'click' );\n\t\t\t\tthis.$element.on( {\n\t\t\t\t\tclick: this.onDropTargetClick.bind( this )\n\t\t\t\t} );\n\t\t\t\tthis.$thumbnail\n\t\t\t\t\t.empty()\n\t\t\t\t\t.css( 'background-image', '' );\n\t\t\t}\n\t\t\tthis.$element.addClass( 'oo-ui-selectFileWidget-empty' );\n\t\t\tthis.setLabel( this.placeholder );\n\t\t}\n\t}\n};\n\n/**\n * If the selected file is an image, get its URL and load it.\n *\n * @return {jQuery.Promise} Promise resolves with the image URL after it has loaded\n */\nOO.ui.SelectFileWidget.prototype.loadAndGetImageUrl = function () {\n\tvar deferred = $.Deferred(),\n\t\tfile = this.currentFile,\n\t\treader = new FileReader();\n\n\tif (\n\t\tfile &&\n\t\t( OO.getProp( file, 'type' ) || '' ).indexOf( 'image/' ) === 0 &&\n\t\tfile.size < this.thumbnailSizeLimit * 1024 * 1024\n\t) {\n\t\treader.onload = function ( event ) {\n\t\t\tvar img = document.createElement( 'img' );\n\t\t\timg.addEventListener( 'load', function () {\n\t\t\t\tif (\n\t\t\t\t\timg.naturalWidth === 0 ||\n\t\t\t\t\timg.naturalHeight === 0 ||\n\t\t\t\t\timg.complete === false\n\t\t\t\t) {\n\t\t\t\t\tdeferred.reject();\n\t\t\t\t} else {\n\t\t\t\t\tdeferred.resolve( event.target.result );\n\t\t\t\t}\n\t\t\t} );\n\t\t\timg.src = event.target.result;\n\t\t};\n\t\treader.readAsDataURL( file );\n\t} else {\n\t\tdeferred.reject();\n\t}\n\n\treturn deferred.promise();\n};\n\n/**\n * Add the input to the widget\n *\n * @private\n */\nOO.ui.SelectFileWidget.prototype.addInput = function () {\n\tif ( this.$input ) {\n\t\tthis.$input.remove();\n\t}\n\n\tif ( !this.isSupported ) {\n\t\tthis.$input = null;\n\t\treturn;\n\t}\n\n\tthis.$input = $( '<input>' ).attr( 'type', 'file' );\n\tthis.$input.on( 'change', this.onFileSelectedHandler );\n\tthis.$input.on( 'click', function ( e ) {\n\t\t// Prevents dropTarget to get clicked which calls\n\t\t// a click on this input\n\t\te.stopPropagation();\n\t} );\n\tthis.$input.attr( {\n\t\ttabindex: -1\n\t} );\n\tif ( this.accept ) {\n\t\tthis.$input.attr( 'accept', this.accept.join( ', ' ) );\n\t}\n\tthis.selectButton.$button.append( this.$input );\n};\n\n/**\n * Determine if we should accept this file\n *\n * @private\n * @param {string} mimeType File MIME type\n * @return {boolean}\n */\nOO.ui.SelectFileWidget.prototype.isAllowedType = function ( mimeType ) {\n\tvar i, mimeTest;\n\n\tif ( !this.accept || !mimeType ) {\n\t\treturn true;\n\t}\n\n\tfor ( i = 0; i < this.accept.length; i++ ) {\n\t\tmimeTest = this.accept[ i ];\n\t\tif ( mimeTest === mimeType ) {\n\t\t\treturn true;\n\t\t} else if ( mimeTest.substr( -2 ) === '/*' ) {\n\t\t\tmimeTest = mimeTest.substr( 0, mimeTest.length - 1 );\n\t\t\tif ( mimeType.substr( 0, mimeTest.length ) === mimeTest ) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn false;\n};\n\n/**\n * Handle file selection from the input\n *\n * @private\n * @param {jQuery.Event} e\n */\nOO.ui.SelectFileWidget.prototype.onFileSelected = function ( e ) {\n\tvar file = OO.getProp( e.target, 'files', 0 ) || null;\n\n\tif ( file && !this.isAllowedType( file.type ) ) {\n\t\tfile = null;\n\t}\n\n\tthis.setValue( file );\n\tthis.addInput();\n};\n\n/**\n * Handle clear button click events.\n *\n * @private\n */\nOO.ui.SelectFileWidget.prototype.onClearClick = function () {\n\tthis.setValue( null );\n\treturn false;\n};\n\n/**\n * Handle key press events.\n *\n * @private\n * @param {jQuery.Event} e Key press event\n */\nOO.ui.SelectFileWidget.prototype.onKeyPress = function ( e ) {\n\tif ( this.isSupported && !this.isDisabled() && this.$input &&\n\t\t( e.which === OO.ui.Keys.SPACE || e.which === OO.ui.Keys.ENTER )\n\t) {\n\t\tthis.$input.click();\n\t\treturn false;\n\t}\n};\n\n/**\n * Handle drop target click events.\n *\n * @private\n * @param {jQuery.Event} e Key press event\n */\nOO.ui.SelectFileWidget.prototype.onDropTargetClick = function () {\n\tif ( this.isSupported && !this.isDisabled() && this.$input ) {\n\t\tthis.$input.click();\n\t\treturn false;\n\t}\n};\n\n/**\n * Handle drag enter and over events\n *\n * @private\n * @param {jQuery.Event} e Drag event\n */\nOO.ui.SelectFileWidget.prototype.onDragEnterOrOver = function ( e ) {\n\tvar itemOrFile,\n\t\tdroppableFile = false,\n\t\tdt = e.originalEvent.dataTransfer;\n\n\te.preventDefault();\n\te.stopPropagation();\n\n\tif ( this.isDisabled() || !this.isSupported ) {\n\t\tthis.$element.removeClass( 'oo-ui-selectFileWidget-canDrop' );\n\t\tdt.dropEffect = 'none';\n\t\treturn false;\n\t}\n\n\t// DataTransferItem and File both have a type property, but in Chrome files\n\t// have no information at this point.\n\titemOrFile = OO.getProp( dt, 'items', 0 ) || OO.getProp( dt, 'files', 0 );\n\tif ( itemOrFile ) {\n\t\tif ( this.isAllowedType( itemOrFile.type ) ) {\n\t\t\tdroppableFile = true;\n\t\t}\n\t// dt.types is Array-like, but not an Array\n\t} else if ( Array.prototype.indexOf.call( OO.getProp( dt, 'types' ) || [], 'Files' ) !== -1 ) {\n\t\t// File information is not available at this point for security so just assume\n\t\t// it is acceptable for now.\n\t\t// https://bugzilla.mozilla.org/show_bug.cgi?id=640534\n\t\tdroppableFile = true;\n\t}\n\n\tthis.$element.toggleClass( 'oo-ui-selectFileWidget-canDrop', droppableFile );\n\tif ( !droppableFile ) {\n\t\tdt.dropEffect = 'none';\n\t}\n\n\treturn false;\n};\n\n/**\n * Handle drag leave events\n *\n * @private\n * @param {jQuery.Event} e Drag event\n */\nOO.ui.SelectFileWidget.prototype.onDragLeave = function () {\n\tthis.$element.removeClass( 'oo-ui-selectFileWidget-canDrop' );\n};\n\n/**\n * Handle drop events\n *\n * @private\n * @param {jQuery.Event} e Drop event\n */\nOO.ui.SelectFileWidget.prototype.onDrop = function ( e ) {\n\tvar file = null,\n\t\tdt = e.originalEvent.dataTransfer;\n\n\te.preventDefault();\n\te.stopPropagation();\n\tthis.$element.removeClass( 'oo-ui-selectFileWidget-canDrop' );\n\n\tif ( this.isDisabled() || !this.isSupported ) {\n\t\treturn false;\n\t}\n\n\tfile = OO.getProp( dt, 'files', 0 );\n\tif ( file && !this.isAllowedType( file.type ) ) {\n\t\tfile = null;\n\t}\n\tif ( file ) {\n\t\tthis.setValue( file );\n\t}\n\n\treturn false;\n};\n\n/**\n * @inheritdoc\n */\nOO.ui.SelectFileWidget.prototype.setDisabled = function ( disabled ) {\n\tOO.ui.SelectFileWidget.parent.prototype.setDisabled.call( this, disabled );\n\tif ( this.selectButton ) {\n\t\tthis.selectButton.setDisabled( disabled );\n\t}\n\tif ( this.clearButton ) {\n\t\tthis.clearButton.setDisabled( disabled );\n\t}\n\treturn this;\n};\n\n/**\n * SearchWidgets combine a {@link OO.ui.TextInputWidget text input field}, where users can type a search query,\n * and a menu of search results, which is displayed beneath the query\n * field. Unlike {@link OO.ui.mixin.LookupElement lookup menus}, search result menus are always visible to the user.\n * Users can choose an item from the menu or type a query into the text field to search for a matching result item.\n * In general, search widgets are used inside a separate {@link OO.ui.Dialog dialog} window.\n *\n * Each time the query is changed, the search result menu is cleared and repopulated. Please see\n * the [OOjs UI demos][1] for an example.\n *\n * [1]: https://tools.wmflabs.org/oojs-ui/oojs-ui/demos/#dialogs-mediawiki-vector-ltr\n *\n * @class\n * @extends OO.ui.Widget\n *\n * @constructor\n * @param {Object} [config] Configuration options\n * @cfg {string|jQuery} [placeholder] Placeholder text for query input\n * @cfg {string} [value] Initial query value\n */\nOO.ui.SearchWidget = function OoUiSearchWidget( config ) {\n\t// Configuration initialization\n\tconfig = config || {};\n\n\t// Parent constructor\n\tOO.ui.SearchWidget.parent.call( this, config );\n\n\t// Properties\n\tthis.query = new OO.ui.TextInputWidget( {\n\t\ticon: 'search',\n\t\tplaceholder: config.placeholder,\n\t\tvalue: config.value\n\t} );\n\tthis.results = new OO.ui.SelectWidget();\n\tthis.$query = $( '<div>' );\n\tthis.$results = $( '<div>' );\n\n\t// Events\n\tthis.query.connect( this, {\n\t\tchange: 'onQueryChange',\n\t\tenter: 'onQueryEnter'\n\t} );\n\tthis.query.$input.on( 'keydown', this.onQueryKeydown.bind( this ) );\n\n\t// Initialization\n\tthis.$query\n\t\t.addClass( 'oo-ui-searchWidget-query' )\n\t\t.append( this.query.$element );\n\tthis.$results\n\t\t.addClass( 'oo-ui-searchWidget-results' )\n\t\t.append( this.results.$element );\n\tthis.$element\n\t\t.addClass( 'oo-ui-searchWidget' )\n\t\t.append( this.$results, this.$query );\n};\n\n/* Setup */\n\nOO.inheritClass( OO.ui.SearchWidget, OO.ui.Widget );\n\n/* Methods */\n\n/**\n * Handle query key down events.\n *\n * @private\n * @param {jQuery.Event} e Key down event\n */\nOO.ui.SearchWidget.prototype.onQueryKeydown = function ( e ) {\n\tvar highlightedItem, nextItem,\n\t\tdir = e.which === OO.ui.Keys.DOWN ? 1 : ( e.which === OO.ui.Keys.UP ? -1 : 0 );\n\n\tif ( dir ) {\n\t\thighlightedItem = this.results.getHighlightedItem();\n\t\tif ( !highlightedItem ) {\n\t\t\thighlightedItem = this.results.getSelectedItem();\n\t\t}\n\t\tnextItem = this.results.getRelativeSelectableItem( highlightedItem, dir );\n\t\tthis.results.highlightItem( nextItem );\n\t\tnextItem.scrollElementIntoView();\n\t}\n};\n\n/**\n * Handle select widget select events.\n *\n * Clears existing results. Subclasses should repopulate items according to new query.\n *\n * @private\n * @param {string} value New value\n */\nOO.ui.SearchWidget.prototype.onQueryChange = function () {\n\t// Reset\n\tthis.results.clearItems();\n};\n\n/**\n * Handle select widget enter key events.\n *\n * Chooses highlighted item.\n *\n * @private\n * @param {string} value New value\n */\nOO.ui.SearchWidget.prototype.onQueryEnter = function () {\n\tvar highlightedItem = this.results.getHighlightedItem();\n\tif ( highlightedItem ) {\n\t\tthis.results.chooseItem( highlightedItem );\n\t}\n};\n\n/**\n * Get the query input.\n *\n * @return {OO.ui.TextInputWidget} Query input\n */\nOO.ui.SearchWidget.prototype.getQuery = function () {\n\treturn this.query;\n};\n\n/**\n * Get the search results menu.\n *\n * @return {OO.ui.SelectWidget} Menu of search results\n */\nOO.ui.SearchWidget.prototype.getResults = function () {\n\treturn this.results;\n};\n\n/**\n * NumberInputWidgets combine a {@link OO.ui.TextInputWidget text input} (where a value\n * can be entered manually) and two {@link OO.ui.ButtonWidget button widgets}\n * (to adjust the value in increments) to allow the user to enter a number.\n *\n *     @example\n *     // Example: A NumberInputWidget.\n *     var numberInput = new OO.ui.NumberInputWidget( {\n *         label: 'NumberInputWidget',\n *         input: { value: 5 },\n *         min: 1,\n *         max: 10\n *     } );\n *     $( 'body' ).append( numberInput.$element );\n *\n * @class\n * @extends OO.ui.TextInputWidget\n *\n * @constructor\n * @param {Object} [config] Configuration options\n * @cfg {Object} [minusButton] Configuration options to pass to the {@link OO.ui.ButtonWidget decrementing button widget}.\n * @cfg {Object} [plusButton] Configuration options to pass to the {@link OO.ui.ButtonWidget incrementing button widget}.\n * @cfg {boolean} [allowInteger=false] Whether the field accepts only integer values.\n * @cfg {number} [min=-Infinity] Minimum allowed value\n * @cfg {number} [max=Infinity] Maximum allowed value\n * @cfg {number} [step=1] Delta when using the buttons or up/down arrow keys\n * @cfg {number|null} [pageStep] Delta when using the page-up/page-down keys. Defaults to 10 times #step.\n * @cfg {boolean} [showButtons=true] Whether to show the plus and minus buttons.\n */\nOO.ui.NumberInputWidget = function OoUiNumberInputWidget( config ) {\n\tvar $field = $( '<div>' )\n\t\t.addClass( 'oo-ui-numberInputWidget-field' );\n\n\t// Configuration initialization\n\tconfig = $.extend( {\n\t\tallowInteger: false,\n\t\tmin: -Infinity,\n\t\tmax: Infinity,\n\t\tstep: 1,\n\t\tpageStep: null,\n\t\tshowButtons: true\n\t}, config );\n\n\t// For backward compatibility\n\t$.extend( config, config.input );\n\tthis.input = this;\n\n\t// Parent constructor\n\tOO.ui.NumberInputWidget.parent.call( this, $.extend( config, {\n\t\ttype: 'number'\n\t} ) );\n\n\tif ( config.showButtons ) {\n\t\tthis.minusButton = new OO.ui.ButtonWidget( $.extend(\n\t\t\t{\n\t\t\t\tdisabled: this.isDisabled(),\n\t\t\t\ttabIndex: -1,\n\t\t\t\tclasses: [ 'oo-ui-numberInputWidget-minusButton' ],\n\t\t\t\ticon: 'subtract'\n\t\t\t},\n\t\t\tconfig.minusButton\n\t\t) );\n\t\tthis.plusButton = new OO.ui.ButtonWidget( $.extend(\n\t\t\t{\n\t\t\t\tdisabled: this.isDisabled(),\n\t\t\t\ttabIndex: -1,\n\t\t\t\tclasses: [ 'oo-ui-numberInputWidget-plusButton' ],\n\t\t\t\ticon: 'add'\n\t\t\t},\n\t\t\tconfig.plusButton\n\t\t) );\n\t}\n\n\t// Events\n\tthis.$input.on( {\n\t\tkeydown: this.onKeyDown.bind( this ),\n\t\t'wheel mousewheel DOMMouseScroll': this.onWheel.bind( this )\n\t} );\n\tif ( config.showButtons ) {\n\t\tthis.plusButton.connect( this, {\n\t\t\tclick: [ 'onButtonClick', +1 ]\n\t\t} );\n\t\tthis.minusButton.connect( this, {\n\t\t\tclick: [ 'onButtonClick', -1 ]\n\t\t} );\n\t}\n\n\t// Build the field\n\t$field.append( this.$input );\n\tif ( config.showButtons ) {\n\t\t$field\n\t\t\t.prepend( this.minusButton.$element )\n\t\t\t.append( this.plusButton.$element );\n\t}\n\n\t// Initialization\n\tthis.setAllowInteger( config.allowInteger || config.isInteger );\n\tthis.setRange( config.min, config.max );\n\tthis.setStep( config.step, config.pageStep );\n\t// Set the validation method after we set allowInteger and range\n\t// so that it doesn't immediately call setValidityFlag\n\tthis.setValidation( this.validateNumber.bind( this ) );\n\n\tthis.$element\n\t\t.addClass( 'oo-ui-numberInputWidget' )\n\t\t.toggleClass( 'oo-ui-numberInputWidget-buttoned', config.showButtons )\n\t\t.append( $field );\n};\n\n/* Setup */\n\nOO.inheritClass( OO.ui.NumberInputWidget, OO.ui.TextInputWidget );\n\n/* Methods */\n\n/**\n * Set whether only integers are allowed\n *\n * @param {boolean} flag\n */\nOO.ui.NumberInputWidget.prototype.setAllowInteger = function ( flag ) {\n\tthis.allowInteger = !!flag;\n\tthis.setValidityFlag();\n};\n// Backward compatibility\nOO.ui.NumberInputWidget.prototype.setIsInteger = OO.ui.NumberInputWidget.prototype.setAllowInteger;\n\n/**\n * Get whether only integers are allowed\n *\n * @return {boolean} Flag value\n */\nOO.ui.NumberInputWidget.prototype.getAllowInteger = function () {\n\treturn this.allowInteger;\n};\n// Backward compatibility\nOO.ui.NumberInputWidget.prototype.getIsInteger = OO.ui.NumberInputWidget.prototype.getAllowInteger;\n\n/**\n * Set the range of allowed values\n *\n * @param {number} min Minimum allowed value\n * @param {number} max Maximum allowed value\n */\nOO.ui.NumberInputWidget.prototype.setRange = function ( min, max ) {\n\tif ( min > max ) {\n\t\tthrow new Error( 'Minimum (' + min + ') must not be greater than maximum (' + max + ')' );\n\t}\n\tthis.min = min;\n\tthis.max = max;\n\tthis.setValidityFlag();\n};\n\n/**\n * Get the current range\n *\n * @return {number[]} Minimum and maximum values\n */\nOO.ui.NumberInputWidget.prototype.getRange = function () {\n\treturn [ this.min, this.max ];\n};\n\n/**\n * Set the stepping deltas\n *\n * @param {number} step Normal step\n * @param {number|null} pageStep Page step. If null, 10 * step will be used.\n */\nOO.ui.NumberInputWidget.prototype.setStep = function ( step, pageStep ) {\n\tif ( step <= 0 ) {\n\t\tthrow new Error( 'Step value must be positive' );\n\t}\n\tif ( pageStep === null ) {\n\t\tpageStep = step * 10;\n\t} else if ( pageStep <= 0 ) {\n\t\tthrow new Error( 'Page step value must be positive' );\n\t}\n\tthis.step = step;\n\tthis.pageStep = pageStep;\n};\n\n/**\n * Get the current stepping values\n *\n * @return {number[]} Step and page step\n */\nOO.ui.NumberInputWidget.prototype.getStep = function () {\n\treturn [ this.step, this.pageStep ];\n};\n\n/**\n * Get the current value of the widget as a number\n *\n * @return {number} May be NaN, or an invalid number\n */\nOO.ui.NumberInputWidget.prototype.getNumericValue = function () {\n\treturn +this.getValue();\n};\n\n/**\n * Adjust the value of the widget\n *\n * @param {number} delta Adjustment amount\n */\nOO.ui.NumberInputWidget.prototype.adjustValue = function ( delta ) {\n\tvar n, v = this.getNumericValue();\n\n\tdelta = +delta;\n\tif ( isNaN( delta ) || !isFinite( delta ) ) {\n\t\tthrow new Error( 'Delta must be a finite number' );\n\t}\n\n\tif ( isNaN( v ) ) {\n\t\tn = 0;\n\t} else {\n\t\tn = v + delta;\n\t\tn = Math.max( Math.min( n, this.max ), this.min );\n\t\tif ( this.allowInteger ) {\n\t\t\tn = Math.round( n );\n\t\t}\n\t}\n\n\tif ( n !== v ) {\n\t\tthis.setValue( n );\n\t}\n};\n/**\n * Validate input\n *\n * @private\n * @param {string} value Field value\n * @return {boolean}\n */\nOO.ui.NumberInputWidget.prototype.validateNumber = function ( value ) {\n\tvar n = +value;\n\tif ( value === '' ) {\n\t\treturn !this.isRequired();\n\t}\n\n\tif ( isNaN( n ) || !isFinite( n ) ) {\n\t\treturn false;\n\t}\n\n\tif ( this.allowInteger && Math.floor( n ) !== n ) {\n\t\treturn false;\n\t}\n\n\tif ( n < this.min || n > this.max ) {\n\t\treturn false;\n\t}\n\n\treturn true;\n};\n\n/**\n * Handle mouse click events.\n *\n * @private\n * @param {number} dir +1 or -1\n */\nOO.ui.NumberInputWidget.prototype.onButtonClick = function ( dir ) {\n\tthis.adjustValue( dir * this.step );\n};\n\n/**\n * Handle mouse wheel events.\n *\n * @private\n * @param {jQuery.Event} event\n */\nOO.ui.NumberInputWidget.prototype.onWheel = function ( event ) {\n\tvar delta = 0;\n\n\tif ( !this.isDisabled() && this.$input.is( ':focus' ) ) {\n\t\t// Standard 'wheel' event\n\t\tif ( event.originalEvent.deltaMode !== undefined ) {\n\t\t\tthis.sawWheelEvent = true;\n\t\t}\n\t\tif ( event.originalEvent.deltaY ) {\n\t\t\tdelta = -event.originalEvent.deltaY;\n\t\t} else if ( event.originalEvent.deltaX ) {\n\t\t\tdelta = event.originalEvent.deltaX;\n\t\t}\n\n\t\t// Non-standard events\n\t\tif ( !this.sawWheelEvent ) {\n\t\t\tif ( event.originalEvent.wheelDeltaX ) {\n\t\t\t\tdelta = -event.originalEvent.wheelDeltaX;\n\t\t\t} else if ( event.originalEvent.wheelDeltaY ) {\n\t\t\t\tdelta = event.originalEvent.wheelDeltaY;\n\t\t\t} else if ( event.originalEvent.wheelDelta ) {\n\t\t\t\tdelta = event.originalEvent.wheelDelta;\n\t\t\t} else if ( event.originalEvent.detail ) {\n\t\t\t\tdelta = -event.originalEvent.detail;\n\t\t\t}\n\t\t}\n\n\t\tif ( delta ) {\n\t\t\tdelta = delta < 0 ? -1 : 1;\n\t\t\tthis.adjustValue( delta * this.step );\n\t\t}\n\n\t\treturn false;\n\t}\n};\n\n/**\n * Handle key down events.\n *\n * @private\n * @param {jQuery.Event} e Key down event\n */\nOO.ui.NumberInputWidget.prototype.onKeyDown = function ( e ) {\n\tif ( !this.isDisabled() ) {\n\t\tswitch ( e.which ) {\n\t\t\tcase OO.ui.Keys.UP:\n\t\t\t\tthis.adjustValue( this.step );\n\t\t\t\treturn false;\n\t\t\tcase OO.ui.Keys.DOWN:\n\t\t\t\tthis.adjustValue( -this.step );\n\t\t\t\treturn false;\n\t\t\tcase OO.ui.Keys.PAGEUP:\n\t\t\t\tthis.adjustValue( this.pageStep );\n\t\t\t\treturn false;\n\t\t\tcase OO.ui.Keys.PAGEDOWN:\n\t\t\t\tthis.adjustValue( -this.pageStep );\n\t\t\t\treturn false;\n\t\t}\n\t}\n};\n\n/**\n * @inheritdoc\n */\nOO.ui.NumberInputWidget.prototype.setDisabled = function ( disabled ) {\n\t// Parent method\n\tOO.ui.NumberInputWidget.parent.prototype.setDisabled.call( this, disabled );\n\n\tif ( this.minusButton ) {\n\t\tthis.minusButton.setDisabled( this.isDisabled() );\n\t}\n\tif ( this.plusButton ) {\n\t\tthis.plusButton.setDisabled( this.isDisabled() );\n\t}\n\n\treturn this;\n};\n\n}( OO ) );\n\n//# sourceMappingURL=oojs-ui-widgets.js.map"]}