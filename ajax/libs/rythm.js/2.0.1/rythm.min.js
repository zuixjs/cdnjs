!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Rythm=e()}(this,function(){"use strict";var t=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},e=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),n=function e(){var n=this;t(this,e),this.initialise=function(t){n.analyser=t,n.analyser.fftSize=2048},this.reset=function(){n.hzHistory=[],n.frequences=new Uint8Array(n.analyser.frequencyBinCount)},this.analyse=function(){n.analyser.getByteFrequencyData(n.frequences);for(var t=0;t<n.frequences.length;t++)n.hzHistory[t]||(n.hzHistory[t]=[]),n.hzHistory[t].length>n.maxValueHistory&&n.hzHistory[t].shift(),n.hzHistory[t].push(n.frequences[t])},this.getRangeAverageRatio=function(t,e){for(var i=0,r=t;r<e+t;r++)i+=n.getFrequenceRatio(r);return i/e},this.getFrequenceRatio=function(t){var e=255,i=0;n.hzHistory[t].forEach(function(t){t<e&&(e=t),t>i&&(i=t)});var r=i-e,a=n.frequences[t]-e,s=a/r;return n.startingScale+n.pulseRatio*s},this.startingScale=0,this.pulseRatio=1,this.maxValueHistory=100,this.hzHistory=[]},i=new n,r=function e(){var n=this;t(this,e),this.createSourceFromAudioElement=function(t){return n.audioCtx.createMediaElementSource(t)},this.connectExternalAudioElement=function(t){n.audio=t,n.currentInputType=n.inputTypeList.EXTERNAL,n.source=n.createSourceFromAudioElement(n.audioElement),n.connectSource(n.source)},this.connectSource=function(t){t.connect(n.gain),n.gain.connect(i.analyser),n.currentInputType!==n.inputTypeList.STREAM&&(i.analyser.connect(n.audioCtx.destination),n.audio.addEventListener("ended",n.stop))},this.setMusic=function(t){n.audio=new Audio(t),n.currentInputType=n.inputTypeList.TRACK,n.source=n.createSourceFromAudioElement(n.audio),n.connectSource(n.source)},this.setGain=function(t){n.gain.gain.value=t},this.plugMicrophone=function(){return n.getMicrophoneStream().then(function(t){n.audio=t,n.currentInputType=n.inputTypeList.STREAM,n.source=n.audioCtx.createMediaStreamSource(t),n.connectSource(n.source)})},this.getMicrophoneStream=function(){return navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,new Promise(function(t,e){navigator.getUserMedia({audio:!0},function(e){return t(e)},function(t){return e(t)})})},this.start=function(){n.currentInputType===n.inputTypeList.TRACK&&n.audio.play()},this.stop=function(){n.currentInputType===n.inputTypeList.TRACK?n.audio.pause():n.currentInputType===n.inputTypeList.STREAM&&(n.audio.getAudioTracks()[0].enabled=!1)},this.browserAudioCtx=AudioContext||webkitAudioContext,this.audioCtx=new this.browserAudioCtx,i.initialise(this.audioCtx.createAnalyser()),this.gain=this.audioCtx.createGain(),this.source={},this.audio={},this.hzHistory=[],this.inputTypeList={TRACK:0,STREAM:1,EXTERNAL:2}},a=new r,s=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=isNaN(n.max)?1.25:n.max,r=isNaN(n.min)?.75:n.min,a=(i-r)*e;t.style.transform="scale("+(r+a)+")"},o=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=isNaN(n.max)?15:n.max,r=isNaN(n.min)?-15:n.min;"left"===n.direction&&(i=-i,r=-r);var a=(i-r)*e;t.style.transform="translateX("+(r+a)+"px)"},u=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=isNaN(n.max)?30:n.max,r=isNaN(n.min)?0:n.min,a=(i-r)*e;t.style.transform="translateY("+-a+"px)"},c=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=isNaN(n.max)?20:n.max,r=isNaN(n.min)?-20:n.min;"left"===n.direction&&(i=-i,r=-r);var a=(i-r)*e;t.style.transform="rotate("+(r+a)+"deg)"},h=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=isNaN(n.max)?1:n.max,r=isNaN(n.max)?0:n.max,a=(i-r)*e;n.reverse?t.style.opacity=i-a:t.style.opacity=r+a},l=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.from||[0,0,0],r=n.to||[255,255,255],a=(r[0]-i[0])*e,s=(r[1]-i[1])*e,o=(r[2]-i[2])*e;t.style.backgroundColor="rgb("+Math.floor(r[0]-a)+", "+Math.floor(r[1]-s)+", "+Math.floor(r[2]-o)+")"},y=function(){function n(){t(this,n),this.dances={},this.registerDance("size",s),this.registerDance("pulse",s),this.registerDance("shake",o),this.registerDance("jump",u),this.registerDance("twist",c),this.registerDance("vanish",h),this.registerDance("color",l)}return e(n,[{key:"registerDance",value:function(t,e){this.dances[t]=e}},{key:"dance",value:function t(e,n,i,r){var t=e;"string"==typeof e&&(t=this.dances[e]||this.dances.pulse);var a=document.getElementsByClassName(n);Array.from(a).forEach(function(e){return t(e,i,r)})}}]),n}(),f=new y,d=function e(){var n=this;t(this,e),this.connectExternalAudioElement=function(t){return n.player.connectExternalAudioElement(audioelement)},this.setMusic=function(t){return n.player.setMusic(t)},this.plugMicrophone=function(){return n.player.plugMicrophone()},this.setGain=function(t){return n.player.setGain(t)},this.addRythm=function(t,e,i,r,a){n.rythms.push({elementClass:t,type:e,startValue:i,nbValue:r,options:a})},this.start=function(){n.stopped=!1,n.player.start(),n.analyser.reset(),n.renderRythm()},this.renderRythm=function(){n.stopped||(n.analyser.analyse(),n.rythms.forEach(function(t){var e=t.type,i=t.elementClass,r=t.nbValue,a=t.startValue,s=t.options;n.dancer.dance(e,i,n.analyser.getRangeAverageRatio(a,r),s)}),requestAnimationFrame(n.renderRythm))},this.stop=function(){n.stopped=!0,n.player.stop()},this.player=a,this.analyser=i,this.maxValueHistory=i.maxValueHistory,this.dancer=f,this.rythms=[],this.addRythm("rythm-bass","pulse",0,10),this.addRythm("rythm-medium","pulse",150,40),this.addRythm("rythm-high","pulse",400,200)};return d});
//# sourceMappingURL=rythm.min.js.map