(function(a,b){a.widget("ui.rangeSliderBar",a.ui.rangeSliderDraggable,{options:{leftHandle:null,rightHandle:null,bounds:{min:0,max:100},type:"rangeSliderHandle",range:false,drag:function(){},stop:function(){},values:{min:0,max:20},wheelSpeed:4,wheelMode:null},_values:{min:0,max:20},_waitingToInit:2,_wheelTimeout:false,_create:function(){a.ui.rangeSliderDraggable.prototype._create.apply(this);this.element.css("position","absolute").css("top",0).addClass("ui-rangeSlider-bar");this.options.leftHandle.bind("initialize",a.proxy(this._onInitialized,this)).bind("mousestart",a.proxy(this._cache,this)).bind("stop",a.proxy(this._onHandleStop,this));this.options.rightHandle.bind("initialize",a.proxy(this._onInitialized,this)).bind("mousestart",a.proxy(this._cache,this)).bind("stop",a.proxy(this._onHandleStop,this));this._bindHandles();this._values=this.options.values;this._setWheelModeOption(this.options.wheelMode)},_setOption:function(c,d){if(c==="range"){this._setRangeOption(d)}else{if(c==="wheelSpeed"){this._setWheelSpeedOption(d)}else{if(c==="wheelMode"){this._setWheelModeOption(d)}}}},_setRangeOption:function(e){if(typeof e!="object"||e===null){e=false}if(e===false&&this.options.range===false){return}if(e!==false){var d=typeof e.min==="undefined"?this.options.range.min||false:e.min,c=typeof e.max==="undefined"?this.options.range.max||false:e.max;this.options.range={min:d,max:c}}else{this.options.range=false}this._setLeftRange();this._setRightRange()},_setWheelSpeedOption:function(c){if(typeof c==="number"&&c>0){this.options.wheelSpeed=c}},_setWheelModeOption:function(c){if(c===null||c===false||c==="zoom"||c==="scroll"){if(this.options.wheelMode!==c){this.element.parent().unbind("mousewheel.bar")}this._bindMouseWheel(c);this.options.wheelMode=c}},_bindMouseWheel:function(c){if(c==="zoom"){this.element.parent().bind("mousewheel.bar",a.proxy(this._mouseWheelZoom,this))}else{if(c==="scroll"){this.element.parent().bind("mousewheel.bar",a.proxy(this._mouseWheelScroll,this))}}},_setLeftRange:function(){if(this.options.range==false){return false}var c=this._values.max,d={min:false,max:false};if((this.options.range.min||false)!==false){d.max=this._leftHandle("substract",c,this.options.range.min)}else{d.max=false}if((this.options.range.max||false)!==false){d.min=this._leftHandle("substract",c,this.options.range.max)}else{d.min=false}this._leftHandle("option","range",d)},_setRightRange:function(){var d=this._values.min,c={min:false,max:false};if((this.options.range.min||false)!==false){c.min=this._rightHandle("add",d,this.options.range.min)}else{c.min=false}if((this.options.range.max||false)!==false){c.max=this._rightHandle("add",d,this.options.range.max)}else{c.max=false}this._rightHandle("option","range",c)},_deactivateRange:function(){this._leftHandle("option","range",false);this._rightHandle("option","range",false)},_reactivateRange:function(){this._setRangeOption(this.options.range)},_onInitialized:function(){this._waitingToInit--;if(this._waitingToInit===0){this._initMe()}},_initMe:function(){this._cache();this.min(this.options.values.min);this.max(this.options.values.max);var d=this._leftHandle("position"),c=this._rightHandle("position")+this.options.rightHandle.width();this.element.offset({left:d});this.element.css("width",c-d)},_leftHandle:function(){return this._handleProxy(this.options.leftHandle,arguments)},_rightHandle:function(){return this._handleProxy(this.options.rightHandle,arguments)},_handleProxy:function(d,c){var e=Array.prototype.slice.call(c);return d[this.options.type].apply(d,e)},_cache:function(){a.ui.rangeSliderDraggable.prototype._cache.apply(this);this._cacheHandles()},_cacheHandles:function(){this.cache.rightHandle={};this.cache.rightHandle.width=this.options.rightHandle.width();this.cache.rightHandle.offset=this.options.rightHandle.offset();this.cache.leftHandle={};this.cache.leftHandle.offset=this.options.leftHandle.offset()},_mouseStart:function(c){a.ui.rangeSliderDraggable.prototype._mouseStart.apply(this,[c]);this._deactivateRange()},_mouseStop:function(c){a.ui.rangeSliderDraggable.prototype._mouseStop.apply(this,[c]);this._cacheHandles();this._values.min=this._leftHandle("value");this._values.max=this._rightHandle("value");this._reactivateRange();this._leftHandle().trigger("stop");this._rightHandle().trigger("stop")},_onDragLeftHandle:function(c,d){this._cacheIfNecessary();if(this._switchedValues()){this._switchHandles();this._onDragRightHandle(c,d);return}this._values.min=d.value;this.cache.offset.left=d.offset.left;this.cache.leftHandle.offset=d.offset;this._positionBar()},_onDragRightHandle:function(c,d){this._cacheIfNecessary();if(this._switchedValues()){this._switchHandles(),this._onDragLeftHandle(c,d);return}this._values.max=d.value;this.cache.rightHandle.offset=d.offset;this._positionBar()},_positionBar:function(){var c=this.cache.rightHandle.offset.left+this.cache.rightHandle.width-this.cache.leftHandle.offset.left;this.cache.width.inner=c;this.element.css("width",c).offset({left:this.cache.leftHandle.offset.left})},_onHandleStop:function(){this._setLeftRange();this._setRightRange()},_switchedValues:function(){if(this.min()>this.max()){var c=this._values.min;this._values.min=this._values.max;this._values.max=c;return true}return false},_switchHandles:function(){var c=this.options.leftHandle;this.options.leftHandle=this.options.rightHandle;this.options.rightHandle=c;this._leftHandle("option","isLeft",true);this._rightHandle("option","isLeft",false);this._bindHandles();this._cacheHandles()},_bindHandles:function(){this.options.leftHandle.unbind(".bar").bind("sliderDrag.bar update.bar moving.bar",a.proxy(this._onDragLeftHandle,this));this.options.rightHandle.unbind(".bar").bind("sliderDrag.bar update.bar moving.bar",a.proxy(this._onDragRightHandle,this))},_constraintPosition:function(e){var c={},d;c.left=a.ui.rangeSliderDraggable.prototype._constraintPosition.apply(this,[e]);c.left=this._leftHandle("position",c.left);d=this._rightHandle("position",c.left+this.cache.width.outer-this.cache.rightHandle.width);c.width=d-c.left+this.cache.rightHandle.width;return c},_applyPosition:function(c){a.ui.rangeSliderDraggable.prototype._applyPosition.apply(this,[c.left]);this.element.width(c.width)},_mouseWheelZoom:function(h,i,d,c){var e=this._values.min+(this._values.max-this._values.min)/2,f={},g={};if(this.options.range===false||this.options.range.min===false){f.max=e;g.min=e}else{f.max=e-this.options.range.min/2;g.min=e+this.options.range.min/2}if(this.options.range!==false&&this.options.range.max!==false){f.min=e-this.options.range.max/2;g.max=e+this.options.range.max/2}this._leftHandle("option","range",f);this._rightHandle("option","range",g);clearTimeout(this._wheelTimeout);this._wheelTimeout=setTimeout(a.proxy(this._wheelStop,this),200);this.zoomOut(c*this.options.wheelSpeed);return false},_mouseWheelScroll:function(e,f,d,c){if(this._wheelTimeout===false){this.startScroll()}else{clearTimeout(this._wheelTimeout)}this._wheelTimeout=setTimeout(a.proxy(this._wheelStop,this),200);this.scrollLeft(c*this.options.wheelSpeed);return false},_wheelStop:function(){this.stopScroll();this._wheelTimeout=false},min:function(c){return this._leftHandle("value",c)},max:function(c){return this._rightHandle("value",c)},startScroll:function(){this._deactivateRange()},stopScroll:function(){this._reactivateRange();this._triggerMouseEvent("stop")},scrollLeft:function(c){c=c||1;if(c<0){return this.scrollRight(-c)}c=this._leftHandle("moveLeft",c);this._rightHandle("moveLeft",c);this.update();this._triggerMouseEvent("scroll")},scrollRight:function(c){c=c||1;if(c<0){return this.scrollLeft(-c)}c=this._rightHandle("moveRight",c);this._leftHandle("moveRight",c);this.update();this._triggerMouseEvent("scroll")},zoomIn:function(d){d=d||1;if(d<0){return this.zoomOut(-d)}var c=this._rightHandle("moveLeft",d);if(d>c){c=c/2;this._rightHandle("moveRight",c)}this._leftHandle("moveRight",c);this.update();this._triggerMouseEvent("zoom")},zoomOut:function(d){d=d||1;if(d<0){return this.zoomIn(-d)}var c=this._rightHandle("moveRight",d);if(d>c){c=c/2;this._rightHandle("moveLeft",c)}this._leftHandle("moveLeft",c);this.update();this._triggerMouseEvent("zoom")},values:function(d,c){if(typeof d!=="undefined"&&typeof c!=="undefined"){var e=Math.min(d,c),f=Math.max(d,c);this._deactivateRange();this.options.leftHandle.unbind(".bar");this.options.rightHandle.unbind(".bar");this._values.min=this._leftHandle("value",e);this._values.max=this._rightHandle("value",f);this._bindHandles();this._reactivateRange();this.update()}return{min:this._values.min,max:this._values.max}},update:function(){this._values.min=this.min();this._values.max=this.max();this._cache();this._positionBar()}})})(jQuery);