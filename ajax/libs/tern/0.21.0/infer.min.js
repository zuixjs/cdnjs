!function(t,e){return"object"==typeof exports&&"object"==typeof module?e(exports,require("acorn"),require("acorn/dist/acorn_loose"),require("acorn/dist/walk"),require("./def"),require("./signal")):"function"==typeof define&&define.amd?define(["exports","acorn/dist/acorn","acorn/dist/acorn_loose","acorn/dist/walk","./def","./signal"],e):void e(t.tern||(t.tern={}),acorn,acorn,acorn.walk,tern.def,tern.signal)}(this,function(t,e,r,n,o,i){"use strict";function s(t,e){var r=Object.create(t);if(e)for(var n in e)r[n]=e[n];return r}function p(t,e,r){var n=t.getType(!1),o=e.getType(!1);return!n||!o||a(n,o,r)}function a(t,e,r){if(!t||r>=5)return e;if(!t||t==e)return t;if(!e)return t;if(t.constructor!=e.constructor)return!1;if(t.constructor!=jt){if(t.constructor==Nt){var n=0,o=0,i=0;for(var s in t.props)n++,s in e.props&&p(t.props[s],e.props[s],r+1)&&i++;for(var s in e.props)o++;return!(n&&o&&i<Math.max(n,o)/2)&&(n>o?t:e)}return t.constructor==Ct&&(!!(t.args.length==e.args.length&&t.args.every(function(t,n){return p(t,e.args[n],r+1)})&&p(t.retval,e.retval,r+1)&&p(t.self,e.self,r+1))&&t)}var u=t.getProp("<i>").getType(!1);if(!u)return e;var f=e.getProp("<i>").getType(!1);return!f||a(u,f,r+1)?e:void 0}function u(t){for(var e=0,r=0,n=0,o=null,i=0;i<t.length;++i){var s=t[i];if(s instanceof jt)++e;else if(s instanceof Ct)++r;else if(s instanceof Nt)++n;else if(s instanceof St){if(o&&s.name!=o.name)return null;o=s}}var p=(e&&1)+(r&&1)+(n&&1)+(o&&1);if(p>1)return null;if(o)return o;for(var a=0,u=null,i=0;i<t.length;++i){var s=t[i],f=0;if(e)f=s.getProp("<i>").isEmpty()?1:2;else if(r){f=1;for(var c=0;c<s.args.length;++c)s.args[c].isEmpty()||++f;s.retval.isEmpty()||++f}else n&&(f=s.name?100:2);f>=a&&(a=f,u=s)}return u}function f(t,e){Ft.disabledComputing={fn:t,prev:Ft.disabledComputing};var r=e();return Ft.disabledComputing=Ft.disabledComputing.prev,r}function c(t){var e=t.charCodeAt(0);return e>=48&&e<=57&&!/\D/.test(t)}function l(t){return"__proto__"==t||"✖"==t||Ot&&"__iterator__"==t}function h(t,e){var r=Ft.props[t]||(Ft.props[t]=[]);r.push(e)}function g(t){return Ft.props[t]}function y(e){if(Ft.workList)return e(Ft.workList);for(var r=[],n=0,o=Ft.workList=function(t,e,o){n<It-Ht*r.length&&r.push(t,e,o,n)},i=e(o),s=0;s<r.length;s+=4){if(kt&&+new Date>=kt)throw new t.TimedOut;n=r[s+3]+1,r[s+1].addType(r[s],r[s+2])}return Ft.workList=null,i}function d(t,e,r){var n=Ft.curSuperCtor,o=Ft.curSuper;Ft.curSuperCtor=t,Ft.curSuper=e;var i=r();return Ft.curSuperCtor=n,Ft.curSuper=o,i}function v(t,e){for(;t.isBlock||t.isCatch||e===!1&&t.fnType&&t.fnType.isArrowFn();)t=t.prev;return t}function m(t,e){var r=v(t).fnType;r&&(r.instantiateScore=(r.instantiateScore||0)+e)}function P(t,e){try{return n.simple(t,{Expression:function(){if(--e<=0)throw Mt}}),!0}catch(t){if(t==Mt)return!1;throw t}}function b(t,e){var r=e.instantiateScore;return!Ft.disabledComputing&&r&&e.args.length&&P(t,5*r)?(m(v(e.originNode.scope.prev),r/2),w(t,e),!0):void(e.instantiateScore=null)}function w(t,e){for(var r=0;r<e.args.length;++r)e.args[r]=new pt;e.self=new pt,e.computeRet=function(r,o){return f(e,function(){var i=Ft.curOrigin;Ft.curOrigin=e.origin;var s=t.scope,p=new Dt(s.prev,s.originNode);for(var a in s.props)for(var u=p.defProp(a,s.props[a].originNode),f=0;f<o.length;++f)e.argNames[f]==a&&f<o.length&&o[f].propagate(u);for(var c=e.argNames.length!=o.length?e.argNames.slice(0,o.length):e.argNames;c.length<o.length;)c.push("?");if(p.fnType=new Ct(e.name,r,o,c,Q,e.generator),p.fnType.originNode=e.originNode,e.arguments){var l=p.fnType.arguments=new pt;p.defProp("arguments").addType(new jt(l));for(var f=0;f<o.length;++f)o[f].propagate(l)}return t.scope=p,n.recursive(t.body,p,null,Rt),n.recursive(t.body,p,null,Gt),Ft.curOrigin=i,p.fnType.retval})}}function T(t){function e(t,n,o){if(!(o>3)&&t.forward)for(var i=0;i<t.forward.length;++i){var s=t.forward[i].propagatesTo();if(s){var p,a=n;if(s instanceof pt)p=s;else{if(!(s.target instanceof pt))continue;a+=s.pathExt,p=s.target}if(p==r)return a;var u=e(p,a,o+1);if(u)return u}}}var r=t.retval;if(r!=Q&&!t.isArrowFn()){var n,i;!r.isEmpty()&&(n=r.getType())instanceof jt&&(r=i=n.getProp("<i>"));for(var s=e(t.self,"!this",0),p=0;!s&&p<t.args.length;++p)s=e(t.args[p],"!"+p,0);if(s){i&&(s="["+s+"]");var a=new o.TypeParser(s),u=a.parseType(!0);return t.computeRet=u.apply?u:function(){return u},t.computeRetSource=s,!0}}}function x(t,e){return t.defProp(e.name,e)}function E(t){return"Identifier"==t.type?t.name:"AssignmentPattern"==t.type?E(t.left):"ObjectPattern"==t.type?"{"+t.properties.map(function(t){return E(t.value)}).join(", ")+"}":"ArrayPattern"==t.type?"["+t.elements.map(function(t){return t?E(t):""}).join(", ")+"]":"RestElement"==t.type?"..."+E(t.argument):"_"}function S(t){return"VariableDeclaration"==t.type&&"var"!=t.kind||"FunctionDeclaration"==t.type||"ClassDeclaration"==t.type}function N(t,e){return{inner:t,outer:e||t}}function O(t){t.scope&&(t.scope=null)}function C(t){var e=t.getSymbolType();if(e)return e.asPropName()}function j(t){switch(t){case"+":case"-":case"~":return Ft.num;case"!":return Ft.bool;case"typeof":return Ft.str;case"void":case"delete":return Q}}function A(t){switch(t){case"==":case"!=":case"===":case"!==":case"<":case">":case">=":case"<=":case"in":case"instanceof":return!0}}function F(t){if(t.regex)return dt(Ft.protos.RegExp);switch(typeof t.value){case"boolean":return Ft.bool;case"number":return Ft.num;case"string":return Ft.str;case"object":case"function":return t.value?dt(Ft.protos.RegExp):Q}}function k(t,e){if(t==e||e==Q)return t;if(t==Q)return e;var r=new pt;return t.propagate(r),e.propagate(r),r}function I(t,e){for(var r=0;r<t.params.length;r++){var n=t.params[r];"Identifier"!=n.type&&D(n,e,t.scope.fnType.args[r])}}function H(t,e){return e.hasProp(t.name)||Ft.topScope.defProp(t.name,t)}function D(t,e,r){var n=qt[t.type];n&&n(t,e,r)}function M(t){var e=v(t);return e.fnType?e.fnType.self:e}function R(t){t.isEmpty()&&t.propertyOf&&(t.propertyOf.getProp(t.propertyName).addType(new Nt,nt),R(t.propertyOf))}function _(t,e,r){!r&&t.id&&(r=t.id.name);var n,o,i=Ft.protos.Object;if(t.superClass)if("Literal"==t.superClass.type&&null==t.superClass.value)i=null;else{var s,p=G(t.superClass,e);n=p.getFunctionType(),n&&(s=n.getProp("prototype").getObjType())?i=s:(n=p,o=p.getProp("prototype"))}var a=new Nt(i,r&&r+".prototype");return o&&o.propagate(new Tt(a)),d(n,o||i,function(){for(var n,o=t.body.body,i=0;i<o.length;i++)"constructor"==o[i].kind&&(n=o[i].value);var s=t.objType=n?G(n,e):new Ct(r,Q,[],null,Q);s.originNode=t.id||n||t;var p=dt(a,s);s.self.addType(p),s.defProp("prototype",t).addType(a);for(var i=0;i<o.length;i++){var u,f=o[i];if("constructor"!=f.kind){var c=Lt(f,e);"<i>"==c||"set"==f.kind?u=Q:(u=(f.static?s:a).defProp(c,f.key),u.initializer=!0,"get"==f.kind&&(u=new ht(p,[],null,u))),G(f.value,e,u);var l=u.getFunctionType();l&&l.self.addType(p)}}return s})}function L(t,e,r){var n=t.length>1&&t.length<6;if(n){for(var o,i=!0,s=0;s<t.length;s++){var p=t[s];p?"Literal"!=p.type||o&&o!=typeof p.value?i=!1:o=typeof p.value:n=!1}i&&(n=!1)}if(n){for(var a=[],s=0;s<t.length;++s)a.push(r(t[s],e));return new jt(a)}if(t.length<2)return new jt(t[0]&&r(t[0],e));for(var u=new pt,s=0;s<t.length;s++)t[s]&&r(t[s],e).propagate(u);return new jt(u)}function q(t){return function(e,r,n,o){var i=t(e,r,o);return n&&i.propagate(n),i}}function V(t){return function(e,r,n,o){return n||(n=new pt),t(e,r,n,o),n}}function G(t,e,r,n){var o=Vt[t.type];return o?o(t,e,r,n):Q}function B(t){return"VariableDeclaration"==t.type?t.declarations[0].id:t}function U(t,e,r){var n=Array.isArray(t);return n&&1==t.length&&(t=t[0],n=!1),n?null==r?function(e){return t.indexOf(e.origin)>-1}:function(n,o){return o&&o.start>=e&&o.end<=r&&t.indexOf(n.origin)>-1}:null==r?function(e){return e.origin==t}:function(n,o){return o&&o.start>=e&&o.end<=r&&n.origin==t}}function z(t){$t=!0;var e=g(t);if(e)for(var r=0;r<e.length;++r){var n=e[r].getProp(t);if(!n.isEmpty())return n}return Q}function W(t,e){var r=new Nt(!0);r.defProp("done").addType(Ft.bool),e.propagate(r.defProp("value"));var n=new Ct(null,Q,t?[t]:[],t?["?"]:[],r),o=new Nt(Ft.definitions.ecmascript&&Ft.definitions.ecmascript.generator_prototype||!0);return o.defProp("next").addType(n),o}function $(t,e){return t.generator?t.computeRet?W(t.yieldval,e):(t.generator===!0&&(t.generator=W(t.yieldval,e)),t.generator):e}function Y(t,e,r){var n=J(t,r).getFunctionType();if(!n)return Q;var o=n.retval;if(n.computeRet){for(var i=0,s=[];i<e.length;++i)s.push(J(e[i],r));var p=Q;"MemberExpression"==t.type&&(p=J(t.object,r)),o=n.computeRet(p,s,e)}return $(n,o)}function J(t,e){var r=Ut[t.type];return r?r(t,e):Q}var K=t.toString=function(t,e,r){return!t||t==r||e&&e<-3?"?":t.toString(e,r)},Q=t.ANull=i.mixin({addType:function(){},propagate:function(){},getProp:function(){return Q},forAllProps:function(){},hasType:function(){return!1},isEmpty:function(){return!0},getFunctionType:function(){},getObjType:function(){},getSymbolType:function(){},getType:function(){},gatherProperties:function(){},propagatesTo:function(){},typeHint:function(){},propHint:function(){},toString:function(){return"?"}}),X=100,Z=90,tt=10,et=6,rt=6,nt=1,ot=90,it=2,st=4,pt=t.AVal=function(){this.types=[],this.forward=null,this.maxWeight=0};pt.prototype=s(Q,{addType:function(t,e){if(e=e||X,this.maxWeight<e){if(this.maxWeight=e,1==this.types.length&&this.types[0]==t)return;this.types.length=0}else if(this.maxWeight>e||this.types.indexOf(t)>-1)return;this.signal("addType",t),this.types.push(t);var r=this.forward;r&&y(function(n){for(var o=0;o<r.length;++o)n(t,r[o],e)})},propagate:function(t,e){if(!(t==Q||t instanceof Et&&this.forward&&this.forward.length>2)){e&&e!=X&&(t=new xt(t,e)),(this.forward||(this.forward=[])).push(t);var r=this.types;r.length&&y(function(n){for(var o=0;o<r.length;++o)n(r[o],t,e)})}},getProp:function(t){if(l(t))return Q;var e=(this.props||(this.props=Object.create(null)))[t];return e||(e=this.props[t]=new pt,this.propagate(new ft(t,e))),e},forAllProps:function(t){this.propagate(new lt(t))},hasType:function(t){return this.types.indexOf(t)>-1},isEmpty:function(){return 0===this.types.length},getFunctionType:function(){for(var t=this.types.length-1;t>=0;--t)if(this.types[t]instanceof Ct)return this.types[t]},getObjType:function(){for(var t=null,e=this.types.length-1;e>=0;--e){var r=this.types[e];if(r instanceof Nt){if(r.name)return r;t||(t=r)}}return t},getSymbolType:function(){for(var t=this.types.length-1;t>=0;--t)if(this.types[t]instanceof At)return this.types[t]},getType:function(t){return 0===this.types.length&&t!==!1?this.makeupType():1===this.types.length?this.types[0]:u(this.types)},toString:function(t,e){if(0==this.types.length)return K(this.makeupType(),t,e);if(1==this.types.length)return K(this.types[0],t,e);var r=at(this.types);return r.length>2?"?":r.map(function(r){return K(r,t,e)}).join("|")},makeupPropType:function(t){var e=this.propertyName,r=t.proto&&t.proto.hasProp(e);if(r){var n=r.getType();if(n)return n}if("<i>"!=e){var o=t.hasProp("<i>");if(o)return o.getType()}else if(t.props["<i>"]!=this)for(var i in t.props){var s=t.props[i];if(!s.isEmpty())return s.getType()}},makeupType:function(){var t=this.propertyOf&&this.makeupPropType(this.propertyOf);if(t)return t;if(!this.forward)return null;for(var e=this.forward.length-1;e>=0;--e){var r=this.forward[e].typeHint();if(r&&!r.isEmpty())return $t=!0,r}for(var n=Object.create(null),o=null,e=0;e<this.forward.length;++e){var i=this.forward[e].propHint();i&&"length"!=i&&"<i>"!=i&&"✖"!=i&&i!=Ft.completingProperty&&(n[i]=!0,o=i)}if(!o)return null;var s=g(o);if(s){var p=[];t:for(var e=0;e<s.length;++e){var a=s[e];for(var i in n)if(!a.hasProp(i))continue t;a.hasCtor&&(a=dt(a)),p.push(a)}var f=u(p);if(f)return $t=!0,f}},typeHint:function(){return this.types.length?this.getType():null},propagatesTo:function(){return this},gatherProperties:function(t,e){for(var r=0;r<this.types.length;++r)this.types[r].gatherProperties(t,e)},guessProperties:function(t){if(this.forward)for(var e=0;e<this.forward.length;++e){var r=this.forward[e].propHint();r&&t(r,null,0)}var n=this.makeupType();n&&n.gatherProperties(t)}});var at=t.simplifyTypes=function(t){var e=[];t:for(var r=0;r<t.length;++r){for(var n=t[r],o=0;o<e.length;o++){var i=a(n,e[o],0);if(i){e[o]=i;continue t}}e.push(n)}return e},ut=t.constraint=function(t){var e=function(){this.origin=Ft.curOrigin,this.construct.apply(this,arguments)};e.prototype=Object.create(Q);for(var r in t)t.hasOwnProperty(r)&&(e.prototype[r]=t[r]);return e},ft=ut({construct:function(t,e){this.prop=t,this.target=e},addType:function(t,e){t.getProp&&t.getProp(this.prop).propagate(this.target,e)},propHint:function(){return this.prop},propagatesTo:function(){if("<i>"==this.prop||!/[^\w_]/.test(this.prop))return{target:this.target,pathExt:"."+this.prop}}}),ct=t.PropHasSubset=t.DefProp=ut({construct:function(t,e,r){this.prop=t,this.type=e,this.originNode=r},addType:function(t,e){if(t instanceof Nt){var r=t.defProp(this.prop,this.originNode);r.origin||(r.origin=this.origin),this.type.propagate(r,e)}},propHint:function(){return this.prop}}),lt=ut({construct:function(t){this.c=t},addType:function(t){t instanceof Nt&&t.forAllProps(this.c)}}),ht=t.IsCallee=ut({construct:function(t,e,r,n){this.self=t,this.args=e,this.argNodes=r,this.retval=n,this.disabled=Ft.disabledComputing},addType:function(t,e){if(t instanceof Ct){for(var r=0;r<this.args.length;++r)r<t.args.length&&this.args[r].propagate(t.args[r],e),t.arguments&&this.args[r].propagate(t.arguments,e);t.isArrowFn()||this.self.propagate(t.self,this.self==Ft.topScope?ot:e);var n=t.computeRet,o=t.retval;if(n)for(var i=this.disabled;i;i=i.prev)(i.fn==t||t.originNode&&i.fn.originNode==t.originNode)&&(n=null);if(n){var s=Ft.disabledComputing;Ft.disabledComputing=this.disabled,o=n(this.self,this.args,this.argNodes),Ft.disabledComputing=s}$(t,o).propagate(this.retval,e)}},typeHint:function(){for(var t=[],e=0;e<this.args.length;++e)t.push("?");return new Ct(null,this.self,this.args,t,Q)},propagatesTo:function(){return{target:this.retval,pathExt:".!ret"}}}),gt=ut({construct:function(t,e,r,n){this.propName=t,this.args=e,this.argNodes=r,this.retval=n,this.disabled=Ft.disabledComputing},addType:function(t,e){var r=new ht(t,this.args,this.argNodes,this.retval);r.disabled=this.disabled,t.getProp(this.propName).propagate(r,e)},propHint:function(){return this.propName}}),yt=t.IsCtor=ut({construct:function(t,e){this.target=t,this.noReuse=e},addType:function(t,e){t instanceof Ct&&(Ft.parent&&!Ft.parent.options.reuseInstances&&(this.noReuse=!0),t.getProp("prototype").propagate(new vt(!this.noReuse&&t,this.target),e))}}),dt=t.getInstance=function(t,e){if(e===!1)return new Nt(t);e||(e=t.hasCtor),t.instances||(t.instances=[]);for(var r=0;r<t.instances.length;++r){var n=t.instances[r];if(n.ctor==e)return n.instance}var o=new Nt(t,e&&e.name);return o.origin=t.origin,t.instances.push({ctor:e,instance:o}),o},vt=t.IsProto=ut({construct:function(t,e){this.ctor=t,this.target=e},addType:function(t,e){t instanceof Nt&&((this.count=(this.count||0)+1)>8||(t==Ft.protos.Array?this.target.addType(new jt):this.target.addType(dt(t,this.ctor))))}}),mt=ut({construct:function(t){this.fn=t},addType:function(t,e){if(t instanceof Nt&&!t.hasCtor){t.hasCtor=this.fn;var r=new wt(t,this.fn);r.addType(this.fn),t.forAllProps(function(t,e,n){n&&e.propagate(r)})}}}),Pt=ut({construct:function(t,e){this.other=t,this.target=e},addType:function(t,e){t==Ft.str?this.target.addType(Ft.str,e):t==Ft.num&&this.other.hasType(Ft.num)&&this.target.addType(Ft.num,e)},typeHint:function(){return this.other}}),bt=t.IfObj=ut({construct:function(t){this.target=t},addType:function(t,e){t instanceof Nt&&this.target.addType(t,e)},propagatesTo:function(){return this.target}}),wt=ut({construct:function(t,e){this.obj=t,this.ctor=e},addType:function(t){t instanceof Ct&&t.self&&t.self.addType(dt(this.obj,this.ctor),st)}}),Tt=ut({construct:function(t){this.obj=t},addType:function(t){t instanceof Nt&&this.obj.proto==Ft.protos.Object&&this.obj.replaceProto(t)}}),xt=ut({construct:function(t,e){this.inner=t,this.weight=e},addType:function(t,e){this.inner.addType(t,Math.min(e,this.weight))},propagatesTo:function(){return this.inner.propagatesTo()},typeHint:function(){return this.inner.typeHint()},propHint:function(){return this.inner.propHint()}}),Et=t.Type=function(){};Et.prototype=s(Q,{constructor:Et,propagate:function(t,e){t.addType(this,e)},hasType:function(t){return t==this},isEmpty:function(){return!1},typeHint:function(){return this},getType:function(){return this}});var St=t.Prim=function(t,e){this.name=e,this.proto=t};St.prototype=s(Et.prototype,{constructor:St,toString:function(){return this.name},getProp:function(t){return this.proto.hasProp(t)||Q},gatherProperties:function(t,e){this.proto&&this.proto.gatherProperties(t,e)}});var Nt=t.Obj=function(t,e){if(this.props||(this.props=Object.create(null)),this.proto=t===!0?Ft.protos.Object:t,t&&t!=Ft.protos.Object&&!e&&t.name&&!(this instanceof Ct)){var r=/^(.*)\.prototype$/.exec(this.proto.name);r&&(e=r[1])}this.name=e,this.maybeProps=null,this.origin=Ft.curOrigin};Nt.prototype=s(Et.prototype,{constructor:Nt,toString:function(t){if(null==t&&(t=0),t<=0&&this.name)return this.name;var e=[],r=!1;for(var n in this.props)if("<i>"!=n){if(e.length>5){r=!0;break}t?e.push(n+": "+K(this.props[n],t-1,this)):e.push(n)}return e.sort(),r&&e.push("..."),"{"+e.join(", ")+"}"},hasProp:function(t,e){c(t)&&(t=this.normalizeIntegerProp(t));var r=this.props[t];if(e!==!1)for(var n=this.proto;n&&!r;n=n.proto)r=n.props[t];return r},defProp:function(t,e){var r=this.hasProp(t,!1);if(r)return e&&!r.originNode&&(r.originNode=e),r;if(l(t))return Q;c(t)&&(t=this.normalizeIntegerProp(t));var n=this.maybeProps&&this.maybeProps[t];return n?(delete this.maybeProps[t],this.maybeUnregProtoPropHandler()):(n=new pt,n.propertyOf=this,n.propertyName=t),this.props[t]=n,n.originNode=e,n.origin=Ft.curOrigin,this.broadcastProp(t,n,!0),n},getProp:function(t){var e=this.hasProp(t,!0)||this.maybeProps&&this.maybeProps[t];if(e)return e;if(l(t))return Q;c(t)&&(t=this.normalizeIntegerProp(t));var r=this.ensureMaybeProps()[t]=new pt;return r.propertyOf=this,r.propertyName=t,r},normalizeIntegerProp:function(t){return"<i>"},broadcastProp:function(t,e,r){if(r&&(this.signal("addProp",t,e),this instanceof Dt||h(t,this)),this.onNewProp)for(var n=0;n<this.onNewProp.length;++n){var o=this.onNewProp[n];o.onProtoProp?o.onProtoProp(t,e,r):o(t,e,r)}},onProtoProp:function(t,e,r){var n=this.maybeProps&&this.maybeProps[t];n&&(delete this.maybeProps[t],this.maybeUnregProtoPropHandler(),this.proto.getProp(t).propagate(n)),this.broadcastProp(t,e,!1)},replaceProto:function(t){this.proto&&this.maybeProps&&this.proto.unregPropHandler(this),this.proto=t,this.maybeProps&&this.proto.forAllProps(this)},ensureMaybeProps:function(){return this.maybeProps||(this.proto&&this.proto.forAllProps(this),this.maybeProps=Object.create(null)),this.maybeProps},removeProp:function(t){var e=this.props[t];delete this.props[t],this.ensureMaybeProps()[t]=e,e.types.length=0},forAllProps:function(t){this.onNewProp||(this.onNewProp=[],this.proto&&this.proto.forAllProps(this)),this.onNewProp.push(t);for(var e=this;e;e=e.proto)for(var r in e.props)t.onProtoProp?t.onProtoProp(r,e.props[r],e==this):t(r,e.props[r],e==this)},maybeUnregProtoPropHandler:function(){if(this.maybeProps){for(var t in this.maybeProps)return;this.maybeProps=null}!this.proto||this.onNewProp&&this.onNewProp.length||this.proto.unregPropHandler(this)},unregPropHandler:function(t){for(var e=0;e<this.onNewProp.length;++e)if(this.onNewProp[e]==t){this.onNewProp.splice(e,1);break}this.maybeUnregProtoPropHandler()},gatherProperties:function(t,e){for(var r in this.props)"<i>"!=r&&":"!=r.charAt(0)&&t(r,this,e);this.proto&&this.proto.gatherProperties(t,e+1)},getObjType:function(){return this}});var Ot="undefined"!=typeof StopIteration,Ct=t.Fn=function(t,e,r,n,o,i){Nt.call(this,Ft.protos.Function,t),this.self=e,this.args=r,this.argNames=n,this.retval=o,this.generator=i};Ct.prototype=s(Nt.prototype,{constructor:Ct,toString:function(t){null==t&&(t=0);for(var e=this.generator?"fn*(":"fn(",r=0;r<this.args.length;++r){r&&(e+=", ");var n=this.argNames[r];n&&"?"!=n&&(e+=n+": "),e+=t>-3?K(this.args[r],t-1,this):"?"}return e+=")",this.retval.isEmpty()||(e+=" -> "+(t>-3?K(this.retval,t-1,this):"?")),e},getProp:function(t){if("prototype"==t){var e=this.hasProp(t,!1);if(!e){e=this.defProp(t);var r=new Nt(!0,this.name&&this.name+".prototype");r.origin=this.origin,e.addType(r,tt)}return e}return Nt.prototype.getProp.call(this,t)},defProp:function(t,e){if("prototype"==t){var r=this.hasProp(t,!1);return r?r:(r=Nt.prototype.defProp.call(this,t,e),r.origin=this.origin,r.propagate(new mt(this)),r)}return Nt.prototype.defProp.call(this,t,e)},getFunctionType:function(){return this},isArrowFn:function(){return this.originNode&&"ArrowFunctionExpression"==this.originNode.type}});var jt=t.Arr=function(t){Nt.call(this,Ft.protos.Array);var e=this.defProp("<i>");if(Array.isArray(t)){this.tuple=t.length;for(var r=0;r<t.length;r++){var n=this.defProp(String(r));t[r].propagate(n),n.propagate(e)}}else t&&(this.tuple=0,t.propagate(e))};jt.prototype=s(Nt.prototype,{constructor:jt,toString:function(t){if(null==t&&(t=0),t<=-3)return"[?]";var e="";if(this.tuple){for(var r,n=0;n in this.props;n++){var o=K(this.getProp(String(n)),t-1,this);r=null==r?o:r==o&&o,e+=(e?", ":"")+o}r&&(e=r)}else e=K(this.getProp("<i>"),t-1,this);return"["+e+"]"},normalizeIntegerProp:function(t){return+t<this.tuple?t:"<i>"}});var At=t.Sym=function(t,e){St.call(this,Ft.protos.Symbol,"Symbol"),this.symName=t,this.originNode=e};At.prototype=s(St.prototype,{constructor:At,asPropName:function(){return":"+this.symName},getSymbolType:function(){return this}}),t.getSymbol=function(t,e){var r=t.replace(/[^\w$\.]/g,"_"),n=Ft.symbols[r];return n?(e&&!n.originNode&&(n.originNode=e),n):Ft.symbols[r]=new At(r,e)},t.Context=function(e,r){this.parent=r,this.props=Object.create(null),this.protos=Object.create(null),this.origins=[],this.curOrigin="ecmascript",this.paths=Object.create(null),this.definitions=Object.create(null),this.purgeGen=0,this.workList=null,this.disabledComputing=null,this.curSuperCtor=this.curSuper=null,this.symbols=Object.create(null),t.withContext(this,function(){if(Ft.protos.Object=new Nt(null,"Object.prototype"),Ft.topScope=new Dt,Ft.topScope.name="<top>",Ft.protos.Array=new Nt(!0,"Array.prototype"),Ft.protos.Function=new Ct("Function.prototype",Q,[],[],Q),Ft.protos.Function.proto=Ft.protos.Object,Ft.protos.RegExp=new Nt(!0,"RegExp.prototype"),Ft.protos.String=new Nt(!0,"String.prototype"),Ft.protos.Number=new Nt(!0,"Number.prototype"),Ft.protos.Boolean=new Nt(!0,"Boolean.prototype"),Ft.protos.Symbol=new Nt(!0,"Symbol.prototype"),Ft.str=new St(Ft.protos.String,"string"),Ft.bool=new St(Ft.protos.Boolean,"bool"),Ft.num=new St(Ft.protos.Number,"number"),Ft.curOrigin=null,e)for(var t=0;t<e.length;++t)o.load(e[t])})},t.Context.prototype.startAnalysis=function(){this.disabledComputing=this.workList=this.curSuperCtor=this.curSuper=null};var Ft=null;t.cx=function(){return Ft},t.withContext=function(t,e){var r=Ft;Ft=t;try{return e()}finally{Ft=r}},t.TimedOut=function(){this.message="Timed out",this.stack=(new Error).stack},t.TimedOut.prototype=Object.create(Error.prototype),t.TimedOut.prototype.name="infer.TimedOut";var kt;t.withTimeout=function(t,e){var r=+new Date+t,n=kt;if(n&&n<r)return e();kt=r;try{return e()}finally{kt=n}},t.addOrigin=function(t){Ft.origins.indexOf(t)<0&&Ft.origins.push(t)};var It=20,Ht=1e-4,Dt=t.Scope=function(t,e,r,n){Nt.call(this,t||!0),this.prev=t,this.originNode=e,this.isBlock=!!r,this.isCatch=!!n};Dt.prototype=s(Nt.prototype,{constructor:Dt,defVar:function(t,e){for(var r=this;;r=r.proto){var n=r.props[t];if(n)return n;if(!r.prev)return r.defProp(t,e)}}});var Mt={},Rt=t.scopeGatherer=n.make({VariablePattern:function(t,e){e.inner&&x(e.inner,t)},AssignmentPattern:function(t,e,r){r(t.left,e,"Pattern"),r(t.right,e.outer,"Expression")},AssignmentExpression:function(t,e,r){"MemberExpression"==t.left.type?r(t.left,e,"Expression"):r(t.left,N(!1,e),"Pattern"),r(t.right,e,"Expression")},MemberPattern:function(t,e,r){r(t,e.outer)},Function:function(t,e,r){for(var n=t.scope=new Dt(e,t),o=[],i=[],s=0;s<t.params.length;++s){var p=t.params[s];if(i.push(E(p)),"Identifier"==p.type)o.push(x(n,p));else{var a=new pt;o.push(a),a.originNode=p,r(p,N(n),"Pattern")}}if(n.fnType=new Ct(t.id&&t.id.name,new pt,o,i,Q,t.generator),n.fnType.originNode=t,t.id){var u="FunctionDeclaration"==t.type;x(u?e:n,t.id)}r(t.body,n,t.expression?"Expression":"Statement")},BlockStatement:function(t,e,r){!t.scope&&t.body.some(S)&&(e=t.scope=new Dt(e,t,!0)),n.base.BlockStatement(t,e,r)},CatchClause:function(t,e,r){if(e=t.scope=new Dt(e,t,!1,!0),"Identifier"==t.param.type){var n=x(e,t.param);r(t.body,e,"Statement");var o=Ft.definitions.ecmascript;o&&n.isEmpty()&&dt(o["Error.prototype"]).propagate(n,rt)}else r(t.param,N(e),"Pattern")},VariableDeclaration:function(t,e,r){for(var n="var"==t.kind?v(e):e,o=0;o<t.declarations.length;++o){var i=t.declarations[o];r(i.id,N(n,e),"Pattern"),i.init&&r(i.init,e,"Expression")}},ClassDeclaration:function(t,e,r){x(e,t.id),t.superClass&&r(t.superClass,e,"Expression");for(var n=0;n<t.body.body.length;n++)r(t.body.body[n],e)},ForInStatement:function(t,e,r){!t.scope&&S(t.left)&&(e=t.scope=new Dt(e,t,!0)),n.base.ForInStatement(t,e,r)},ForStatement:function(t,e,r){!t.scope&&t.init&&S(t.init)&&(e=t.scope=new Dt(e,t,!0)),n.base.ForStatement(t,e,r)},ImportDeclaration:function(t,e){for(var r=0;r<t.specifiers.length;r++)x(e,t.specifiers[r].local)}});Rt.ForOfStatement=Rt.ForInStatement;var _t={BlockStatement:O,Function:O,CatchClause:O,ForInStateMent:O,ForStatement:O};t.clearScopes=function(t){n.simple(t,_t)};var Lt=t.propName=function(t,e){var r=t.property||t.key;if(!t.computed&&"Identifier"==r.type)return r.name;if("Literal"==r.type){if("string"==typeof r.value)return r.value;if("number"==typeof r.value)return String(r.value)}if(e){var n=C(G(r,e));if(n)return t.propName=n}else if(t.propName)return t.propName;return"<i>"},qt=t.inferPatternVisitor={Identifier:function(t,e,r){r.propagate(H(t,e))},MemberExpression:function(t,e,r){var n=G(t.object,e),o=Lt(t,e);n.propagate(new ct(o,r,t.property))},RestElement:function(t,e,r){D(t.argument,e,new jt(r))},ObjectPattern:function(t,e,r){for(var n=0;n<t.properties.length;++n){var o=t.properties[n];D(o.value,e,r.getProp(Lt(o)))}},ArrayPattern:function(t,e,r){for(var n=0;n<t.elements.length;n++)t.elements[n]&&D(t.elements[n],e,r.getProp(String(n)))},AssignmentPattern:function(t,e,r){D(t.left,e,k(r,G(t.right,e)))}},Vt=t.inferExprVisitor={ArrayExpression:q(function(t,e){return L(t.elements,e,G)}),ObjectExpression:q(function(t,e,r){for(var n,o=Ft.protos.Object,i=0;i<t.properties.length;++i){var s=t.properties[i];if("__proto__"==s.key.name)if("Literal"==s.value.type&&null==s.value.value)o=null;else{var p=G(s.value,e),a=p.getObjType();a?o=a:n=p}}var u=t.objType=new Nt(o,r);return n&&n.propagate(new Tt(u)),u.originNode=t,d(null,n||o,function(){for(var r=0;r<t.properties.length;++r){var n=t.properties[r],o=n.key;if(!l(n.key.name)){var i,s=Lt(n,e);if("<i>"==s||"set"==n.kind)i=Q;else{var p=i=u.defProp(s,o);p.initializer=!0,"get"==n.kind&&(i=new ht(u,[],null,p))}G(n.value,e,i,s),"FunctionExpression"==n.value.type&&n.value.scope.fnType.self.addType(u,it)}}}),u}),FunctionExpression:q(function(t,e,r){var o=t.scope,i=o.fnType;return r&&!i.name&&(i.name=r),I(t,o),t.expression?G(t.body,o,o.fnType.retval=new pt):n.recursive(t.body,o,null,Gt,"Statement"),"ArrowFunctionExpression"==t.type&&M(e).propagate(i.self),b(t,i)||T(i),t.id&&o.getProp(t.id.name).addType(i),i}),ClassExpression:q(_),SequenceExpression:q(function(t,e){for(var r=0,n=t.expressions.length-1;r<n;++r)G(t.expressions[r],e,Q);return G(t.expressions[n],e)}),UnaryExpression:q(function(t,e){return G(t.argument,e,Q),j(t.operator)}),UpdateExpression:q(function(t,e){return G(t.argument,e,Q),Ft.num}),BinaryExpression:q(function(t,e){if("+"==t.operator){var r=G(t.left,e),n=G(t.right,e);if(r.hasType(Ft.str)||n.hasType(Ft.str))return Ft.str;if(r.hasType(Ft.num)&&n.hasType(Ft.num))return Ft.num;var o=new pt;return r.propagate(new Pt(n,o)),n.propagate(new Pt(r,o)),o}return G(t.left,e,Q),G(t.right,e,Q),A(t.operator)?Ft.bool:Ft.num}),AssignmentExpression:q(function(t,e,r){var n,o;if("MemberExpression"==t.left.type?(o=Lt(t.left,e),r||(r="Identifier"==t.left.object.type?t.left.object.name+"."+o:o)):r||"Identifier"!=t.left.type||(r=t.left.name),t.operator&&"="!=t.operator&&"+="!=t.operator?(G(t.right,e,Q),n=Ft.num):n=G(t.right,e,null,r),"MemberExpression"==t.left.type){var i=G(t.left.object,e);if("prototype"==o&&m(e,20),"<i>"==o){var s=t.left.property.name,p=e.props[s],a=p&&p.iteratesOver;if(a){m(e,20);var u="MemberExpression"==t.right.type&&t.right.computed&&t.right.property.name==s;return a.forAllProps(function(t,e,r){r&&"prototype"!=t&&"<i>"!=t&&i.propagate(new ct(t,u?e:Q))}),n}}i.propagate(new ct(o,n,t.left.property)),R(i),"FunctionExpression"==t.right.type&&i.propagate(t.right.scope.fnType.self,it)}else D(t.left,e,n);return n}),LogicalExpression:V(function(t,e,r){G(t.left,e,r),G(t.right,e,r)}),ConditionalExpression:V(function(t,e,r){G(t.test,e,Q),G(t.consequent,e,r),G(t.alternate,e,r)}),NewExpression:V(function(t,e,r,n){"Identifier"==t.callee.type&&t.callee.name in e.props&&m(e,20);for(var o=0,i=[];o<t.arguments.length;++o)i.push(G(t.arguments[o],e));var s=G(t.callee,e),p=new pt;s.propagate(new yt(p,n&&/\.prototype$/.test(n))),p.propagate(r,Z),s.propagate(new ht(p,i,t.arguments,new bt(r)))}),CallExpression:V(function(t,e,r){for(var n=0,o=[];n<t.arguments.length;++n)o.push(G(t.arguments[n],e));var i=v(e).fnType;if("MemberExpression"==t.callee.type){var s=G(t.callee.object,e),p=Lt(t.callee,e);i&&("call"==p||"apply"==p)&&i.args.indexOf(s)>-1&&m(e,30),s.propagate(new gt(p,o,t.arguments,r))}else if("Super"==t.callee.type&&Ft.curSuperCtor)t.callee.superType=Ft.curSuperCtor,Ft.curSuperCtor.propagate(new ht(M(e),o,t.arguments,r)),M(e).propagate(r,Z);else{var a=G(t.callee,e);i&&i.args.indexOf(a)>-1&&m(e,30);var u=a.getFunctionType();u&&u.instantiateScore&&i&&m(e,u.instantiateScore/5),a.propagate(new ht(Ft.topScope,o,t.arguments,r))}}),MemberExpression:V(function(t,e,r){var n,o=Lt(t);if("<i>"==o){var i=G(t.property,e),s=C(i);s?o=t.propName=s:i.hasType(Ft.num)||(n=et)}G(t.object,e).getProp(o).propagate(r,n)}),Identifier:q(function(t,e){if("arguments"==t.name){var r=v(e,!1);!r.fnType||t.name in r.props||r.defProp(t.name,r.fnType.originNode).addType(new jt(r.fnType.arguments=new pt))}return e.getProp(t.name)}),ThisExpression:q(function(t,e){return M(e)}),Super:q(function(t){return t.superType=Ft.curSuper||Q}),Literal:q(function(t){return F(t)}),TemplateLiteral:q(function(t,e){for(var r=0;r<t.expressions.length;++r)G(t.expressions[r],e,Q);return Ft.str}),TaggedTemplateExpression:V(function(t,e,r){for(var n=[new jt(Ft.str)],o=0;o<t.quasi.expressions.length;++o)n.push(G(t.quasi.expressions[o],e));G(t.tag,e,new ht(Ft.topScope,n,t.quasi.expressions,r))}),YieldExpression:q(function(t,e){var r=Q,n=v(e).fnType;return n&&(n.retval==Q&&(n.retval=new pt),n.yieldval||(n.yieldval=new pt),r=n.retval),t.argument&&(t.delegate?G(t.argument,e,new gt("next",[],null,new ft("value",r))):G(t.argument,e,r)),n?n.yieldval:Q})};Vt.ArrowFunctionExpression=Vt.FunctionExpression;var Gt=t.inferWrapper=n.make({Expression:function(t,e){G(t,t.scope||e,Q)},FunctionDeclaration:function(t,e,r){var n=t.scope,o=n.fnType;I(t,n),r(t.body,n,"Statement"),b(t,o)||T(o),e.getProp(t.id.name).addType(o)},Statement:function(t,e,r){r(t,t.scope||e)},VariableDeclaration:function(t,e){for(var r=0;r<t.declarations.length;++r){var n=t.declarations[r];if("Identifier"==n.id.type){var o=e.getProp(n.id.name);n.init&&G(n.init,e,o,n.id.name)}else n.init&&D(n.id,e,G(n.init,e))}},ClassDeclaration:function(t,e){e.getProp(t.id.name).addType(_(t,e,t.id.name));
},ReturnStatement:function(t,e){if(t.argument){var r=Q,n=v(e).fnType;n&&(n.retval==Q&&(n.retval=new pt),r=n.retval),G(t.argument,e,r)}},ForInStatement:function(t,e,r){var n=G(t.right,e);if("Identifier"==t.right.type&&t.right.name in e.props||"MemberExpression"==t.right.type&&"prototype"==t.right.property.name){m(e,5);var o=B(t.left);"Identifier"==o.type?(o.name in e.props&&(e.getProp(o.name).iteratesOver=n),n.getProp("<i>").propagate(H(o,e))):D(o,e,n.getProp("<i>"))}r(t.body,e,"Statement")},ForOfStatement:function(t,e,r){var n,o=B(t.left);"Identifier"==o.type?n=H(o,e):D(o,e,n=new pt),G(t.right,e,new gt(":Symbol.iterator",[],null,new gt("next",[],null,new ft("value",n)))),r(t.body,e,"Statement")}}),Bt=t.parse=function(t,n,o){n&&!Array.isArray(n)||(n=o);var i;try{i=e.parse(t,n)}catch(e){i=r.parse_dammit(t,n)}return i};t.analyze=function(e,r,o){"string"==typeof e&&(e=Bt(e)),r||(r="file#"+Ft.origins.length),t.addOrigin(Ft.curOrigin=r),o||(o=Ft.topScope),Ft.startAnalysis(),n.recursive(e,o,null,Rt),Ft.parent&&Ft.parent.signal("preInfer",e,o),n.recursive(e,o,null,Gt),Ft.parent&&Ft.parent.signal("postInfer",e,o),Ft.curOrigin=null},t.purge=function(t,e,r){var n=U(t,e,r);++Ft.purgeGen,Ft.topScope.purge(n);for(var o in Ft.props){for(var i=Ft.props[o],s=0;s<i.length;++s){var p=i[s],a=p.props[o];a&&!n(a,a.originNode)||i.splice(s--,1)}i.length||delete Ft.props[o]}},pt.prototype.purge=function(t){if(this.purgeGen!=Ft.purgeGen){this.purgeGen=Ft.purgeGen;for(var e=0;e<this.types.length;++e){var r=this.types[e];t(r,r.originNode)?this.types.splice(e--,1):r.purge(t)}if(this.types.length||(this.maxWeight=0),this.forward)for(var e=0;e<this.forward.length;++e){var n=this.forward[e];t(n)?(this.forward.splice(e--,1),this.props&&(this.props=null)):n.purge&&n.purge(t)}}},Q.purge=function(){},Nt.prototype.purge=function(t){if(this.purgeGen==Ft.purgeGen)return!0;this.purgeGen=Ft.purgeGen;for(var e in this.props){var r=this.props[e];t(r,r.originNode)&&this.removeProp(e),r.purge(t)}},Ct.prototype.purge=function(t){if(!Nt.prototype.purge.call(this,t)){this.self.purge(t),this.retval.purge(t);for(var e=0;e<this.args.length;++e)this.args[e].purge(t)}};var Ut=t.typeFinder={ArrayExpression:function(t,e){return L(t.elements,e,J)},ObjectExpression:function(t){return t.objType},ClassExpression:function(t){return t.objType},FunctionExpression:function(t){return t.scope.fnType},ArrowFunctionExpression:function(t){return t.scope.fnType},SequenceExpression:function(t,e){return J(t.expressions[t.expressions.length-1],e)},UnaryExpression:function(t){return j(t.operator)},UpdateExpression:function(){return Ft.num},BinaryExpression:function(t,e){if(A(t.operator))return Ft.bool;if("+"==t.operator){var r=J(t.left,e),n=J(t.right,e);if(r.hasType(Ft.str)||n.hasType(Ft.str))return Ft.str}return Ft.num},AssignmentExpression:function(t,e){return J(t.right,e)},LogicalExpression:function(t,e){var r=J(t.left,e);return r.isEmpty()?J(t.right,e):r},ConditionalExpression:function(t,e){var r=J(t.consequent,e);return r.isEmpty()?J(t.alternate,e):r},NewExpression:function(t,e){var r=J(t.callee,e).getFunctionType(),n=r&&r.getProp("prototype").getObjType();return n?dt(n,r):Q},CallExpression:function(t,e){return Y(t.callee,t.arguments,e)},MemberExpression:function(t,e){var r=Lt(t),n=J(t.object,e).getType();return n?n.getProp(r):"<i>"==r?Q:z(r)},MethodDefinition:function(t){var e=Lt(t),r=M(t.value.scope).getType();return r?r.getProp(e):Q},Identifier:function(t,e){return e.hasProp(t.name)||Q},ThisExpression:function(t,e){return M(e)},Literal:function(t){return F(t)},Super:q(function(t){return t.superType}),TemplateLiteral:function(){return Ft.str},TaggedTemplateExpression:function(t,e){return Y(t.tag,t.quasi.expressions,e)},YieldExpression:function(t,e){var r=v(e).fnType;return r?r.yieldval:Q}},zt=t.searchVisitor=n.make({Function:function(t,e,r){n.base.Function(t,t.scope,r)},CatchClause:function(t,e,r){n.base.CatchClause(t,t.scope,r)},Property:function(t,e,r){t.computed&&r(t.key,e,"Expression"),t.key!=t.value&&r(t.value,e,"Expression")},Statement:function(t,e,r){r(t,t.scope||e)},ImportSpecifier:function(t,e,r){r(t.local,e)},ImportDefaultSpecifier:function(t,e,r){r(t.local,e)},ImportNamespaceSpecifier:function(t,e,r){r(t.local,e)}});t.fullVisitor=n.make({MemberExpression:function(t,e,r){r(t.object,e,"Expression"),r(t.property,e,t.computed?"Expression":null)},Property:function(t,e,r){t.computed&&r(t.key,e,"Expression"),r(t.value,e,"Expression")}},zt),t.findExpressionAt=function(t,e,r,o,i){var s=i||function(t,e){return("Identifier"!=e.type||"✖"!=e.name)&&Ut.hasOwnProperty(e.type)};return n.findNodeAt(t,e,r,s,zt,o||Ft.topScope)},t.findExpressionAround=function(t,e,r,o,i){var s=i||function(t,r){return!(null!=e&&r.start>e)&&(("Identifier"!=r.type||"✖"!=r.name)&&Ut.hasOwnProperty(r.type))};return n.findNodeAround(t,r,s,zt,o||Ft.topScope)},t.expressionType=function(t){return J(t.node,t.state)},t.parentNode=function(t,e){function r(e,i,s){if(e.start<=t.start&&e.end>=t.end){var p=o[o.length-1];if(e==t)throw{found:p};p!=e&&o.push(e),n.base[s||e.type](e,i,r),p!=e&&o.pop()}}var o=[];try{r(e,null)}catch(t){if(t.found)return t.found;throw t}};var Wt=t.findTypeFromContext={ArrayExpression:function(t,e,r){return r(t,!0).getProp("<i>")},ObjectExpression:function(t,e,r){for(var n=0;n<t.properties.length;++n){var o=e.properties[n];if(o.value==e)return r(t,!0).getProp(Lt(o))}},UnaryExpression:function(t){return j(t.operator)},UpdateExpression:function(){return Ft.num},BinaryExpression:function(t){return A(t.operator)?Ft.bool:Ft.num},AssignmentExpression:function(t,e,r){return r(t.left)},LogicalExpression:function(t,e,r){return r(t,!0)},ConditionalExpression:function(t,e,r){if(t.consequent==e||t.alternate==e)return r(t,!0)},CallExpression:function(t,e,r){for(var n=0;n<t.arguments.length;n++){var o=t.arguments[n];if(o==e){var i=r(t.callee).getFunctionType();if(i instanceof Ct)return i.args[n];break}}},ReturnStatement:function(t,e,r){var o=n.findNodeAround(e.sourceFile.ast,e.start-1,"Function");if(o){var i="FunctionDeclaration"!=o.node.type?r(o.node,!0).getFunctionType():o.node.scope.fnType;if(i)return i.retval.getType()}},VariableDeclarator:function(t,e,r){if(t.init==e)return r(t.id)}};Wt.NewExpression=Wt.CallExpression,t.typeFromContext=function(e,r){var n=t.parentNode(r.node,e),o=null;if(Wt.hasOwnProperty(n.type)){var i=Wt[n.type];o=i&&i(n,r.node,function(n,o){var i={node:n,state:r.state},s=o?t.typeFromContext(e,i):t.expressionType(i);return s||Q})}return o||t.expressionType(r)};var $t=!1;t.resetGuessing=function(t){$t=t},t.didGuess=function(){return $t},t.forAllPropertiesOf=function(t,e){t.gatherProperties(e,0)},t.findRefs=function(e,r,o,i,s){function p(t,r,n){if(t.name==o&&(t!=e.id||"FunctionDeclaration"!=e.type))for(var p=r;p;p=p.prev)if(p==i&&s(t,r,n),o in p.props)return}n.ancestor(e,{Identifier:p,VariablePattern:p},t.fullVisitor,r)};var Yt=n.make({Function:function(t,e,r){r(t.body,t.scope,t.expression?"Expression":"Statement")},Statement:function(t,e,r){r(t,t.scope||e)}});t.findPropRefs=function(t,e,r,o,i){function s(t){for(;t&&t!=r;){if(t.props[o]||t.maybeProps&&t.maybeProps[o])return!1;t=t.proto}return t}for(;r&&!r.props[o]&&(!r.maybeProps||!r.maybeProps[o]);)r=r.proto;if(!r)throw new Error("Couldn't locate property in the base object type.");n.simple(t,{MemberExpression:function(t,e){t.computed||Lt(t)!=o||s(J(t.object,e).getType())&&i(t.property,e)},ObjectExpression:function(t,e){if(J(t,e).getType()==r)for(var n=0;n<t.properties.length;++n)Lt(t.properties[n])==o&&i(t.properties[n].key,e)},MethodDefinition:function(t){Lt(t)==o&&t.value&&s(M(t.value.scope).getType())&&i(t.key,t.value.scope)}},Yt,e)};var Jt=t.scopeAt=function(t,e,r){var o=n.findNodeAround(t,e,function(t,e){return e.scope});return o?o.node.scope:r||Ft.topScope};t.forAllLocalsAt=function(t,e,r,n){var o=Jt(t,e,r);o.gatherProperties(n,0)},o=t.def=o.init({},t)});
//# sourceMappingURL=infer.min.js.map