"use strict";angular.module("colorpicker.module",[]).factory("Helper",function(){return{closestSlider:function(b){var a=b.matches||b.webkitMatchesSelector||b.mozMatchesSelector||b.msMatchesSelector;if(a.bind(b)("I")){return b.parentNode}return b},getOffset:function(c,b){var a=0,f=0,e=0,d=0;while(c&&!isNaN(c.offsetLeft)&&!isNaN(c.offsetTop)){a+=c.offsetLeft;f+=c.offsetTop;if(!b&&c.tagName==="BODY"){e+=document.documentElement.scrollLeft||c.scrollLeft;d+=document.documentElement.scrollTop||c.scrollTop}else{e+=c.scrollLeft;d+=c.scrollTop}c=c.offsetParent}return{top:f,left:a,scrollX:e,scrollY:d}},stringParsers:[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(a){return[a[1],a[2],a[3],a[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(a){return[2.55*a[1],2.55*a[2],2.55*a[3],a[4]]}},{re:/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,parse:function(a){return[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16)]}},{re:/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/,parse:function(a){return[parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16),parseInt(a[3]+a[3],16)]}}]}}).factory("Color",["Helper",function(a){return{value:{h:1,s:1,b:1,a:1},rgb:function(){var b=this.toRGB();return"rgb("+b.r+","+b.g+","+b.b+")"},rgba:function(){var b=this.toRGB();return"rgba("+b.r+","+b.g+","+b.b+","+b.a+")"},hex:function(){return this.toHex()},RGBtoHSB:function(j,i,c,e){j/=255;i/=255;c/=255;var h,f,d,k;d=Math.max(j,i,c);k=d-Math.min(j,i,c);h=(k===0?null:d===j?(i-c)/k:d===i?(c-j)/k+2:(j-i)/k+4);h=((h+360)%6)*60/360;f=k===0?0:k/d;return{h:h||1,s:f,b:d,a:e||1}},setColor:function(e){e=e.toLowerCase();for(var d in a.stringParsers){if(a.stringParsers.hasOwnProperty(d)){var f=a.stringParsers[d];var c=f.re.exec(e),b=c&&f.parse(c);if(b){this.value=this.RGBtoHSB.apply(null,b);return false}}}},setHue:function(b){this.value.h=1-b},setSaturation:function(b){this.value.s=b},setLightness:function(c){this.value.b=1-c},setAlpha:function(b){this.value.a=parseInt((1-b)*100,10)/100},toRGB:function(g,l,i,j){if(!g){g=this.value.h;l=this.value.s;i=this.value.b}g*=360;var f,k,d,e,c;g=(g%360)/60;c=i*l;e=c*(1-Math.abs(g%2-1));f=k=d=i-c;g=~~g;f+=[c,e,0,0,e,c][g];k+=[e,c,c,e,0,0][g];d+=[0,0,e,c,c,e][g];return{r:Math.round(f*255),g:Math.round(k*255),b:Math.round(d*255),a:j||this.value.a}},toHex:function(g,f,c,d){var e=this.toRGB(g,f,c,d);return"#"+((1<<24)|(parseInt(e.r,10)<<16)|(parseInt(e.g,10)<<8)|parseInt(e.b,10)).toString(16).substr(1)}}}]).factory("Slider",["Helper",function(a){var b={maxLeft:0,maxTop:0,callLeft:null,callTop:null,knob:{top:0,left:0}},c={};return{getSlider:function(){return b},getLeftPosition:function(d){return Math.max(0,Math.min(b.maxLeft,b.left+((d.pageX||c.left)-c.left)))},getTopPosition:function(d){return Math.max(0,Math.min(b.maxTop,b.top+((d.pageY||c.top)-c.top)))},setSlider:function(e,d){var f=a.closestSlider(e.target),g=a.getOffset(f,d);b.knob=f.children[0].style;b.left=e.pageX-g.left-window.pageXOffset+g.scrollX;b.top=e.pageY-g.top-window.pageYOffset+g.scrollY;c={left:e.pageX,top:e.pageY}},setSaturation:function(e,d){b={maxLeft:100,maxTop:100,callLeft:"setSaturation",callTop:"setLightness"};this.setSlider(e,d)},setHue:function(e,d){b={maxLeft:0,maxTop:100,callLeft:false,callTop:"setHue"};this.setSlider(e,d)},setAlpha:function(e,d){b={maxLeft:0,maxTop:100,callLeft:false,callTop:"setAlpha"};this.setSlider(e,d)},setKnob:function(e,d){b.knob.top=e+"px";b.knob.left=d+"px"}}}]).directive("colorpicker",["$document","$compile","Color","Slider","Helper",function(e,a,d,c,b){return{require:"?ngModel",restrict:"A",link:function(t,x,s,n){var w=s.colorpicker?s.colorpicker:"hex",E=angular.isDefined(s.colorpickerPosition)?s.colorpickerPosition:"bottom",f=angular.isDefined(s.colorpickerFixedPosition)?s.colorpickerFixedPosition:false,D=angular.isDefined(s.colorpickerParent)?x.parent():angular.element(document.body),i=angular.isDefined(s.colorpickerWithInput)?s.colorpickerWithInput:false,h=i?'<input type="text" name="colorpicker-input">':"",B='<div class="colorpicker dropdown"><div class="dropdown-menu"><colorpicker-saturation><i></i></colorpicker-saturation><colorpicker-hue><i></i></colorpicker-hue><colorpicker-alpha><i></i></colorpicker-alpha><colorpicker-preview></colorpicker-preview>'+h+'<button class="close close-colorpicker">&times;</button></div></div>',u=angular.element(B),A=d,r,G=u.find("colorpicker-hue"),l=u.find("colorpicker-saturation"),g=u.find("colorpicker-preview"),o=u.find("i");a(u)(t);if(i){var p=u.find("input");p.on("mousedown",function(H){H.stopPropagation()}).on("keyup",function(I){var H=this.value;x.val(H);if(n){t.$apply(n.$setViewValue(H))}I.stopPropagation();I.preventDefault()});x.on("keyup",function(){p.val(x.val())})}var k=function(){e.on("mousemove",z);e.on("mouseup",v)};if(w==="rgba"){u.addClass("alpha");r=u.find("colorpicker-alpha");r.on("click",function(H){c.setAlpha(H,f);z(H)}).on("mousedown",function(H){c.setAlpha(H,f);k()})}G.on("click",function(H){c.setHue(H,f);z(H)}).on("mousedown",function(H){c.setHue(H,f);k()});l.on("click",function(H){c.setSaturation(H,f);z(H)}).on("mousedown",function(H){c.setSaturation(H,f);k()});if(f){u.addClass("colorpicker-fixed-position")}u.addClass("colorpicker-position-"+E);D.append(u);if(n){n.$render=function(){x.val(n.$viewValue)};t.$watch(s.ngModel,function(){m()})}x.on("$destroy",function(){u.remove()});var q=function(){try{g.css("backgroundColor",A[w]())}catch(H){g.css("backgroundColor",A.toHex())}l.css("backgroundColor",A.toHex(A.value.h,1,1,1));if(w==="rgba"){r.css.backgroundColor=A.toHex()}};var z=function(J){var L=c.getLeftPosition(J),K=c.getTopPosition(J),I=c.getSlider();c.setKnob(K,L);if(I.callLeft){A[I.callLeft].call(A,L/100)}if(I.callTop){A[I.callTop].call(A,K/100)}q();var H=A[w]();x.val(H);if(n){t.$apply(n.$setViewValue(H))}if(i){p.val(H)}return false};var v=function(){e.off("mousemove",z);e.off("mouseup",v)};var m=function(){A.setColor(x.val());o.eq(0).css({left:A.value.s*100+"px",top:100-A.value.b*100+"px"});o.eq(1).css("top",100*(1-A.value.h)+"px");o.eq(2).css("top",100*(1-A.value.a)+"px");q()};var y=function(){var I,H=b.getOffset(x[0]);if(angular.isDefined(s.colorpickerParent)){H.left=0;H.top=0}if(E==="top"){I={top:H.top-147,left:H.left}}else{if(E==="right"){I={top:H.top,left:H.left+126}}else{if(E==="bottom"){I={top:H.top+x[0].offsetHeight+2,left:H.left}}else{if(E==="left"){I={top:H.top,left:H.left-150}}}}}return{top:I.top+"px",left:I.left+"px"}};var j=function(){F()};x.on("click",function(){m();u.addClass("colorpicker-visible").css(y());e.on("mousedown",j)});u.on("mousedown",function(H){H.stopPropagation();H.preventDefault()});var C=function(H){if(n){t.$emit(H,{name:s.ngModel,value:n.$modelValue})}};var F=function(){if(u.hasClass("colorpicker-visible")){u.removeClass("colorpicker-visible");C("colorpicker-closed");e.off("mousedown",j)}};u.find("button").on("click",function(){F()})}}}]);