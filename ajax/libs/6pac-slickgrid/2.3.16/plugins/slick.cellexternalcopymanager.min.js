!function(e){e.extend(!0,window,{Slick:{CellExternalCopyManager:function(t){var o,l,n=this,a=t||{},r=a.copiedCellStyleLayerKey||"copy-manager",i=a.copiedCellStyle||"copied",s=0,c=a.bodyElement||document.body,u=a.onCopyInit||null,d=a.onCopySuccess||null,f={C:67,V:86,ESC:27,INSERT:45};function h(t,l){if(a.dataItemColumnValueExtractor){var n=a.dataItemColumnValueExtractor(t,l);if(n)return n}var r="";if(l.editor){var i={container:e("<p>"),column:l,position:{top:0,left:0},grid:o},s=new l.editor(i);s.loadValue(t),r=s.serializeValue(),s.destroy()}else r=t[l.field];return r}function C(t,l,n){if(a.dataItemColumnValueSetter)return a.dataItemColumnValueSetter(t,l,n);if(l.editor){var r={container:e("body"),column:l,position:{top:0,left:0},grid:o},i=new l.editor(r);i.loadValue(t),i.applyValue(t,n),i.destroy()}else t[l.field]=n}function m(e){var t=document.createElement("textarea");return t.style.position="absolute",t.style.left="-1000px",t.style.top=document.body.scrollTop+"px",t.value=e,c.appendChild(t),t.select(),t}function g(e,t){var r;if(!o.getEditorLock().isActive()||o.getOptions().autoEdit){if(e.which==f.ESC&&l&&(e.preventDefault(),y(),n.onCopyCancelled.notify({ranges:l}),l=null),(e.which===f.C||e.which===f.INSERT)&&(e.ctrlKey||e.metaKey)&&!e.shiftKey&&(u&&u.call(),0!=(r=o.getSelectionModel().getSelectedRanges()).length)){l=r,p(r),n.onCopyCells.notify({ranges:r});for(var i=o.getColumns(),s="",g=0;g<r.length;g++){for(var v=r[g],w=[],S=v.fromRow;S<v.toRow+1;S++){var D=[],R=o.getDataItem(S);if(""==w&&a.includeHeaderWhenCopying){for(var x=[],E=v.fromCell;E<v.toCell+1;E++)i[E].name.length>0&&x.push(i[E].name);w.push(x.join("\t"))}for(var E=v.fromCell;E<v.toCell+1;E++)D.push(h(R,i[E]));w.push(D.join("\t"))}s+=w.join("\r\n")+"\r\n"}if(window.clipboardData)return window.clipboardData.setData("Text",s),!0;var V=document.activeElement,b=m(s);if(b.focus(),setTimeout(function(){c.removeChild(b),V?V.focus():console.log("Not element to restore focus to after copy?")},100),d){var I=0;I=1===r.length?r[0].toRow+1-r[0].fromRow:r.length,d.call(this,I)}return!1}if(!a.readOnlyMode&&(e.which===f.V&&(e.ctrlKey||e.metaKey)&&!e.shiftKey||e.which===f.INSERT&&e.shiftKey&&!e.ctrlKey)){var b=m("");return setTimeout(function(){!function(e,t){var o=e.getColumns(),l=t.value.split(/[\n\f\r]/);""==l[l.length-1]&&l.pop();var r=[],i=0;c.removeChild(t);for(var s=0;s<l.length;s++)""!=l[s]?r[i++]=l[s].split("\t"):r[s]=[""];var u=e.getActiveCell(),d=e.getSelectionModel().getSelectedRanges(),f=d&&d.length?d[0]:null,h=null,m=null;if(f)h=f.fromRow,m=f.fromCell;else{if(!u)return;h=u.row,m=u.cell}var g=!1,y=r.length,v=r.length?r[0].length:0;1==r.length&&1==r[0].length&&f&&(g=!0,y=f.toRow-f.fromRow+1,v=f.toCell-f.fromCell+1);var w=e.getData().length-h,S=0;if(w<y&&a.newRowCreator){var D=e.getData();for(S=1;S<=y-w;S++)D.push({});e.setData(D),e.render()}var R=h+y>e.getDataLength();if(a.newRowCreator&&R){var x=h+y-e.getDataLength();a.newRowCreator(x)}var E={isClipboardCommand:!0,clippedRange:r,oldValues:[],cellExternalCopyManager:n,_options:a,setDataItemValueForColumn:C,markCopySelection:p,oneCellToMultiple:g,activeRow:h,activeCell:m,destH:y,destW:v,maxDestY:e.getDataLength(),maxDestX:e.getColumns().length,h:0,w:0,execute:function(){this.h=0;for(var t=0;t<this.destH;t++){this.oldValues[t]=[],this.w=0,this.h++;for(var l=0;l<this.destW;l++){this.w++;var n=h+t,a=m+l;if(n<this.maxDestY&&a<this.maxDestX){e.getCellNode(n,a);var i=e.getDataItem(n);this.oldValues[t][l]=i[o[a].field],g?this.setDataItemValueForColumn(i,o[a],r[0][0]):this.setDataItemValueForColumn(i,o[a],r[t]?r[t][l]:""),e.updateCell(n,a),e.onCellChange.notify({row:n,cell:a,item:i,grid:e})}}}var s={fromCell:m,fromRow:h,toCell:m+this.w-1,toRow:h+this.h-1};this.markCopySelection([s]),e.getSelectionModel().setSelectedRanges([s]),this.cellExternalCopyManager.onPasteCells.notify({ranges:[s]})},undo:function(){for(var t=0;t<this.destH;t++)for(var l=0;l<this.destW;l++){var n=h+t,a=m+l;if(n<this.maxDestY&&a<this.maxDestX){e.getCellNode(n,a);var r=e.getDataItem(n);g?this.setDataItemValueForColumn(r,o[a],this.oldValues[0][0]):this.setDataItemValueForColumn(r,o[a],this.oldValues[t][l]),e.updateCell(n,a),e.onCellChange.notify({row:n,cell:a,item:r,grid:e})}}var i={fromCell:m,fromRow:h,toCell:m+this.w-1,toRow:h+this.h-1};if(this.markCopySelection([i]),e.getSelectionModel().setSelectedRanges([i]),this.cellExternalCopyManager.onPasteCells.notify({ranges:[i]}),S>1){for(var s=e.getData();S>1;S--)s.splice(s.length-1,1);e.setData(s),e.render()}}};a.clipboardCommandHandler?a.clipboardCommandHandler(E):E.execute()}(o,b)},100),!1}}}function p(e){y();for(var t=o.getColumns(),l={},a=0;a<e.length;a++)for(var c=e[a].fromRow;c<=e[a].toRow;c++){l[c]={};for(var u=e[a].fromCell;u<=e[a].toCell&&u<t.length;u++)l[c][t[u].id]=i}o.setCellCssStyles(r,l),clearTimeout(s),s=setTimeout(function(){n.clearCopySelection()},2e3)}function y(){o.removeCellCssStyles(r)}e.extend(this,{init:function(e){(o=e).onKeyDown.subscribe(g);var t=e.getSelectionModel();if(!t)throw new Error("Selection model is mandatory for this plugin. Please set a selection model on the grid before adding this plugin: grid.setSelectionModel(new Slick.CellSelectionModel())");t.onSelectedRangesChanged.subscribe(function(e,t){o.focus()})},destroy:function(){o.onKeyDown.unsubscribe(g)},clearCopySelection:y,handleKeyDown:g,onCopyCells:new Slick.Event,onCopyCancelled:new Slick.Event,onPasteCells:new Slick.Event})}}})}(jQuery);