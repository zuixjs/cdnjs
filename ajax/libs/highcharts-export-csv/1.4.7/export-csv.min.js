!function(t){"object"==typeof module&&module.exports?module.exports=t:t(Highcharts)}(function(t){"use strict";var e=t.each,o=t.pick,n=t.seriesTypes,a=void 0!==document.createElement("a").download;function i(e,o,n,i,r){var s,l,c,p=((e.options.exporting||{}).csv||{}).url||"http://www.highcharts.com/studies/csv-export/download.php";c=e.options.exporting.filename?e.options.exporting.filename:e.title?e.title.textStr.replace(/ /g,"-").toLowerCase():"chart",window.Blob&&window.navigator.msSaveOrOpenBlob?(l=new Blob([i]),window.navigator.msSaveOrOpenBlob(l,c+"."+n)):a?((s=document.createElement("a")).href=o,s.target="_blank",s.download=c+"."+n,e.container.append(s),s.click(),s.remove()):t.post(p,{data:i,type:r,extension:n})}t.setOptions({lang:{downloadCSV:"Download CSV",downloadXLS:"Download XLS",viewData:"View data table"}}),t.Chart.prototype.getDataRows=function(){var n,a,i,r,s,l,c,p=(this.options.exporting||{}).csv||{},x=this.xAxis,d={},m=[],h=[],u=p.dateFormat||"%Y-%m-%d %H:%M:%S",f=p.columnHeaderFormatter||function(e,o,n){return e instanceof t.Axis?e.options.title&&e.options.title.text||(e.isDatetimeAxis?"DateTime":"Category"):e?e.name+(n>1?" ("+o+")":""):"Category"},g=[];i=0,e(this.series,function(n){var a,r=n.options.keys||n.pointArrayMap||["y"],s=r.length,l=n.requireSorting,c={},p=t.inArray(n.xAxis,x);if(e(r,function(t){c[t]=n[t+"Axis"]&&n[t+"Axis"].categories||[]}),!1!==n.options.includeInCSVExport&&!1!==n.visible){for(t.find(g,function(t){return t[0]===p})||g.push([p,i]),a=0;a<s;)h.push(f(n,r[a],r.length)),a+=1;e(n.points,function(t,e){var x,m,h=l?t.x:e;for(a=0,d[h]||(d[h]=[],d[h].xValues=[]),d[h].x=t.x,d[h].xValues[p]=t.x,n.xAxis&&"name"!==n.exportKey||(d[h].name=t.name);a<s;)m=t[x=r[a]],d[h][i+a]=o(c[x][m],m),a+=1}),i+=a}});for(r in d)d.hasOwnProperty(r)&&m.push(d[r]);for(a=[h],i=g.length;i--;)l=g[i][0],c=g[i][1],n=x[l],m.sort(function(t,e){return t.xValues[l]-e.xValues[l]}),s=f(n),a[0].splice(c,0,s),e(m,function(e){var a=e.name;a||(n.isDatetimeAxis?(e.x instanceof Date&&(e.x=e.x.getTime()),a=t.dateFormat(u,e.x)):a=n.categories?o(n.names[e.x],n.categories[e.x],e.x):e.x),e.splice(c,0,a)});return a=a.concat(m)},t.Chart.prototype.getCSV=function(t){var o="",n=this.getDataRows(),a=(this.options.exporting||{}).csv||{},i=a.itemDelimiter||",",r=a.lineDelimiter||"\n";return e(n,function(e,a){for(var s="",l=e.length,c=t?1.1.toLocaleString()[1]:".";l--;)"string"==typeof(s=e[l])&&(s='"'+s+'"'),"number"==typeof s&&","===c&&(s=s.toString().replace(".",",")),e[l]=s;o+=e.join(i),a<n.length-1&&(o+=r)}),o},t.Chart.prototype.getTable=function(t){var o="<table><thead>",n=this.getDataRows();return e(n,function(e,n){var a,i,r=n?"td":"th",s=t?1.1.toLocaleString()[1]:".";for(o+="<tr>",i=0;i<e.length;i+=1)"number"==typeof(a=e[i])?(a=a.toString(),","===s&&(a=a.replace(".",s)),o+="<"+r+' class="number">'+a+"</"+r+">"):o+="<"+r+">"+(void 0===a?"":a)+"</"+r+">";o+="</tr>",n||(o+="</thead><tbody>")}),o+="</tbody></table>"},t.Chart.prototype.downloadCSV=function(){var t=this.getCSV(!0);i(this,"data:text/csv,\ufeff"+encodeURIComponent(t),"csv",t,"text/csv")},t.Chart.prototype.downloadXLS=function(){var t,e='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head>\x3c!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>Ark1</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--\x3e<style>td{border:none;font-family: Calibri, sans-serif;} .number{mso-number-format:"0.00";}</style><meta name=ProgId content=Excel.Sheet><meta charset=UTF-8></head><body>'+this.getTable(!0)+"</body></html>";i(this,"data:application/vnd.ms-excel;base64,"+(t=e,window.btoa(unescape(encodeURIComponent(t)))),"xls",e,"application/vnd.ms-excel")},t.Chart.prototype.viewData=function(){this.dataTableDiv||(this.dataTableDiv=document.createElement("div"),this.dataTableDiv.className="highcharts-data-table",this.renderTo.parentNode.insertBefore(this.dataTableDiv,this.renderTo.nextSibling)),this.dataTableDiv.innerHTML=this.getTable()},t.getOptions().exporting&&t.getOptions().exporting.buttons.contextButton.menuItems.push({textKey:"downloadCSV",onclick:function(){this.downloadCSV()}},{textKey:"downloadXLS",onclick:function(){this.downloadXLS()}},{textKey:"viewData",onclick:function(){this.viewData()}}),n.map&&(n.map.prototype.exportKey="name"),n.mapbubble&&(n.mapbubble.prototype.exportKey="name")});