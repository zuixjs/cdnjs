/*! asynquence-contrib
    v0.13.0 (c) Kyle Simpson
    MIT License: http://getify.mit-license.org
*/
!function UMD(e,n){"undefined"!=typeof module&&module.exports?(module.exports=function $$inject$dependency(e){if("string"==typeof e)try{e=require(e)}catch(t){return $$inject$dependency}return n(e)},"string"==typeof e&&(module.exports=module.exports(require("path").join("..",e)))):"function"==typeof define&&define.amd?define([e],n):n(e)}(this.ASQ||"asynquence",function DEF(e){"use strict";function isPromise(n){var t=typeof n;return null!==n&&("object"==t||"function"==t)&&!e.isSequence(n)&&"function"==typeof n.then}var n=Array.prototype.slice,t=Object.create(null),r="__ASQ__",a=e.__schedule,u=e.__tapSequence;return e.extend("after",function $$extend(e,r){return function $$after(r){var a=arguments.length>1?n.call(arguments,1):void 0;return r=+r||0,e.then(function $$then(e){var u=a||n.call(arguments,1);setTimeout(function $$set$timeout(){e.apply(t,u)},r)}),e}}),e.after=function $$after(){return e().after.apply(t,arguments)},function IIFE(){var u;e.iterable=function $$iterable(){function throwSequenceErrors(){throw 1===$.length?$[0]:$}function notifyErrors(){var e;if(o=null,l)for(0!==f.length||c||(c=!0,throwSequenceErrors());f.length>0;){c=!0,e=f.shift();try{e.apply(t,$)}catch(n){checkBranding(n)?$=$.concat(n):$.push(n),0===f.length&&throwSequenceErrors()}}}function val(){if(l||s||0===arguments.length)return i;var e=n.call(arguments).map(function mapper(e){return"function"!=typeof e?function $$val(){return e}:e});return p.push.apply(p,e),i}function or(){return s||0===arguments.length?i:(f.push.apply(f,arguments),o||(o=a(notifyErrors)),i)}function pipe(){return s||0===arguments.length?i:(n.call(arguments).forEach(function $$each(e){val(e).or(e.fail)}),i)}function next(){if(l||s||0===p.length)return p.length>0&&$throw$("Sequence cannot be iterated"),{done:!0};try{return{value:p.shift().apply(t,arguments)}}catch(n){return e.isMessageWrapper(n)?$throw$.apply(t,n):$throw$(n),{}}}function $throw$(){return l||s?i:($.push.apply($,arguments),l=!0,o||(o=a(notifyErrors)),i)}function $return$(e){return(l||s)&&(e=void 0),abort(),{done:!0,value:e}}function abort(){l||s||(s=!0,clearTimeout(o),o=null,p.length=f.length=$.length=0)}function duplicate(){var n;return u={val_queue:p.slice(),or_queue:f.slice()},n=e.iterable(),u=null,n}function defer(){return f.push(function $$ignored(){}),i}function brandIt(e){return Object.defineProperty(e,r,{enumerable:!1,value:!0}),e}var i,o,l=!1,c=!1,s=!1,p=[],f=[],$=[];return i=brandIt({val:val,then:val,or:or,pipe:pipe,next:next,"throw":$throw$,"return":$return$,abort:abort,duplicate:duplicate,defer:defer}),i["function"==typeof Symbol&&Symbol.iterator||"@@iterator"]=function $$iter(){return i},u&&(p=u.val_queue.slice(0),f=u.or_queue.slice(0)),i.val.apply(t,arguments),i}}(),e.extend("race",function $$extend(r,a){return function $$race(){if(a("seq_error")||a("seq_aborted")||0===arguments.length)return r;var i=n.call(arguments).map(function $$map(n){var t;return e.isSequence(n)?(t={seq:n},u(t),function $$fn(e){t.seq.pipe(e)}):n});return r.then(function $$then(e){var r=n.call(arguments);i.forEach(function $$each(e){e.apply(t,r)})}),r}}),e.extend("runner",function $$extend(r,u){return function $$runner(){if(u("seq_error")||u("seq_aborted")||0===arguments.length)return r;var i=n.call(arguments);return r.then(function $$then(r){function wrap(n){return"function"==typeof n?(n=n.call(t,p),isPromise(n)&&(n=e.iterable(n))):n=e.isSequence(n)&&"next"in n?n.duplicate():e.iterable(n),e.isSequence(n)&&n.or(function $$or(){r.fail.apply(t,arguments)}),n}function addWrapped(){c.push.apply(c,n.call(arguments).map(wrap))}var o,l,c=i,s={messages:n.call(arguments,1),add:addWrapped},p=s;c=c.map(wrap),function iterate(){o=c.shift();try{l=e.isMessageWrapper(p)&&e.isSequence(o)?o.next.apply(o,p):o.next(p)}catch(n){return r.fail(n)}if(!u("seq_aborted"))if(l.value===s)c.push(o),p=s,a(iterate);else{if(!e.isSequence(l.value))if(isPromise(l.value))l.value=e().promise(l.value);else if("function"==typeof l.value){var i=l.value;l.value=e(function $$ASQ(e){i(e.errfcb)})}else e.isMessageWrapper(l.value)?l.value=e.apply(t,l.value.length>0?l.value:e.messages(void 0)):"undefined"!=typeof l.value?l.value=e(l.value):l.value=e();l.value.val(function $$val(){u("seq_aborted")||(arguments.length>0&&(p=arguments.length>1?e.messages.apply(t,arguments):arguments[0]),l.done||(p===s?c.push(o):c.unshift(o)),c.length>0?iterate():("undefined"!=typeof p?e.isMessageWrapper(p)||(p=[p]):p=[],r.apply(t,p)))}).or(function $$or(){if(!u("seq_aborted"))try{o["throw"].apply(o,arguments)}catch(e){r.fail(e)}})}}()}),r}}),e.extend("toPromise",function $$extend(r,a){return function $$to$promise(){return new Promise(function $$executor(a,u){r.val(function $$val(){var r=n.call(arguments);return a.call(t,r.length>1?r:r[0]),e.messages.apply(t,r)}).or(function $$or(){var e=n.call(arguments);u.call(t,e.length>1?e:e[0])})})}}),e.wrap=function $$wrap(r,a){function checkThis(e,n){return!e||"undefined"!=typeof window&&e===window||"undefined"!=typeof global&&e===global?n:e}var u,i,o,l;if(a=a&&"object"==typeof a?a:{},a.errfcb&&a.splitcb||a.errfcb&&a.simplecb||a.splitcb&&a.simplecb||"errfcb"in a&&!a.errfcb&&!a.splitcb&&!a.simplecb||a.params_first&&a.params_last)throw Error("Invalid options");return l=a["this"]&&"object"==typeof a["this"]?a["this"]:t,u=a.errfcb||!(a.splitcb||a.simplecb),i=!!a.params_first||!a.params_last&&!("params_first"in a||a.params_first)||"params_last"in a&&!a.params_first&&!a.params_last,o=i?"push":"unshift",a.gen?function $$wrapped$gen(){return e.apply(t,arguments).runner(r)}:u?function $$wrapped$errfcb(){var t=n.call(arguments),a=checkThis(this,l);return e(function $$asq(e){t[o](e.errfcb),r.apply(a,t)})}:a.splitcb?function $$wrapped$splitcb(){var t=n.call(arguments),a=checkThis(this,l);return e(function $$asq(e){t[o](e,e.fail),r.apply(a,t)})}:a.simplecb?function $$wrapped$simplecb(){var t=n.call(arguments),a=checkThis(this,l);return e(function $$asq(e){t[o](e),r.apply(a,t)})}:void 0},e});
